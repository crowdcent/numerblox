
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../targets/">
      
      
        <link rel="next" href="../neutralization/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.4.8">
    
    
      
        <title>Meta Estimators - numerblox</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.4b4a2bd9.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.356b1318.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Ubuntu";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="005380">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#meta-estimators" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="numerblox" class="md-header__button md-logo" aria-label="numerblox" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19.5 9V1.5h-3V9h-3V1.5h-3V9h-3V1.5H4.65V9H3v1.5h18V9h-1.5m0 4.5h-3V21h-3v-7.5h-3V21h-3v-7.5H4.65V21H3v1.5h18V21h-1.5v-7.5Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            numerblox
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Meta Estimators
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href=".." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../end_to_end/" class="md-tabs__link">
        
  
    
  
  End-To-End Examples

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../download/" class="md-tabs__link">
        
  
    
  
  Downloaders

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../numerframe/" class="md-tabs__link">
        
  
    
  
  NumerFrame

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../preprocessing/" class="md-tabs__link">
        
  
    
  
  Preprocessing

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../targets/" class="md-tabs__link">
        
  
    
  
  Target Engineering

      </a>
    </li>
  

      
        
  
  
    
  
  
    <li class="md-tabs__item md-tabs__item--active">
      <a href="./" class="md-tabs__link">
        
  
    
  
  Meta Estimators

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../neutralization/" class="md-tabs__link">
        
  
    
  
  Feature Neutralization

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../penalization/" class="md-tabs__link">
        
  
    
  
  Feature Penalization

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../prediction_loaders/" class="md-tabs__link">
        
  
    
  
  Prediction Loaders

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../evaluation/" class="md-tabs__link">
        
  
    
  
  Evaluation

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../submission/" class="md-tabs__link">
        
  
    
  
  Submitters

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../contributing/" class="md-tabs__link">
        
  
    
  
  How To Contribute

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../crowdcent/" class="md-tabs__link">
        
  
    
  
  About CrowdCent

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../disclaimer/" class="md-tabs__link">
        
  
    
  
  Disclaimer

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../api/" class="md-tabs__link">
        
  
    
  
  API Reference

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="numerblox" class="md-nav__button md-logo" aria-label="numerblox" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19.5 9V1.5h-3V9h-3V1.5h-3V9h-3V1.5H4.65V9H3v1.5h18V9h-1.5m0 4.5h-3V21h-3v-7.5h-3V21h-3v-7.5H4.65V21H3v1.5h18V21h-1.5v-7.5Z"/></svg>

    </a>
    numerblox
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../end_to_end/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    End-To-End Examples
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../download/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Downloaders
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../numerframe/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    NumerFrame
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../preprocessing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Preprocessing
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../targets/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Target Engineering
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Meta Estimators
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Meta Estimators
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#crossvalestimator" class="md-nav__link">
    CrossValEstimator
  </a>
  
    <nav class="md-nav" aria-label="CrossValEstimator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#why-crossvalestimator" class="md-nav__link">
    Why CrossValEstimator?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example" class="md-nav__link">
    Example
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#metapipeline" class="md-nav__link">
    MetaPipeline
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#why-metapipeline" class="md-nav__link">
    Why MetaPipeline?
  </a>
  
    <nav class="md-nav" aria-label="Why MetaPipeline?">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example_1" class="md-nav__link">
    Example
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../neutralization/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Feature Neutralization
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../penalization/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Feature Penalization
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../prediction_loaders/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Prediction Loaders
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../evaluation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Evaluation
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../submission/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Submitters
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../contributing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    How To Contribute
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../crowdcent/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    About CrowdCent
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../disclaimer/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Disclaimer
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../api/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    API Reference
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#crossvalestimator" class="md-nav__link">
    CrossValEstimator
  </a>
  
    <nav class="md-nav" aria-label="CrossValEstimator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#why-crossvalestimator" class="md-nav__link">
    Why CrossValEstimator?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example" class="md-nav__link">
    Example
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#metapipeline" class="md-nav__link">
    MetaPipeline
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#why-metapipeline" class="md-nav__link">
    Why MetaPipeline?
  </a>
  
    <nav class="md-nav" aria-label="Why MetaPipeline?">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example_1" class="md-nav__link">
    Example
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="meta-estimators">Meta Estimators</h1>
<p>Meta estimator wrap existing scikit-learn estimators to provide additional functionality. Currently, the following meta estimators are available:</p>
<ul>
<li><a href="#crossvalestimator">CrossValEstimator</a></li>
<li><a href="#metapipeline">MetaPipeline</a></li>
</ul>
<h2 id="crossvalestimator">CrossValEstimator</h2>
<p><code>CrossValEstimator</code> provides a way to integrate cross-validation directly into model training, enabling simultaneous fitting of multiple models across data folds. By doing this, you can fit it as one transformer and get outputs for each fold during the prediction phase.</p>
<h3 id="why-crossvalestimator">Why CrossValEstimator?</h3>
<ul>
<li>
<p><strong>Holistic Training</strong>: Cross-validation offers a more robust model training process by leveraging multiple sub-sets of your data. This way, your model's performance is less susceptible to the peculiarities of any single data split.</p>
</li>
<li>
<p><strong>Inherent Ensemble</strong>: By training on multiple folds, you're essentially building an ensemble of models. Ensembles often outperform individual models since they average out biases, reduce variance, and are less likely to overfit.</p>
</li>
<li>
<p><strong>Custom Evaluation</strong>: With the <code>evaluation_func</code> parameter, you can input your custom evaluation logic, allowing for flexible and tailored performance assessment for each fold.</p>
</li>
<li>
<p><strong>Flexibility with Predictions</strong>: Choose between different prediction functions like 'predict', 'predict_proba', and 'predict_log_proba' using the <code>predict_func</code> parameter.</p>
</li>
<li>
<p><strong>Verbose Logging</strong>: Gain insights into the training process with detailed logs during the fitting phase, aiding in debugging and understanding model performance across folds.</p>
</li>
</ul>
<h3 id="example">Example</h3>
<pre><code class="language-py">from sklearn.model_selection import KFold
from xgboost import XGBRegressor

from numerblox.meta import CrossValEstimator

# Define the cross-validation strategy
cv = KFold(n_splits=5)

# Initialize the estimator
estimator = XGBRegressor(n_estimators=100, max_depth=3)

# (optional) Define a custom evaluation function
def custom_eval(y_true, y_pred):
    return {&quot;mse&quot;: ((y_true - y_pred) ** 2).mean()}

# Initialize the CrossValEstimator
cross_val_estimator = CrossValEstimator(cv=cv, 
                                        estimator=estimator,
                                        evaluation_func=custom_eval)

# Fit the CrossValEstimator
cross_val_estimator.fit(X_train, y_train)
predictions = cross_val_estimator.predict(X_test)
</code></pre>
<h2 id="metapipeline">MetaPipeline</h2>
<p>The <code>MetaPipeline</code> extends the functionality of scikit-learn's <code>Pipeline</code> by seamlessly integrating models and post-model transformations. It empowers you to employ sophisticated data transformation techniques not just before, but also after your model's predictions. This is particularly useful when post-processing predictions, such as neutralizing feature exposures in financial models.</p>
<h2 id="why-metapipeline">Why MetaPipeline?</h2>
<ul>
<li>
<p><strong>Post-Model Transformations</strong>: It can be crucial to apply transformations, like feature neutralization, after obtaining predictions. <code>MetaPipeline</code> facilitates such operations, leading to improved model generalization and stability.</p>
</li>
<li>
<p><strong>Streamlined Workflow</strong>: Instead of managing separate sequences for transformations and predictions, you can orchestrate them under a single umbrella, simplifying both development and production workflows.</p>
</li>
<li>
<p><strong>Flexible Integration</strong>: <code>MetaPipeline</code> gracefully handles a variety of objects, including <code>Pipeline</code>, <code>FeatureUnion</code>, and <code>ColumnTransformer</code>. This makes it a versatile tool adaptable to diverse tasks and data structures.</p>
</li>
</ul>
<h4 id="example_1">Example</h4>
<p>Consider a scenario where you have an <code>XGBRegressor</code> model and want to apply a <code>FeatureNeutralizer</code> after obtaining the model's predictions:</p>
<pre><code class="language-py">from xgboost import XGBRegressor
from numerblox.meta import MetaPipeline 
from numerblox.neutralizers import FeatureNeutralizer

# Define MetaPipeline steps
steps = [
    ('xgb_regressor', XGBRegressor(n_estimators=100, max_depth=3)),
    ('feature_neutralizer', FeatureNeutralizer(proportion=0.5))
]

# Create MetaPipeline
meta_pipeline = MetaPipeline(steps)

# Train and predict using MetaPipeline
meta_pipeline.fit(X_train, y_train)
predictions = meta_pipeline.predict(X_test)
</code></pre>
<p>For a more succinct creation of a <code>MetaPipeline</code>, you can use the <code>make_meta_pipeline</code> function:</p>
<pre><code class="language-py">from numerblox.meta import make_meta_pipeline

pipeline = make_meta_pipeline(XGBRegressor(n_estimators=100, max_depth=3),
                              FeatureNeutralizer(proportion=0.5))
</code></pre>





                
              </article>
            </div>
          
          
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.top", "navigation.tabs", "navigation.tracking", "navigation.tabs.sticky", "navigation.expand", "content.code.copy"], "search": "../assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.81fa17fe.min.js"></script>
      
    
  </body>
</html>