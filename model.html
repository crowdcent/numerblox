<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="Generating predictions for Numerai on preprocessed data.">

<title>numerblox - Model</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<script src="https://unpkg.com/@jupyter-widgets/html-manager@*/dist/embed-amd.js" crossorigin="anonymous"></script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="styles.css">
<meta property="og:title" content="numerblox - Model">
<meta property="og:description" content="Generating predictions for Numerai on preprocessed data.">
<meta property="og:site-name" content="numerblox">
<meta name="twitter:title" content="numerblox - Model">
<meta name="twitter:description" content="Generating predictions for Numerai on preprocessed data.">
<meta name="twitter:card" content="summary">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">numerblox</span>
    </a>
  </div>
        <div class="quarto-navbar-tools ms-auto">
</div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./model.html">Model</a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">NumerBlox</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./misc.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Misc</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./download.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Download</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./numerframe.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">NumerFrame</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./preprocessing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preprocessing</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./model.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Model</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./postprocessing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Postprocessing</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./modelpipeline.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ModelPipeline</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./evaluation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Evaluation</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./key.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Key</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./submission.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Submission</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#base" id="toc-base" class="nav-link active" data-scroll-target="#base">0. Base</a>
  <ul class="collapse">
  <li><a href="#basemodel" id="toc-basemodel" class="nav-link" data-scroll-target="#basemodel">0.1. BaseModel</a></li>
  <li><a href="#basemodel-1" id="toc-basemodel-1" class="nav-link" data-scroll-target="#basemodel-1">BaseModel</a></li>
  <li><a href="#directorymodel" id="toc-directorymodel" class="nav-link" data-scroll-target="#directorymodel">0.2. DirectoryModel</a></li>
  <li><a href="#directorymodel-1" id="toc-directorymodel-1" class="nav-link" data-scroll-target="#directorymodel-1">DirectoryModel</a></li>
  </ul></li>
  <li><a href="#single-model-formats" id="toc-single-model-formats" class="nav-link" data-scroll-target="#single-model-formats">1. Single model formats</a>
  <ul class="collapse">
  <li><a href="#singlemodel" id="toc-singlemodel" class="nav-link" data-scroll-target="#singlemodel">1.1. SingleModel</a></li>
  <li><a href="#singlemodel-1" id="toc-singlemodel-1" class="nav-link" data-scroll-target="#singlemodel-1">SingleModel</a></li>
  <li><a href="#wandbkerasmodel" id="toc-wandbkerasmodel" class="nav-link" data-scroll-target="#wandbkerasmodel">1.2. WandbKerasModel</a></li>
  <li><a href="#wandbkerasmodel-1" id="toc-wandbkerasmodel-1" class="nav-link" data-scroll-target="#wandbkerasmodel-1">WandbKerasModel</a></li>
  <li><a href="#csvsub" id="toc-csvsub" class="nav-link" data-scroll-target="#csvsub">1.3. CSVSub</a></li>
  <li><a href="#externalcsvs" id="toc-externalcsvs" class="nav-link" data-scroll-target="#externalcsvs">ExternalCSVs</a></li>
  <li><a href="#numerbay" id="toc-numerbay" class="nav-link" data-scroll-target="#numerbay">1.4. NumerBay</a></li>
  <li><a href="#numerbaycsvs" id="toc-numerbaycsvs" class="nav-link" data-scroll-target="#numerbaycsvs">NumerBayCSVs</a></li>
  </ul></li>
  <li><a href="#loading-all-models-in-directory" id="toc-loading-all-models-in-directory" class="nav-link" data-scroll-target="#loading-all-models-in-directory">2. Loading all models in directory</a>
  <ul class="collapse">
  <li><a href="#joblib-directory" id="toc-joblib-directory" class="nav-link" data-scroll-target="#joblib-directory">2.1. Joblib directory</a></li>
  <li><a href="#joblibmodel" id="toc-joblibmodel" class="nav-link" data-scroll-target="#joblibmodel">JoblibModel</a></li>
  <li><a href="#catboost-directory-.cbm" id="toc-catboost-directory-.cbm" class="nav-link" data-scroll-target="#catboost-directory-.cbm">2.2. Catboost directory (.cbm)</a></li>
  <li><a href="#catboostmodel" id="toc-catboostmodel" class="nav-link" data-scroll-target="#catboostmodel">CatBoostModel</a></li>
  <li><a href="#lightgbm-directory-.lgb" id="toc-lightgbm-directory-.lgb" class="nav-link" data-scroll-target="#lightgbm-directory-.lgb">2.3. LightGBM directory (.lgb)</a></li>
  <li><a href="#lgbmmodel" id="toc-lgbmmodel" class="nav-link" data-scroll-target="#lgbmmodel">LGBMModel</a></li>
  </ul></li>
  <li><a href="#baseline-models" id="toc-baseline-models" class="nav-link" data-scroll-target="#baseline-models">3. Baseline models</a>
  <ul class="collapse">
  <li><a href="#constantmodel" id="toc-constantmodel" class="nav-link" data-scroll-target="#constantmodel">3.1. ConstantModel</a></li>
  <li><a href="#constantmodel-1" id="toc-constantmodel-1" class="nav-link" data-scroll-target="#constantmodel-1">ConstantModel</a></li>
  <li><a href="#randommodel" id="toc-randommodel" class="nav-link" data-scroll-target="#randommodel">3.2. RandomModel</a></li>
  <li><a href="#randommodel-1" id="toc-randommodel-1" class="nav-link" data-scroll-target="#randommodel-1">RandomModel</a></li>
  <li><a href="#example-validation-predictions" id="toc-example-validation-predictions" class="nav-link" data-scroll-target="#example-validation-predictions">3.3. Example (validation) predictions</a></li>
  <li><a href="#examplepredictionsmodel" id="toc-examplepredictionsmodel" class="nav-link" data-scroll-target="#examplepredictionsmodel">ExamplePredictionsModel</a></li>
  </ul></li>
  <li><a href="#custom-model" id="toc-custom-model" class="nav-link" data-scroll-target="#custom-model">4. Custom Model</a>
  <ul class="collapse">
  <li><a href="#from-basemodel" id="toc-from-basemodel" class="nav-link" data-scroll-target="#from-basemodel">4.1. From BaseModel</a></li>
  <li><a href="#awesomemodel" id="toc-awesomemodel" class="nav-link" data-scroll-target="#awesomemodel">AwesomeModel</a></li>
  <li><a href="#from-directorymodel" id="toc-from-directorymodel" class="nav-link" data-scroll-target="#from-directorymodel">4.2. From DirectoryModel</a></li>
  <li><a href="#awesomedirectorymodel" id="toc-awesomedirectorymodel" class="nav-link" data-scroll-target="#awesomedirectorymodel">AwesomeDirectoryModel</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/crowdcent/numerblox/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Model</h1>
</div>

<div>
  <div class="description">
    Generating predictions for Numerai on preprocessed data.
  </div>
</div>


<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->
<section id="base" class="level2">
<h2 class="anchored" data-anchor-id="base">0. Base</h2>
<section id="basemodel" class="level3">
<h3 class="anchored" data-anchor-id="basemodel">0.1. BaseModel</h3>
<p>The <a href="https://crowdcent.github.io/numerblox/model.html#basemodel"><code>BaseModel</code></a> is an abstract base class that handles directory logic and naming conventions. All models should inherit from <a href="https://crowdcent.github.io/numerblox/model.html#basemodel"><code>BaseModel</code></a> and be sure to implement the <code>.predict</code> method.</p>
<p>In general, models are loaded in from disk. However, if no model files are involved in your model you should pass an empty string (<code>""</code>) as the <code>model_directory</code> argument.</p>
<p>Note that a new prediction column will have the column name <code>prediction_{MODEL_NAME}</code>.</p>
<hr>
<p><a href="https://github.com/crowdcent/numerblox/blob/master/numerblox/model.py#L33" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="basemodel-1" class="level3">
<h3 class="anchored" data-anchor-id="basemodel-1">BaseModel</h3>
<blockquote class="blockquote">
<pre><code> BaseModel (model_directory:str, model_name:str=None)</code></pre>
</blockquote>
<p>Setup for model prediction on a Dataset.</p>
<p>:param model_directory: Main directory from which to read in models.</p>
<p>:param model_name: Name that will be used to create column names and for display purposes.</p>
</section>
<section id="directorymodel" class="level3">
<h3 class="anchored" data-anchor-id="directorymodel">0.2. DirectoryModel</h3>
<p>A <a href="https://crowdcent.github.io/numerblox/model.html#directorymodel"><code>DirectoryModel</code></a> assumes that you have a directory of models and you want to load + predict for all models with a certain <code>file_suffix</code> (for example, <code>.joblib</code>, <code>.cbm</code> or <code>.lgb</code>). This base class handles prediction logic for this situation.</p>
<p>If you are thinking of implementing your own model and your use case involves reading multiple models from a directory, then you should inherit from <a href="https://crowdcent.github.io/numerblox/model.html#directorymodel"><code>DirectoryModel</code></a> and be sure to implement <code>.load_models</code>. You then don’t have to implement any prediction logic in the <code>.predict</code> method.</p>
<p>When inheriting from <a href="https://crowdcent.github.io/numerblox/model.html#directorymodel"><code>DirectoryModel</code></a> the only mandatory method implementation is for <code>.load_models</code>. It should instantiate all models and return them as a <code>list</code>.</p>
<hr>
<p><a href="https://github.com/crowdcent/numerblox/blob/master/numerblox/model.py#L66" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="directorymodel-1" class="level3">
<h3 class="anchored" data-anchor-id="directorymodel-1">DirectoryModel</h3>
<blockquote class="blockquote">
<pre><code> DirectoryModel (model_directory:str, file_suffix:str,
                 model_name:str=None, feature_cols:list=None,
                 combine_preds=True)</code></pre>
</blockquote>
<p>Base class implementation where predictions are averaged out from a directory of models. Walks through every file with given file_suffix in a directory.</p>
<p>:param model_directory: Main directory from which to read in models.</p>
<p>:param file_suffix: File format to load (For example, .joblib, .pkl, .cbm or .lgb)</p>
<p>:param model_name: Name that will be used to create column names and for display purposes.</p>
<p>:param feature_cols: optional list of features to use for prediction. Selects all feature columns (i.e.&nbsp;column names with prefix ‘feature’) by default.</p>
<p>:param combine_preds: Whether to average predictions along column axis. Only relevant for multi target models.</p>
<p>Convenient when you want to predict the main target by averaging a multi-target model.</p>
</section>
</section>
<section id="single-model-formats" class="level2">
<h2 class="anchored" data-anchor-id="single-model-formats">1. Single model formats</h2>
<p>Implementations for common Numerai model prediction situations.</p>
<section id="singlemodel" class="level3">
<h3 class="anchored" data-anchor-id="singlemodel">1.1. SingleModel</h3>
<p>In many cases you just want to load a single model file and create predictions for that model. <a href="https://crowdcent.github.io/numerblox/model.html#singlemodel"><code>SingleModel</code></a> supports this.</p>
<p>This class supports multiple model formats for easy use. All models should have a <code>.predict</code> method. Currently, <code>.joblib</code>, <code>.cbm</code>, <code>.pkl</code>, <code>.pickle</code> and <code>.h5</code> (keras) format are supported.</p>
<p><strong>Things to keep in mind</strong> - This model will use all available features in the <a href="https://crowdcent.github.io/numerblox/numerframe.html#numerframe"><code>NumerFrame</code></a> and use them for prediction by default. Define <code>feature_cols</code> in <a href="https://crowdcent.github.io/numerblox/model.html#singlemodel"><code>SingleModel</code></a> or implement a <a href="https://crowdcent.github.io/numerblox/preprocessing.html#featureselectionpreprocessor"><code>FeatureSelectionPreProcessor</code></a> as part of your <a href="https://crowdcent.github.io/numerblox/modelpipeline.html#modelpipeline"><code>ModelPipeline</code></a> if you are using a subset of features. - If you have XGBoost models we recommend saving them as <code>.joblib</code>. - The added prediction column will have the column name <code>prediction_{MODEL_NAME}</code> if 1 target is predicted. For multiple targets the new column names will be <code>prediction_{MODEL_NAME}_{i}</code> for each target number i (starting with 0). - We welcome the Numerai community to extend <a href="https://crowdcent.github.io/numerblox/model.html#singlemodel"><code>SingleModel</code></a> for more file formats. See the Contributing section in <code>README.md</code> for more information on contributing.</p>
<hr>
<p><a href="https://github.com/crowdcent/numerblox/blob/master/numerblox/model.py#L120" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="singlemodel-1" class="level3">
<h3 class="anchored" data-anchor-id="singlemodel-1">SingleModel</h3>
<blockquote class="blockquote">
<pre><code> SingleModel (model_file_path:str, model_name:str=None,
              combine_preds=False, autoencoder_mlp=False,
              feature_cols:list=None)</code></pre>
</blockquote>
<p>Load single model from file and perform prediction logic.</p>
<p>:param model_file_path: Full path to model file.</p>
<p>Support loading directly from GCS if path starts with ‘gs://’.</p>
<p>:param model_name: Name that will be used to create column names and for display purposes.</p>
<p>:param combine_preds: Whether to average predictions along column axis. Only relevant for multi target models. Convenient when you want to predict the main target by averaging a multi-target model.</p>
<p>:param autoencoder_mlp: Whether your model is an autoencoder + MLP model. Will take the 3rd of tuple output in this case. Only relevant for NN models. More info on autoencoders: https://forum.numer.ai/t/autoencoder-and-multitask-mlp-on-new-dataset-from-kaggle-jane-street/4338</p>
<p>:param feature_cols: optional list of features to use for prediction. Selects all feature columns (i.e.&nbsp;column names with prefix ‘feature’) by default.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>dataf <span class="op">=</span> create_numerframe(<span class="st">"test_assets/mini_numerai_version_2_data.parquet"</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>test_paths <span class="op">=</span> [<span class="st">"test_assets/joblib_v2_example_model.joblib"</span>]</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> path <span class="kw">in</span> test_paths:</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> SingleModel(path, model_name<span class="op">=</span><span class="st">"test"</span>)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(model.predict(dataf).get_prediction_data.head(<span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>2023-09-20 18:31:08.629005: I tensorflow/tsl/cuda/cudart_stub.cc:28] Could not find cuda drivers on your machine, GPU will not be used.
2023-09-20 18:31:08.698026: I tensorflow/tsl/cuda/cudart_stub.cc:28] Could not find cuda drivers on your machine, GPU will not be used.
2023-09-20 18:31:08.699488: I tensorflow/core/platform/cpu_feature_guard.cc:182] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
2023-09-20 18:31:09.914738: W tensorflow/compiler/tf2tensorrt/utils/py_utils.cc:38] TF-TRT Warning: Could not find TensorRT</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>                  prediction_test
id                               
n559bd06a8861222         0.506948
n9d39dea58c9e3cf         0.492578</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> SingleModel(test_paths[<span class="dv">0</span>], model_name<span class="op">=</span><span class="st">"test"</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>model.suffix_to_model_mapping</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>{'.joblib': &lt;function joblib.numpy_pickle.load(filename, mmap_mode=None)&gt;,
 '.cbm': &lt;bound method CatBoost.load_model of &lt;catboost.core.CatBoost object&gt;&gt;,
 '.pkl': &lt;function _pickle.load(file, *, fix_imports=True, encoding='ASCII', errors='strict', buffers=())&gt;,
 '.pickle': &lt;function _pickle.load(file, *, fix_imports=True, encoding='ASCII', errors='strict', buffers=())&gt;,
 '.h5': functools.partial(&lt;function load_model&gt;, compile=False)}</code></pre>
</div>
</div>
<p>You can also load directly from GCS if the path is prefixed by <code>gs://</code>. For example, <code>gs://my_bucket_name/my_model.joblib</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># my_model_path = "gs://my_bucket_name/my_model.joblib"</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="co"># model = SingleModel(my_model_path, model_name="test")</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="co"># df = create_numerframe("test_assets/train_int8_5_eras.parquet")</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co"># preds = model.predict(df.get_feature_data).get_prediction_data</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="wandbkerasmodel" class="level3">
<h3 class="anchored" data-anchor-id="wandbkerasmodel">1.2. WandbKerasModel</h3>
<p>This model is for a specific case. Namely, if you are logging Keras model using <a href="https://wandb.ai/site">Weights &amp; Biases</a> and want to download the best model for a specific run. <a href="https://crowdcent.github.io/numerblox/model.html#wandbkerasmodel"><code>WandbKerasModel</code></a> wraps <a href="https://crowdcent.github.io/numerblox/model.html#singlemodel"><code>SingleModel</code></a> and only adds additional logic for downloading models from Weights &amp; Biases.</p>
<p>To authenticate your W&amp;B account you are given several options: 1. Run <code>wandb login</code> in terminal and follow instructions (<a href="https://docs.wandb.ai/ref/cli/wandb-login">docs</a>). 2. Configure <a href="https://docs.wandb.ai/guides/track/advanced/environment-variables">global environment variable</a> <code>"WANDB_API_KEY"</code>. 3. Run <code>wandb.init(project=PROJECT_NAME, entity=ENTITY_NAME)</code> and pass API key from <a href="https://wandb.ai/authorize">https://wandb.ai/authorize</a>.</p>
<hr>
<p><a href="https://github.com/crowdcent/numerblox/blob/master/numerblox/model.py#L205" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="wandbkerasmodel-1" class="level3">
<h3 class="anchored" data-anchor-id="wandbkerasmodel-1">WandbKerasModel</h3>
<blockquote class="blockquote">
<pre><code> WandbKerasModel (run_path:str, file_name:str='model-best.h5',
                  combine_preds=False, autoencoder_mlp=False,
                  replace=False, feature_cols:list=None)</code></pre>
</blockquote>
<p>Download best .h5 model from Weights &amp; Biases (W&amp;B) run in local directory and make predictions. More info on W&amp;B: https://wandb.ai/site</p>
<p>:param run_path: W&amp;B path structured as entity/project/run_id. Can be copied from the Overview tab of a W&amp;B run. For more info: https://docs.wandb.ai/ref/app/pages/run-page#overview-tab</p>
<p>:param file_name: Name of .h5 file as saved in W&amp;B run. ‘model-best.h5’ by default. File name can be found under files tab of W&amp;B run.</p>
<p>:param combine_preds: Whether to average predictions along column axis. Convenient when you want to predict the main target by averaging a multi-target model.</p>
<p>:param autoencoder_mlp: Whether your model is an autoencoder + MLP model. Will take the 3rd of tuple output in this case. Only relevant for NN models.</p>
<p>More info on autoencoders: https://forum.numer.ai/t/autoencoder-and-multitask-mlp-on-new-dataset-from-kaggle-jane-street/4338</p>
<p>:param replace: Replace any model files saved under the same file name with downloaded W&amp;B run model. WARNING: Setting to True may overwrite models in your local environment.</p>
<p>:param feature_cols: optional list of features to use for prediction. Selects all feature columns (i.e.&nbsp;column names with prefix ‘feature’) by default.</p>
</section>
<section id="csvsub" class="level3">
<h3 class="anchored" data-anchor-id="csvsub">1.3. CSVSub</h3>
<p>This model is a wrapper for if you want to add predictions from external CSVs in a directory.</p>
<hr>
<p><a href="https://github.com/crowdcent/numerblox/blob/master/numerblox/model.py#L261" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="externalcsvs" class="level3">
<h3 class="anchored" data-anchor-id="externalcsvs">ExternalCSVs</h3>
<blockquote class="blockquote">
<pre><code> ExternalCSVs (data_directory:str='external_submissions')</code></pre>
</blockquote>
<p>Load external submissions and add to NumerFrame.</p>
<p>All csv files in this directory will be added to NumerFrame. Make sure all external predictions are prepared and ready for submission. i.e.&nbsp;IDs lining up and one column named ‘prediction’.</p>
<p>:param data_directory: Directory path for retrieving external submission.</p>
<p>For testing, the <code>external_submissions</code> directory contains <code>test_predictions.csv</code> with values from feature <code>target_thomas_20</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>dataf <span class="op">=</span> create_numerframe(<span class="st">"test_assets/mini_numerai_version_2_data.parquet"</span>)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>external <span class="op">=</span> ExternalCSVs(data_directory<span class="op">=</span><span class="st">"test_assets/external_submissions"</span>)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>new_dataf <span class="op">=</span> external.predict(dataf)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>new_dataf.get_prediction_data.head(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"51aabfddeff4480280e5050a53890deb","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">prediction_test_predictions.csv</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">id</th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">n559bd06a8861222</td>
<td>0.333333</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">n9d39dea58c9e3cf</td>
<td>0.500000</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>If no submissions are found in the given <code>data_directory</code> you should recieve a warning.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>ExternalCSVs(data_directory<span class="op">=</span><span class="st">"Some_nonexisting_directory_12354321"</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">⚠ WARNING: No csvs found in directory <span style="color: #008000; text-decoration-color: #008000">'Some_nonexisting_directory_12354321'</span>. ⚠
</pre>
</div>
</div>
</section>
<section id="numerbay" class="level3">
<h3 class="anchored" data-anchor-id="numerbay">1.4. NumerBay</h3>
<p>This model is a wrapper for if you want to add predictions from NumerBay purchases.</p>
<p>Currently only Numerai Classic submissions are supported. Numerai Signals will be supported in a future version.</p>
<hr>
<p><a href="https://github.com/crowdcent/numerblox/blob/master/numerblox/model.py#L288" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="numerbaycsvs" class="level3">
<h3 class="anchored" data-anchor-id="numerbaycsvs">NumerBayCSVs</h3>
<blockquote class="blockquote">
<pre><code> NumerBayCSVs (data_directory:str='numerbay_submissions',
               numerbay_product_full_names:list=None,
               numerbay_username:str=None, numerbay_password:str=None,
               numerbay_key_path:str=None,
               ticker_col:str='bloomberg_ticker')</code></pre>
</blockquote>
<p>Load NumerBay submissions and add to NumerFrame.</p>
<p>Make sure to provide correct NumerBay credentials and that your purchases have been confirmed and artifacts are available for download.</p>
<p>:param data_directory: Directory path for caching submission. Files not already present in the directory will be downloaded from NumerBay. :param numerbay_product_full_names: List of product full names (in the format of [category]-[product name]) to download from NumerBay. E.g. [‘numerai-predictions-numerbay’] :param numerbay_username: NumerBay username :param numerbay_password: NumerBay password :param numerbay_key_path: NumerBay encryption key json file path (exported from the profile page)</p>
<p>Example usage</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># nb_model = NumerBayCSVs(data_directory='/app/notebooks/tmp',</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="co">#                         numerbay_product_full_names=['numerai-predictions-someproduct'],</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="co">#                         numerbay_username="myusername",</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co">#                         numerbay_password="mypassword",</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="co">#                         numerbay_key_path="/app/notebooks/tmp/numerbay.json")</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="co"># preds = nb_model.predict(dataf)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="loading-all-models-in-directory" class="level2">
<h2 class="anchored" data-anchor-id="loading-all-models-in-directory">2. Loading all models in directory</h2>
<section id="joblib-directory" class="level3">
<h3 class="anchored" data-anchor-id="joblib-directory">2.1. Joblib directory</h3>
<p>Many models, like <code>scikit-learn</code>, can conveniently be saved as <code>.joblib</code> files. This class automatically loads all <code>.joblib</code> files in a given folder and generates (averaged out) predictions.</p>
<hr>
<p><a href="https://github.com/crowdcent/numerblox/blob/master/numerblox/model.py#L376" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="joblibmodel" class="level3">
<h3 class="anchored" data-anchor-id="joblibmodel">JoblibModel</h3>
<blockquote class="blockquote">
<pre><code> JoblibModel (model_directory:str, model_name:str=None,
              feature_cols:list=None)</code></pre>
</blockquote>
<p>Load and predict for arbitrary models in directory saved as .joblib.</p>
<p>All loaded models should have a .predict method and accept the features present in the data.</p>
<p>:param model_directory: Main directory from which to read in models.</p>
<p>:param model_name: Name that will be used to create column names and for display purposes.</p>
<p>:param feature_cols: optional list of features to use for prediction. Selects all feature columns (i.e.&nbsp;column names with prefix ‘feature’) by default.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>dataf <span class="op">=</span> create_numerframe(<span class="st">"test_assets/mini_numerai_version_2_data.parquet"</span>)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> JoblibModel(<span class="st">"test_assets"</span>, model_name<span class="op">=</span><span class="st">"Joblib_LGB"</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>predictions <span class="op">=</span> model.predict(dataf).get_prediction_data</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> predictions[<span class="st">'prediction_Joblib_LGB'</span>].between(<span class="dv">0</span>, <span class="dv">1</span>).<span class="bu">all</span>()</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>predictions.head(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"4092e673c45b4089a499723fad759435","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">✅ Finished step <span style="font-weight: bold">DirectoryModel</span>. Output <span style="color: #808000; text-decoration-color: #808000">shape</span>=<span style="font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">10</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1074</span><span style="font-weight: bold">)</span>. Time taken for step: <span style="color: #000080; text-decoration-color: #000080; font-weight: bold">0:00:00</span><span style="color: #000080; text-decoration-color: #000080">.</span><span style="color: #000080; text-decoration-color: #000080; font-weight: bold">376394</span>. ✅
</pre>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">prediction_Joblib_LGB</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">id</th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">n559bd06a8861222</td>
<td>0.506948</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">n9d39dea58c9e3cf</td>
<td>0.492578</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="catboost-directory-.cbm" class="level3">
<h3 class="anchored" data-anchor-id="catboost-directory-.cbm">2.2. Catboost directory (.cbm)</h3>
<p>This model setup loads all <code>CatBoost</code> (<code>.cbm</code>) models present in a given directory and makes (averaged out) predictions.</p>
<hr>
<p><a href="https://github.com/crowdcent/numerblox/blob/master/numerblox/model.py#L402" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="catboostmodel" class="level3">
<h3 class="anchored" data-anchor-id="catboostmodel">CatBoostModel</h3>
<blockquote class="blockquote">
<pre><code> CatBoostModel (model_directory:str, model_name:str=None,
                feature_cols:list=None)</code></pre>
</blockquote>
<p>Load and predict with all .cbm models (CatBoostRegressor) in directory.</p>
<p>:param model_directory: Main directory from which to read in models.</p>
<p>:param model_name: Name that will be used to define column names and for display purposes.</p>
<p>:param feature_cols: optional list of features to use for prediction. Selects all feature columns (i.e.&nbsp;column names with prefix ‘feature’) by default.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Example on NumerFrame</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="co"># !pip install catboost</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="co"># dataf = create_numerframe("test_assets/mini_numerai_version_2_data.parquet")</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="co"># model = CatBoostModel("test_assets", model_name="CB")</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="co"># predictions = model.predict(dataf).get_prediction_data</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="co"># assert predictions['prediction_CB'].between(0, 1).all()</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="co"># predictions.head(2)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="lightgbm-directory-.lgb" class="level3">
<h3 class="anchored" data-anchor-id="lightgbm-directory-.lgb">2.3. LightGBM directory (.lgb)</h3>
<p>This model setup loads all <code>LightGBM</code> (<code>.lgb</code>) models present in a given directory and makes (averaged out) predictions.</p>
<hr>
<p><a href="https://github.com/crowdcent/numerblox/blob/master/numerblox/model.py#L427" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="lgbmmodel" class="level3">
<h3 class="anchored" data-anchor-id="lgbmmodel">LGBMModel</h3>
<blockquote class="blockquote">
<pre><code> LGBMModel (model_directory:str, model_name:str=None,
            feature_cols:list=None)</code></pre>
</blockquote>
<p>Load and predict with all .lgb models (LightGBM) in directory.</p>
<p>:param model_directory: Main directory from which to read in models.</p>
<p>:param model_name: Name that will be used to define column names and for display purposes.</p>
<p>:param feature_cols: optional list of features to use for prediction. Selects all feature columns (i.e.&nbsp;column names with prefix ‘feature’) by default.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Example on NumerFrame</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="co"># !pip install lightgbm</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="co"># dataf = create_numerframe("test_assets/mini_numerai_version_2_data.parquet")</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="co"># model = LGBMModel("test_assets", model_name="LGB")</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="co"># predictions = model.predict(dataf).get_prediction_data</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="co"># assert predictions['prediction_LGB'].between(0, 1).all()</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="co"># predictions.head(2)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="baseline-models" class="level2">
<h2 class="anchored" data-anchor-id="baseline-models">3. Baseline models</h2>
<p>Setting a baseline is always an important step for data science problems. This section introduces models that should only be used a baselines.</p>
<section id="constantmodel" class="level3">
<h3 class="anchored" data-anchor-id="constantmodel">3.1. ConstantModel</h3>
<p>This model simply outputs a constant of your choice. Convenient for setting classification baselines.</p>
<hr>
<p><a href="https://github.com/crowdcent/numerblox/blob/master/numerblox/model.py#L452" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="constantmodel-1" class="level3">
<h3 class="anchored" data-anchor-id="constantmodel-1">ConstantModel</h3>
<blockquote class="blockquote">
<pre><code> ConstantModel (constant:float=0.5, model_name:str=None)</code></pre>
</blockquote>
<p>WARNING: Only use this Model for testing purposes.</p>
<p>Create constant prediction.</p>
<p>:param constant: Value for constant prediction.</p>
<p>:param model_name: Name that will be used to create column names and for display purposes.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>constant <span class="op">=</span> <span class="fl">0.85</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>dataf <span class="op">=</span> create_numerframe(<span class="st">"test_assets/mini_numerai_version_2_data.parquet"</span>)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>constant_model <span class="op">=</span> ConstantModel(constant<span class="op">=</span>constant)</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>predictions <span class="op">=</span> constant_model.predict(dataf).get_prediction_data</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> (predictions.to_numpy() <span class="op">==</span> constant).<span class="bu">all</span>()</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>predictions.head(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">prediction_constant_0.85</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">id</th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">n559bd06a8861222</td>
<td>0.85</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">n9d39dea58c9e3cf</td>
<td>0.85</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="randommodel" class="level3">
<h3 class="anchored" data-anchor-id="randommodel">3.2. RandomModel</h3>
<p>This model returns uniformly distributed predictions in range <span class="math inline">\([0...1)\)</span>. Solid naive baseline for regression models.</p>
<hr>
<p><a href="https://github.com/crowdcent/numerblox/blob/master/numerblox/model.py#L473" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="randommodel-1" class="level3">
<h3 class="anchored" data-anchor-id="randommodel-1">RandomModel</h3>
<blockquote class="blockquote">
<pre><code> RandomModel (model_name:str=None)</code></pre>
</blockquote>
<p>WARNING: Only use this Model for testing purposes.</p>
<p>Create uniformly distributed predictions.</p>
<p>:param model_name: Name that will be used to create column names and for display purposes.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>dataf <span class="op">=</span> create_numerframe(<span class="st">"test_assets/mini_numerai_version_2_data.parquet"</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>random_model <span class="op">=</span> RandomModel()</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>predictions <span class="op">=</span> random_model.predict(dataf).get_prediction_data</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> predictions[<span class="st">'prediction_random'</span>].between(<span class="dv">0</span>, <span class="dv">1</span>).<span class="bu">all</span>()</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>predictions.head(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">prediction_random</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">id</th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">n559bd06a8861222</td>
<td>0.478581</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">n9d39dea58c9e3cf</td>
<td>0.600459</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="example-validation-predictions" class="level3">
<h3 class="anchored" data-anchor-id="example-validation-predictions">3.3. Example (validation) predictions</h3>
<p>This Model performs downloading and adding of example predictions for Numerai Classic. Convenient when you are constructing a <a href="https://crowdcent.github.io/numerblox/modelpipeline.html#modelpipeline"><code>ModelPipeline</code></a> and want to include example predictions.</p>
<hr>
<p><a href="https://github.com/crowdcent/numerblox/blob/master/numerblox/model.py#L491" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="examplepredictionsmodel" class="level3">
<h3 class="anchored" data-anchor-id="examplepredictionsmodel">ExamplePredictionsModel</h3>
<blockquote class="blockquote">
<pre><code> ExamplePredictionsModel
                          (file_name:str='v4.2/validation_example_preds.pa
                          rquet',
                          data_directory:str='example_predictions_model',
                          round_num:int=None)</code></pre>
</blockquote>
<p>Load example predictions and add to NumerFrame.</p>
<p>:param file_name: File to download from NumerAPI. By default this is example predictions for v4.2 data. Other example of example predictions in previous version: - v4.1. -&gt; “v4.1/validation_example_preds.parquet” - v4. -&gt; “v4/validation_example_preds.parquet” ‘example_validation_predictions.parquet’ by default.</p>
<p>:param data_directory: Directory path to download example predictions to or directory where example data already exists.</p>
<p>:param round_num: Optional round number. Downloads most recent round by default.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># # Download validation data</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="co"># downloader = NumeraiClassicDownloader("example_predictions_model")</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="co"># val_file = "v4.2/validation_int8.parquet"</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># val_save_path = f"{str(downloader.dir)}/{val_file}"</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="co"># downloader.download_single_dataset(filename=val_file,</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="co">#                                    dest_path=val_save_path)</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a><span class="co"># # Load validation data and add example predictions</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a><span class="co"># dataf = create_numerframe(val_save_path)</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a><span class="co"># example_model = ExamplePredictionsModel()</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a><span class="co"># predictions = example_model.predict(dataf).get_prediction_data</span></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a><span class="co"># assert predictions['prediction_example'].between(0, 1).all()</span></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a><span class="co"># predictions.head(2)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="custom-model" class="level2">
<h2 class="anchored" data-anchor-id="custom-model">4. Custom Model</h2>
<p>There are two different ways to implement new models. Both have their own conveniences and use cases.</p>
<p><strong>4.1.</strong> Inherit from <a href="https://crowdcent.github.io/numerblox/model.html#basemodel"><code>BaseModel</code></a> (custom prediction logic).</p>
<p><strong>4.2.</strong> Inherit from <a href="https://crowdcent.github.io/numerblox/model.html#directorymodel"><code>DirectoryModel</code></a> (make predictions for all models in directory with given file suffix. Prediction logic will already be implemented. Only implement model loading logic).</p>
<p><strong>4.1. (From BaseModel)</strong> works well when you have no or only a single file that you use for generating predictions.</p>
<p>Examples: 1. Loading a model is not relevant or your model is already loaded in memory. 2. You would like predictions for one model loaded from disk. 3. The object you are loading already aggregates multiple models and transformation steps (such as <a href="https://scikit-learn.org/stable/modules/generated/sklearn.pipeline.FeatureUnion.html">scikit-learn FeatureUnion</a>).</p>
<p><strong>4.2. (From DirectoryModel)</strong> is convenient when you have a lot of similar models in a directory and want to generate predictions for all of them.</p>
<p>Examples: 1. You have multiple similar models saved through a cross validation process. 2. You have a bagging strategy where a lot of models trained on slightly different data or with different initializations should are averaged.</p>
<section id="from-basemodel" class="level3">
<h3 class="anchored" data-anchor-id="from-basemodel">4.1. From BaseModel</h3>
<p>Arbitrary models can be instantiated and used for prediction generation by inheriting from <a href="https://crowdcent.github.io/numerblox/model.html#basemodel"><code>BaseModel</code></a>. Arbitrary logic (model loading, prediction, etc.) can be defined in <code>.predict</code> as long as the method takes a <a href="https://crowdcent.github.io/numerblox/numerframe.html#numerframe"><code>NumerFrame</code></a> as input and outputs a <a href="https://crowdcent.github.io/numerblox/numerframe.html#numerframe"><code>NumerFrame</code></a>.</p>
<p>For clear console output we recommend adding the <code>@display_processor_info</code> decorator to the <code>.predict</code> method.</p>
<p>If your model does not involve reading files from disk specify <code>model_directory=""</code>.</p>
<hr>
<p><a href="https://github.com/crowdcent/numerblox/blob/master/numerblox/model.py#L533" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="awesomemodel" class="level3">
<h3 class="anchored" data-anchor-id="awesomemodel">AwesomeModel</h3>
<blockquote class="blockquote">
<pre><code> AwesomeModel (model_directory:str, model_name:str=None,
               feature_cols:list=None)</code></pre>
</blockquote>
<p>TEMPLATE - Predict with arbitrary prediction logic and model formats.</p>
<p>:param model_directory: Main directory from which to read in models.</p>
<p>:param model_name: Name that will be used to define column names and for display purposes.</p>
<p>:param feature_cols: optional list of features to use for prediction. Selects all feature columns (i.e.&nbsp;column names with prefix ‘feature’) by default.</p>
</section>
<section id="from-directorymodel" class="level3">
<h3 class="anchored" data-anchor-id="from-directorymodel">4.2. From DirectoryModel</h3>
<p>You may want to implement a setup similar to <a href="https://crowdcent.github.io/numerblox/model.html#joblibmodel"><code>JoblibModel</code></a> and <a href="https://crowdcent.github.io/numerblox/model.html#catboostmodel"><code>CatBoostModel</code></a>. Namely, load in all models of a certain type from a directory, predict for all and take the average. If this is your use case, inherit from <a href="https://crowdcent.github.io/numerblox/model.html#directorymodel"><code>DirectoryModel</code></a> and be sure to implement the <code>.load_models</code> method.</p>
<p>For a <a href="https://crowdcent.github.io/numerblox/model.html#directorymodel"><code>DirectoryModel</code></a> you should specify a <code>file_suffix</code> (like <code>.joblib</code> or <code>.cbm</code>) which will be used to store all available models in <code>self.model_paths</code>.</p>
<p>The <code>.predict</code> method will in this case already be implemented, but can be overridden if the prediction logic is more complex. For example, if you want to apply weighted averaging or a geometric mean for models within a given directory.</p>
<hr>
<p><a href="https://github.com/crowdcent/numerblox/blob/master/numerblox/model.py#L560" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="awesomedirectorymodel" class="level3">
<h3 class="anchored" data-anchor-id="awesomedirectorymodel">AwesomeDirectoryModel</h3>
<blockquote class="blockquote">
<pre><code> AwesomeDirectoryModel (model_directory:str, model_name:str=None,
                        feature_cols:list=None)</code></pre>
</blockquote>
<p>TEMPLATE - Load in all models of arbitrary file format and predict for all.</p>
<p>:param model_directory: Main directory from which to read in models.</p>
<p>:param model_name: Name that will be used to define column names and for display purposes.</p>
<p>:param feature_cols: optional list of features to use for prediction. Selects all feature columns (i.e.&nbsp;column names with prefix ‘feature’) by default.</p>
<hr>


</section>
</section>

</main> <!-- /main -->
<script type="application/vnd.jupyter.widget-state+json">
{"state":{},"version_major":2,"version_minor":0}
</script>
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>