<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="Feature/target selection, engineering and manipulation.">

<title>numerblox - Preprocessing</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<script src="https://unpkg.com/@jupyter-widgets/html-manager@*/dist/embed-amd.js" crossorigin="anonymous"></script>


<link rel="stylesheet" href="styles.css">
<meta property="og:title" content="numerblox - Preprocessing">
<meta property="og:description" content="Feature/target selection, engineering and manipulation.">
<meta property="og:site-name" content="numerblox">
<meta name="twitter:title" content="numerblox - Preprocessing">
<meta name="twitter:description" content="Feature/target selection, engineering and manipulation.">
<meta name="twitter:card" content="summary">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">numerblox</span>
    </a>
  </div>
        <div class="quarto-navbar-tools ms-auto">
</div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./preprocessing.html">Preprocessing</a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">NumerBlox</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./misc.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Misc</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./download.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Download</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./numerframe.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">NumerFrame</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./preprocessing.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Preprocessing</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./model.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Model</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./postprocessing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Postprocessing</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./modelpipeline.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ModelPipeline</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./evaluation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Evaluation</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./key.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Key</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./submission.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Submission</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#base" id="toc-base" class="nav-link active" data-scroll-target="#base">0. Base</a></li>
  <li><a href="#baseprocessor" id="toc-baseprocessor" class="nav-link" data-scroll-target="#baseprocessor">0.1. BaseProcessor</a>
  <ul class="collapse">
  <li><a href="#baseprocessor-1" id="toc-baseprocessor-1" class="nav-link" data-scroll-target="#baseprocessor-1">BaseProcessor</a></li>
  </ul></li>
  <li><a href="#logging" id="toc-logging" class="nav-link" data-scroll-target="#logging">0.2. Logging</a>
  <ul class="collapse">
  <li><a href="#display_processor_info" id="toc-display_processor_info" class="nav-link" data-scroll-target="#display_processor_info">display_processor_info</a></li>
  </ul></li>
  <li><a href="#common-preprocessing-steps" id="toc-common-preprocessing-steps" class="nav-link" data-scroll-target="#common-preprocessing-steps">1. Common preprocessing steps</a></li>
  <li><a href="#tournament-agnostic" id="toc-tournament-agnostic" class="nav-link" data-scroll-target="#tournament-agnostic">1.0 Tournament agnostic</a>
  <ul class="collapse">
  <li><a href="#copypreprocessor" id="toc-copypreprocessor" class="nav-link" data-scroll-target="#copypreprocessor">1.0.1. CopyPreProcessor</a></li>
  <li><a href="#copypreprocessor-1" id="toc-copypreprocessor-1" class="nav-link" data-scroll-target="#copypreprocessor-1">CopyPreProcessor</a></li>
  <li><a href="#featureselectionpreprocessor" id="toc-featureselectionpreprocessor" class="nav-link" data-scroll-target="#featureselectionpreprocessor">1.0.2. FeatureSelectionPreProcessor</a></li>
  <li><a href="#featureselectionpreprocessor-1" id="toc-featureselectionpreprocessor-1" class="nav-link" data-scroll-target="#featureselectionpreprocessor-1">FeatureSelectionPreProcessor</a></li>
  <li><a href="#targetselectionpreprocessor" id="toc-targetselectionpreprocessor" class="nav-link" data-scroll-target="#targetselectionpreprocessor">1.0.3. TargetSelectionPreProcessor</a></li>
  <li><a href="#targetselectionpreprocessor-1" id="toc-targetselectionpreprocessor-1" class="nav-link" data-scroll-target="#targetselectionpreprocessor-1">TargetSelectionPreProcessor</a></li>
  <li><a href="#reducememoryprocessor" id="toc-reducememoryprocessor" class="nav-link" data-scroll-target="#reducememoryprocessor">1.0.4. ReduceMemoryProcessor</a></li>
  <li><a href="#reducememoryprocessor-1" id="toc-reducememoryprocessor-1" class="nav-link" data-scroll-target="#reducememoryprocessor-1">ReduceMemoryProcessor</a></li>
  </ul></li>
  <li><a href="#numerai-classic" id="toc-numerai-classic" class="nav-link" data-scroll-target="#numerai-classic">1.1. Numerai Classic</a>
  <ul class="collapse">
  <li><a href="#numerai-classic-version-agnostic" id="toc-numerai-classic-version-agnostic" class="nav-link" data-scroll-target="#numerai-classic-version-agnostic">1.1.0 Numerai Classic: Version agnostic</a></li>
  <li><a href="#bayesiangmmtargetprocessor-1" id="toc-bayesiangmmtargetprocessor-1" class="nav-link" data-scroll-target="#bayesiangmmtargetprocessor-1">BayesianGMMTargetProcessor</a></li>
  <li><a href="#numerai-classic-v4.2-rain-specific" id="toc-numerai-classic-v4.2-rain-specific" class="nav-link" data-scroll-target="#numerai-classic-v4.2-rain-specific">1.1.1. Numerai Classic: v4.2 (Rain) specific</a></li>
  <li><a href="#groupstatspreprocessor" id="toc-groupstatspreprocessor" class="nav-link" data-scroll-target="#groupstatspreprocessor">GroupStatsPreProcessor</a></li>
  </ul></li>
  <li><a href="#numerai-signals" id="toc-numerai-signals" class="nav-link" data-scroll-target="#numerai-signals">1.2. Numerai Signals</a>
  <ul class="collapse">
  <li><a href="#katsufeaturegenerator" id="toc-katsufeaturegenerator" class="nav-link" data-scroll-target="#katsufeaturegenerator">1.2.1. KatsuFeatureGenerator</a></li>
  <li><a href="#katsufeaturegenerator-1" id="toc-katsufeaturegenerator-1" class="nav-link" data-scroll-target="#katsufeaturegenerator-1">KatsuFeatureGenerator</a></li>
  <li><a href="#eraquantileprocessor" id="toc-eraquantileprocessor" class="nav-link" data-scroll-target="#eraquantileprocessor">1.2.2. EraQuantileProcessor</a></li>
  <li><a href="#eraquantileprocessor-1" id="toc-eraquantileprocessor-1" class="nav-link" data-scroll-target="#eraquantileprocessor-1">EraQuantileProcessor</a></li>
  <li><a href="#tickermapper" id="toc-tickermapper" class="nav-link" data-scroll-target="#tickermapper">1.2.3. TickerMapper</a></li>
  <li><a href="#tickermapper-1" id="toc-tickermapper-1" class="nav-link" data-scroll-target="#tickermapper-1">TickerMapper</a></li>
  <li><a href="#signalstargetprocessor" id="toc-signalstargetprocessor" class="nav-link" data-scroll-target="#signalstargetprocessor">1.2.4. SignalsTargetProcessor</a></li>
  <li><a href="#signalstargetprocessor-1" id="toc-signalstargetprocessor-1" class="nav-link" data-scroll-target="#signalstargetprocessor-1">SignalsTargetProcessor</a></li>
  <li><a href="#lagpreprocessor" id="toc-lagpreprocessor" class="nav-link" data-scroll-target="#lagpreprocessor">1.2.5. LagPreProcessor</a></li>
  <li><a href="#lagpreprocessor-1" id="toc-lagpreprocessor-1" class="nav-link" data-scroll-target="#lagpreprocessor-1">LagPreProcessor</a></li>
  <li><a href="#differencepreprocessor" id="toc-differencepreprocessor" class="nav-link" data-scroll-target="#differencepreprocessor">1.2.6. DifferencePreProcessor</a></li>
  <li><a href="#differencepreprocessor-1" id="toc-differencepreprocessor-1" class="nav-link" data-scroll-target="#differencepreprocessor-1">DifferencePreProcessor</a></li>
  <li><a href="#pandastafeaturegenerator" id="toc-pandastafeaturegenerator" class="nav-link" data-scroll-target="#pandastafeaturegenerator">1.2.7. PandasTaFeatureGenerator</a></li>
  <li><a href="#pandastafeaturegenerator-1" id="toc-pandastafeaturegenerator-1" class="nav-link" data-scroll-target="#pandastafeaturegenerator-1">PandasTaFeatureGenerator</a></li>
  </ul></li>
  <li><a href="#custom-preprocessors" id="toc-custom-preprocessors" class="nav-link" data-scroll-target="#custom-preprocessors">2. Custom preprocessors</a>
  <ul class="collapse">
  <li><a href="#awesomepreprocessor" id="toc-awesomepreprocessor" class="nav-link" data-scroll-target="#awesomepreprocessor">AwesomePreProcessor</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/crowdcent/numerblox/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Preprocessing</h1>
</div>

<div>
  <div class="description">
    Feature/target selection, engineering and manipulation.
  </div>
</div>


<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->
<section id="base" class="level2">
<h2 class="anchored" data-anchor-id="base">0. Base</h2>
<p>These objects will provide a base for all pre- and post-processing functionality and log relevant information.</p>
</section>
<section id="baseprocessor" class="level2">
<h2 class="anchored" data-anchor-id="baseprocessor">0.1. BaseProcessor</h2>
<p><a href="https://crowdcent.github.io/numerblox/preprocessing.html#baseprocessor"><code>BaseProcessor</code></a> defines common functionality for <code>preprocessing</code> and <code>postprocessing</code> (Section 5).</p>
<p>Every Preprocessor should inherit from <a href="https://crowdcent.github.io/numerblox/preprocessing.html#baseprocessor"><code>BaseProcessor</code></a> and implement the <code>.transform</code> method.</p>
<hr>
<p><a href="https://github.com/crowdcent/numerblox/blob/master/numerblox/preprocessing.py#L32" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="baseprocessor-1" class="level3">
<h3 class="anchored" data-anchor-id="baseprocessor-1">BaseProcessor</h3>
<blockquote class="blockquote">
<pre><code> BaseProcessor ()</code></pre>
</blockquote>
<p>Common functionality for preprocessors and postprocessors.</p>
</section>
</section>
<section id="logging" class="level2">
<h2 class="anchored" data-anchor-id="logging">0.2. Logging</h2>
<p>We would like to keep an overview of which steps are done in a data pipeline and where processing bottlenecks occur. The decorator below will display for a given function/method: 1. When it has finished. 2. What the output shape of the data is. 3. How long it took to finish.</p>
<p>To use this functionality, simply add <code>@display_processor_info</code> as a decorator to the function/method you want to track.</p>
<p>We will use this decorator throughout the pipeline (<code>preprocessing</code>, <code>model</code> and <code>postprocessing</code>).</p>
<p>Inspiration for this decorator: <a href="https://calmcode.io/pandas-pipe/logs.html">Calmcode Pandas Pipe Logs</a></p>
<hr>
<p><a href="https://github.com/crowdcent/numerblox/blob/master/numerblox/preprocessing.py#L50" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="display_processor_info" class="level3">
<h3 class="anchored" data-anchor-id="display_processor_info">display_processor_info</h3>
<blockquote class="blockquote">
<pre><code> display_processor_info (func)</code></pre>
</blockquote>
<p>Fancy console output for data processing.</p>
<div class="cell">
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">✅ Finished step <span style="font-weight: bold">TestDisplay</span>. Output <span style="color: #808000; text-decoration-color: #808000">shape</span>=<span style="font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">11471</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2183</span><span style="font-weight: bold">)</span>. Time taken for step: <span style="color: #000080; text-decoration-color: #000080; font-weight: bold">0:00:02</span><span style="color: #000080; text-decoration-color: #000080">.</span><span style="color: #000080; text-decoration-color: #000080; font-weight: bold">002134</span>. ✅
</pre>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">era</th>
<th data-quarto-table-cell-role="th">data_type</th>
<th data-quarto-table-cell-role="th">feature_honoured_observational_balaamite</th>
<th data-quarto-table-cell-role="th">feature_polaroid_vadose_quinze</th>
<th data-quarto-table-cell-role="th">feature_untidy_withdrawn_bargeman</th>
<th data-quarto-table-cell-role="th">feature_genuine_kyphotic_trehala</th>
<th data-quarto-table-cell-role="th">feature_unenthralled_sportful_schoolhouse</th>
<th data-quarto-table-cell-role="th">feature_divulsive_explanatory_ideologue</th>
<th data-quarto-table-cell-role="th">feature_ichthyotic_roofed_yeshiva</th>
<th data-quarto-table-cell-role="th">feature_waggly_outlandish_carbonisation</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">target_bravo_v4_20</th>
<th data-quarto-table-cell-role="th">target_bravo_v4_60</th>
<th data-quarto-table-cell-role="th">target_charlie_v4_20</th>
<th data-quarto-table-cell-role="th">target_charlie_v4_60</th>
<th data-quarto-table-cell-role="th">target_delta_v4_20</th>
<th data-quarto-table-cell-role="th">target_delta_v4_60</th>
<th data-quarto-table-cell-role="th">target_echo_v4_20</th>
<th data-quarto-table-cell-role="th">target_echo_v4_60</th>
<th data-quarto-table-cell-role="th">target_jeremy_v4_20</th>
<th data-quarto-table-cell-role="th">target_jeremy_v4_60</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">id</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">n003bba8a98662e4</td>
<td>0001</td>
<td>train</td>
<td>4</td>
<td>2</td>
<td>4</td>
<td>4</td>
<td>0</td>
<td>0</td>
<td>4</td>
<td>4</td>
<td>...</td>
<td>0.25</td>
<td>0.00</td>
<td>0.50</td>
<td>0.25</td>
<td>0.25</td>
<td>0.00</td>
<td>0.25</td>
<td>0.00</td>
<td>0.25</td>
<td>0.25</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">n003bee128c2fcfc</td>
<td>0001</td>
<td>train</td>
<td>2</td>
<td>4</td>
<td>1</td>
<td>3</td>
<td>0</td>
<td>3</td>
<td>2</td>
<td>3</td>
<td>...</td>
<td>0.75</td>
<td>1.00</td>
<td>0.75</td>
<td>0.75</td>
<td>0.75</td>
<td>0.75</td>
<td>0.75</td>
<td>0.75</td>
<td>0.75</td>
<td>1.00</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">n0048ac83aff7194</td>
<td>0001</td>
<td>train</td>
<td>2</td>
<td>1</td>
<td>3</td>
<td>0</td>
<td>3</td>
<td>0</td>
<td>3</td>
<td>3</td>
<td>...</td>
<td>0.50</td>
<td>0.25</td>
<td>0.50</td>
<td>0.25</td>
<td>0.50</td>
<td>0.25</td>
<td>0.50</td>
<td>0.25</td>
<td>0.50</td>
<td>0.25</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">n00691bec80d3e02</td>
<td>0001</td>
<td>train</td>
<td>4</td>
<td>2</td>
<td>2</td>
<td>3</td>
<td>0</td>
<td>4</td>
<td>1</td>
<td>4</td>
<td>...</td>
<td>0.75</td>
<td>0.50</td>
<td>0.75</td>
<td>0.75</td>
<td>0.50</td>
<td>0.50</td>
<td>0.75</td>
<td>0.50</td>
<td>0.50</td>
<td>0.50</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">n00b8720a2fdc4f2</td>
<td>0001</td>
<td>train</td>
<td>4</td>
<td>3</td>
<td>4</td>
<td>4</td>
<td>0</td>
<td>0</td>
<td>4</td>
<td>2</td>
<td>...</td>
<td>0.75</td>
<td>0.50</td>
<td>0.75</td>
<td>0.50</td>
<td>0.75</td>
<td>0.50</td>
<td>0.75</td>
<td>0.50</td>
<td>0.50</td>
<td>0.50</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">nff8c4db7e8c26ab</td>
<td>0005</td>
<td>train</td>
<td>4</td>
<td>3</td>
<td>1</td>
<td>2</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>3</td>
<td>...</td>
<td>0.50</td>
<td>0.50</td>
<td>1.00</td>
<td>0.50</td>
<td>0.75</td>
<td>0.50</td>
<td>0.50</td>
<td>0.50</td>
<td>0.75</td>
<td>0.75</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">nffaef40da241883</td>
<td>0005</td>
<td>train</td>
<td>3</td>
<td>2</td>
<td>4</td>
<td>3</td>
<td>1</td>
<td>4</td>
<td>3</td>
<td>0</td>
<td>...</td>
<td>0.50</td>
<td>0.50</td>
<td>0.75</td>
<td>0.50</td>
<td>0.50</td>
<td>0.50</td>
<td>0.50</td>
<td>0.50</td>
<td>0.50</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">nffd795bbc001447</td>
<td>0005</td>
<td>train</td>
<td>3</td>
<td>2</td>
<td>2</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>4</td>
<td>...</td>
<td>0.50</td>
<td>0.50</td>
<td>0.50</td>
<td>0.50</td>
<td>0.50</td>
<td>0.50</td>
<td>0.50</td>
<td>0.50</td>
<td>0.50</td>
<td>0.50</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">nfff8f6044464a9e</td>
<td>0005</td>
<td>train</td>
<td>2</td>
<td>0</td>
<td>2</td>
<td>3</td>
<td>2</td>
<td>4</td>
<td>1</td>
<td>4</td>
<td>...</td>
<td>0.50</td>
<td>0.50</td>
<td>0.50</td>
<td>0.50</td>
<td>0.50</td>
<td>0.50</td>
<td>0.50</td>
<td>0.50</td>
<td>0.50</td>
<td>0.50</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">nffff520391f69ad</td>
<td>0005</td>
<td>train</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>2</td>
<td>1</td>
<td>4</td>
<td>0</td>
<td>1</td>
<td>...</td>
<td>0.50</td>
<td>0.50</td>
<td>0.50</td>
<td>0.50</td>
<td>0.25</td>
<td>0.50</td>
<td>0.50</td>
<td>0.50</td>
<td>0.00</td>
<td>0.50</td>
</tr>
</tbody>
</table>

<p>11471 rows × 2183 columns</p>
</div>
</div>
</div>
</section>
</section>
<section id="common-preprocessing-steps" class="level2">
<h2 class="anchored" data-anchor-id="common-preprocessing-steps">1. Common preprocessing steps</h2>
<p>This section implements commonly used preprocessing for Numerai. We invite the Numerai community to develop new preprocessors.</p>
</section>
<section id="tournament-agnostic" class="level2">
<h2 class="anchored" data-anchor-id="tournament-agnostic">1.0 Tournament agnostic</h2>
<p>Preprocessors that can be applied for both Numerai Classic and Numerai Signals.</p>
<section id="copypreprocessor" class="level3">
<h3 class="anchored" data-anchor-id="copypreprocessor">1.0.1. CopyPreProcessor</h3>
<p>The first and obvious preprocessor is copying, which is implemented as a default in <a href="https://crowdcent.github.io/numerblox/modelpipeline.html#modelpipeline"><code>ModelPipeline</code></a> (Section 4) to avoid manipulation of the original DataFrame or <a href="https://crowdcent.github.io/numerblox/numerframe.html#numerframe"><code>NumerFrame</code></a> that you load in.</p>
<hr>
<p><a href="https://github.com/crowdcent/numerblox/blob/master/numerblox/preprocessing.py#L67" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="copypreprocessor-1" class="level3">
<h3 class="anchored" data-anchor-id="copypreprocessor-1">CopyPreProcessor</h3>
<blockquote class="blockquote">
<pre><code> CopyPreProcessor ()</code></pre>
</blockquote>
<p>Copy DataFrame to avoid manipulation of original DataFrame.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>dataset <span class="op">=</span> create_numerframe(</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"test_assets/train_int8_5_eras.parquet"</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>copied_dataset <span class="op">=</span> CopyPreProcessor().transform(dataset)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> copied_dataset.equals(dataset)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> dataset.meta <span class="op">==</span> copied_dataset.meta</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">✅ Finished step <span style="font-weight: bold">CopyPreProcessor</span>. Output <span style="color: #808000; text-decoration-color: #808000">shape</span>=<span style="font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">11471</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2183</span><span style="font-weight: bold">)</span>. Time taken for step: <span style="color: #000080; text-decoration-color: #000080; font-weight: bold">0:00:00</span><span style="color: #000080; text-decoration-color: #000080">.</span><span style="color: #000080; text-decoration-color: #000080; font-weight: bold">081558</span>. ✅
</pre>
</div>
</div>
</section>
<section id="featureselectionpreprocessor" class="level3">
<h3 class="anchored" data-anchor-id="featureselectionpreprocessor">1.0.2. FeatureSelectionPreProcessor</h3>
<p><a href="https://crowdcent.github.io/numerblox/preprocessing.html#featureselectionpreprocessor"><code>FeatureSelectionPreProcessor</code></a> will keep all features that you pass + keeps all other columns that are not features.</p>
<hr>
<p><a href="https://github.com/crowdcent/numerblox/blob/master/numerblox/preprocessing.py#L78" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="featureselectionpreprocessor-1" class="level3">
<h3 class="anchored" data-anchor-id="featureselectionpreprocessor-1">FeatureSelectionPreProcessor</h3>
<blockquote class="blockquote">
<pre><code> FeatureSelectionPreProcessor (feature_cols:Union[str,list])</code></pre>
</blockquote>
<p>Keep only features given + all target, predictions and aux columns.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>selected_dataset <span class="op">=</span> FeatureSelectionPreProcessor(</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    feature_cols<span class="op">=</span>[<span class="st">"feature_byzantine_festinate_mannose"</span>]</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>).transform(dataset)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> selected_dataset.get_feature_data.shape[<span class="dv">1</span>] <span class="op">==</span> <span class="dv">1</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> dataset.meta <span class="op">==</span> selected_dataset.meta</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">✅ Finished step <span style="font-weight: bold">FeatureSelectionPreProcessor</span>. Output <span style="color: #808000; text-decoration-color: #808000">shape</span>=<span style="font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">11471</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">52</span><span style="font-weight: bold">)</span>. Time taken for step: <span style="color: #000080; text-decoration-color: #000080; font-weight: bold">0:00:00</span><span style="color: #000080; text-decoration-color: #000080">.</span><span style="color: #000080; text-decoration-color: #000080; font-weight: bold">003162</span>. ✅
</pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>selected_dataset.head(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">feature_byzantine_festinate_mannose</th>
<th data-quarto-table-cell-role="th">target</th>
<th data-quarto-table-cell-role="th">target_nomi_v4_20</th>
<th data-quarto-table-cell-role="th">target_nomi_v4_60</th>
<th data-quarto-table-cell-role="th">target_tyler_v4_20</th>
<th data-quarto-table-cell-role="th">target_tyler_v4_60</th>
<th data-quarto-table-cell-role="th">target_victor_v4_20</th>
<th data-quarto-table-cell-role="th">target_victor_v4_60</th>
<th data-quarto-table-cell-role="th">target_ralph_v4_20</th>
<th data-quarto-table-cell-role="th">target_ralph_v4_60</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">target_charlie_v4_20</th>
<th data-quarto-table-cell-role="th">target_charlie_v4_60</th>
<th data-quarto-table-cell-role="th">target_delta_v4_20</th>
<th data-quarto-table-cell-role="th">target_delta_v4_60</th>
<th data-quarto-table-cell-role="th">target_echo_v4_20</th>
<th data-quarto-table-cell-role="th">target_echo_v4_60</th>
<th data-quarto-table-cell-role="th">target_jeremy_v4_20</th>
<th data-quarto-table-cell-role="th">target_jeremy_v4_60</th>
<th data-quarto-table-cell-role="th">era</th>
<th data-quarto-table-cell-role="th">data_type</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">id</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">n003bba8a98662e4</td>
<td>2</td>
<td>0.25</td>
<td>0.25</td>
<td>0.00</td>
<td>0.50</td>
<td>0.25</td>
<td>0.25</td>
<td>0.00</td>
<td>0.25</td>
<td>0.25</td>
<td>...</td>
<td>0.50</td>
<td>0.25</td>
<td>0.25</td>
<td>0.00</td>
<td>0.25</td>
<td>0.00</td>
<td>0.25</td>
<td>0.25</td>
<td>0001</td>
<td>train</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">n003bee128c2fcfc</td>
<td>2</td>
<td>0.75</td>
<td>0.75</td>
<td>0.75</td>
<td>0.75</td>
<td>0.75</td>
<td>0.75</td>
<td>0.75</td>
<td>0.75</td>
<td>0.75</td>
<td>...</td>
<td>0.75</td>
<td>0.75</td>
<td>0.75</td>
<td>0.75</td>
<td>0.75</td>
<td>0.75</td>
<td>0.75</td>
<td>1.00</td>
<td>0001</td>
<td>train</td>
</tr>
</tbody>
</table>

<p>2 rows × 52 columns</p>
</div>
</div>
</div>
</section>
<section id="targetselectionpreprocessor" class="level3">
<h3 class="anchored" data-anchor-id="targetselectionpreprocessor">1.0.3. TargetSelectionPreProcessor</h3>
<p><a href="https://crowdcent.github.io/numerblox/preprocessing.html#targetselectionpreprocessor"><code>TargetSelectionPreProcessor</code></a> will keep all targets that you pass + all other columns that are not targets.</p>
<p>Not relevant for an inference pipeline, but especially convenient for Numerai Classic training if you train on a subset of the available targets. Can also be applied to Signals if you are using engineered targets in your pipeline.</p>
<hr>
<p><a href="https://github.com/crowdcent/numerblox/blob/master/numerblox/preprocessing.py#L99" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="targetselectionpreprocessor-1" class="level3">
<h3 class="anchored" data-anchor-id="targetselectionpreprocessor-1">TargetSelectionPreProcessor</h3>
<blockquote class="blockquote">
<pre><code> TargetSelectionPreProcessor (target_cols:Union[str,list])</code></pre>
</blockquote>
<p>Keep only features given + all target, predictions and aux columns.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>dataset <span class="op">=</span> create_numerframe(</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"test_assets/train_int8_5_eras.parquet"</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>target_cols <span class="op">=</span> [<span class="st">"target"</span>, <span class="st">"target_janet_v4_60"</span>, <span class="st">"target_william_v4_20"</span>]</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>selected_dataset <span class="op">=</span> TargetSelectionPreProcessor(target_cols<span class="op">=</span>target_cols).transform(</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    dataset</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> selected_dataset.get_target_data.shape[<span class="dv">1</span>] <span class="op">==</span> <span class="bu">len</span>(target_cols)</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>selected_dataset.head(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">✅ Finished step <span style="font-weight: bold">TargetSelectionPreProcessor</span>. Output <span style="color: #808000; text-decoration-color: #808000">shape</span>=<span style="font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">11471</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2137</span><span style="font-weight: bold">)</span>. Time taken for step: <span style="color: #000080; text-decoration-color: #000080; font-weight: bold">0:00:00</span><span style="color: #000080; text-decoration-color: #000080">.</span><span style="color: #000080; text-decoration-color: #000080; font-weight: bold">076958</span>. ✅
</pre>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">target</th>
<th data-quarto-table-cell-role="th">target_janet_v4_60</th>
<th data-quarto-table-cell-role="th">target_william_v4_20</th>
<th data-quarto-table-cell-role="th">feature_honoured_observational_balaamite</th>
<th data-quarto-table-cell-role="th">feature_polaroid_vadose_quinze</th>
<th data-quarto-table-cell-role="th">feature_untidy_withdrawn_bargeman</th>
<th data-quarto-table-cell-role="th">feature_genuine_kyphotic_trehala</th>
<th data-quarto-table-cell-role="th">feature_unenthralled_sportful_schoolhouse</th>
<th data-quarto-table-cell-role="th">feature_divulsive_explanatory_ideologue</th>
<th data-quarto-table-cell-role="th">feature_ichthyotic_roofed_yeshiva</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">feature_shimmering_coverable_congolese</th>
<th data-quarto-table-cell-role="th">feature_biserial_fulfilled_harpoon</th>
<th data-quarto-table-cell-role="th">feature_pitiable_authoritative_clangor</th>
<th data-quarto-table-cell-role="th">feature_abdominal_subtriplicate_fin</th>
<th data-quarto-table-cell-role="th">feature_centenarian_ileac_caschrom</th>
<th data-quarto-table-cell-role="th">feature_expected_beatified_coparcenary</th>
<th data-quarto-table-cell-role="th">feature_unread_isopodan_ethic</th>
<th data-quarto-table-cell-role="th">feature_china_fistular_phenylketonuria</th>
<th data-quarto-table-cell-role="th">era</th>
<th data-quarto-table-cell-role="th">data_type</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">id</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">n003bba8a98662e4</td>
<td>0.25</td>
<td>0.5</td>
<td>0.333333</td>
<td>4</td>
<td>2</td>
<td>4</td>
<td>4</td>
<td>0</td>
<td>0</td>
<td>4</td>
<td>...</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>0001</td>
<td>train</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">n003bee128c2fcfc</td>
<td>0.75</td>
<td>0.5</td>
<td>0.666667</td>
<td>2</td>
<td>4</td>
<td>1</td>
<td>3</td>
<td>0</td>
<td>3</td>
<td>2</td>
<td>...</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>0001</td>
<td>train</td>
</tr>
</tbody>
</table>

<p>2 rows × 2137 columns</p>
</div>
</div>
</div>
</section>
<section id="reducememoryprocessor" class="level3">
<h3 class="anchored" data-anchor-id="reducememoryprocessor">1.0.4. ReduceMemoryProcessor</h3>
<p>Numerai datasets can take up a lot of RAM and may put a strain on your compute environment.</p>
<p>For Numerai Classic, many of the feature and target columns can be downscaled to <code>float16</code>. <code>int8</code> if you are using the Numerai int8 datasets. For Signals it depends on the features you are generating.</p>
<p><a href="https://crowdcent.github.io/numerblox/preprocessing.html#reducememoryprocessor"><code>ReduceMemoryProcessor</code></a> downscales the type of your numeric columns to reduce the memory footprint as much as possible.</p>
<hr>
<p><a href="https://github.com/crowdcent/numerblox/blob/master/numerblox/preprocessing.py#L120" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="reducememoryprocessor-1" class="level3">
<h3 class="anchored" data-anchor-id="reducememoryprocessor-1">ReduceMemoryProcessor</h3>
<blockquote class="blockquote">
<pre><code> ReduceMemoryProcessor (deep_mem_inspect=False)</code></pre>
</blockquote>
<p>Reduce memory usage as much as possible.</p>
<p>Credits to kainsama and others for writing about memory usage reduction for Numerai data: https://forum.numer.ai/t/reducing-memory/313</p>
<p>:param deep_mem_inspect: Introspect the data deeply by interrogating object dtypes. Yields a more accurate representation of memory usage if you have complex object columns.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>dataf <span class="op">=</span> create_numerframe(<span class="st">"test_assets/train_int8_5_eras.parquet"</span>)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>rmp <span class="op">=</span> ReduceMemoryProcessor()</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>dataf <span class="op">=</span> rmp.transform(dataf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">Memory usage of DataFrame is <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">25.73</span><span style="font-weight: bold"> MB</span>
</pre>
</div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">Memory usage after optimization is: <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">47.98</span><span style="font-weight: bold"> MB</span>
</pre>
</div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="color: #008000; text-decoration-color: #008000"> Usage decreased by </span><span style="color: #008000; text-decoration-color: #008000; font-weight: bold">-86.48</span><span style="color: #008000; text-decoration-color: #008000; font-weight: bold">%</span>
</pre>
</div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">✅ Finished step <span style="font-weight: bold">ReduceMemoryProcessor</span>. Output <span style="color: #808000; text-decoration-color: #808000">shape</span>=<span style="font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">11471</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2183</span><span style="font-weight: bold">)</span>. Time taken for step: <span style="color: #000080; text-decoration-color: #000080; font-weight: bold">0:00:05</span><span style="color: #000080; text-decoration-color: #000080">.</span><span style="color: #000080; text-decoration-color: #000080; font-weight: bold">473843</span>. ✅
</pre>
</div>
</div>
</section>
</section>
<section id="numerai-classic" class="level2">
<h2 class="anchored" data-anchor-id="numerai-classic">1.1. Numerai Classic</h2>
<p>The Numerai Classic dataset has a certain structure that you may not encounter in the Numerai Signals tournament. Therefore, this section has all preprocessors that can only be applied to Numerai Classic.</p>
<section id="numerai-classic-version-agnostic" class="level3">
<h3 class="anchored" data-anchor-id="numerai-classic-version-agnostic">1.1.0 Numerai Classic: Version agnostic</h3>
<p>Preprocessors that work for all Numerai Classic versions.</p>
<section id="bayesiangmmtargetprocessor" class="level4">
<h4 class="anchored" data-anchor-id="bayesiangmmtargetprocessor">1.1.0.1. BayesianGMMTargetProcessor</h4>
<hr>
<p><a href="https://github.com/crowdcent/numerblox/blob/master/numerblox/preprocessing.py#L207" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
</section>
<section id="bayesiangmmtargetprocessor-1" class="level3">
<h3 class="anchored" data-anchor-id="bayesiangmmtargetprocessor-1">BayesianGMMTargetProcessor</h3>
<blockquote class="blockquote">
<pre><code> BayesianGMMTargetProcessor (target_col:str='target',
                             feature_names:list=None, n_components:int=6)</code></pre>
</blockquote>
<p>Generate synthetic (fake) target using a Bayesian Gaussian Mixture model.</p>
<p>Based on Michael Oliver’s GitHub Gist implementation:</p>
<p>https://gist.github.com/the-moliver/dcdd2862dc2c78dda600f1b449071c93</p>
<p>:param target_col: Column from which to create fake target.</p>
<p>:param feature_names: Selection of features used for Bayesian GMM. All features by default. :param n_components: Number of components for fitting Bayesian Gaussian Mixture Model.</p>
</section>
<section id="numerai-classic-v4.2-rain-specific" class="level3">
<h3 class="anchored" data-anchor-id="numerai-classic-v4.2-rain-specific">1.1.1. Numerai Classic: v4.2 (Rain) specific</h3>
<p>Preprocessors that only work for the v4.2 (Rain) dataset.</p>
<section id="groupstatsprocessor" class="level4">
<h4 class="anchored" data-anchor-id="groupstatsprocessor">1.1.1.1. GroupStatsProcessor</h4>
<p>v4.2. reintroduces the concept of feature groups. This allows us to create new features out of aggregate statistics. <code>GroupStatsProcessor</code> will calculate the mean, median, standard deviation and skewness for each feature group in a row.</p>
<p>First we define a mapping for each feature group to its associated features.</p>
<hr>
<p><a href="https://github.com/crowdcent/numerblox/blob/master/numerblox/preprocessing.py#L293" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
</section>
<section id="groupstatspreprocessor" class="level3">
<h3 class="anchored" data-anchor-id="groupstatspreprocessor">GroupStatsPreProcessor</h3>
<blockquote class="blockquote">
<pre><code> GroupStatsPreProcessor (groups:list=None)</code></pre>
</blockquote>
<p>WARNING: Only supported for v4.2 (Rain) data. The Rain dataset (re)introduced feature groups.</p>
<p>Calculates group statistics for all data groups.</p>
<p>:param groups: Groups to create features for. All groups by default.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>v4_2_data <span class="op">=</span> create_numerframe(<span class="st">"test_assets/train_int8_5_eras.parquet"</span>)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Groups can be created for a subset of groups. Processes all groups by default.</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>gsp <span class="op">=</span> GroupStatsPreProcessor(groups<span class="op">=</span>[<span class="st">'rain'</span>, <span class="st">'sunshine'</span>])</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>v4_2_group_stats_df <span class="op">=</span> gsp.transform(v4_2_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">✅ Finished step <span style="font-weight: bold">GroupStatsPreProcessor</span>. Output <span style="color: #808000; text-decoration-color: #808000">shape</span>=<span style="font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">11471</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2189</span><span style="font-weight: bold">)</span>. Time taken for step: <span style="color: #000080; text-decoration-color: #000080; font-weight: bold">0:00:00</span><span style="color: #000080; text-decoration-color: #000080">.</span><span style="color: #000080; text-decoration-color: #000080; font-weight: bold">470712</span>. ✅
</pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>new_cols <span class="op">=</span> [col <span class="cf">for</span> col <span class="kw">in</span> v4_2_group_stats_df.columns <span class="cf">if</span> <span class="bu">any</span>(k <span class="kw">in</span> col <span class="cf">for</span> k <span class="kw">in</span> [<span class="st">"rain_mean"</span>, <span class="st">"rain_std"</span>, <span class="st">"rain_skew"</span>,</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>                                                                                 <span class="st">"sunshine_mean"</span>, <span class="st">"sunshine_std"</span>, <span class="st">"sunshine_skew"</span>])]</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>v4_2_group_stats_df[new_cols].head(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">feature_rain_mean</th>
<th data-quarto-table-cell-role="th">feature_rain_std</th>
<th data-quarto-table-cell-role="th">feature_rain_skew</th>
<th data-quarto-table-cell-role="th">feature_sunshine_mean</th>
<th data-quarto-table-cell-role="th">feature_sunshine_std</th>
<th data-quarto-table-cell-role="th">feature_sunshine_skew</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">id</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">n003bba8a98662e4</td>
<td>2.0</td>
<td>0.0</td>
<td>0.0</td>
<td>2.153846</td>
<td>0.533761</td>
<td>3.190169</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">n003bee128c2fcfc</td>
<td>2.0</td>
<td>0.0</td>
<td>0.0</td>
<td>1.898462</td>
<td>0.456940</td>
<td>-3.517183</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
</section>
<section id="numerai-signals" class="level2">
<h2 class="anchored" data-anchor-id="numerai-signals">1.2. Numerai Signals</h2>
<p>Preprocessors that are specific to Numerai Signals.</p>
<section id="katsufeaturegenerator" class="level3">
<h3 class="anchored" data-anchor-id="katsufeaturegenerator">1.2.1. KatsuFeatureGenerator</h3>
<p><a href="https://www.kaggle.com/code1110">Katsu1110</a> provides an excellent and fast feature engineering scheme in his <a href="https://www.kaggle.com/code1110/numeraisignals-starter-for-beginners">Kaggle notebook on starting with Numerai Signals</a>. It is surprisingly effective, fast and works well for modeling. This preprocessor is based on his feature engineering setup in that notebook.</p>
<p>Features generated: 1. MACD and MACD signal 2. RSI 3. Percentage rate of return 4. Volatility 5. MA (moving average) gap</p>
<hr>
<p><a href="https://github.com/crowdcent/numerblox/blob/master/numerblox/preprocessing.py#L335" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="katsufeaturegenerator-1" class="level3">
<h3 class="anchored" data-anchor-id="katsufeaturegenerator-1">KatsuFeatureGenerator</h3>
<blockquote class="blockquote">
<pre><code> KatsuFeatureGenerator (windows:list, ticker_col:str='ticker',
                        close_col:str='close', num_cores:int=None)</code></pre>
</blockquote>
<p>Effective feature engineering setup based on Katsu’s starter notebook. Based on source by Katsu1110: https://www.kaggle.com/code1110/numeraisignals-starter-for-beginners</p>
<p>:param windows: Time interval to apply for window features:</p>
<ol type="1">
<li><p>Percentage Rate of change</p></li>
<li><p>Volatility</p></li>
<li><p>Moving Average gap</p></li>
</ol>
<p>:param ticker_col: Columns with tickers to iterate over.</p>
<p>:param close_col: Column name where you have closing price stored.</p>
<p>Let’s create a simple synthetic dataset to test preprocessors on. Many preprocessor require at least <code>ticker</code>, <code>date</code> and <code>close</code> columns. More advanced feature engineering preprocessors should also have <code>open</code>, <code>high</code>, <code>low</code> and <code>volume</code> columns.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>instances <span class="op">=</span> []</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>tickers <span class="op">=</span> [<span class="st">"ABC.US"</span>, <span class="st">"DEF.US"</span>, <span class="st">"GHI.US"</span>]</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> ticker <span class="kw">in</span> tickers:</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    price <span class="op">=</span> np.random.randint(<span class="dv">10</span>, <span class="dv">100</span>)</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">100</span>):</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>        price <span class="op">+=</span> np.random.uniform(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>        instances.append(</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>            {</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>                <span class="st">"ticker"</span>: ticker,</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>                <span class="st">"date"</span>: pd.Timestamp(<span class="st">"2020-01-01"</span>) <span class="op">+</span> pd.Timedelta(days<span class="op">=</span>i),</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>                <span class="st">"open"</span>: price <span class="op">-</span> <span class="fl">0.05</span>,</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>                <span class="st">"high"</span>: price <span class="op">+</span> <span class="fl">0.02</span>,</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>                <span class="st">"low"</span>: price <span class="op">-</span> <span class="fl">0.01</span>,</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>                <span class="st">"close"</span>: price,</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>                <span class="st">"volume"</span>: np.random.randint(<span class="dv">1000</span>, <span class="dv">10000</span>),</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>dummy_df <span class="op">=</span> NumerFrame(instances)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>dummy_df.head(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ticker</th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">open</th>
<th data-quarto-table-cell-role="th">high</th>
<th data-quarto-table-cell-role="th">low</th>
<th data-quarto-table-cell-role="th">close</th>
<th data-quarto-table-cell-role="th">volume</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>ABC.US</td>
<td>2020-01-01</td>
<td>59.472206</td>
<td>59.542206</td>
<td>59.512206</td>
<td>59.522206</td>
<td>5683</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>ABC.US</td>
<td>2020-01-02</td>
<td>58.490325</td>
<td>58.560325</td>
<td>58.530325</td>
<td>58.540325</td>
<td>8416</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>dataf <span class="op">=</span> NumerFrame(dummy_df)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>dataf.loc[:, <span class="st">"friday_date"</span>] <span class="op">=</span> dataf[<span class="st">"date"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>kfpp <span class="op">=</span> KatsuFeatureGenerator(windows<span class="op">=</span>[<span class="dv">20</span>, <span class="dv">40</span>, <span class="dv">60</span>], num_cores<span class="op">=</span><span class="dv">8</span>)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>new_dataf <span class="op">=</span> kfpp.transform(dataf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">Feature engineering for <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3</span> tickers using <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">8</span> CPU cores.
</pre>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"664ebe7067ea4d8b8f48eb3719c4a04c","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"fd52d6af82f146a490a52c5788c22329","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">✅ Finished step <span style="font-weight: bold">KatsuFeatureGenerator</span>. Output <span style="color: #808000; text-decoration-color: #808000">shape</span>=<span style="font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">300</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">20</span><span style="font-weight: bold">)</span>. Time taken for step: <span style="color: #000080; text-decoration-color: #000080; font-weight: bold">0:00:00</span><span style="color: #000080; text-decoration-color: #000080">.</span><span style="color: #000080; text-decoration-color: #000080; font-weight: bold">153968</span>. ✅
</pre>
</div>
</div>
<p>12 features are generated in this test (3*3 window features + 3 non window features).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>new_dataf.sort_values([<span class="st">"ticker"</span>, <span class="st">"date"</span>]).get_feature_data.tail(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">feature_close_ROCP_20</th>
<th data-quarto-table-cell-role="th">feature_close_VOL_20</th>
<th data-quarto-table-cell-role="th">feature_close_MA_gap_20</th>
<th data-quarto-table-cell-role="th">feature_close_ROCP_40</th>
<th data-quarto-table-cell-role="th">feature_close_VOL_40</th>
<th data-quarto-table-cell-role="th">feature_close_MA_gap_40</th>
<th data-quarto-table-cell-role="th">feature_close_ROCP_60</th>
<th data-quarto-table-cell-role="th">feature_close_VOL_60</th>
<th data-quarto-table-cell-role="th">feature_close_MA_gap_60</th>
<th data-quarto-table-cell-role="th">feature_RSI</th>
<th data-quarto-table-cell-role="th">feature_MACD</th>
<th data-quarto-table-cell-role="th">feature_MACD_signal</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">298</td>
<td>-0.003848</td>
<td>0.001384</td>
<td>1.013424</td>
<td>-0.003641</td>
<td>0.001535</td>
<td>1.007679</td>
<td>0.024575</td>
<td>0.001445</td>
<td>1.007059</td>
<td>57.889148</td>
<td>-0.124340</td>
<td>-0.414811</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">299</td>
<td>-0.001148</td>
<td>0.001413</td>
<td>1.020715</td>
<td>0.014429</td>
<td>0.001505</td>
<td>1.014503</td>
<td>0.036681</td>
<td>0.001449</td>
<td>1.013638</td>
<td>61.647071</td>
<td>0.045781</td>
<td>-0.322692</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="eraquantileprocessor" class="level3">
<h3 class="anchored" data-anchor-id="eraquantileprocessor">1.2.2. EraQuantileProcessor</h3>
<p>Numerai Signals’ objective is predicting a ranking of equities. Therefore, we can benefit from creating rankings out of the features. Doing this reduces noise and works as a normalization mechanism for your features. <a href="https://crowdcent.github.io/numerblox/preprocessing.html#eraquantileprocessor"><code>EraQuantileProcessor</code></a> bins features in a given number of quantiles for each era in the dataset.</p>
<hr>
<p><a href="https://github.com/crowdcent/numerblox/blob/master/numerblox/preprocessing.py#L447" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="eraquantileprocessor-1" class="level3">
<h3 class="anchored" data-anchor-id="eraquantileprocessor-1">EraQuantileProcessor</h3>
<blockquote class="blockquote">
<pre><code> EraQuantileProcessor (num_quantiles:int=50, era_col:str='friday_date',
                       features:list=None, num_cores:int=None,
                       random_state:int=0, batch_size:int=1)</code></pre>
</blockquote>
<p>Transform features into quantiles on a per-era basis</p>
<p>:param num_quantiles: Number of buckets to split data into.</p>
<p>:param era_col: Era column name in the dataframe to perform each transformation.</p>
<p>:param features: All features that you want quantized. All feature cols by default.</p>
<p>:param num_cores: CPU cores to allocate for quantile transforming. All available cores by default.</p>
<p>:param random_state: Seed for QuantileTransformer.</p>
<p>:param batch_size: How many feature to process at the same time. For Numerai Signals scale data it is advisable to process features one by one. This is the default setting.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>era_quantiler <span class="op">=</span> EraQuantileProcessor(num_quantiles<span class="op">=</span><span class="dv">50</span>)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>era_dataf <span class="op">=</span> era_quantiler.transform(new_dataf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">Quantiling for <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">12</span> features using <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">32</span> CPU cores.
</pre>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"6034a00feb0e4314921b90c84f43b824","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">✅ Finished step <span style="font-weight: bold">EraQuantileProcessor</span>. Output <span style="color: #808000; text-decoration-color: #808000">shape</span>=<span style="font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">300</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">21</span><span style="font-weight: bold">)</span>. Time taken for step: <span style="color: #000080; text-decoration-color: #000080; font-weight: bold">0:00:00</span><span style="color: #000080; text-decoration-color: #000080">.</span><span style="color: #000080; text-decoration-color: #000080; font-weight: bold">457428</span>. ✅
</pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>era_dataf.get_feature_data.tail(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">feature_close_ROCP_20</th>
<th data-quarto-table-cell-role="th">feature_close_VOL_20</th>
<th data-quarto-table-cell-role="th">feature_close_MA_gap_20</th>
<th data-quarto-table-cell-role="th">feature_close_ROCP_40</th>
<th data-quarto-table-cell-role="th">feature_close_VOL_40</th>
<th data-quarto-table-cell-role="th">feature_close_MA_gap_40</th>
<th data-quarto-table-cell-role="th">feature_close_ROCP_60</th>
<th data-quarto-table-cell-role="th">feature_close_VOL_60</th>
<th data-quarto-table-cell-role="th">feature_close_MA_gap_60</th>
<th data-quarto-table-cell-role="th">feature_RSI</th>
<th data-quarto-table-cell-role="th">feature_MACD</th>
<th data-quarto-table-cell-role="th">feature_MACD_signal</th>
<th data-quarto-table-cell-role="th">feature_close_ROCP_20_quantile50</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">298</td>
<td>-0.003848</td>
<td>0.001384</td>
<td>1.013424</td>
<td>-0.003641</td>
<td>0.001535</td>
<td>1.007679</td>
<td>0.024575</td>
<td>0.001445</td>
<td>1.007059</td>
<td>57.889148</td>
<td>-0.124340</td>
<td>-0.414811</td>
<td>0.5</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">299</td>
<td>-0.001148</td>
<td>0.001413</td>
<td>1.020715</td>
<td>0.014429</td>
<td>0.001505</td>
<td>1.014503</td>
<td>0.036681</td>
<td>0.001449</td>
<td>1.013638</td>
<td>61.647071</td>
<td>0.045781</td>
<td>-0.322692</td>
<td>0.5</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="tickermapper" class="level3">
<h3 class="anchored" data-anchor-id="tickermapper">1.2.3. TickerMapper</h3>
<p>Numerai Signals data APIs may work with different ticker formats. Our goal with <a href="https://crowdcent.github.io/numerblox/preprocessing.html#tickermapper"><code>TickerMapper</code></a> is to map <code>ticker_col</code> to <code>target_ticker_format</code>.</p>
<hr>
<p><a href="https://github.com/crowdcent/numerblox/blob/master/numerblox/preprocessing.py#L517" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="tickermapper-1" class="level3">
<h3 class="anchored" data-anchor-id="tickermapper-1">TickerMapper</h3>
<blockquote class="blockquote">
<pre><code> TickerMapper (ticker_col:str='ticker',
               target_ticker_format:str='bloomberg_ticker',
               mapper_path:str='https://numerai-signals-public-data.s3-us-
               west-2.amazonaws.com/signals_ticker_map_w_bbg.csv')</code></pre>
</blockquote>
<p>Map ticker from one format to another.</p>
<p>:param ticker_col: Column used for mapping. Must already be present in the input data.</p>
<p>:param target_ticker_format: Format to map tickers to. Must be present in the ticker map.</p>
<p>For default mapper supported ticker formats are: [‘ticker’, ‘bloomberg_ticker’, ‘yahoo’]</p>
<p>:param mapper_path: Path to CSV file containing at least ticker_col and target_ticker_format columns.</p>
<p>Can be either a web link of local path. Numerai Signals mapping by default.</p>
<p>Use default signals mapping to convert between Numerai ticker, Bloomberg ticker and Yahoo ticker formats.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>test_dataf <span class="op">=</span> pd.DataFrame([<span class="st">"AAPL"</span>, <span class="st">"MSFT"</span>], columns<span class="op">=</span>[<span class="st">"ticker"</span>])</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>mapper <span class="op">=</span> TickerMapper()</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>mapper.transform(test_dataf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">✅ Finished step <span style="font-weight: bold">TickerMapper</span>. Output <span style="color: #808000; text-decoration-color: #808000">shape</span>=<span style="font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">)</span>. Time taken for step: <span style="color: #000080; text-decoration-color: #000080; font-weight: bold">0:00:00</span><span style="color: #000080; text-decoration-color: #000080">.</span><span style="color: #000080; text-decoration-color: #000080; font-weight: bold">001820</span>. ✅
</pre>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ticker</th>
<th data-quarto-table-cell-role="th">bloomberg_ticker</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>AAPL</td>
<td>AAPL US</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>MSFT</td>
<td>MSFT US</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>You can also use a CSV file for mapping. For example, the mapping Numerai user degerhan provides in <a href="https://github.com/degerhan/dsignals">dsignals</a> for EOD data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>test_dataf <span class="op">=</span> pd.DataFrame([<span class="st">"LLB SW"</span>, <span class="st">"DRAK NA"</span>, <span class="st">"SWB MK"</span>, <span class="st">"ELEKTRA* MF"</span>, <span class="st">"NOT_A_TICKER"</span>], columns<span class="op">=</span>[<span class="st">"bloomberg_ticker"</span>])</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>mapper <span class="op">=</span> TickerMapper(ticker_col<span class="op">=</span><span class="st">"bloomberg_ticker"</span>, target_ticker_format<span class="op">=</span><span class="st">"signals_ticker"</span>,</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>                      mapper_path<span class="op">=</span><span class="st">"test_assets/eodhd-map.csv"</span>)</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>mapper.transform(test_dataf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">✅ Finished step <span style="font-weight: bold">TickerMapper</span>. Output <span style="color: #808000; text-decoration-color: #808000">shape</span>=<span style="font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">5</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">)</span>. Time taken for step: <span style="color: #000080; text-decoration-color: #000080; font-weight: bold">0:00:00</span><span style="color: #000080; text-decoration-color: #000080">.</span><span style="color: #000080; text-decoration-color: #000080; font-weight: bold">002913</span>. ✅
</pre>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">bloomberg_ticker</th>
<th data-quarto-table-cell-role="th">signals_ticker</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>LLB SW</td>
<td>LLB.SW</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>DRAK NA</td>
<td>DRAK.AS</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>SWB MK</td>
<td>5211.KLSE</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>ELEKTRA* MF</td>
<td>ELEKTRA.MX</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>NOT_A_TICKER</td>
<td>NaN</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="signalstargetprocessor" class="level3">
<h3 class="anchored" data-anchor-id="signalstargetprocessor">1.2.4. SignalsTargetProcessor</h3>
<p>Numerai provides <a href="https://docs.numer.ai/numerai-signals/signals-overview#universe">targets for 5000 stocks</a> that are neutralized against all sorts of factors. However, it can be helpful to experiment with creating your own targets. You might want to explore different windows, different target binning and/or neutralization. <a href="https://crowdcent.github.io/numerblox/preprocessing.html#signalstargetprocessor"><code>SignalsTargetProcessor</code></a> engineers 3 different targets for every given windows: - <code>_raw</code>: Raw return based on price movements. - <code>_rank</code>: Ranks of raw return. - <code>_group</code>: Binned returns based on rank.</p>
<p>Note that Numerai provides targets based on 4-day returns and 20-day returns. While you can explore any window you like, it makes sense to start with <code>windows</code> close to these timeframes.</p>
<p>For the <code>bins</code> argument there are also many options possible. The followed are commonly used binning: - Nomi bins: <code>[0, 0.05, 0.25, 0.75, 0.95, 1]</code> - Uniform bins: <code>[0, 0.20, 0.40, 0.60, 0.80, 1]</code></p>
<hr>
<p><a href="https://github.com/crowdcent/numerblox/blob/master/numerblox/preprocessing.py#L557" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="signalstargetprocessor-1" class="level3">
<h3 class="anchored" data-anchor-id="signalstargetprocessor-1">SignalsTargetProcessor</h3>
<blockquote class="blockquote">
<pre><code> SignalsTargetProcessor (price_col:str='close', windows:list=None,
                         bins:list=None, labels:list=None)</code></pre>
</blockquote>
<p>Engineer targets for Numerai Signals.</p>
<p>More information on implements Numerai Signals targets:</p>
<p>https://forum.numer.ai/t/decoding-the-signals-target/2501</p>
<p>:param price_col: Column from which target will be derived.</p>
<p>:param windows: Timeframes to use for engineering targets. 10 and 20-day by default.</p>
<p>:param bins: Binning used to create group targets. Nomi binning by default.</p>
<p>:param labels: Scaling for binned target. Must be same length as resulting bins (bins-1). Numerai labels by default.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>stp <span class="op">=</span> SignalsTargetProcessor()</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>era_dataf.meta.era_col <span class="op">=</span> <span class="st">"date"</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>new_target_dataf <span class="op">=</span> stp.transform(era_dataf)</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>new_target_dataf.get_target_data.head(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"9391e495b26f4b8c90549885c23168d9","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">✅ Finished step <span style="font-weight: bold">SignalsTargetProcessor</span>. Output <span style="color: #808000; text-decoration-color: #808000">shape</span>=<span style="font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">300</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">27</span><span style="font-weight: bold">)</span>. Time taken for step: <span style="color: #000080; text-decoration-color: #000080; font-weight: bold">0:00:00</span><span style="color: #000080; text-decoration-color: #000080">.</span><span style="color: #000080; text-decoration-color: #000080; font-weight: bold">270008</span>. ✅
</pre>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">target_10d_raw</th>
<th data-quarto-table-cell-role="th">target_10d_rank</th>
<th data-quarto-table-cell-role="th">target_10d_group</th>
<th data-quarto-table-cell-role="th">target_20d_raw</th>
<th data-quarto-table-cell-role="th">target_20d_rank</th>
<th data-quarto-table-cell-role="th">target_20d_group</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>-0.027611</td>
<td>0.666667</td>
<td>0.5</td>
<td>-0.02454</td>
<td>0.333333</td>
<td>0.5</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>-0.004478</td>
<td>0.666667</td>
<td>0.5</td>
<td>-0.00889</td>
<td>0.666667</td>
<td>0.5</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="lagpreprocessor" class="level3">
<h3 class="anchored" data-anchor-id="lagpreprocessor">1.2.5. LagPreProcessor</h3>
<p>Many models like Gradient Boosting Machines (GBMs) don’t learn any time-series patterns by itself. However, if we create lags of our features the models will pick up on time dependencies between features. <a href="https://crowdcent.github.io/numerblox/preprocessing.html#lagpreprocessor"><code>LagPreProcessor</code></a> create lag features for given features and windows.</p>
<hr>
<p><a href="https://github.com/crowdcent/numerblox/blob/master/numerblox/preprocessing.py#L603" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="lagpreprocessor-1" class="level3">
<h3 class="anchored" data-anchor-id="lagpreprocessor-1">LagPreProcessor</h3>
<blockquote class="blockquote">
<pre><code> LagPreProcessor (windows:list=None, ticker_col:str='bloomberg_ticker',
                  feature_names:list=None)</code></pre>
</blockquote>
<p>Add lag features based on given windows.</p>
<p>:param windows: All lag windows to process for all features.</p>
<p>[5, 10, 15, 20] by default (4 weeks lookback)</p>
<p>:param ticker_col: Column name for grouping by tickers.</p>
<p>:param feature_names: All features for which you want to create lags. All features by default.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>lpp <span class="op">=</span> LagPreProcessor(ticker_col<span class="op">=</span><span class="st">"ticker"</span>, feature_names<span class="op">=</span>[<span class="st">"close"</span>, <span class="st">"volume"</span>])</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>dataf <span class="op">=</span> lpp(dataf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"6023fdaf87084a13b24d434ea9a5d652","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">✅ Finished step <span style="font-weight: bold">LagPreProcessor</span>. Output <span style="color: #808000; text-decoration-color: #808000">shape</span>=<span style="font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">300</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">16</span><span style="font-weight: bold">)</span>. Time taken for step: <span style="color: #000080; text-decoration-color: #000080; font-weight: bold">0:00:00</span><span style="color: #000080; text-decoration-color: #000080">.</span><span style="color: #000080; text-decoration-color: #000080; font-weight: bold">026052</span>. ✅
</pre>
</div>
</div>
<p>All lag features will contain <code>lag</code> in the column name.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>dataf.get_pattern_data(<span class="st">"lag"</span>).tail(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">close_lag5</th>
<th data-quarto-table-cell-role="th">close_lag10</th>
<th data-quarto-table-cell-role="th">close_lag15</th>
<th data-quarto-table-cell-role="th">close_lag20</th>
<th data-quarto-table-cell-role="th">volume_lag5</th>
<th data-quarto-table-cell-role="th">volume_lag10</th>
<th data-quarto-table-cell-role="th">volume_lag15</th>
<th data-quarto-table-cell-role="th">volume_lag20</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">298</td>
<td>85.300109</td>
<td>84.936054</td>
<td>86.874928</td>
<td>87.625224</td>
<td>3420.0</td>
<td>8816.0</td>
<td>1034.0</td>
<td>7048.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">299</td>
<td>85.761071</td>
<td>83.983167</td>
<td>87.079665</td>
<td>88.011967</td>
<td>2626.0</td>
<td>2588.0</td>
<td>8234.0</td>
<td>9973.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="differencepreprocessor" class="level3">
<h3 class="anchored" data-anchor-id="differencepreprocessor">1.2.6. DifferencePreProcessor</h3>
<p>After creating lags with the <a href="https://crowdcent.github.io/numerblox/preprocessing.html#lagpreprocessor"><code>LagPreProcessor</code></a>, it may be useful to create new features that calculate the difference between those lags. Through this process in <a href="https://crowdcent.github.io/numerblox/preprocessing.html#differencepreprocessor"><code>DifferencePreProcessor</code></a>, we can provide models with more time-series related patterns.</p>
<hr>
<p><a href="https://github.com/crowdcent/numerblox/blob/master/numerblox/preprocessing.py#L636" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="differencepreprocessor-1" class="level3">
<h3 class="anchored" data-anchor-id="differencepreprocessor-1">DifferencePreProcessor</h3>
<blockquote class="blockquote">
<pre><code> DifferencePreProcessor (windows:list=None, feature_names:list=None,
                         pct_diff:bool=False, abs_diff:bool=False)</code></pre>
</blockquote>
<p>Add difference features based on given windows. Run LagPreProcessor first.</p>
<p>:param windows: All lag windows to process for all features.</p>
<p>:param feature_names: All features for which you want to create differences. All features that also have lags by default.</p>
<p>:param pct_change: Method to calculate differences. If True, will calculate differences with a percentage change. Otherwise calculates a simple difference. Defaults to False</p>
<p>:param abs_diff: Whether to also calculate the absolute value of all differences. Defaults to True</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>dpp <span class="op">=</span> DifferencePreProcessor(</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>    feature_names<span class="op">=</span>[<span class="st">"close"</span>, <span class="st">"volume"</span>], windows<span class="op">=</span>[<span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">15</span>, <span class="dv">20</span>], pct_diff<span class="op">=</span><span class="va">True</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>dataf <span class="op">=</span> dpp.transform(dataf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"127a93734432428d8ea25adf8785e319","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">✅ Finished step <span style="font-weight: bold">DifferencePreProcessor</span>. Output <span style="color: #808000; text-decoration-color: #808000">shape</span>=<span style="font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">300</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">24</span><span style="font-weight: bold">)</span>. Time taken for step: <span style="color: #000080; text-decoration-color: #000080; font-weight: bold">0:00:00</span><span style="color: #000080; text-decoration-color: #000080">.</span><span style="color: #000080; text-decoration-color: #000080; font-weight: bold">026679</span>. ✅
</pre>
</div>
</div>
<p>All difference features will contain <code>diff</code> in the column name.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>dataf.get_pattern_data(<span class="st">"diff"</span>).tail(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">close_diff5</th>
<th data-quarto-table-cell-role="th">close_diff10</th>
<th data-quarto-table-cell-role="th">close_diff15</th>
<th data-quarto-table-cell-role="th">close_diff20</th>
<th data-quarto-table-cell-role="th">volume_diff5</th>
<th data-quarto-table-cell-role="th">volume_diff10</th>
<th data-quarto-table-cell-role="th">volume_diff15</th>
<th data-quarto-table-cell-role="th">volume_diff20</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">298</td>
<td>0.023306</td>
<td>0.027692</td>
<td>0.004756</td>
<td>-0.003848</td>
<td>0.409064</td>
<td>-0.45338</td>
<td>3.660542</td>
<td>-0.316260</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">299</td>
<td>0.025068</td>
<td>0.046768</td>
<td>0.009546</td>
<td>-0.001148</td>
<td>0.691927</td>
<td>0.71677</td>
<td>-0.460408</td>
<td>-0.554497</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="pandastafeaturegenerator" class="level3">
<h3 class="anchored" data-anchor-id="pandastafeaturegenerator">1.2.7. PandasTaFeatureGenerator</h3>
<p>This generator takes in a <a href="https://github.com/twopirllc/pandas-ta">pandas-ta</a> strategy and processing them on multiple cores. There is a simple default strategy available with RSI features for 14 and 60 rows.</p>
<p>To learn more about defining pandas-ta strategies. Check <a href="https://github.com/twopirllc/pandas-ta#pandas-ta-strategies">this section of the pandas-ta README</a>.</p>
<hr>
<p><a href="https://github.com/crowdcent/numerblox/blob/master/numerblox/preprocessing.py#L683" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="pandastafeaturegenerator-1" class="level3">
<h3 class="anchored" data-anchor-id="pandastafeaturegenerator-1">PandasTaFeatureGenerator</h3>
<blockquote class="blockquote">
<pre><code> PandasTaFeatureGenerator (strategy:pandas_ta.core.Strategy=None,
                           ticker_col:str='ticker', num_cores:int=None)</code></pre>
</blockquote>
<p>Generate features with pandas-ta. https://github.com/twopirllc/pandas-ta</p>
<p>:param strategy: Valid Pandas Ta strategy.</p>
<p>For more information on creating a strategy, see:</p>
<p>https://github.com/twopirllc/pandas-ta#pandas-ta-strategy</p>
<p>By default, a strategy with RSI(14) and RSI(60) is used.</p>
<p>:param ticker_col: Column name for grouping by tickers.</p>
<p>:param num_cores: Number of cores to use for multiprocessing.</p>
<p>By default, all available cores are used.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>pta <span class="op">=</span> PandasTaFeatureGenerator()</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>new_pta_df <span class="op">=</span> pta.transform(dummy_df)</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>new_pta_df.tail(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"f9364e07891d4da0b47b85c11e9ab3de","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"4581b2c078ab42a390cf767dba766296","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">✅ Finished step <span style="font-weight: bold">PandasTaFeatureGenerator</span>. Output <span style="color: #808000; text-decoration-color: #808000">shape</span>=<span style="font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">300</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">10</span><span style="font-weight: bold">)</span>. Time taken for step: <span style="color: #000080; text-decoration-color: #000080; font-weight: bold">0:00:00</span><span style="color: #000080; text-decoration-color: #000080">.</span><span style="color: #000080; text-decoration-color: #000080; font-weight: bold">422446</span>. ✅
</pre>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ticker</th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">open</th>
<th data-quarto-table-cell-role="th">high</th>
<th data-quarto-table-cell-role="th">low</th>
<th data-quarto-table-cell-role="th">close</th>
<th data-quarto-table-cell-role="th">volume</th>
<th data-quarto-table-cell-role="th">friday_date</th>
<th data-quarto-table-cell-role="th">feature_RSI_14</th>
<th data-quarto-table-cell-role="th">feature_RSI_60</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">298</td>
<td>GHI.US</td>
<td>2020-04-08</td>
<td>87.238077</td>
<td>87.308077</td>
<td>87.278077</td>
<td>87.288077</td>
<td>4819</td>
<td>2020-04-08</td>
<td>57.889148</td>
<td>53.066919</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">299</td>
<td>GHI.US</td>
<td>2020-04-09</td>
<td>87.860901</td>
<td>87.930901</td>
<td>87.900901</td>
<td>87.910901</td>
<td>4443</td>
<td>2020-04-09</td>
<td>61.647071</td>
<td>54.309328</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>The feature data can be selected directly through a <a href="https://crowdcent.github.io/numerblox/numerframe.html#numerframe"><code>NumerFrame</code></a> convenience method called <code>.get_feature_data</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>new_pta_df.get_feature_data.tail(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">feature_RSI_14</th>
<th data-quarto-table-cell-role="th">feature_RSI_60</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">298</td>
<td>57.889148</td>
<td>53.066919</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">299</td>
<td>61.647071</td>
<td>54.309328</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>A custom <code>pandas-ta</code> strategy can be defined as follows. Check the <a href="https://github.com/twopirllc/pandas-ta#indicators-by-category">pandas-ta docs</a> for more information on available indicators and arguments.</p>
<p><code>ta</code> takes in a list of dictionaries defining indicators and optional additional arguments. We use <code>col_names</code> for convenience so features are prefixed by <code>feature_</code> and can be easily retrieved within a <a href="https://crowdcent.github.io/numerblox/numerframe.html#numerframe"><code>NumerFrame</code></a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>strategy <span class="op">=</span> ta.Strategy(name<span class="op">=</span><span class="st">"mystrategy"</span>,</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>                       ta<span class="op">=</span>[{<span class="st">"kind"</span>: <span class="st">"cmo"</span>, <span class="st">"col_names"</span>: (<span class="st">"feature_CMO"</span>)}, <span class="co"># Chande Momentum Oscillator</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>                           {<span class="st">"kind"</span>: <span class="st">"rsi"</span>, <span class="st">"length"</span>: <span class="dv">60</span>, <span class="st">"col_names"</span>: (<span class="st">"feature_RSI_60"</span>)} <span class="co"># Relative Strength Index</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>                           ])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>pta <span class="op">=</span> PandasTaFeatureGenerator(strategy<span class="op">=</span>strategy)</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>new_pta_df <span class="op">=</span> pta.transform(dummy_df)</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>new_pta_df.get_feature_data.tail(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"f0a824f4cc9747a5a0cc64a5dd5a0266","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"f1ef82153d094b49bc7d1ab72885dff3","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">✅ Finished step <span style="font-weight: bold">PandasTaFeatureGenerator</span>. Output <span style="color: #808000; text-decoration-color: #808000">shape</span>=<span style="font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">300</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">10</span><span style="font-weight: bold">)</span>. Time taken for step: <span style="color: #000080; text-decoration-color: #000080; font-weight: bold">0:00:00</span><span style="color: #000080; text-decoration-color: #000080">.</span><span style="color: #000080; text-decoration-color: #000080; font-weight: bold">375046</span>. ✅
</pre>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">feature_CMO</th>
<th data-quarto-table-cell-role="th">feature_RSI_60</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">295</td>
<td>-2.293119</td>
<td>50.268290</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">296</td>
<td>6.295807</td>
<td>51.480114</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">297</td>
<td>19.281522</td>
<td>53.528935</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">298</td>
<td>15.778296</td>
<td>53.066919</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">299</td>
<td>23.294142</td>
<td>54.309328</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
</section>
<section id="custom-preprocessors" class="level2">
<h2 class="anchored" data-anchor-id="custom-preprocessors">2. Custom preprocessors</h2>
<p>There are an almost unlimited number of ways to preprocess (selection, engineering and manipulation). We have only scratched the surface with the preprocessors currently implemented. We invite the Numerai community to develop Numerai Classic and Numerai Signals preprocessors.</p>
<p>A new Preprocessor should inherit from <a href="https://crowdcent.github.io/numerblox/preprocessing.html#baseprocessor"><code>BaseProcessor</code></a> and implement a <code>transform</code> method. For efficient implementation, we recommend you use <a href="https://crowdcent.github.io/numerblox/numerframe.html#numerframe"><code>NumerFrame</code></a> functionality for preprocessing. You can also support Pandas DataFrame input as long as the <code>transform</code> method returns a <a href="https://crowdcent.github.io/numerblox/numerframe.html#numerframe"><code>NumerFrame</code></a>. This ensures that the Preprocessor still works within a full <code>numerai-blocks</code> pipeline. A template for new preprocessors is given below.</p>
<p>To enable fancy logging output. Add the <code>@display_processor_info</code> decorator to the <code>transform</code> method.</p>
<hr>
<p><a href="https://github.com/crowdcent/numerblox/blob/master/numerblox/preprocessing.py#L753" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="awesomepreprocessor" class="level3">
<h3 class="anchored" data-anchor-id="awesomepreprocessor">AwesomePreProcessor</h3>
<blockquote class="blockquote">
<pre><code> AwesomePreProcessor ()</code></pre>
</blockquote>
<p>TEMPLATE - Do some awesome preprocessing.</p>
<hr>


</section>
</section>

</main> <!-- /main -->
<script type="application/vnd.jupyter.widget-state+json">
{"state":{},"version_major":2,"version_minor":0}
</script>
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>