<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="Compute evaluation metrics.">

<title>numerblox - Evaluation</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<script src="https://unpkg.com/@jupyter-widgets/html-manager@*/dist/embed-amd.js" crossorigin="anonymous"></script>


<link rel="stylesheet" href="styles.css">
<meta property="og:title" content="numerblox - Evaluation">
<meta property="og:description" content="Compute evaluation metrics.">
<meta property="og:image" content="https://crowdcent.github.io/numerblox/07_evaluation_files/figure-html/cell-12-output-1.png">
<meta property="og:site-name" content="numerblox">
<meta property="og:image:height" content="499">
<meta property="og:image:width" content="1234">
<meta name="twitter:title" content="numerblox - Evaluation">
<meta name="twitter:description" content="Compute evaluation metrics.">
<meta name="twitter:image" content="https://crowdcent.github.io/numerblox/07_evaluation_files/figure-html/cell-12-output-1.png">
<meta name="twitter:image-height" content="499">
<meta name="twitter:image-width" content="1234">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">numerblox</span>
    </a>
  </div>
        <div class="quarto-navbar-tools ms-auto">
</div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./evaluation.html">Evaluation</a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">NumerBlox</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./misc.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Misc</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./download.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Download</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./numerframe.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">NumerFrame</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./preprocessing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preprocessing</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./model.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Model</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./postprocessing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Postprocessing</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./modelpipeline.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ModelPipeline</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./evaluation.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Evaluation</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./key.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Key</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./submission.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Submission</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#overview" id="toc-overview" class="nav-link active" data-scroll-target="#overview">Overview</a></li>
  <li><a href="#base" id="toc-base" class="nav-link" data-scroll-target="#base">0. Base</a>
  <ul class="collapse">
  <li><a href="#baseevaluator" id="toc-baseevaluator" class="nav-link" data-scroll-target="#baseevaluator">BaseEvaluator</a></li>
  </ul></li>
  <li><a href="#numerai-classic" id="toc-numerai-classic" class="nav-link" data-scroll-target="#numerai-classic">1. Numerai Classic</a>
  <ul class="collapse">
  <li><a href="#numeraiclassicevaluator" id="toc-numeraiclassicevaluator" class="nav-link" data-scroll-target="#numeraiclassicevaluator">NumeraiClassicEvaluator</a></li>
  </ul></li>
  <li><a href="#numerai-signals" id="toc-numerai-signals" class="nav-link" data-scroll-target="#numerai-signals">2. Numerai Signals</a>
  <ul class="collapse">
  <li><a href="#numeraisignalsevaluator" id="toc-numeraisignalsevaluator" class="nav-link" data-scroll-target="#numeraisignalsevaluator">NumeraiSignalsEvaluator</a></li>
  <li><a href="#example-usage" id="toc-example-usage" class="nav-link" data-scroll-target="#example-usage">Example usage</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/crowdcent/numerblox/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Evaluation</h1>
</div>

<div>
  <div class="description">
    Compute evaluation metrics.
  </div>
</div>


<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->
<section id="overview" class="level2">
<h2 class="anchored" data-anchor-id="overview">Overview</h2>
<p>This section provides evaluation schemes for both Numerai Classic and Signals. The <code>Evaluator</code> takes a <a href="https://crowdcent.github.io/numerblox/numerframe.html#numerframe"><code>NumerFrame</code></a> as input and returns a Pandas DataFrame containing metrics for each given prediction column.</p>
</section>
<section id="base" class="level2">
<h2 class="anchored" data-anchor-id="base">0. Base</h2>
<p><a href="https://crowdcent.github.io/numerblox/evaluation.html#baseevaluator"><code>BaseEvaluator</code></a> implements all the evaluation logic that is common for Numerai Classic and Signals. This includes: - Mean, Standard Deviation and Sharpe for era returns. - Max drawdown - Annual Percentage Yield (APY) - Correlation with example predictions - Max <a href="https://forum.numer.ai/t/model-diagnostics-feature-exposure/899">feature exposure</a> - <a href="https://docs.numer.ai/tournament/feature-neutral-correlation">Feature Neutral Mean (FNC)</a>, Standard deviation and Sharpe - <a href="https://forum.numer.ai/t/true-contribution-details/5128/4">Exposure Dissimilarity</a> - <a href="https://www.investopedia.com/terms/c/calmarratio.asp">Calmar Ratio</a> - Mean, Standard Deviation and Sharpe for TB200 (Buy top 200 stocks and sell bottom 200 stocks). - Mean, Standard Deviation and Sharpe for TB500 (Buy top 500 stocks and sell bottom 500 stocks).</p>
<hr>
<p><a href="https://github.com/crowdcent/numerblox/blob/master/numerblox/evaluation.py#L426" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="baseevaluator" class="level3">
<h3 class="anchored" data-anchor-id="baseevaluator">BaseEvaluator</h3>
<blockquote class="blockquote">
<pre><code> BaseEvaluator (era_col:str='era', fast_mode=False)</code></pre>
</blockquote>
<p>Evaluation functionality that is relevant for both Numerai Classic and Numerai Signals.</p>
<p>:param era_col: Column name pointing to eras.</p>
<p>Most commonly ‚Äúera‚Äù for Numerai Classic and ‚Äúfriday_date‚Äù for Numerai Signals.</p>
<p>:param fast_mode: Will skip compute intensive metrics if set to True, namely max_exposure, feature neutral mean, TB200 and TB500.</p>
<p>Note that we calculate the sample standard deviation with ddof=0. It may differ slightly from the standard Pandas calculation, but is consistent with how NumPy computes standard deviation. More info: https://stackoverflow.com/questions/24984178/different-std-in-pandas-vs-numpy</p>
</section>
</section>
<section id="numerai-classic" class="level2">
<h2 class="anchored" data-anchor-id="numerai-classic">1. Numerai Classic</h2>
<p><a href="https://crowdcent.github.io/numerblox/evaluation.html#numeraiclassicevaluator"><code>NumeraiClassicEvaluator</code></a> extends the base evaluation scheme with metrics specific to Numerai Classic.</p>
<hr>
<p><a href="https://github.com/crowdcent/numerblox/blob/master/numerblox/evaluation.py#L807" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="numeraiclassicevaluator" class="level3">
<h3 class="anchored" data-anchor-id="numeraiclassicevaluator">NumeraiClassicEvaluator</h3>
<blockquote class="blockquote">
<pre><code> NumeraiClassicEvaluator (era_col:str='era', fast_mode=False)</code></pre>
</blockquote>
<p>Evaluator for all metrics that are relevant in Numerai Classic.</p>
</section>
</section>
<section id="numerai-signals" class="level2">
<h2 class="anchored" data-anchor-id="numerai-signals">2. Numerai Signals</h2>
<p><a href="https://crowdcent.github.io/numerblox/evaluation.html#numeraisignalsevaluator"><code>NumeraiSignalsEvaluator</code></a> extends the base evaluation scheme with metrics specific to Numerai Signals.</p>
<hr>
<p><a href="https://github.com/crowdcent/numerblox/blob/master/numerblox/evaluation.py#L853" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="numeraisignalsevaluator" class="level3">
<h3 class="anchored" data-anchor-id="numeraisignalsevaluator">NumeraiSignalsEvaluator</h3>
<blockquote class="blockquote">
<pre><code> NumeraiSignalsEvaluator (era_col:str='friday_date', fast_mode=False)</code></pre>
</blockquote>
<p>Evaluator for all metrics that are relevant in Numerai Signals.</p>
</section>
<section id="example-usage" class="level3">
<h3 class="anchored" data-anchor-id="example-usage">Example usage</h3>
<section id="numeraiclassicevaluator-1" class="level4">
<h4 class="anchored" data-anchor-id="numeraiclassicevaluator-1">NumeraiClassicEvaluator</h4>
<p>We will test <a href="https://crowdcent.github.io/numerblox/evaluation.html#numeraiclassicevaluator"><code>NumeraiClassicEvaluator</code></a> on version v4.2 evaluation data with example predictions. The baseline reference (<code>example_col</code>) will be random predictions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> numerblox.download <span class="im">import</span> NumeraiClassicDownloader</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>directory <span class="op">=</span> <span class="st">"eval_test_1234321/"</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>downloader <span class="op">=</span> NumeraiClassicDownloader(directory_path<span class="op">=</span>directory)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>No existing directory found at 'eval_test_1234321'. Creating directory...</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>downloader.download_single_dataset(filename<span class="op">=</span><span class="st">"v4.2/validation_int8.parquet"</span>,</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>                                   dest_path<span class="op">=</span>directory <span class="op">+</span> <span class="st">"validation.parquet"</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>downloader.download_single_dataset(filename<span class="op">=</span><span class="st">"v4.2/validation_example_preds.parquet"</span>,</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>                                   dest_path<span class="op">=</span>directory <span class="op">+</span> <span class="st">"validation_example_preds.parquet"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">üìÅ <span style="color: #008000; text-decoration-color: #008000">Downloading</span> <span style="color: #008000; text-decoration-color: #008000">'v4.2/validation_int8.parquet'</span> üìÅ
</pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2023-09-11 12:56:23,926 INFO numerapi.utils: starting download
eval_test_1234321/validation.parquet: 2.16GB [00:52, 41.1MB/s]                            
2023-09-11 12:57:17,092 INFO numerapi.utils: starting download
eval_test_1234321/validation_example_preds.parquet: 60.7MB [00:04, 14.0MB/s]                            </code></pre>
</div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">üìÅ <span style="color: #008000; text-decoration-color: #008000">Downloading</span> <span style="color: #008000; text-decoration-color: #008000">'v4.2/validation_example_preds.parquet'</span> üìÅ
</pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">1234</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>test_dataf <span class="op">=</span> create_numerframe(directory <span class="op">+</span> <span class="st">"validation.parquet"</span>,</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>                               columns<span class="op">=</span>[<span class="st">'era'</span>, <span class="st">'data_type'</span>, <span class="st">'feature_honoured_observational_balaamite'</span>,</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>                                        <span class="st">'feature_polaroid_vadose_quinze'</span>, <span class="st">'target'</span>, <span class="st">'target_nomi_v4_20'</span>, <span class="st">'target_nomi_v4_60'</span>, <span class="st">'id'</span>])</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>example_preds <span class="op">=</span> pd.read_parquet(directory <span class="op">+</span> <span class="st">"validation_example_preds.parquet"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>test_dataf <span class="op">=</span> test_dataf.merge(example_preds, on<span class="op">=</span><span class="st">"id"</span>, how<span class="op">=</span><span class="st">"left"</span>).reset_index()</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>test_dataf <span class="op">=</span> test_dataf.sample(<span class="dv">10_000</span>, random_state<span class="op">=</span><span class="dv">1234</span>)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>test_dataf.loc[:, <span class="st">"prediction_random"</span>] <span class="op">=</span> np.random.uniform(size<span class="op">=</span><span class="bu">len</span>(test_dataf))</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>test_dataf.head(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">id</th>
<th data-quarto-table-cell-role="th">era</th>
<th data-quarto-table-cell-role="th">data_type</th>
<th data-quarto-table-cell-role="th">feature_honoured_observational_balaamite</th>
<th data-quarto-table-cell-role="th">feature_polaroid_vadose_quinze</th>
<th data-quarto-table-cell-role="th">target</th>
<th data-quarto-table-cell-role="th">target_nomi_v4_20</th>
<th data-quarto-table-cell-role="th">target_nomi_v4_60</th>
<th data-quarto-table-cell-role="th">prediction</th>
<th data-quarto-table-cell-role="th">prediction_random</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">2199551</td>
<td>n3b8237d69852ab6</td>
<td>1006</td>
<td>validation</td>
<td>1</td>
<td>1</td>
<td>0.75</td>
<td>0.5</td>
<td>0.5</td>
<td>0.638587</td>
<td>0.191519</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2116441</td>
<td>nabfc4390f355fa4</td>
<td>0990</td>
<td>validation</td>
<td>3</td>
<td>1</td>
<td>0.75</td>
<td>0.5</td>
<td>0.5</td>
<td>0.088223</td>
<td>0.622109</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>The <code>Evaluator</code> returns a Pandas DataFrame containing metrics for each prediction column defined. Note that any column can be used as example prediction. For practical use cases we recommend using proper example predictions (provided by Numerai) instead of random predictions.</p>
</section>
<section id="fast-evaluation" class="level4">
<h4 class="anchored" data-anchor-id="fast-evaluation">Fast evaluation</h4>
<p><code>fast_mode</code> skips max. feature exposure, feature neutral mean, FNCv3, Exposure Dissimilarity, TB200 and TB500 calculations, which can take a while to compute on full Numerai datasets.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>evaluator <span class="op">=</span> NumeraiClassicEvaluator(fast_mode<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>val_stats_fast <span class="op">=</span> evaluator.full_evaluation(</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    dataf<span class="op">=</span>test_dataf,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    target_col<span class="op">=</span><span class="st">"target"</span>,</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    pred_cols<span class="op">=</span>[<span class="st">"prediction"</span>, <span class="st">"prediction_random"</span>],</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    example_col<span class="op">=</span><span class="st">"prediction_random"</span>,</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>val_stats_fast</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>WARNING: No suitable feature set defined for FNC. Skipping calculation of FNC.</code></pre>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"071960daab3e4b60a7d58768c94f6637","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">target</th>
<th data-quarto-table-cell-role="th">mean</th>
<th data-quarto-table-cell-role="th">std</th>
<th data-quarto-table-cell-role="th">sharpe</th>
<th data-quarto-table-cell-role="th">max_drawdown</th>
<th data-quarto-table-cell-role="th">apy</th>
<th data-quarto-table-cell-role="th">calmar_ratio</th>
<th data-quarto-table-cell-role="th">corr_with_example_preds</th>
<th data-quarto-table-cell-role="th">legacy_mean</th>
<th data-quarto-table-cell-role="th">legacy_std</th>
<th data-quarto-table-cell-role="th">legacy_sharpe</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">prediction</td>
<td>target</td>
<td>0.016806</td>
<td>0.245725</td>
<td>0.068394</td>
<td>-0.999953</td>
<td>-6.785841</td>
<td>-6.786159</td>
<td>0.011225</td>
<td>0.010627</td>
<td>0.243476</td>
<td>0.043646</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">prediction_random</td>
<td>target</td>
<td>-0.003442</td>
<td>0.236131</td>
<td>-0.014578</td>
<td>-1.000000</td>
<td>-60.911901</td>
<td>-60.911904</td>
<td>0.981155</td>
<td>-0.001949</td>
<td>0.237189</td>
<td>-0.008219</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="full-evaluation" class="level4">
<h4 class="anchored" data-anchor-id="full-evaluation">Full evaluation</h4>
<p>The full evaluation also computes the metrics from fast mode. Additionally, it computes max. feature exposure, feature neutral mean, FNCv3, Exposure Dissimilarity, TB200 and TB500 calculations. Note that this can take a long time when computing on the full dataset and using all features.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>evaluator <span class="op">=</span> NumeraiClassicEvaluator(fast_mode<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>val_stats_full <span class="op">=</span> evaluator.full_evaluation(</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    dataf<span class="op">=</span>test_dataf,</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    target_col<span class="op">=</span><span class="st">"target"</span>,</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    pred_cols<span class="op">=</span>[<span class="st">"prediction"</span>, <span class="st">"prediction_random"</span>],</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    example_col<span class="op">=</span><span class="st">"prediction_random"</span>,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>val_stats_full</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>WARNING: No suitable feature set defined for FNC. Skipping calculation of FNC.</code></pre>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"9b7ab6d1c25947f4aa976a61ac97744c","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">ü§ñ Neutralized <span style="color: #000080; text-decoration-color: #000080; font-weight: bold">'prediction'</span><span style="color: #000080; text-decoration-color: #000080; font-weight: bold"> with proportion </span><span style="color: #000080; text-decoration-color: #000080; font-weight: bold">'1.0'</span><span style="color: #000080; text-decoration-color: #000080; font-weight: bold"> ü§ñ</span>
</pre>
</div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">New neutralized column = <span style="color: #008000; text-decoration-color: #008000; font-weight: bold">'prediction_neutralized_1.0'</span>.
</pre>
</div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">‚úÖ Finished step <span style="font-weight: bold">FeatureNeutralizer</span>. Output <span style="color: #808000; text-decoration-color: #808000">shape</span>=<span style="font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">10000</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">11</span><span style="font-weight: bold">)</span>. Time taken for step: <span style="color: #000080; text-decoration-color: #000080; font-weight: bold">0:00:02</span><span style="color: #000080; text-decoration-color: #000080">.</span><span style="color: #000080; text-decoration-color: #000080; font-weight: bold">280491</span>. ‚úÖ
</pre>
</div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">ü§ñ Neutralized <span style="color: #000080; text-decoration-color: #000080; font-weight: bold">'prediction_random'</span><span style="color: #000080; text-decoration-color: #000080; font-weight: bold"> with proportion </span><span style="color: #000080; text-decoration-color: #000080; font-weight: bold">'1.0'</span><span style="color: #000080; text-decoration-color: #000080; font-weight: bold"> ü§ñ</span>
</pre>
</div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">New neutralized column = <span style="color: #008000; text-decoration-color: #008000; font-weight: bold">'prediction_random_neutralized_1.0'</span>.
</pre>
</div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">‚úÖ Finished step <span style="font-weight: bold">FeatureNeutralizer</span>. Output <span style="color: #808000; text-decoration-color: #808000">shape</span>=<span style="font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">10000</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">12</span><span style="font-weight: bold">)</span>. Time taken for step: <span style="color: #000080; text-decoration-color: #000080; font-weight: bold">0:00:02</span><span style="color: #000080; text-decoration-color: #000080">.</span><span style="color: #000080; text-decoration-color: #000080; font-weight: bold">307913</span>. ‚úÖ
</pre>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">target</th>
<th data-quarto-table-cell-role="th">mean</th>
<th data-quarto-table-cell-role="th">std</th>
<th data-quarto-table-cell-role="th">sharpe</th>
<th data-quarto-table-cell-role="th">max_drawdown</th>
<th data-quarto-table-cell-role="th">apy</th>
<th data-quarto-table-cell-role="th">calmar_ratio</th>
<th data-quarto-table-cell-role="th">corr_with_example_preds</th>
<th data-quarto-table-cell-role="th">legacy_mean</th>
<th data-quarto-table-cell-role="th">legacy_std</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">feature_neutral_mean</th>
<th data-quarto-table-cell-role="th">feature_neutral_std</th>
<th data-quarto-table-cell-role="th">feature_neutral_sharpe</th>
<th data-quarto-table-cell-role="th">tb200_mean</th>
<th data-quarto-table-cell-role="th">tb200_std</th>
<th data-quarto-table-cell-role="th">tb200_sharpe</th>
<th data-quarto-table-cell-role="th">tb500_mean</th>
<th data-quarto-table-cell-role="th">tb500_std</th>
<th data-quarto-table-cell-role="th">tb500_sharpe</th>
<th data-quarto-table-cell-role="th">exposure_dissimilarity</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">prediction</td>
<td>target</td>
<td>0.016806</td>
<td>0.245725</td>
<td>0.068394</td>
<td>-0.999953</td>
<td>-6.785841</td>
<td>-6.786159</td>
<td>0.011225</td>
<td>0.010627</td>
<td>0.243476</td>
<td>...</td>
<td>0.015166</td>
<td>0.246742</td>
<td>0.061465</td>
<td>0.009263</td>
<td>0.241614</td>
<td>0.038338</td>
<td>0.009263</td>
<td>0.241614</td>
<td>0.038338</td>
<td>-1.37308</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">prediction_random</td>
<td>target</td>
<td>-0.003442</td>
<td>0.236131</td>
<td>-0.014578</td>
<td>-1.000000</td>
<td>-60.911901</td>
<td>-60.911904</td>
<td>0.981155</td>
<td>-0.001949</td>
<td>0.237189</td>
<td>...</td>
<td>-0.005719</td>
<td>0.242857</td>
<td>-0.023548</td>
<td>0.002266</td>
<td>0.236810</td>
<td>0.009570</td>
<td>0.002266</td>
<td>0.236810</td>
<td>0.009570</td>
<td>0.00000</td>
</tr>
</tbody>
</table>

<p>2 rows √ó 22 columns</p>
</div>
</div>
</div>
</section>
<section id="plot-correlations" class="level4">
<h4 class="anchored" data-anchor-id="plot-correlations">Plot correlations</h4>
<p>The <code>plot_correlations</code> method will use matplotlib to plot per era correlation scores over time. The plots default to a rolling window of 20 eras in order to best align with repuation scores as measured on the Numerai leaderboards.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>evaluator.plot_correlations(</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>    test_dataf.fillna(<span class="fl">0.5</span>), pred_cols<span class="op">=</span>[<span class="st">"prediction"</span>, <span class="st">"prediction_random"</span>], roll_mean<span class="op">=</span><span class="dv">20</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="07_evaluation_files/figure-html/cell-12-output-1.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="07_evaluation_files/figure-html/cell-12-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Clean up environment</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>downloader.remove_base_directory()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">‚ö† <span style="color: #800000; text-decoration-color: #800000">Deleting directory for </span><span style="color: #800000; text-decoration-color: #800000">'NumeraiClassicDownloader</span><span style="color: #008000; text-decoration-color: #008000">'</span> ‚ö†
Path: <span style="color: #008000; text-decoration-color: #008000">'/home/clepelaars/numerblox/nbs/eval_test_1234321'</span>
</pre>
</div>
</div>
<hr>


</section>
</section>
</section>

</main> <!-- /main -->
<script type="application/vnd.jupyter.widget-state+json">
{"state":{},"version_major":2,"version_minor":0}
</script>
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "Óßã";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>