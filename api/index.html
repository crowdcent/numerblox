
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../disclaimer/">
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.4.8">
    
    
      
        <title>API Reference - numerblox</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.4b4a2bd9.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.356b1318.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Ubuntu";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="005380">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#full-api-reference" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="numerblox" class="md-header__button md-logo" aria-label="numerblox" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19.5 9V1.5h-3V9h-3V1.5h-3V9h-3V1.5H4.65V9H3v1.5h18V9h-1.5m0 4.5h-3V21h-3v-7.5h-3V21h-3v-7.5H4.65V21H3v1.5h18V21h-1.5v-7.5Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            numerblox
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              API Reference
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href=".." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../end_to_end/" class="md-tabs__link">
        
  
    
  
  End-To-End Examples

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../download/" class="md-tabs__link">
        
  
    
  
  Downloaders

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../numerframe/" class="md-tabs__link">
        
  
    
  
  NumerFrame

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../preprocessing/" class="md-tabs__link">
        
  
    
  
  Preprocessing

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../targets/" class="md-tabs__link">
        
  
    
  
  Target Engineering

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../meta/" class="md-tabs__link">
        
  
    
  
  Meta Estimators

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../neutralization/" class="md-tabs__link">
        
  
    
  
  Feature Neutralization

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../penalization/" class="md-tabs__link">
        
  
    
  
  Feature Penalization

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../prediction_loaders/" class="md-tabs__link">
        
  
    
  
  Prediction Loaders

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../models/" class="md-tabs__link">
        
  
    
  
  Models

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../evaluation/" class="md-tabs__link">
        
  
    
  
  Evaluation

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../submission/" class="md-tabs__link">
        
  
    
  
  Submitters

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../contributing/" class="md-tabs__link">
        
  
    
  
  How To Contribute

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../crowdcent/" class="md-tabs__link">
        
  
    
  
  About CrowdCent

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../disclaimer/" class="md-tabs__link">
        
  
    
  
  Disclaimer

      </a>
    </li>
  

      
        
  
  
    
  
  
    <li class="md-tabs__item md-tabs__item--active">
      <a href="./" class="md-tabs__link">
        
  
    
  
  API Reference

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="numerblox" class="md-nav__button md-logo" aria-label="numerblox" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19.5 9V1.5h-3V9h-3V1.5h-3V9h-3V1.5H4.65V9H3v1.5h18V9h-1.5m0 4.5h-3V21h-3v-7.5h-3V21h-3v-7.5H4.65V21H3v1.5h18V21h-1.5v-7.5Z"/></svg>

    </a>
    numerblox
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../end_to_end/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    End-To-End Examples
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../download/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Downloaders
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../numerframe/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    NumerFrame
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../preprocessing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Preprocessing
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../targets/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Target Engineering
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../meta/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Meta Estimators
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../neutralization/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Feature Neutralization
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../penalization/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Feature Penalization
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../prediction_loaders/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Prediction Loaders
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../models/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Models
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../evaluation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Evaluation
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../submission/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Submitters
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../contributing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    How To Contribute
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../crowdcent/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    About CrowdCent
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../disclaimer/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Disclaimer
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    API Reference
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    API Reference
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#numerblox.download" class="md-nav__link">
    download
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.download.BaseDownloader" class="md-nav__link">
    BaseDownloader
  </a>
  
    <nav class="md-nav" aria-label="BaseDownloader">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.download.BaseDownloader.__call__" class="md-nav__link">
    __call__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.download.BaseDownloader.download_inference_data" class="md-nav__link">
    download_inference_data()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.download.BaseDownloader.download_training_data" class="md-nav__link">
    download_training_data()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.download.BaseIO" class="md-nav__link">
    BaseIO
  </a>
  
    <nav class="md-nav" aria-label="BaseIO">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.download.BaseIO.get_all_files" class="md-nav__link">
    get_all_files
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.download.BaseIO.is_empty" class="md-nav__link">
    is_empty
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.download.BaseIO.download_directory_from_gcs" class="md-nav__link">
    download_directory_from_gcs()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.download.BaseIO.download_file_from_gcs" class="md-nav__link">
    download_file_from_gcs()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.download.BaseIO.remove_base_directory" class="md-nav__link">
    remove_base_directory()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.download.BaseIO.upload_directory_to_gcs" class="md-nav__link">
    upload_directory_to_gcs()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.download.BaseIO.upload_file_to_gcs" class="md-nav__link">
    upload_file_to_gcs()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.download.EODDownloader" class="md-nav__link">
    EODDownloader
  </a>
  
    <nav class="md-nav" aria-label="EODDownloader">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.download.EODDownloader.download_inference_data" class="md-nav__link">
    download_inference_data()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.download.EODDownloader.download_training_data" class="md-nav__link">
    download_training_data()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.download.EODDownloader.generate_full_dataf" class="md-nav__link">
    generate_full_dataf()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.download.EODDownloader.generate_stock_dataf" class="md-nav__link">
    generate_stock_dataf()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.download.EODDownloader.get_live_data" class="md-nav__link">
    get_live_data()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.download.KaggleDownloader" class="md-nav__link">
    KaggleDownloader
  </a>
  
    <nav class="md-nav" aria-label="KaggleDownloader">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.download.KaggleDownloader.download_inference_data" class="md-nav__link">
    download_inference_data()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.download.KaggleDownloader.download_training_data" class="md-nav__link">
    download_training_data()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.download.NumeraiClassicDownloader" class="md-nav__link">
    NumeraiClassicDownloader
  </a>
  
    <nav class="md-nav" aria-label="NumeraiClassicDownloader">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.download.NumeraiClassicDownloader.__get_dest_path" class="md-nav__link">
    __get_dest_path()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.download.NumeraiClassicDownloader.download_example_data" class="md-nav__link">
    download_example_data()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.download.NumeraiClassicDownloader.download_inference_data" class="md-nav__link">
    download_inference_data()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.download.NumeraiClassicDownloader.download_live_data" class="md-nav__link">
    download_live_data()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.download.NumeraiClassicDownloader.download_meta_model_preds" class="md-nav__link">
    download_meta_model_preds()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.download.NumeraiClassicDownloader.download_single_dataset" class="md-nav__link">
    download_single_dataset()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.download.NumeraiClassicDownloader.download_training_data" class="md-nav__link">
    download_training_data()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.download.NumeraiClassicDownloader.get_classic_features" class="md-nav__link">
    get_classic_features()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.numerframe" class="md-nav__link">
    numerframe
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.numerframe.NumerFrame" class="md-nav__link">
    NumerFrame
  </a>
  
    <nav class="md-nav" aria-label="NumerFrame">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.numerframe.NumerFrame.get_aux_data" class="md-nav__link">
    get_aux_data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.numerframe.NumerFrame.get_era_data" class="md-nav__link">
    get_era_data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.numerframe.NumerFrame.get_feature_data" class="md-nav__link">
    get_feature_data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.numerframe.NumerFrame.get_fncv3_feature_data" class="md-nav__link">
    get_fncv3_feature_data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.numerframe.NumerFrame.get_medium_feature_data" class="md-nav__link">
    get_medium_feature_data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.numerframe.NumerFrame.get_prediction_aux_data" class="md-nav__link">
    get_prediction_aux_data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.numerframe.NumerFrame.get_prediction_data" class="md-nav__link">
    get_prediction_data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.numerframe.NumerFrame.get_single_target_data" class="md-nav__link">
    get_single_target_data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.numerframe.NumerFrame.get_small_feature_data" class="md-nav__link">
    get_small_feature_data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.numerframe.NumerFrame.get_target_data" class="md-nav__link">
    get_target_data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.numerframe.NumerFrame.get_unique_eras" class="md-nav__link">
    get_unique_eras
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.numerframe.NumerFrame.get_v2_equivalent_feature_data" class="md-nav__link">
    get_v2_equivalent_feature_data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.numerframe.NumerFrame.get_v3_equivalent_feature_data" class="md-nav__link">
    get_v3_equivalent_feature_data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.numerframe.NumerFrame.__init_meta_attrs" class="md-nav__link">
    __init_meta_attrs()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.numerframe.NumerFrame.__set_era_col" class="md-nav__link">
    __set_era_col()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.numerframe.NumerFrame.get_column_selection" class="md-nav__link">
    get_column_selection()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.numerframe.NumerFrame.get_era_batch" class="md-nav__link">
    get_era_batch()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.numerframe.NumerFrame.get_feature_group" class="md-nav__link">
    get_feature_group()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.numerframe.NumerFrame.get_feature_target_pair" class="md-nav__link">
    get_feature_target_pair()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.numerframe.NumerFrame.get_last_n_eras" class="md-nav__link">
    get_last_n_eras()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.numerframe.NumerFrame.get_pattern_data" class="md-nav__link">
    get_pattern_data()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.numerframe.create_numerframe" class="md-nav__link">
    create_numerframe()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.preprocessing.base" class="md-nav__link">
    base
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.preprocessing.base.BasePreProcessor" class="md-nav__link">
    BasePreProcessor
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.preprocessing.classic" class="md-nav__link">
    classic
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.preprocessing.classic.GroupStatsPreProcessor" class="md-nav__link">
    GroupStatsPreProcessor
  </a>
  
    <nav class="md-nav" aria-label="GroupStatsPreProcessor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.preprocessing.classic.GroupStatsPreProcessor.get_feature_names_out" class="md-nav__link">
    get_feature_names_out()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.preprocessing.classic.GroupStatsPreProcessor.transform" class="md-nav__link">
    transform()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.preprocessing.signals" class="md-nav__link">
    signals
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.preprocessing.signals.DifferencePreProcessor" class="md-nav__link">
    DifferencePreProcessor
  </a>
  
    <nav class="md-nav" aria-label="DifferencePreProcessor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.preprocessing.signals.DifferencePreProcessor.transform" class="md-nav__link">
    transform()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.preprocessing.signals.EraQuantileProcessor" class="md-nav__link">
    EraQuantileProcessor
  </a>
  
    <nav class="md-nav" aria-label="EraQuantileProcessor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.preprocessing.signals.EraQuantileProcessor.get_feature_names_out" class="md-nav__link">
    get_feature_names_out()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.preprocessing.signals.HLOCVAdjuster" class="md-nav__link">
    HLOCVAdjuster
  </a>
  
    <nav class="md-nav" aria-label="HLOCVAdjuster">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.preprocessing.signals.HLOCVAdjuster.transform" class="md-nav__link">
    transform()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.preprocessing.signals.KatsuFeatureGenerator" class="md-nav__link">
    KatsuFeatureGenerator
  </a>
  
    <nav class="md-nav" aria-label="KatsuFeatureGenerator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.preprocessing.signals.KatsuFeatureGenerator.__ema1" class="md-nav__link">
    __ema1()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.preprocessing.signals.KatsuFeatureGenerator.feature_engineering" class="md-nav__link">
    feature_engineering()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.preprocessing.signals.KatsuFeatureGenerator.get_feature_names_out" class="md-nav__link">
    get_feature_names_out()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.preprocessing.signals.KatsuFeatureGenerator.transform" class="md-nav__link">
    transform()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.preprocessing.signals.LagPreProcessor" class="md-nav__link">
    LagPreProcessor
  </a>
  
    <nav class="md-nav" aria-label="LagPreProcessor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.preprocessing.signals.LagPreProcessor.get_feature_names_out" class="md-nav__link">
    get_feature_names_out()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.preprocessing.signals.PandasTaFeatureGenerator" class="md-nav__link">
    PandasTaFeatureGenerator
  </a>
  
    <nav class="md-nav" aria-label="PandasTaFeatureGenerator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.preprocessing.signals.PandasTaFeatureGenerator.add_features" class="md-nav__link">
    add_features()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.preprocessing.signals.PandasTaFeatureGenerator.transform" class="md-nav__link">
    transform()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.preprocessing.signals.ReduceMemoryProcessor" class="md-nav__link">
    ReduceMemoryProcessor
  </a>
  
    <nav class="md-nav" aria-label="ReduceMemoryProcessor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.preprocessing.signals.ReduceMemoryProcessor.get_feature_names_out" class="md-nav__link">
    get_feature_names_out()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.preprocessing.signals.TickerMapper" class="md-nav__link">
    TickerMapper
  </a>
  
    <nav class="md-nav" aria-label="TickerMapper">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.preprocessing.signals.TickerMapper.transform" class="md-nav__link">
    transform()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.targets" class="md-nav__link">
    targets
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.targets.BaseTargetProcessor" class="md-nav__link">
    BaseTargetProcessor
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.targets.BayesianGMMTargetProcessor" class="md-nav__link">
    BayesianGMMTargetProcessor
  </a>
  
    <nav class="md-nav" aria-label="BayesianGMMTargetProcessor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.targets.BayesianGMMTargetProcessor.fit" class="md-nav__link">
    fit()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.targets.BayesianGMMTargetProcessor.get_feature_names_out" class="md-nav__link">
    get_feature_names_out()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.targets.BayesianGMMTargetProcessor.transform" class="md-nav__link">
    transform()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.targets.SignalsTargetProcessor" class="md-nav__link">
    SignalsTargetProcessor
  </a>
  
    <nav class="md-nav" aria-label="SignalsTargetProcessor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.targets.SignalsTargetProcessor.get_feature_names_out" class="md-nav__link">
    get_feature_names_out()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.meta" class="md-nav__link">
    meta
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.meta.CrossValEstimator" class="md-nav__link">
    CrossValEstimator
  </a>
  
    <nav class="md-nav" aria-label="CrossValEstimator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.meta.CrossValEstimator.__sklearn_is_fitted__" class="md-nav__link">
    __sklearn_is_fitted__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.meta.CrossValEstimator.fit" class="md-nav__link">
    fit()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.meta.CrossValEstimator.transform" class="md-nav__link">
    transform()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.meta.MetaEstimator" class="md-nav__link">
    MetaEstimator
  </a>
  
    <nav class="md-nav" aria-label="MetaEstimator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.meta.MetaEstimator.fit" class="md-nav__link">
    fit()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.meta.MetaEstimator.predict" class="md-nav__link">
    predict()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.meta.MetaEstimator.transform" class="md-nav__link">
    transform()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.meta.MetaPipeline" class="md-nav__link">
    MetaPipeline
  </a>
  
    <nav class="md-nav" aria-label="MetaPipeline">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.meta.MetaPipeline.predict" class="md-nav__link">
    predict()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.meta.MetaPipeline.wrap_estimators_as_transformers" class="md-nav__link">
    wrap_estimators_as_transformers()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.meta.make_meta_pipeline" class="md-nav__link">
    make_meta_pipeline()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.neutralizers" class="md-nav__link">
    neutralizers
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.neutralizers.BaseNeutralizer" class="md-nav__link">
    BaseNeutralizer
  </a>
  
    <nav class="md-nav" aria-label="BaseNeutralizer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.neutralizers.BaseNeutralizer.fit_transform" class="md-nav__link">
    fit_transform()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.neutralizers.BaseNeutralizer.get_feature_names_out" class="md-nav__link">
    get_feature_names_out()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.neutralizers.BaseNeutralizer.predict" class="md-nav__link">
    predict()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.neutralizers.FeatureNeutralizer" class="md-nav__link">
    FeatureNeutralizer
  </a>
  
    <nav class="md-nav" aria-label="FeatureNeutralizer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.neutralizers.FeatureNeutralizer.neutralize" class="md-nav__link">
    neutralize()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.neutralizers.FeatureNeutralizer.neutralize_cuda" class="md-nav__link">
    neutralize_cuda()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.neutralizers.FeatureNeutralizer.transform" class="md-nav__link">
    transform()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.penalizers" class="md-nav__link">
    penalizers
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.penalizers.BasePenalizer" class="md-nav__link">
    BasePenalizer
  </a>
  
    <nav class="md-nav" aria-label="BasePenalizer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.penalizers.BasePenalizer.fit_transform" class="md-nav__link">
    fit_transform()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.penalizers.BasePenalizer.get_feature_names_out" class="md-nav__link">
    get_feature_names_out()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.penalizers.BasePenalizer.predict" class="md-nav__link">
    predict()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.penalizers.FeaturePenalizer" class="md-nav__link">
    FeaturePenalizer
  </a>
  
    <nav class="md-nav" aria-label="FeaturePenalizer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.penalizers.FeaturePenalizer.transform" class="md-nav__link">
    transform()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.prediction_loaders" class="md-nav__link">
    prediction_loaders
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.prediction_loaders.BasePredictionLoader" class="md-nav__link">
    BasePredictionLoader
  </a>
  
    <nav class="md-nav" aria-label="BasePredictionLoader">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.prediction_loaders.BasePredictionLoader.get_feature_names_out" class="md-nav__link">
    get_feature_names_out()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.prediction_loaders.BasePredictionLoader.transform" class="md-nav__link">
    transform()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.prediction_loaders.ExamplePredictions" class="md-nav__link">
    ExamplePredictions
  </a>
  
    <nav class="md-nav" aria-label="ExamplePredictions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.prediction_loaders.ExamplePredictions.transform" class="md-nav__link">
    transform()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.evaluation" class="md-nav__link">
    evaluation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.evaluation.BaseEvaluator" class="md-nav__link">
    BaseEvaluator
  </a>
  
    <nav class="md-nav" aria-label="BaseEvaluator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.evaluation.BaseEvaluator.apy" class="md-nav__link">
    apy()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.evaluation.BaseEvaluator.autocorr1" class="md-nav__link">
    autocorr1()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.evaluation.BaseEvaluator.autocorr_penalty" class="md-nav__link">
    autocorr_penalty()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.evaluation.BaseEvaluator.cross_correlation" class="md-nav__link">
    cross_correlation()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.evaluation.BaseEvaluator.evaluation_one_col" class="md-nav__link">
    evaluation_one_col()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.evaluation.BaseEvaluator.exposure_dissimilarity" class="md-nav__link">
    exposure_dissimilarity()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.evaluation.BaseEvaluator.feature_neutral_mean_std_sharpe" class="md-nav__link">
    feature_neutral_mean_std_sharpe()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.evaluation.BaseEvaluator.full_evaluation" class="md-nav__link">
    full_evaluation()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.evaluation.BaseEvaluator.get_feature_exposures_corrv2" class="md-nav__link">
    get_feature_exposures_corrv2()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.evaluation.BaseEvaluator.get_feature_exposures_pearson" class="md-nav__link">
    get_feature_exposures_pearson()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.evaluation.BaseEvaluator.max_drawdown" class="md-nav__link">
    max_drawdown()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.evaluation.BaseEvaluator.max_feature_exposure" class="md-nav__link">
    max_feature_exposure()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.evaluation.BaseEvaluator.mean_std_sharpe" class="md-nav__link">
    mean_std_sharpe()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.evaluation.BaseEvaluator.model_contribution" class="md-nav__link">
    model_contribution()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.evaluation.BaseEvaluator.numerai_corr" class="md-nav__link">
    numerai_corr()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.evaluation.BaseEvaluator.per_era_corrs" class="md-nav__link">
    per_era_corrs()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.evaluation.BaseEvaluator.per_era_numerai_corrs" class="md-nav__link">
    per_era_numerai_corrs()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.evaluation.BaseEvaluator.plot_correlations" class="md-nav__link">
    plot_correlations()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.evaluation.BaseEvaluator.smart_sharpe" class="md-nav__link">
    smart_sharpe()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.evaluation.BaseEvaluator.tbx_mean_std_sharpe" class="md-nav__link">
    tbx_mean_std_sharpe()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.evaluation.NumeraiClassicEvaluator" class="md-nav__link">
    NumeraiClassicEvaluator
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.evaluation.NumeraiSignalsEvaluator" class="md-nav__link">
    NumeraiSignalsEvaluator
  </a>
  
    <nav class="md-nav" aria-label="NumeraiSignalsEvaluator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.evaluation.NumeraiSignalsEvaluator.__await_diagnostics" class="md-nav__link">
    __await_diagnostics()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.evaluation.NumeraiSignalsEvaluator.get_neutralized_corr" class="md-nav__link">
    get_neutralized_corr()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.submission" class="md-nav__link">
    submission
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.submission.BaseSubmitter" class="md-nav__link">
    BaseSubmitter
  </a>
  
    <nav class="md-nav" aria-label="BaseSubmitter">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.submission.BaseSubmitter.get_model_mapping" class="md-nav__link">
    get_model_mapping
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.submission.BaseSubmitter.__call__" class="md-nav__link">
    __call__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.submission.BaseSubmitter.combine_csvs" class="md-nav__link">
    combine_csvs()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.submission.BaseSubmitter.full_submission" class="md-nav__link">
    full_submission()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.submission.BaseSubmitter.save_csv" class="md-nav__link">
    save_csv()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.submission.BaseSubmitter.upload_predictions" class="md-nav__link">
    upload_predictions()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.submission.NumerBaySubmitter" class="md-nav__link">
    NumerBaySubmitter
  </a>
  
    <nav class="md-nav" aria-label="NumerBaySubmitter">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.submission.NumerBaySubmitter.__call__" class="md-nav__link">
    __call__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.submission.NumerBaySubmitter.full_submission" class="md-nav__link">
    full_submission()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.submission.NumerBaySubmitter.upload_predictions" class="md-nav__link">
    upload_predictions()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.submission.NumeraiClassicSubmitter" class="md-nav__link">
    NumeraiClassicSubmitter
  </a>
  
    <nav class="md-nav" aria-label="NumeraiClassicSubmitter">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.submission.NumeraiClassicSubmitter.save_csv" class="md-nav__link">
    save_csv()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.submission.NumeraiSignalsSubmitter" class="md-nav__link">
    NumeraiSignalsSubmitter
  </a>
  
    <nav class="md-nav" aria-label="NumeraiSignalsSubmitter">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.submission.NumeraiSignalsSubmitter.save_csv" class="md-nav__link">
    save_csv()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#numerblox.download" class="md-nav__link">
    download
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.download.BaseDownloader" class="md-nav__link">
    BaseDownloader
  </a>
  
    <nav class="md-nav" aria-label="BaseDownloader">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.download.BaseDownloader.__call__" class="md-nav__link">
    __call__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.download.BaseDownloader.download_inference_data" class="md-nav__link">
    download_inference_data()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.download.BaseDownloader.download_training_data" class="md-nav__link">
    download_training_data()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.download.BaseIO" class="md-nav__link">
    BaseIO
  </a>
  
    <nav class="md-nav" aria-label="BaseIO">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.download.BaseIO.get_all_files" class="md-nav__link">
    get_all_files
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.download.BaseIO.is_empty" class="md-nav__link">
    is_empty
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.download.BaseIO.download_directory_from_gcs" class="md-nav__link">
    download_directory_from_gcs()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.download.BaseIO.download_file_from_gcs" class="md-nav__link">
    download_file_from_gcs()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.download.BaseIO.remove_base_directory" class="md-nav__link">
    remove_base_directory()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.download.BaseIO.upload_directory_to_gcs" class="md-nav__link">
    upload_directory_to_gcs()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.download.BaseIO.upload_file_to_gcs" class="md-nav__link">
    upload_file_to_gcs()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.download.EODDownloader" class="md-nav__link">
    EODDownloader
  </a>
  
    <nav class="md-nav" aria-label="EODDownloader">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.download.EODDownloader.download_inference_data" class="md-nav__link">
    download_inference_data()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.download.EODDownloader.download_training_data" class="md-nav__link">
    download_training_data()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.download.EODDownloader.generate_full_dataf" class="md-nav__link">
    generate_full_dataf()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.download.EODDownloader.generate_stock_dataf" class="md-nav__link">
    generate_stock_dataf()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.download.EODDownloader.get_live_data" class="md-nav__link">
    get_live_data()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.download.KaggleDownloader" class="md-nav__link">
    KaggleDownloader
  </a>
  
    <nav class="md-nav" aria-label="KaggleDownloader">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.download.KaggleDownloader.download_inference_data" class="md-nav__link">
    download_inference_data()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.download.KaggleDownloader.download_training_data" class="md-nav__link">
    download_training_data()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.download.NumeraiClassicDownloader" class="md-nav__link">
    NumeraiClassicDownloader
  </a>
  
    <nav class="md-nav" aria-label="NumeraiClassicDownloader">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.download.NumeraiClassicDownloader.__get_dest_path" class="md-nav__link">
    __get_dest_path()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.download.NumeraiClassicDownloader.download_example_data" class="md-nav__link">
    download_example_data()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.download.NumeraiClassicDownloader.download_inference_data" class="md-nav__link">
    download_inference_data()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.download.NumeraiClassicDownloader.download_live_data" class="md-nav__link">
    download_live_data()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.download.NumeraiClassicDownloader.download_meta_model_preds" class="md-nav__link">
    download_meta_model_preds()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.download.NumeraiClassicDownloader.download_single_dataset" class="md-nav__link">
    download_single_dataset()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.download.NumeraiClassicDownloader.download_training_data" class="md-nav__link">
    download_training_data()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.download.NumeraiClassicDownloader.get_classic_features" class="md-nav__link">
    get_classic_features()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.numerframe" class="md-nav__link">
    numerframe
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.numerframe.NumerFrame" class="md-nav__link">
    NumerFrame
  </a>
  
    <nav class="md-nav" aria-label="NumerFrame">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.numerframe.NumerFrame.get_aux_data" class="md-nav__link">
    get_aux_data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.numerframe.NumerFrame.get_era_data" class="md-nav__link">
    get_era_data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.numerframe.NumerFrame.get_feature_data" class="md-nav__link">
    get_feature_data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.numerframe.NumerFrame.get_fncv3_feature_data" class="md-nav__link">
    get_fncv3_feature_data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.numerframe.NumerFrame.get_medium_feature_data" class="md-nav__link">
    get_medium_feature_data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.numerframe.NumerFrame.get_prediction_aux_data" class="md-nav__link">
    get_prediction_aux_data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.numerframe.NumerFrame.get_prediction_data" class="md-nav__link">
    get_prediction_data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.numerframe.NumerFrame.get_single_target_data" class="md-nav__link">
    get_single_target_data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.numerframe.NumerFrame.get_small_feature_data" class="md-nav__link">
    get_small_feature_data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.numerframe.NumerFrame.get_target_data" class="md-nav__link">
    get_target_data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.numerframe.NumerFrame.get_unique_eras" class="md-nav__link">
    get_unique_eras
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.numerframe.NumerFrame.get_v2_equivalent_feature_data" class="md-nav__link">
    get_v2_equivalent_feature_data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.numerframe.NumerFrame.get_v3_equivalent_feature_data" class="md-nav__link">
    get_v3_equivalent_feature_data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.numerframe.NumerFrame.__init_meta_attrs" class="md-nav__link">
    __init_meta_attrs()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.numerframe.NumerFrame.__set_era_col" class="md-nav__link">
    __set_era_col()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.numerframe.NumerFrame.get_column_selection" class="md-nav__link">
    get_column_selection()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.numerframe.NumerFrame.get_era_batch" class="md-nav__link">
    get_era_batch()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.numerframe.NumerFrame.get_feature_group" class="md-nav__link">
    get_feature_group()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.numerframe.NumerFrame.get_feature_target_pair" class="md-nav__link">
    get_feature_target_pair()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.numerframe.NumerFrame.get_last_n_eras" class="md-nav__link">
    get_last_n_eras()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.numerframe.NumerFrame.get_pattern_data" class="md-nav__link">
    get_pattern_data()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.numerframe.create_numerframe" class="md-nav__link">
    create_numerframe()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.preprocessing.base" class="md-nav__link">
    base
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.preprocessing.base.BasePreProcessor" class="md-nav__link">
    BasePreProcessor
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.preprocessing.classic" class="md-nav__link">
    classic
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.preprocessing.classic.GroupStatsPreProcessor" class="md-nav__link">
    GroupStatsPreProcessor
  </a>
  
    <nav class="md-nav" aria-label="GroupStatsPreProcessor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.preprocessing.classic.GroupStatsPreProcessor.get_feature_names_out" class="md-nav__link">
    get_feature_names_out()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.preprocessing.classic.GroupStatsPreProcessor.transform" class="md-nav__link">
    transform()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.preprocessing.signals" class="md-nav__link">
    signals
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.preprocessing.signals.DifferencePreProcessor" class="md-nav__link">
    DifferencePreProcessor
  </a>
  
    <nav class="md-nav" aria-label="DifferencePreProcessor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.preprocessing.signals.DifferencePreProcessor.transform" class="md-nav__link">
    transform()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.preprocessing.signals.EraQuantileProcessor" class="md-nav__link">
    EraQuantileProcessor
  </a>
  
    <nav class="md-nav" aria-label="EraQuantileProcessor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.preprocessing.signals.EraQuantileProcessor.get_feature_names_out" class="md-nav__link">
    get_feature_names_out()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.preprocessing.signals.HLOCVAdjuster" class="md-nav__link">
    HLOCVAdjuster
  </a>
  
    <nav class="md-nav" aria-label="HLOCVAdjuster">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.preprocessing.signals.HLOCVAdjuster.transform" class="md-nav__link">
    transform()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.preprocessing.signals.KatsuFeatureGenerator" class="md-nav__link">
    KatsuFeatureGenerator
  </a>
  
    <nav class="md-nav" aria-label="KatsuFeatureGenerator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.preprocessing.signals.KatsuFeatureGenerator.__ema1" class="md-nav__link">
    __ema1()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.preprocessing.signals.KatsuFeatureGenerator.feature_engineering" class="md-nav__link">
    feature_engineering()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.preprocessing.signals.KatsuFeatureGenerator.get_feature_names_out" class="md-nav__link">
    get_feature_names_out()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.preprocessing.signals.KatsuFeatureGenerator.transform" class="md-nav__link">
    transform()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.preprocessing.signals.LagPreProcessor" class="md-nav__link">
    LagPreProcessor
  </a>
  
    <nav class="md-nav" aria-label="LagPreProcessor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.preprocessing.signals.LagPreProcessor.get_feature_names_out" class="md-nav__link">
    get_feature_names_out()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.preprocessing.signals.PandasTaFeatureGenerator" class="md-nav__link">
    PandasTaFeatureGenerator
  </a>
  
    <nav class="md-nav" aria-label="PandasTaFeatureGenerator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.preprocessing.signals.PandasTaFeatureGenerator.add_features" class="md-nav__link">
    add_features()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.preprocessing.signals.PandasTaFeatureGenerator.transform" class="md-nav__link">
    transform()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.preprocessing.signals.ReduceMemoryProcessor" class="md-nav__link">
    ReduceMemoryProcessor
  </a>
  
    <nav class="md-nav" aria-label="ReduceMemoryProcessor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.preprocessing.signals.ReduceMemoryProcessor.get_feature_names_out" class="md-nav__link">
    get_feature_names_out()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.preprocessing.signals.TickerMapper" class="md-nav__link">
    TickerMapper
  </a>
  
    <nav class="md-nav" aria-label="TickerMapper">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.preprocessing.signals.TickerMapper.transform" class="md-nav__link">
    transform()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.targets" class="md-nav__link">
    targets
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.targets.BaseTargetProcessor" class="md-nav__link">
    BaseTargetProcessor
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.targets.BayesianGMMTargetProcessor" class="md-nav__link">
    BayesianGMMTargetProcessor
  </a>
  
    <nav class="md-nav" aria-label="BayesianGMMTargetProcessor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.targets.BayesianGMMTargetProcessor.fit" class="md-nav__link">
    fit()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.targets.BayesianGMMTargetProcessor.get_feature_names_out" class="md-nav__link">
    get_feature_names_out()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.targets.BayesianGMMTargetProcessor.transform" class="md-nav__link">
    transform()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.targets.SignalsTargetProcessor" class="md-nav__link">
    SignalsTargetProcessor
  </a>
  
    <nav class="md-nav" aria-label="SignalsTargetProcessor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.targets.SignalsTargetProcessor.get_feature_names_out" class="md-nav__link">
    get_feature_names_out()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.meta" class="md-nav__link">
    meta
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.meta.CrossValEstimator" class="md-nav__link">
    CrossValEstimator
  </a>
  
    <nav class="md-nav" aria-label="CrossValEstimator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.meta.CrossValEstimator.__sklearn_is_fitted__" class="md-nav__link">
    __sklearn_is_fitted__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.meta.CrossValEstimator.fit" class="md-nav__link">
    fit()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.meta.CrossValEstimator.transform" class="md-nav__link">
    transform()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.meta.MetaEstimator" class="md-nav__link">
    MetaEstimator
  </a>
  
    <nav class="md-nav" aria-label="MetaEstimator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.meta.MetaEstimator.fit" class="md-nav__link">
    fit()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.meta.MetaEstimator.predict" class="md-nav__link">
    predict()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.meta.MetaEstimator.transform" class="md-nav__link">
    transform()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.meta.MetaPipeline" class="md-nav__link">
    MetaPipeline
  </a>
  
    <nav class="md-nav" aria-label="MetaPipeline">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.meta.MetaPipeline.predict" class="md-nav__link">
    predict()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.meta.MetaPipeline.wrap_estimators_as_transformers" class="md-nav__link">
    wrap_estimators_as_transformers()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.meta.make_meta_pipeline" class="md-nav__link">
    make_meta_pipeline()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.neutralizers" class="md-nav__link">
    neutralizers
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.neutralizers.BaseNeutralizer" class="md-nav__link">
    BaseNeutralizer
  </a>
  
    <nav class="md-nav" aria-label="BaseNeutralizer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.neutralizers.BaseNeutralizer.fit_transform" class="md-nav__link">
    fit_transform()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.neutralizers.BaseNeutralizer.get_feature_names_out" class="md-nav__link">
    get_feature_names_out()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.neutralizers.BaseNeutralizer.predict" class="md-nav__link">
    predict()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.neutralizers.FeatureNeutralizer" class="md-nav__link">
    FeatureNeutralizer
  </a>
  
    <nav class="md-nav" aria-label="FeatureNeutralizer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.neutralizers.FeatureNeutralizer.neutralize" class="md-nav__link">
    neutralize()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.neutralizers.FeatureNeutralizer.neutralize_cuda" class="md-nav__link">
    neutralize_cuda()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.neutralizers.FeatureNeutralizer.transform" class="md-nav__link">
    transform()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.penalizers" class="md-nav__link">
    penalizers
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.penalizers.BasePenalizer" class="md-nav__link">
    BasePenalizer
  </a>
  
    <nav class="md-nav" aria-label="BasePenalizer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.penalizers.BasePenalizer.fit_transform" class="md-nav__link">
    fit_transform()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.penalizers.BasePenalizer.get_feature_names_out" class="md-nav__link">
    get_feature_names_out()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.penalizers.BasePenalizer.predict" class="md-nav__link">
    predict()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.penalizers.FeaturePenalizer" class="md-nav__link">
    FeaturePenalizer
  </a>
  
    <nav class="md-nav" aria-label="FeaturePenalizer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.penalizers.FeaturePenalizer.transform" class="md-nav__link">
    transform()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.prediction_loaders" class="md-nav__link">
    prediction_loaders
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.prediction_loaders.BasePredictionLoader" class="md-nav__link">
    BasePredictionLoader
  </a>
  
    <nav class="md-nav" aria-label="BasePredictionLoader">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.prediction_loaders.BasePredictionLoader.get_feature_names_out" class="md-nav__link">
    get_feature_names_out()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.prediction_loaders.BasePredictionLoader.transform" class="md-nav__link">
    transform()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.prediction_loaders.ExamplePredictions" class="md-nav__link">
    ExamplePredictions
  </a>
  
    <nav class="md-nav" aria-label="ExamplePredictions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.prediction_loaders.ExamplePredictions.transform" class="md-nav__link">
    transform()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.evaluation" class="md-nav__link">
    evaluation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.evaluation.BaseEvaluator" class="md-nav__link">
    BaseEvaluator
  </a>
  
    <nav class="md-nav" aria-label="BaseEvaluator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.evaluation.BaseEvaluator.apy" class="md-nav__link">
    apy()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.evaluation.BaseEvaluator.autocorr1" class="md-nav__link">
    autocorr1()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.evaluation.BaseEvaluator.autocorr_penalty" class="md-nav__link">
    autocorr_penalty()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.evaluation.BaseEvaluator.cross_correlation" class="md-nav__link">
    cross_correlation()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.evaluation.BaseEvaluator.evaluation_one_col" class="md-nav__link">
    evaluation_one_col()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.evaluation.BaseEvaluator.exposure_dissimilarity" class="md-nav__link">
    exposure_dissimilarity()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.evaluation.BaseEvaluator.feature_neutral_mean_std_sharpe" class="md-nav__link">
    feature_neutral_mean_std_sharpe()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.evaluation.BaseEvaluator.full_evaluation" class="md-nav__link">
    full_evaluation()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.evaluation.BaseEvaluator.get_feature_exposures_corrv2" class="md-nav__link">
    get_feature_exposures_corrv2()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.evaluation.BaseEvaluator.get_feature_exposures_pearson" class="md-nav__link">
    get_feature_exposures_pearson()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.evaluation.BaseEvaluator.max_drawdown" class="md-nav__link">
    max_drawdown()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.evaluation.BaseEvaluator.max_feature_exposure" class="md-nav__link">
    max_feature_exposure()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.evaluation.BaseEvaluator.mean_std_sharpe" class="md-nav__link">
    mean_std_sharpe()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.evaluation.BaseEvaluator.model_contribution" class="md-nav__link">
    model_contribution()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.evaluation.BaseEvaluator.numerai_corr" class="md-nav__link">
    numerai_corr()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.evaluation.BaseEvaluator.per_era_corrs" class="md-nav__link">
    per_era_corrs()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.evaluation.BaseEvaluator.per_era_numerai_corrs" class="md-nav__link">
    per_era_numerai_corrs()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.evaluation.BaseEvaluator.plot_correlations" class="md-nav__link">
    plot_correlations()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.evaluation.BaseEvaluator.smart_sharpe" class="md-nav__link">
    smart_sharpe()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.evaluation.BaseEvaluator.tbx_mean_std_sharpe" class="md-nav__link">
    tbx_mean_std_sharpe()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.evaluation.NumeraiClassicEvaluator" class="md-nav__link">
    NumeraiClassicEvaluator
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.evaluation.NumeraiSignalsEvaluator" class="md-nav__link">
    NumeraiSignalsEvaluator
  </a>
  
    <nav class="md-nav" aria-label="NumeraiSignalsEvaluator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.evaluation.NumeraiSignalsEvaluator.__await_diagnostics" class="md-nav__link">
    __await_diagnostics()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.evaluation.NumeraiSignalsEvaluator.get_neutralized_corr" class="md-nav__link">
    get_neutralized_corr()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.submission" class="md-nav__link">
    submission
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.submission.BaseSubmitter" class="md-nav__link">
    BaseSubmitter
  </a>
  
    <nav class="md-nav" aria-label="BaseSubmitter">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.submission.BaseSubmitter.get_model_mapping" class="md-nav__link">
    get_model_mapping
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.submission.BaseSubmitter.__call__" class="md-nav__link">
    __call__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.submission.BaseSubmitter.combine_csvs" class="md-nav__link">
    combine_csvs()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.submission.BaseSubmitter.full_submission" class="md-nav__link">
    full_submission()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.submission.BaseSubmitter.save_csv" class="md-nav__link">
    save_csv()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.submission.BaseSubmitter.upload_predictions" class="md-nav__link">
    upload_predictions()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.submission.NumerBaySubmitter" class="md-nav__link">
    NumerBaySubmitter
  </a>
  
    <nav class="md-nav" aria-label="NumerBaySubmitter">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.submission.NumerBaySubmitter.__call__" class="md-nav__link">
    __call__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.submission.NumerBaySubmitter.full_submission" class="md-nav__link">
    full_submission()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.submission.NumerBaySubmitter.upload_predictions" class="md-nav__link">
    upload_predictions()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.submission.NumeraiClassicSubmitter" class="md-nav__link">
    NumeraiClassicSubmitter
  </a>
  
    <nav class="md-nav" aria-label="NumeraiClassicSubmitter">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.submission.NumeraiClassicSubmitter.save_csv" class="md-nav__link">
    save_csv()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.submission.NumeraiSignalsSubmitter" class="md-nav__link">
    NumeraiSignalsSubmitter
  </a>
  
    <nav class="md-nav" aria-label="NumeraiSignalsSubmitter">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.submission.NumeraiSignalsSubmitter.save_csv" class="md-nav__link">
    save_csv()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="full-api-reference">Full API Reference</h1>
<p>This section provides a detailed reference to all objects defined in NumerBlox.</p>


<div class="doc doc-object doc-module">



<a id="numerblox.download"></a>
  <div class="doc doc-contents first">

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">




<h2 id="numerblox.download.BaseDownloader" class="doc doc-heading">
          <code>BaseDownloader</code>


</h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="numerblox.download.BaseIO" href="#numerblox.download.BaseIO">BaseIO</a></code></p>

  
      <p>Abstract base class for downloaders.</p>
<p>:param directory_path: Base folder to download files to.</p>

            <details class="quote">
              <summary>Source code in <code>numerblox/download.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">BaseDownloader</span><span class="p">(</span><span class="n">BaseIO</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Abstract base class for downloaders.</span>

<span class="sd">    :param directory_path: Base folder to download files to.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">directory_path</span><span class="o">=</span><span class="n">directory_path</span><span class="p">)</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">download_training_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Download all necessary files needed for training. &quot;&quot;&quot;</span>
        <span class="o">...</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">download_inference_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Download minimal amount of files needed for weekly inference. &quot;&quot;&quot;</span>
        <span class="o">...</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_load_json</span><span class="p">(</span><span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Load JSON from file and return as dictionary. &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">file_path</span><span class="p">))</span> <span class="k">as</span> <span class="n">json_file</span><span class="p">:</span>
            <span class="n">json_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">json_file</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">json_data</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">json_data</span>

    <span class="k">def</span> <span class="nf">_default_save_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span> <span class="n">dt</span><span class="p">,</span> <span class="n">end</span><span class="p">:</span> <span class="n">dt</span><span class="p">,</span> <span class="n">backend</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Save to downloader directory indicating backend, start date and end date as parquet file. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">backend</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">start</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">end</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">.parquet&quot;</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The most common use case will be to get weekly inference data. So calling the class itself returns inference data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">download_inference_data</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">




<h3 id="numerblox.download.BaseDownloader.__call__" class="doc doc-heading">
          <code class="highlight language-python"><span class="fm">__call__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>The most common use case will be to get weekly inference data. So calling the class itself returns inference data.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/download.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The most common use case will be to get weekly inference data. So calling the class itself returns inference data.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">download_inference_data</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="numerblox.download.BaseDownloader.download_inference_data" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">download_inference_data</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Download minimal amount of files needed for weekly inference.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/download.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="k">def</span> <span class="nf">download_inference_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Download minimal amount of files needed for weekly inference. &quot;&quot;&quot;</span>
    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="numerblox.download.BaseDownloader.download_training_data" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">download_training_data</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Download all necessary files needed for training.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/download.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="k">def</span> <span class="nf">download_training_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Download all necessary files needed for training. &quot;&quot;&quot;</span>
    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">




<h2 id="numerblox.download.BaseIO" class="doc doc-heading">
          <code>BaseIO</code>


</h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><span title="abc.ABC">ABC</span></code></p>

  
      <p>Basic functionality for IO (downloading and uploading).</p>
<p>:param directory_path: Base folder for IO. Will be created if it does not exist.</p>

            <details class="quote">
              <summary>Source code in <code>numerblox/download.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">BaseIO</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Basic functionality for IO (downloading and uploading).</span>

<span class="sd">    :param directory_path: Base folder for IO. Will be created if it does not exist.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">directory_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_create_directory</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">remove_base_directory</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove directory with all contents.&quot;&quot;&quot;</span>
        <span class="n">abs_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;WARNING: Deleting directory for &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&#39;</span><span class="se">\n</span><span class="s2">Path: &#39;</span><span class="si">{</span><span class="n">abs_path</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
        <span class="p">)</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">abs_path</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">download_file_from_gcs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bucket_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">gcs_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get file from GCS bucket and download to local directory.</span>
<span class="sd">        :param gcs_path: Path to file on GCS bucket.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">blob_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="o">.</span><span class="n">resolve</span><span class="p">())</span>
        <span class="n">blob</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_gcs_blob</span><span class="p">(</span><span class="n">bucket_name</span><span class="o">=</span><span class="n">bucket_name</span><span class="p">,</span> <span class="n">blob_path</span><span class="o">=</span><span class="n">blob_path</span><span class="p">)</span>
        <span class="n">blob</span><span class="o">.</span><span class="n">download_to_filename</span><span class="p">(</span><span class="n">gcs_path</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Downloaded GCS object &#39;</span><span class="si">{</span><span class="n">gcs_path</span><span class="si">}</span><span class="s2">&#39; from bucket &#39;</span><span class="si">{</span><span class="n">blob</span><span class="o">.</span><span class="n">bucket</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&#39; to local directory &#39;</span><span class="si">{</span><span class="n">blob_path</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">upload_file_to_gcs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bucket_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">gcs_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">local_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Upload file to some GCS bucket.</span>
<span class="sd">        :param gcs_path: Path to file on GCS bucket.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">blob</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_gcs_blob</span><span class="p">(</span><span class="n">bucket_name</span><span class="o">=</span><span class="n">bucket_name</span><span class="p">,</span> <span class="n">blob_path</span><span class="o">=</span><span class="n">gcs_path</span><span class="p">)</span>
        <span class="n">blob</span><span class="o">.</span><span class="n">upload_from_filename</span><span class="p">(</span><span class="n">local_path</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Local file &#39;</span><span class="si">{</span><span class="n">local_path</span><span class="si">}</span><span class="s2">&#39; uploaded to &#39;</span><span class="si">{</span><span class="n">gcs_path</span><span class="si">}</span><span class="s2">&#39; in bucket </span><span class="si">{</span><span class="n">blob</span><span class="o">.</span><span class="n">bucket</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">download_directory_from_gcs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bucket_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">gcs_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Copy full directory from GCS bucket to local environment.</span>
<span class="sd">        :param gcs_path: Name of directory on GCS bucket.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">blob_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="o">.</span><span class="n">resolve</span><span class="p">())</span>
        <span class="n">blob</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_gcs_blob</span><span class="p">(</span><span class="n">bucket_name</span><span class="o">=</span><span class="n">bucket_name</span><span class="p">,</span> <span class="n">blob_path</span><span class="o">=</span><span class="n">blob_path</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">gcs_file</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">gcs_path</span> <span class="o">+</span> <span class="s2">&quot;/**&quot;</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">gcs_file</span><span class="p">):</span>
                <span class="n">blob</span><span class="o">.</span><span class="n">download_to_filename</span><span class="p">(</span><span class="n">blob_path</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Directory &#39;</span><span class="si">{</span><span class="n">gcs_path</span><span class="si">}</span><span class="s2">&#39; from bucket &#39;</span><span class="si">{</span><span class="n">blob</span><span class="o">.</span><span class="n">bucket</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&#39; downloaded to &#39;</span><span class="si">{</span><span class="n">blob_path</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">upload_directory_to_gcs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bucket_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">gcs_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Upload full base directory to GCS bucket.</span>
<span class="sd">        :param gcs_path: Name of directory on GCS bucket.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">blob</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_gcs_blob</span><span class="p">(</span><span class="n">bucket_name</span><span class="o">=</span><span class="n">bucket_name</span><span class="p">,</span> <span class="n">blob_path</span><span class="o">=</span><span class="n">gcs_path</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">local_path</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;/**&quot;</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">local_path</span><span class="p">):</span>
                <span class="n">blob</span><span class="o">.</span><span class="n">upload_from_filename</span><span class="p">(</span><span class="n">local_path</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Directory &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="si">}</span><span class="s2">&#39; uploaded to &#39;</span><span class="si">{</span><span class="n">gcs_path</span><span class="si">}</span><span class="s2">&#39; in bucket </span><span class="si">{</span><span class="n">blob</span><span class="o">.</span><span class="n">bucket</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_gcs_blob</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bucket_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">blob_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">storage</span><span class="o">.</span><span class="n">Blob</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Create blob that interacts with Google Cloud Storage (GCS). &quot;&quot;&quot;</span>
        <span class="n">client</span> <span class="o">=</span> <span class="n">storage</span><span class="o">.</span><span class="n">Client</span><span class="p">()</span>
        <span class="c1"># https://console.cloud.google.com/storage/browser/[bucket_name]</span>
        <span class="n">bucket</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get_bucket</span><span class="p">(</span><span class="n">bucket_name</span><span class="p">)</span>
        <span class="n">blob</span> <span class="o">=</span> <span class="n">bucket</span><span class="o">.</span><span class="n">blob</span><span class="p">(</span><span class="n">blob_path</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">blob</span>

    <span class="k">def</span> <span class="nf">_append_folder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">folder</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Path</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return base directory Path object appended with &#39;folder&#39;.</span>
<span class="sd">        Create directory if it does not exist.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dir</span> <span class="o">/</span> <span class="n">folder</span><span class="p">)</span>
        <span class="nb">dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">dir</span>

    <span class="k">def</span> <span class="nf">_create_directory</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Create base directory if it does not exist. &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="o">.</span><span class="n">is_dir</span><span class="p">():</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;No existing directory found at &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="si">}</span><span class="s2">&#39;. Creating directory...&quot;</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">get_all_files</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Return all paths of contents in directory. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="o">.</span><span class="n">iterdir</span><span class="p">())</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_empty</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Check if directory is empty. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_all_files</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">




<h3 id="numerblox.download.BaseIO.get_all_files" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_all_files</span><span class="p">:</span> <span class="nb">list</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Return all paths of contents in directory.</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">




<h3 id="numerblox.download.BaseIO.is_empty" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">is_empty</span><span class="p">:</span> <span class="nb">bool</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Check if directory is empty.</p>
  </div>

</div>




<div class="doc doc-object doc-function">




<h3 id="numerblox.download.BaseIO.download_directory_from_gcs" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">download_directory_from_gcs</span><span class="p">(</span><span class="n">bucket_name</span><span class="p">,</span> <span class="n">gcs_path</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Copy full directory from GCS bucket to local environment.
:param gcs_path: Name of directory on GCS bucket.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/download.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">download_directory_from_gcs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bucket_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">gcs_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Copy full directory from GCS bucket to local environment.</span>
<span class="sd">    :param gcs_path: Name of directory on GCS bucket.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">blob_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="o">.</span><span class="n">resolve</span><span class="p">())</span>
    <span class="n">blob</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_gcs_blob</span><span class="p">(</span><span class="n">bucket_name</span><span class="o">=</span><span class="n">bucket_name</span><span class="p">,</span> <span class="n">blob_path</span><span class="o">=</span><span class="n">blob_path</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">gcs_file</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">gcs_path</span> <span class="o">+</span> <span class="s2">&quot;/**&quot;</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">gcs_file</span><span class="p">):</span>
            <span class="n">blob</span><span class="o">.</span><span class="n">download_to_filename</span><span class="p">(</span><span class="n">blob_path</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Directory &#39;</span><span class="si">{</span><span class="n">gcs_path</span><span class="si">}</span><span class="s2">&#39; from bucket &#39;</span><span class="si">{</span><span class="n">blob</span><span class="o">.</span><span class="n">bucket</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&#39; downloaded to &#39;</span><span class="si">{</span><span class="n">blob_path</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="numerblox.download.BaseIO.download_file_from_gcs" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">download_file_from_gcs</span><span class="p">(</span><span class="n">bucket_name</span><span class="p">,</span> <span class="n">gcs_path</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Get file from GCS bucket and download to local directory.
:param gcs_path: Path to file on GCS bucket.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/download.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">download_file_from_gcs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bucket_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">gcs_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get file from GCS bucket and download to local directory.</span>
<span class="sd">    :param gcs_path: Path to file on GCS bucket.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">blob_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="o">.</span><span class="n">resolve</span><span class="p">())</span>
    <span class="n">blob</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_gcs_blob</span><span class="p">(</span><span class="n">bucket_name</span><span class="o">=</span><span class="n">bucket_name</span><span class="p">,</span> <span class="n">blob_path</span><span class="o">=</span><span class="n">blob_path</span><span class="p">)</span>
    <span class="n">blob</span><span class="o">.</span><span class="n">download_to_filename</span><span class="p">(</span><span class="n">gcs_path</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Downloaded GCS object &#39;</span><span class="si">{</span><span class="n">gcs_path</span><span class="si">}</span><span class="s2">&#39; from bucket &#39;</span><span class="si">{</span><span class="n">blob</span><span class="o">.</span><span class="n">bucket</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&#39; to local directory &#39;</span><span class="si">{</span><span class="n">blob_path</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="numerblox.download.BaseIO.remove_base_directory" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">remove_base_directory</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Remove directory with all contents.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/download.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">remove_base_directory</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Remove directory with all contents.&quot;&quot;&quot;</span>
    <span class="n">abs_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;WARNING: Deleting directory for &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&#39;</span><span class="se">\n</span><span class="s2">Path: &#39;</span><span class="si">{</span><span class="n">abs_path</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
    <span class="p">)</span>
    <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">abs_path</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="numerblox.download.BaseIO.upload_directory_to_gcs" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">upload_directory_to_gcs</span><span class="p">(</span><span class="n">bucket_name</span><span class="p">,</span> <span class="n">gcs_path</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Upload full base directory to GCS bucket.
:param gcs_path: Name of directory on GCS bucket.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/download.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">upload_directory_to_gcs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bucket_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">gcs_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Upload full base directory to GCS bucket.</span>
<span class="sd">    :param gcs_path: Name of directory on GCS bucket.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">blob</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_gcs_blob</span><span class="p">(</span><span class="n">bucket_name</span><span class="o">=</span><span class="n">bucket_name</span><span class="p">,</span> <span class="n">blob_path</span><span class="o">=</span><span class="n">gcs_path</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">local_path</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;/**&quot;</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">local_path</span><span class="p">):</span>
            <span class="n">blob</span><span class="o">.</span><span class="n">upload_from_filename</span><span class="p">(</span><span class="n">local_path</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Directory &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="si">}</span><span class="s2">&#39; uploaded to &#39;</span><span class="si">{</span><span class="n">gcs_path</span><span class="si">}</span><span class="s2">&#39; in bucket </span><span class="si">{</span><span class="n">blob</span><span class="o">.</span><span class="n">bucket</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="numerblox.download.BaseIO.upload_file_to_gcs" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">upload_file_to_gcs</span><span class="p">(</span><span class="n">bucket_name</span><span class="p">,</span> <span class="n">gcs_path</span><span class="p">,</span> <span class="n">local_path</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Upload file to some GCS bucket.
:param gcs_path: Path to file on GCS bucket.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/download.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">upload_file_to_gcs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bucket_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">gcs_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">local_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Upload file to some GCS bucket.</span>
<span class="sd">    :param gcs_path: Path to file on GCS bucket.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">blob</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_gcs_blob</span><span class="p">(</span><span class="n">bucket_name</span><span class="o">=</span><span class="n">bucket_name</span><span class="p">,</span> <span class="n">blob_path</span><span class="o">=</span><span class="n">gcs_path</span><span class="p">)</span>
    <span class="n">blob</span><span class="o">.</span><span class="n">upload_from_filename</span><span class="p">(</span><span class="n">local_path</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Local file &#39;</span><span class="si">{</span><span class="n">local_path</span><span class="si">}</span><span class="s2">&#39; uploaded to &#39;</span><span class="si">{</span><span class="n">gcs_path</span><span class="si">}</span><span class="s2">&#39; in bucket </span><span class="si">{</span><span class="n">blob</span><span class="o">.</span><span class="n">bucket</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">




<h2 id="numerblox.download.EODDownloader" class="doc doc-heading">
          <code>EODDownloader</code>


</h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="numerblox.download.BaseDownloader" href="#numerblox.download.BaseDownloader">BaseDownloader</a></code></p>

  
      <p>Download data from EOD historical data. </p>
<p>More info: https://eodhistoricaldata.com/</p>
<p>Make sure you have the underlying Python package installed.
<code>pip install eod</code>.</p>
<p>:param directory_path: Base folder to download files to. </p>
<p>:param key: Valid EOD client key. </p>
<p>:param tickers: List of valid EOD tickers (Bloomberg ticker format). </p>
<p>:param frequency: Choose from [d, w, m]. </p>
<p>Daily data by default.</p>

            <details class="quote">
              <summary>Source code in <code>numerblox/download.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">EODDownloader</span><span class="p">(</span><span class="n">BaseDownloader</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Download data from EOD historical data. \n</span>
<span class="sd">    More info: https://eodhistoricaldata.com/</span>

<span class="sd">    Make sure you have the underlying Python package installed.</span>
<span class="sd">    `pip install eod`.</span>

<span class="sd">    :param directory_path: Base folder to download files to. \n</span>
<span class="sd">    :param key: Valid EOD client key. \n</span>
<span class="sd">    :param tickers: List of valid EOD tickers (Bloomberg ticker format). \n</span>
<span class="sd">    :param frequency: Choose from [d, w, m]. \n</span>
<span class="sd">    Daily data by default.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">directory_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                 <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                 <span class="n">tickers</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
                 <span class="n">frequency</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;d&quot;</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">directory_path</span><span class="o">=</span><span class="n">directory_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="n">key</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tickers</span> <span class="o">=</span> <span class="n">tickers</span>
        <span class="k">try</span><span class="p">:</span> 
            <span class="kn">from</span> <span class="nn">eod</span> <span class="kn">import</span> <span class="n">EodHistoricalData</span>
        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s2">&quot;Could not import eod package. Please install eod package with &#39;pip install eod&#39;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="n">EodHistoricalData</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span> <span class="o">=</span> <span class="n">frequency</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_time</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end_date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cpu_count</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">()</span>
        <span class="c1"># Time to sleep in between API calls to avoid hitting EOD rate limits.</span>
        <span class="c1"># EOD rate limit is set at 1000 calls per minute.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sleep_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpu_count</span> <span class="o">/</span> <span class="mi">32</span>

    <span class="k">def</span> <span class="nf">download_inference_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Download one year of data for defined tickers. &quot;&quot;&quot;</span>
        <span class="n">start</span> <span class="o">=</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_time</span><span class="p">)</span> <span class="o">-</span> <span class="n">relativedelta</span><span class="p">(</span><span class="n">years</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">dataf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_live_data</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">)</span>
        <span class="n">dataf</span><span class="o">.</span><span class="n">to_parquet</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_default_save_path</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="n">start</span><span class="p">),</span>
                                                 <span class="n">end</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end_date</span><span class="p">),</span>
                                                 <span class="n">backend</span><span class="o">=</span><span class="s2">&quot;eod&quot;</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">download_training_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Download full date length available.</span>
<span class="sd">        start: Starting data in %Y-%m-%d format.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">start</span> <span class="k">if</span> <span class="n">start</span> <span class="k">else</span> <span class="s2">&quot;1970-01-01&quot;</span>
        <span class="n">dataf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_full_dataf</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">)</span>
        <span class="n">dataf</span><span class="o">.</span><span class="n">to_parquet</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_default_save_path</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="n">start</span><span class="p">),</span>
                                                 <span class="n">end</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end_date</span><span class="p">),</span>
                                                 <span class="n">backend</span><span class="o">=</span><span class="s2">&quot;eod&quot;</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">get_live_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NumerFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get NumerFrame data from some starting date.</span>
<span class="sd">        start: Starting data in %Y-%m-%d format.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dataf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_full_dataf</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">NumerFrame</span><span class="p">(</span><span class="n">dataf</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">generate_full_dataf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Collect all price data for list of EOD ticker symbols (Bloomberg tickers).</span>
<span class="sd">        start: Starting data in %Y-%m-%d format.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">price_datafs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">with</span> <span class="n">ThreadPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">)</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
            <span class="n">tasks</span> <span class="o">=</span> <span class="p">[</span><span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">generate_stock_dataf</span><span class="p">,</span> <span class="n">ticker</span><span class="p">,</span> <span class="n">start</span><span class="p">)</span> <span class="k">for</span> <span class="n">ticker</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tickers</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">concurrent</span><span class="o">.</span><span class="n">futures</span><span class="o">.</span><span class="n">as_completed</span><span class="p">(</span><span class="n">tasks</span><span class="p">),</span>
                             <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tickers</span><span class="p">),</span>
                             <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;EOD price data extraction&quot;</span><span class="p">):</span>
                <span class="n">price_datafs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">task</span><span class="o">.</span><span class="n">result</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">price_datafs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">generate_stock_dataf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ticker</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate Price DataFrame for a single ticker.</span>
<span class="sd">        ticker: EOD ticker symbol (Bloomberg tickers).</span>
<span class="sd">        For example, Apple stock = AAPL.US.</span>
<span class="sd">        start: Starting data in %Y-%m-%d format.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sleep_time</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get_prices_eod</span><span class="p">(</span><span class="n">ticker</span><span class="p">,</span> <span class="n">period</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="p">,</span>
                                              <span class="n">from_</span><span class="o">=</span><span class="n">start</span><span class="p">,</span> <span class="n">to</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">end_date</span><span class="p">)</span>
            <span class="n">stock_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">resp</span><span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">)</span>
            <span class="n">stock_df</span><span class="p">[</span><span class="s1">&#39;ticker&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ticker</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;WARNING: Date pull failed on ticker: &#39;</span><span class="si">{</span><span class="n">ticker</span><span class="si">}</span><span class="s2">&#39;. Exception: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">stock_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">stock_df</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">




<h3 id="numerblox.download.EODDownloader.download_inference_data" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">download_inference_data</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Download one year of data for defined tickers.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/download.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">download_inference_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Download one year of data for defined tickers. &quot;&quot;&quot;</span>
    <span class="n">start</span> <span class="o">=</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_time</span><span class="p">)</span> <span class="o">-</span> <span class="n">relativedelta</span><span class="p">(</span><span class="n">years</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">dataf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_live_data</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">)</span>
    <span class="n">dataf</span><span class="o">.</span><span class="n">to_parquet</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_default_save_path</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="n">start</span><span class="p">),</span>
                                             <span class="n">end</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end_date</span><span class="p">),</span>
                                             <span class="n">backend</span><span class="o">=</span><span class="s2">&quot;eod&quot;</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="numerblox.download.EODDownloader.download_training_data" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">download_training_data</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Download full date length available.
start: Starting data in %Y-%m-%d format.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/download.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">download_training_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Download full date length available.</span>
<span class="sd">    start: Starting data in %Y-%m-%d format.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">start</span> <span class="k">if</span> <span class="n">start</span> <span class="k">else</span> <span class="s2">&quot;1970-01-01&quot;</span>
    <span class="n">dataf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_full_dataf</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">)</span>
    <span class="n">dataf</span><span class="o">.</span><span class="n">to_parquet</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_default_save_path</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="n">start</span><span class="p">),</span>
                                             <span class="n">end</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end_date</span><span class="p">),</span>
                                             <span class="n">backend</span><span class="o">=</span><span class="s2">&quot;eod&quot;</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="numerblox.download.EODDownloader.generate_full_dataf" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">generate_full_dataf</span><span class="p">(</span><span class="n">start</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Collect all price data for list of EOD ticker symbols (Bloomberg tickers).
start: Starting data in %Y-%m-%d format.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/download.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">generate_full_dataf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Collect all price data for list of EOD ticker symbols (Bloomberg tickers).</span>
<span class="sd">    start: Starting data in %Y-%m-%d format.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">price_datafs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">with</span> <span class="n">ThreadPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">)</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
        <span class="n">tasks</span> <span class="o">=</span> <span class="p">[</span><span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">generate_stock_dataf</span><span class="p">,</span> <span class="n">ticker</span><span class="p">,</span> <span class="n">start</span><span class="p">)</span> <span class="k">for</span> <span class="n">ticker</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tickers</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">concurrent</span><span class="o">.</span><span class="n">futures</span><span class="o">.</span><span class="n">as_completed</span><span class="p">(</span><span class="n">tasks</span><span class="p">),</span>
                         <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tickers</span><span class="p">),</span>
                         <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;EOD price data extraction&quot;</span><span class="p">):</span>
            <span class="n">price_datafs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">task</span><span class="o">.</span><span class="n">result</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">price_datafs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="numerblox.download.EODDownloader.generate_stock_dataf" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">generate_stock_dataf</span><span class="p">(</span><span class="n">ticker</span><span class="p">,</span> <span class="n">start</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Generate Price DataFrame for a single ticker.
ticker: EOD ticker symbol (Bloomberg tickers).
For example, Apple stock = AAPL.US.
start: Starting data in %Y-%m-%d format.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/download.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">generate_stock_dataf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ticker</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate Price DataFrame for a single ticker.</span>
<span class="sd">    ticker: EOD ticker symbol (Bloomberg tickers).</span>
<span class="sd">    For example, Apple stock = AAPL.US.</span>
<span class="sd">    start: Starting data in %Y-%m-%d format.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sleep_time</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get_prices_eod</span><span class="p">(</span><span class="n">ticker</span><span class="p">,</span> <span class="n">period</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="p">,</span>
                                          <span class="n">from_</span><span class="o">=</span><span class="n">start</span><span class="p">,</span> <span class="n">to</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">end_date</span><span class="p">)</span>
        <span class="n">stock_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">resp</span><span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">)</span>
        <span class="n">stock_df</span><span class="p">[</span><span class="s1">&#39;ticker&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ticker</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;WARNING: Date pull failed on ticker: &#39;</span><span class="si">{</span><span class="n">ticker</span><span class="si">}</span><span class="s2">&#39;. Exception: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">stock_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">stock_df</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="numerblox.download.EODDownloader.get_live_data" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_live_data</span><span class="p">(</span><span class="n">start</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Get NumerFrame data from some starting date.
start: Starting data in %Y-%m-%d format.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/download.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_live_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NumerFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get NumerFrame data from some starting date.</span>
<span class="sd">    start: Starting data in %Y-%m-%d format.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dataf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_full_dataf</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">NumerFrame</span><span class="p">(</span><span class="n">dataf</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">




<h2 id="numerblox.download.KaggleDownloader" class="doc doc-heading">
          <code>KaggleDownloader</code>


</h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="numerblox.download.BaseDownloader" href="#numerblox.download.BaseDownloader">BaseDownloader</a></code></p>

  
      <p>Download financial data from Kaggle.</p>
<p>For authentication, make sure you have a directory called .kaggle in your home directory
with therein a kaggle.json file. kaggle.json should have the following structure: </p>
<p><code>{"username": USERNAME, "key": KAGGLE_API_KEY}</code> </p>
<p>More info on authentication: github.com/Kaggle/kaggle-api#api-credentials </p>
<p>More info on the Kaggle Python API: kaggle.com/donkeys/kaggle-python-api </p>
<p>:param directory_path: Base folder to download files to.</p>

            <details class="quote">
              <summary>Source code in <code>numerblox/download.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">KaggleDownloader</span><span class="p">(</span><span class="n">BaseDownloader</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Download financial data from Kaggle.</span>

<span class="sd">    For authentication, make sure you have a directory called .kaggle in your home directory</span>
<span class="sd">    with therein a kaggle.json file. kaggle.json should have the following structure: \n</span>
<span class="sd">    `{&quot;username&quot;: USERNAME, &quot;key&quot;: KAGGLE_API_KEY}` \n</span>
<span class="sd">    More info on authentication: github.com/Kaggle/kaggle-api#api-credentials \n</span>

<span class="sd">    More info on the Kaggle Python API: kaggle.com/donkeys/kaggle-python-api \n</span>

<span class="sd">    :param directory_path: Base folder to download files to.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__check_kaggle_import</span><span class="p">()</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">directory_path</span><span class="o">=</span><span class="n">directory_path</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">download_inference_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kaggle_dataset_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Download arbitrary Kaggle dataset.</span>
<span class="sd">        :param kaggle_dataset_path: Path on Kaggle (URL slug on kaggle.com/)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">download_training_data</span><span class="p">(</span><span class="n">kaggle_dataset_path</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">download_training_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kaggle_dataset_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Download arbitrary Kaggle dataset.</span>
<span class="sd">        :param kaggle_dataset_path: Path on Kaggle (URL slug on kaggle.com/)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__check_kaggle_import</span><span class="p">()</span>
        <span class="n">kaggle</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">dataset_download_files</span><span class="p">(</span><span class="n">kaggle_dataset_path</span><span class="p">,</span>
                                          <span class="n">path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="p">,</span> <span class="n">unzip</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">__check_kaggle_import</span><span class="p">():</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">kaggle</span>
        <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">OSError</span><span class="p">(</span><span class="s2">&quot;Could not find kaggle.json credentials. Make sure it&#39;s located in /home/runner/.kaggle. Or use the environment method. Check github.com/Kaggle/kaggle-api#api-credentials for more information on authentication.&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">




<h3 id="numerblox.download.KaggleDownloader.download_inference_data" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">download_inference_data</span><span class="p">(</span><span class="n">kaggle_dataset_path</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Download arbitrary Kaggle dataset.
:param kaggle_dataset_path: Path on Kaggle (URL slug on kaggle.com/)</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/download.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">download_inference_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kaggle_dataset_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Download arbitrary Kaggle dataset.</span>
<span class="sd">    :param kaggle_dataset_path: Path on Kaggle (URL slug on kaggle.com/)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">download_training_data</span><span class="p">(</span><span class="n">kaggle_dataset_path</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="numerblox.download.KaggleDownloader.download_training_data" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">download_training_data</span><span class="p">(</span><span class="n">kaggle_dataset_path</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Download arbitrary Kaggle dataset.
:param kaggle_dataset_path: Path on Kaggle (URL slug on kaggle.com/)</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/download.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">download_training_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kaggle_dataset_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Download arbitrary Kaggle dataset.</span>
<span class="sd">    :param kaggle_dataset_path: Path on Kaggle (URL slug on kaggle.com/)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">__check_kaggle_import</span><span class="p">()</span>
    <span class="n">kaggle</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">dataset_download_files</span><span class="p">(</span><span class="n">kaggle_dataset_path</span><span class="p">,</span>
                                      <span class="n">path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="p">,</span> <span class="n">unzip</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">




<h2 id="numerblox.download.NumeraiClassicDownloader" class="doc doc-heading">
          <code>NumeraiClassicDownloader</code>


</h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="numerblox.download.BaseDownloader" href="#numerblox.download.BaseDownloader">BaseDownloader</a></code></p>

  
      <p>WARNING: Versions 1-3 (legacy data) are deprecated. Only supporting version 4+.</p>
<p>Downloading from NumerAPI for Numerai Classic data. </p>
<p>:param directory_path: Base folder to download files to. </p>
<p>All <em>args, </em>*kwargs will be passed to NumerAPI initialization.</p>

            <details class="quote">
              <summary>Source code in <code>numerblox/download.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">NumeraiClassicDownloader</span><span class="p">(</span><span class="n">BaseDownloader</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    WARNING: Versions 1-3 (legacy data) are deprecated. Only supporting version 4+.</span>

<span class="sd">    Downloading from NumerAPI for Numerai Classic data. \n</span>
<span class="sd">    :param directory_path: Base folder to download files to. \n</span>
<span class="sd">    All *args, **kwargs will be passed to NumerAPI initialization.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">directory_path</span><span class="o">=</span><span class="n">directory_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">napi</span> <span class="o">=</span> <span class="n">NumerAPI</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_round</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">napi</span><span class="o">.</span><span class="n">get_current_round</span><span class="p">()</span>
        <span class="c1"># NumerAPI filenames corresponding to version, class and data type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">version_mapping</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;4&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;train&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;int8&quot;</span><span class="p">:</span> <span class="p">[</span>
                        <span class="s2">&quot;v4/train_int8.parquet&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;v4/validation_int8.parquet&quot;</span>
                    <span class="p">],</span>
                    <span class="s2">&quot;float&quot;</span><span class="p">:</span> <span class="p">[</span>
                        <span class="s2">&quot;v4/train.parquet&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;v4/validation.parquet&quot;</span>
                    <span class="p">]</span>
                <span class="p">},</span>
                <span class="s2">&quot;inference&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;int8&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;v4/live_int8.parquet&quot;</span><span class="p">],</span>
                    <span class="s2">&quot;float&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;v4/live.parquet&quot;</span><span class="p">]</span>
                <span class="p">},</span>
                <span class="s2">&quot;live&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;int8&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;v4/live_int8.parquet&quot;</span><span class="p">],</span>
                    <span class="s2">&quot;float&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;v4/live.parquet&quot;</span><span class="p">]</span>
                <span class="p">},</span>
                <span class="s2">&quot;example&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="s2">&quot;v4/live_example_preds.parquet&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;v4/validation_example_preds.parquet&quot;</span>
                <span class="p">]</span>
            <span class="p">},</span>
            <span class="s2">&quot;4.1&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;train&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;int8&quot;</span><span class="p">:</span> <span class="p">[</span>
                        <span class="s2">&quot;v4.1/train_int8.parquet&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;v4.1/validation_int8.parquet&quot;</span>
                    <span class="p">],</span>
                    <span class="s2">&quot;float&quot;</span><span class="p">:</span> <span class="p">[</span>
                        <span class="s2">&quot;v4.1/train.parquet&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;v4.1/validation.parquet&quot;</span>
                    <span class="p">]</span>
                <span class="p">},</span>
                <span class="s2">&quot;inference&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;int8&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;v4.1/live_int8.parquet&quot;</span><span class="p">],</span>
                    <span class="s2">&quot;float&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;v4.1/live.parquet&quot;</span><span class="p">]</span>
                <span class="p">},</span>
                <span class="s2">&quot;live&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;int8&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;v4.1/live_int8.parquet&quot;</span><span class="p">],</span>
                    <span class="s2">&quot;float&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;v4.1/live.parquet&quot;</span><span class="p">]</span>
                <span class="p">},</span>
                <span class="s2">&quot;example&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="s2">&quot;v4.1/live_example_preds.parquet&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;v4.1/validation_example_preds.parquet&quot;</span>
                <span class="p">],</span>
            <span class="p">},</span>
            <span class="s2">&quot;4.2&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;train&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;int8&quot;</span><span class="p">:</span> <span class="p">[</span>
                        <span class="s2">&quot;v4.2/train_int8.parquet&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;v4.2/validation_int8.parquet&quot;</span>
                    <span class="p">],</span>   
            <span class="p">},</span>
                <span class="s2">&quot;inference&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;int8&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;v4.2/live_int8.parquet&quot;</span><span class="p">],</span>
                    <span class="s2">&quot;float&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;v4.2/live.parquet&quot;</span><span class="p">]</span>
                <span class="p">},</span>
                <span class="s2">&quot;live&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;int8&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;v4.2/live_int8.parquet&quot;</span><span class="p">],</span>
                    <span class="s2">&quot;float&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;v4.2/live.parquet&quot;</span><span class="p">]</span>
                <span class="p">},</span>
                <span class="s2">&quot;example&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="s2">&quot;v4.2/live_example_preds.parquet&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;v4.2/validation_example_preds.parquet&quot;</span>
                <span class="p">],</span>
        <span class="p">}</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="nf">download_training_data</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">subfolder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">version</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;4.2&quot;</span><span class="p">,</span> <span class="n">int8</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get Numerai classic training and validation data.</span>
<span class="sd">        :param subfolder: Specify folder to create folder within base directory root.</span>
<span class="sd">        Saves in base directory root by default.</span>
<span class="sd">        :param version: Numerai dataset version.</span>
<span class="sd">        4.1 = Sunshine dataset</span>
<span class="sd">        4.2 (default) = Rain Dataset</span>
<span class="sd">        NOTE: 4.2 is only available as int8 version so explicitly pass</span>
<span class="sd">        int8 = True if you want to download 4.2 data.</span>
<span class="sd">        :param int8: Integer version of data</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data_type</span> <span class="o">=</span> <span class="s2">&quot;int8&quot;</span> <span class="k">if</span> <span class="n">int8</span> <span class="k">else</span> <span class="s2">&quot;float&quot;</span>
        <span class="c1"># 4.2 data is only (currently) available in int8 format.</span>
        <span class="c1"># Raise exception to avoid confusion about the 4.2. dataset.</span>
        <span class="k">if</span> <span class="n">data_type</span> <span class="o">==</span> <span class="s2">&quot;float&quot;</span> <span class="ow">and</span> <span class="n">version</span> <span class="o">==</span> <span class="s2">&quot;4.2&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;No float version of training data is available for version 4.2. If you would like to download the 4.2 (Rain) dataset make sure to explicitly pass `int8=True`.&quot;&quot;&quot;</span><span class="p">)</span>
        <span class="n">train_val_files</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_version_mapping</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">version</span><span class="p">))[</span><span class="s2">&quot;train&quot;</span><span class="p">][</span><span class="n">data_type</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">train_val_files</span><span class="p">:</span>
            <span class="n">dest_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_dest_path</span><span class="p">(</span><span class="n">subfolder</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">download_single_dataset</span><span class="p">(</span>
                <span class="n">filename</span><span class="o">=</span><span class="n">file</span><span class="p">,</span>
                <span class="n">dest_path</span><span class="o">=</span><span class="n">dest_path</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">download_inference_data</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">subfolder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">version</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;4.2&quot;</span><span class="p">,</span>
        <span class="n">int8</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">round_num</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get Numerai classic inference (tournament) data.</span>
<span class="sd">        If only minimal live data is needed, consider .download_live_data.</span>
<span class="sd">        :param subfolder: Specify folder to create folder within base directory root.</span>
<span class="sd">        Saves in base directory root by default.</span>
<span class="sd">        :param version: Numerai dataset version </span>
<span class="sd">        4.1 = Sunshine dataset</span>
<span class="sd">        4.2 (default) = Rain Dataset</span>
<span class="sd">        :param int8: Integer version of data</span>
<span class="sd">        :param round_num: Numerai tournament round number. Downloads latest round by default.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data_type</span> <span class="o">=</span> <span class="s2">&quot;int8&quot;</span> <span class="k">if</span> <span class="n">int8</span> <span class="k">else</span> <span class="s2">&quot;float&quot;</span>
        <span class="k">if</span> <span class="n">data_type</span> <span class="o">==</span> <span class="s2">&quot;float&quot;</span> <span class="ow">and</span> <span class="n">version</span> <span class="o">==</span> <span class="s2">&quot;4.2&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;No float version of training data is available for version 4.2. onwards. If you would like to download the 4.2 (Rain) dataset make sure to explicitly pass `int8=True`.&quot;&quot;&quot;</span><span class="p">)</span>
        <span class="n">inference_files</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_version_mapping</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">version</span><span class="p">))[</span><span class="s2">&quot;inference&quot;</span><span class="p">][</span><span class="n">data_type</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">inference_files</span><span class="p">:</span>
            <span class="n">dest_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_dest_path</span><span class="p">(</span><span class="n">subfolder</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">download_single_dataset</span><span class="p">(</span>
                <span class="n">filename</span><span class="o">=</span><span class="n">file</span><span class="p">,</span>
                <span class="n">dest_path</span><span class="o">=</span><span class="n">dest_path</span><span class="p">,</span>
                <span class="n">round_num</span><span class="o">=</span><span class="n">round_num</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">download_single_dataset</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">dest_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">round_num</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Download one of the available datasets through NumerAPI.</span>

<span class="sd">        :param filename: Name as listed in NumerAPI (Check NumerAPI().list_datasets() for full overview)</span>
<span class="sd">        :param dest_path: Full path where file will be saved.</span>
<span class="sd">        :param round_num: Numerai tournament round number. Downloads latest round by default.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Downloading &#39;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">napi</span><span class="o">.</span><span class="n">download_dataset</span><span class="p">(</span>
            <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span>
            <span class="n">dest_path</span><span class="o">=</span><span class="n">dest_path</span><span class="p">,</span>
            <span class="n">round_num</span><span class="o">=</span><span class="n">round_num</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">download_live_data</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">subfolder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="n">version</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;4.2&quot;</span><span class="p">,</span>
            <span class="n">int8</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">round_num</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Download all live data in specified folder for given version (i.e. minimal data needed for inference).</span>

<span class="sd">        :param subfolder: Specify folder to create folder within directory root.</span>
<span class="sd">        Saves in directory root by default.</span>
<span class="sd">        :param version: Numerai dataset version </span>
<span class="sd">        4.1 = Sunshine dataset</span>
<span class="sd">        4.2 (default) = Rain Dataset</span>
<span class="sd">        :param int8: Integer version of data</span>
<span class="sd">        :param round_num: Numerai tournament round number. Downloads latest round by default.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data_type</span> <span class="o">=</span> <span class="s2">&quot;int8&quot;</span> <span class="k">if</span> <span class="n">int8</span> <span class="k">else</span> <span class="s2">&quot;float&quot;</span>
        <span class="n">live_files</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_version_mapping</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">version</span><span class="p">))[</span><span class="s2">&quot;live&quot;</span><span class="p">][</span><span class="n">data_type</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">live_files</span><span class="p">:</span>
            <span class="n">dest_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_dest_path</span><span class="p">(</span><span class="n">subfolder</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">download_single_dataset</span><span class="p">(</span>
                <span class="n">filename</span><span class="o">=</span><span class="n">file</span><span class="p">,</span>
                <span class="n">dest_path</span><span class="o">=</span><span class="n">dest_path</span><span class="p">,</span>
                <span class="n">round_num</span><span class="o">=</span><span class="n">round_num</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">download_example_data</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">subfolder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">version</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;4.2&quot;</span><span class="p">,</span> <span class="n">round_num</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Download all example prediction data in specified folder for given version.</span>

<span class="sd">        :param subfolder: Specify folder to create folder within base directory root.</span>
<span class="sd">        Saves in base directory root by default.</span>
<span class="sd">        :param version: Numerai dataset version (4.1=Sunshine dataset)</span>
<span class="sd">        :param round_num: Numerai tournament round number. Downloads latest round by default.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">example_files</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_version_mapping</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">version</span><span class="p">))[</span><span class="s2">&quot;example&quot;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">example_files</span><span class="p">:</span>
            <span class="n">dest_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_dest_path</span><span class="p">(</span><span class="n">subfolder</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">download_single_dataset</span><span class="p">(</span>
                <span class="n">filename</span><span class="o">=</span><span class="n">file</span><span class="p">,</span>
                <span class="n">dest_path</span><span class="o">=</span><span class="n">dest_path</span><span class="p">,</span>
                <span class="n">round_num</span><span class="o">=</span><span class="n">round_num</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_classic_features</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subfolder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s2">&quot;v4.2/features.json&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Download feature overview (stats and feature sets) through NumerAPI and load as dict.</span>
<span class="sd">        :param subfolder: Specify folder to create folder within base directory root.</span>
<span class="sd">        Saves in base directory root by default.</span>
<span class="sd">        :param filename: name for feature overview.</span>
<span class="sd">        *args, **kwargs will be passed to the JSON loader.</span>
<span class="sd">        :return: Feature overview dict</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dest_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_dest_path</span><span class="p">(</span><span class="n">subfolder</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">download_single_dataset</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span>
                                     <span class="n">dest_path</span><span class="o">=</span><span class="n">dest_path</span><span class="p">)</span>
        <span class="n">json_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_json</span><span class="p">(</span><span class="n">dest_path</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">json_data</span>

    <span class="k">def</span> <span class="nf">download_meta_model_preds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subfolder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s2">&quot;v4.2/meta_model.parquet&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Download Meta model predictions through NumerAPI.</span>
<span class="sd">        :param subfolder: Specify folder to create folder within base directory root.</span>
<span class="sd">        Saves in base directory root by default.</span>
<span class="sd">        :param filename: name for meta model predictions file.</span>
<span class="sd">        :return: Meta model predictions as DataFrame.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dest_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_dest_path</span><span class="p">(</span><span class="n">subfolder</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">download_single_dataset</span><span class="p">(</span>
            <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span>
            <span class="n">dest_path</span><span class="o">=</span><span class="n">dest_path</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="n">dest_path</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_version_mapping</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">version</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Check if data version is supported and return file mapping for version. &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">mapping_dictionary</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">version_mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">version</span><span class="p">)]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Version &#39;</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">&#39; is not available. Available versions are </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">version_mapping</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">mapping_dictionary</span>

    <span class="k">def</span> <span class="nf">__get_dest_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subfolder</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Prepare destination path for downloading. &quot;&quot;&quot;</span>
        <span class="nb">dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_append_folder</span><span class="p">(</span><span class="n">subfolder</span><span class="p">)</span>
        <span class="n">dest_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">dir</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
        <span class="k">return</span> <span class="n">dest_path</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">




<h3 id="numerblox.download.NumeraiClassicDownloader.__get_dest_path" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">__get_dest_path</span><span class="p">(</span><span class="n">subfolder</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Prepare destination path for downloading.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/download.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">__get_dest_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subfolder</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Prepare destination path for downloading. &quot;&quot;&quot;</span>
    <span class="nb">dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_append_folder</span><span class="p">(</span><span class="n">subfolder</span><span class="p">)</span>
    <span class="n">dest_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">dir</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
    <span class="k">return</span> <span class="n">dest_path</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="numerblox.download.NumeraiClassicDownloader.download_example_data" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">download_example_data</span><span class="p">(</span><span class="n">subfolder</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="s1">&#39;4.2&#39;</span><span class="p">,</span> <span class="n">round_num</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Download all example prediction data in specified folder for given version.</p>
<p>:param subfolder: Specify folder to create folder within base directory root.
Saves in base directory root by default.
:param version: Numerai dataset version (4.1=Sunshine dataset)
:param round_num: Numerai tournament round number. Downloads latest round by default.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/download.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">download_example_data</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">subfolder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">version</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;4.2&quot;</span><span class="p">,</span> <span class="n">round_num</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Download all example prediction data in specified folder for given version.</span>

<span class="sd">    :param subfolder: Specify folder to create folder within base directory root.</span>
<span class="sd">    Saves in base directory root by default.</span>
<span class="sd">    :param version: Numerai dataset version (4.1=Sunshine dataset)</span>
<span class="sd">    :param round_num: Numerai tournament round number. Downloads latest round by default.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">example_files</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_version_mapping</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">version</span><span class="p">))[</span><span class="s2">&quot;example&quot;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">example_files</span><span class="p">:</span>
        <span class="n">dest_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_dest_path</span><span class="p">(</span><span class="n">subfolder</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">download_single_dataset</span><span class="p">(</span>
            <span class="n">filename</span><span class="o">=</span><span class="n">file</span><span class="p">,</span>
            <span class="n">dest_path</span><span class="o">=</span><span class="n">dest_path</span><span class="p">,</span>
            <span class="n">round_num</span><span class="o">=</span><span class="n">round_num</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="numerblox.download.NumeraiClassicDownloader.download_inference_data" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">download_inference_data</span><span class="p">(</span><span class="n">subfolder</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="s1">&#39;4.2&#39;</span><span class="p">,</span> <span class="n">int8</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">round_num</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Get Numerai classic inference (tournament) data.
If only minimal live data is needed, consider .download_live_data.
:param subfolder: Specify folder to create folder within base directory root.
Saves in base directory root by default.
:param version: Numerai dataset version 
4.1 = Sunshine dataset
4.2 (default) = Rain Dataset
:param int8: Integer version of data
:param round_num: Numerai tournament round number. Downloads latest round by default.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/download.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">download_inference_data</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">subfolder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">version</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;4.2&quot;</span><span class="p">,</span>
    <span class="n">int8</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">round_num</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get Numerai classic inference (tournament) data.</span>
<span class="sd">    If only minimal live data is needed, consider .download_live_data.</span>
<span class="sd">    :param subfolder: Specify folder to create folder within base directory root.</span>
<span class="sd">    Saves in base directory root by default.</span>
<span class="sd">    :param version: Numerai dataset version </span>
<span class="sd">    4.1 = Sunshine dataset</span>
<span class="sd">    4.2 (default) = Rain Dataset</span>
<span class="sd">    :param int8: Integer version of data</span>
<span class="sd">    :param round_num: Numerai tournament round number. Downloads latest round by default.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data_type</span> <span class="o">=</span> <span class="s2">&quot;int8&quot;</span> <span class="k">if</span> <span class="n">int8</span> <span class="k">else</span> <span class="s2">&quot;float&quot;</span>
    <span class="k">if</span> <span class="n">data_type</span> <span class="o">==</span> <span class="s2">&quot;float&quot;</span> <span class="ow">and</span> <span class="n">version</span> <span class="o">==</span> <span class="s2">&quot;4.2&quot;</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;No float version of training data is available for version 4.2. onwards. If you would like to download the 4.2 (Rain) dataset make sure to explicitly pass `int8=True`.&quot;&quot;&quot;</span><span class="p">)</span>
    <span class="n">inference_files</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_version_mapping</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">version</span><span class="p">))[</span><span class="s2">&quot;inference&quot;</span><span class="p">][</span><span class="n">data_type</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">inference_files</span><span class="p">:</span>
        <span class="n">dest_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_dest_path</span><span class="p">(</span><span class="n">subfolder</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">download_single_dataset</span><span class="p">(</span>
            <span class="n">filename</span><span class="o">=</span><span class="n">file</span><span class="p">,</span>
            <span class="n">dest_path</span><span class="o">=</span><span class="n">dest_path</span><span class="p">,</span>
            <span class="n">round_num</span><span class="o">=</span><span class="n">round_num</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="numerblox.download.NumeraiClassicDownloader.download_live_data" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">download_live_data</span><span class="p">(</span><span class="n">subfolder</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="s1">&#39;4.2&#39;</span><span class="p">,</span> <span class="n">int8</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">round_num</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Download all live data in specified folder for given version (i.e. minimal data needed for inference).</p>
<p>:param subfolder: Specify folder to create folder within directory root.
Saves in directory root by default.
:param version: Numerai dataset version 
4.1 = Sunshine dataset
4.2 (default) = Rain Dataset
:param int8: Integer version of data
:param round_num: Numerai tournament round number. Downloads latest round by default.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/download.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">download_live_data</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">subfolder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">version</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;4.2&quot;</span><span class="p">,</span>
        <span class="n">int8</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">round_num</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Download all live data in specified folder for given version (i.e. minimal data needed for inference).</span>

<span class="sd">    :param subfolder: Specify folder to create folder within directory root.</span>
<span class="sd">    Saves in directory root by default.</span>
<span class="sd">    :param version: Numerai dataset version </span>
<span class="sd">    4.1 = Sunshine dataset</span>
<span class="sd">    4.2 (default) = Rain Dataset</span>
<span class="sd">    :param int8: Integer version of data</span>
<span class="sd">    :param round_num: Numerai tournament round number. Downloads latest round by default.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data_type</span> <span class="o">=</span> <span class="s2">&quot;int8&quot;</span> <span class="k">if</span> <span class="n">int8</span> <span class="k">else</span> <span class="s2">&quot;float&quot;</span>
    <span class="n">live_files</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_version_mapping</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">version</span><span class="p">))[</span><span class="s2">&quot;live&quot;</span><span class="p">][</span><span class="n">data_type</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">live_files</span><span class="p">:</span>
        <span class="n">dest_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_dest_path</span><span class="p">(</span><span class="n">subfolder</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">download_single_dataset</span><span class="p">(</span>
            <span class="n">filename</span><span class="o">=</span><span class="n">file</span><span class="p">,</span>
            <span class="n">dest_path</span><span class="o">=</span><span class="n">dest_path</span><span class="p">,</span>
            <span class="n">round_num</span><span class="o">=</span><span class="n">round_num</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="numerblox.download.NumeraiClassicDownloader.download_meta_model_preds" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">download_meta_model_preds</span><span class="p">(</span><span class="n">subfolder</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;v4.2/meta_model.parquet&#39;</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Download Meta model predictions through NumerAPI.
:param subfolder: Specify folder to create folder within base directory root.
Saves in base directory root by default.
:param filename: name for meta model predictions file.
:return: Meta model predictions as DataFrame.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/download.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">download_meta_model_preds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subfolder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s2">&quot;v4.2/meta_model.parquet&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Download Meta model predictions through NumerAPI.</span>
<span class="sd">    :param subfolder: Specify folder to create folder within base directory root.</span>
<span class="sd">    Saves in base directory root by default.</span>
<span class="sd">    :param filename: name for meta model predictions file.</span>
<span class="sd">    :return: Meta model predictions as DataFrame.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dest_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_dest_path</span><span class="p">(</span><span class="n">subfolder</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">download_single_dataset</span><span class="p">(</span>
        <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span>
        <span class="n">dest_path</span><span class="o">=</span><span class="n">dest_path</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="n">dest_path</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="numerblox.download.NumeraiClassicDownloader.download_single_dataset" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">download_single_dataset</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">dest_path</span><span class="p">,</span> <span class="n">round_num</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Download one of the available datasets through NumerAPI.</p>
<p>:param filename: Name as listed in NumerAPI (Check NumerAPI().list_datasets() for full overview)
:param dest_path: Full path where file will be saved.
:param round_num: Numerai tournament round number. Downloads latest round by default.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/download.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">download_single_dataset</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">dest_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">round_num</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Download one of the available datasets through NumerAPI.</span>

<span class="sd">    :param filename: Name as listed in NumerAPI (Check NumerAPI().list_datasets() for full overview)</span>
<span class="sd">    :param dest_path: Full path where file will be saved.</span>
<span class="sd">    :param round_num: Numerai tournament round number. Downloads latest round by default.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Downloading &#39;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">napi</span><span class="o">.</span><span class="n">download_dataset</span><span class="p">(</span>
        <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span>
        <span class="n">dest_path</span><span class="o">=</span><span class="n">dest_path</span><span class="p">,</span>
        <span class="n">round_num</span><span class="o">=</span><span class="n">round_num</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="numerblox.download.NumeraiClassicDownloader.download_training_data" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">download_training_data</span><span class="p">(</span><span class="n">subfolder</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="s1">&#39;4.2&#39;</span><span class="p">,</span> <span class="n">int8</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Get Numerai classic training and validation data.
:param subfolder: Specify folder to create folder within base directory root.
Saves in base directory root by default.
:param version: Numerai dataset version.
4.1 = Sunshine dataset
4.2 (default) = Rain Dataset
NOTE: 4.2 is only available as int8 version so explicitly pass
int8 = True if you want to download 4.2 data.
:param int8: Integer version of data</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/download.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">download_training_data</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">subfolder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">version</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;4.2&quot;</span><span class="p">,</span> <span class="n">int8</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get Numerai classic training and validation data.</span>
<span class="sd">    :param subfolder: Specify folder to create folder within base directory root.</span>
<span class="sd">    Saves in base directory root by default.</span>
<span class="sd">    :param version: Numerai dataset version.</span>
<span class="sd">    4.1 = Sunshine dataset</span>
<span class="sd">    4.2 (default) = Rain Dataset</span>
<span class="sd">    NOTE: 4.2 is only available as int8 version so explicitly pass</span>
<span class="sd">    int8 = True if you want to download 4.2 data.</span>
<span class="sd">    :param int8: Integer version of data</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data_type</span> <span class="o">=</span> <span class="s2">&quot;int8&quot;</span> <span class="k">if</span> <span class="n">int8</span> <span class="k">else</span> <span class="s2">&quot;float&quot;</span>
    <span class="c1"># 4.2 data is only (currently) available in int8 format.</span>
    <span class="c1"># Raise exception to avoid confusion about the 4.2. dataset.</span>
    <span class="k">if</span> <span class="n">data_type</span> <span class="o">==</span> <span class="s2">&quot;float&quot;</span> <span class="ow">and</span> <span class="n">version</span> <span class="o">==</span> <span class="s2">&quot;4.2&quot;</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;No float version of training data is available for version 4.2. If you would like to download the 4.2 (Rain) dataset make sure to explicitly pass `int8=True`.&quot;&quot;&quot;</span><span class="p">)</span>
    <span class="n">train_val_files</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_version_mapping</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">version</span><span class="p">))[</span><span class="s2">&quot;train&quot;</span><span class="p">][</span><span class="n">data_type</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">train_val_files</span><span class="p">:</span>
        <span class="n">dest_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_dest_path</span><span class="p">(</span><span class="n">subfolder</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">download_single_dataset</span><span class="p">(</span>
            <span class="n">filename</span><span class="o">=</span><span class="n">file</span><span class="p">,</span>
            <span class="n">dest_path</span><span class="o">=</span><span class="n">dest_path</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="numerblox.download.NumeraiClassicDownloader.get_classic_features" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_classic_features</span><span class="p">(</span><span class="n">subfolder</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;v4.2/features.json&#39;</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Download feature overview (stats and feature sets) through NumerAPI and load as dict.
:param subfolder: Specify folder to create folder within base directory root.
Saves in base directory root by default.
:param filename: name for feature overview.
<em>args, </em>*kwargs will be passed to the JSON loader.
:return: Feature overview dict</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/download.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_classic_features</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subfolder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s2">&quot;v4.2/features.json&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Download feature overview (stats and feature sets) through NumerAPI and load as dict.</span>
<span class="sd">    :param subfolder: Specify folder to create folder within base directory root.</span>
<span class="sd">    Saves in base directory root by default.</span>
<span class="sd">    :param filename: name for feature overview.</span>
<span class="sd">    *args, **kwargs will be passed to the JSON loader.</span>
<span class="sd">    :return: Feature overview dict</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dest_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_dest_path</span><span class="p">(</span><span class="n">subfolder</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">download_single_dataset</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span>
                                 <span class="n">dest_path</span><span class="o">=</span><span class="n">dest_path</span><span class="p">)</span>
    <span class="n">json_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_json</span><span class="p">(</span><span class="n">dest_path</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">json_data</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>




  </div>

  </div>

</div><hr />


<div class="doc doc-object doc-module">



<a id="numerblox.numerframe"></a>
  <div class="doc doc-contents first">

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">




<h2 id="numerblox.numerframe.NumerFrame" class="doc doc-heading">
          <code>NumerFrame</code>


</h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><span title="pandas.DataFrame">DataFrame</span></code></p>

  
      <p>Data structure which extends Pandas DataFrames and
allows for additional Numerai specific functionality.</p>

            <details class="quote">
              <summary>Source code in <code>numerblox/numerframe.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">NumerFrame</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Data structure which extends Pandas DataFrames and</span>
<span class="sd">    allows for additional Numerai specific functionality.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_metadata</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;meta&quot;</span><span class="p">,</span> <span class="s2">&quot;feature_cols&quot;</span><span class="p">,</span> <span class="s2">&quot;target_cols&quot;</span><span class="p">,</span>
                 <span class="s2">&quot;prediction_cols&quot;</span><span class="p">,</span> <span class="s2">&quot;not_aux_cols&quot;</span><span class="p">,</span> <span class="s2">&quot;aux_cols&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meta</span> <span class="o">=</span> <span class="n">AttrDict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__set_era_col</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__init_meta_attrs</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_constructor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">NumerFrame</span>

    <span class="k">def</span> <span class="nf">__init_meta_attrs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Dynamically track column groups. &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feature_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">col</span><span class="p">)</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;feature&quot;</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">col</span><span class="p">)</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;target&quot;</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prediction_cols</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">col</span><span class="p">)</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;prediction&quot;</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">not_aux_cols</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_cols</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_cols</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">prediction_cols</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aux_cols</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">col</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">not_aux_cols</span>
        <span class="p">]</span>

    <span class="k">def</span> <span class="nf">__set_era_col</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Each NumerFrame should have an era column to benefit from all functionality. &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;era&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">era_col</span> <span class="o">=</span> <span class="s2">&quot;era&quot;</span>
        <span class="k">elif</span> <span class="s2">&quot;friday_date&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">era_col</span> <span class="o">=</span> <span class="s2">&quot;friday_date&quot;</span>
        <span class="k">elif</span> <span class="s2">&quot;date&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">era_col</span> <span class="o">=</span> <span class="s2">&quot;date&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">era_col</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">get_column_selection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cols</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s2">&quot;NumerFrame&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Return NumerFrame from selection of columns. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">cols</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cols</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="n">cols</span><span class="p">]]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">get_feature_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;NumerFrame&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; All columns for which name starts with &#39;target&#39;.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_column_selection</span><span class="p">(</span><span class="n">cols</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">feature_cols</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">get_target_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;NumerFrame&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; All columns for which name starts with &#39;target&#39;.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_column_selection</span><span class="p">(</span><span class="n">cols</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">target_cols</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">get_single_target_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;NumerFrame&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Column with name &#39;target&#39; (Main Numerai target column). &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_column_selection</span><span class="p">(</span><span class="n">cols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">])</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">get_prediction_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;NumerFrame&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; All columns for which name starts with &#39;prediction&#39;.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_column_selection</span><span class="p">(</span><span class="n">cols</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prediction_cols</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">get_aux_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;NumerFrame&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; All columns that are not features, targets or predictions. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_column_selection</span><span class="p">(</span><span class="n">cols</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">aux_cols</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">get_era_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;NumerFrame&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Column of all eras. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_column_selection</span><span class="p">(</span><span class="n">cols</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">era_col</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">get_prediction_aux_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;NumerFrame&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; All predictions columns and aux columns (for ensembling, etc.). &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_column_selection</span><span class="p">(</span><span class="n">cols</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prediction_cols</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">aux_cols</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">get_fncv3_feature_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;NumerFrame&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Get FNCv3 features. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_column_selection</span><span class="p">(</span><span class="n">cols</span><span class="o">=</span><span class="n">FNCV3_FEATURES</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">get_small_feature_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;NumerFrame&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Small subset of the Numerai dataset for v4.2 data. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_column_selection</span><span class="p">(</span><span class="n">cols</span><span class="o">=</span><span class="n">SMALL_FEATURES</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">get_medium_feature_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;NumerFrame&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Medium subset of the Numerai dataset for v4.2 data. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_column_selection</span><span class="p">(</span><span class="n">cols</span><span class="o">=</span><span class="n">MEDIUM_FEATURES</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">get_v2_equivalent_feature_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;NumerFrame&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Features equivalent to the deprecated v2 Numerai data. For v4.2 data. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_column_selection</span><span class="p">(</span><span class="n">cols</span><span class="o">=</span><span class="n">V2_EQUIVALENT_FEATURES</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">get_v3_equivalent_feature_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;NumerFrame&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Features equivalent to the deprecated v3 Numerai data. For v4.2 data. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_column_selection</span><span class="p">(</span><span class="n">cols</span><span class="o">=</span><span class="n">V3_EQUIVALENT_FEATURES</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">get_unique_eras</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Get all unique eras in the data. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">era_col</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">get_last_n_eras</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;NumerFrame&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        Get data for the last n eras. </span>
<span class="sd">        Make sure eras are sorted in the way you prefer.</span>
<span class="sd">        :param n: Number of eras to select.</span>
<span class="sd">        :return: NumerFrame with last n eras.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">eras</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">era_col</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()[</span><span class="o">-</span><span class="n">n</span><span class="p">:]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">era_col</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">eras</span><span class="p">)]</span>

    <span class="k">def</span> <span class="nf">get_feature_group</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;NumerFrame&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Get feature group based on name or list of names. &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">V4_2_FEATURE_GROUP_MAPPING</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> \
            <span class="sa">f</span><span class="s2">&quot;Group &#39;</span><span class="si">{</span><span class="n">group</span><span class="si">}</span><span class="s2">&#39; not found in </span><span class="si">{</span><span class="n">V4_2_FEATURE_GROUP_MAPPING</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_column_selection</span><span class="p">(</span><span class="n">cols</span><span class="o">=</span><span class="n">V4_2_FEATURE_GROUP_MAPPING</span><span class="p">[</span><span class="n">group</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">get_pattern_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pattern</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;NumerFrame&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get columns based on pattern (for example &#39;_20&#39; to get all 20-day Numerai targets).</span>
<span class="sd">        :param pattern: A &#39;like&#39; pattern (pattern in column_name == True)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">like</span><span class="o">=</span><span class="n">pattern</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_feature_target_pair</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multi_target</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="s2">&quot;NumerFrame&quot;</span><span class="p">,</span> <span class="s2">&quot;NumerFrame&quot;</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get split of feature and target columns.</span>
<span class="sd">        :param multi_target: Returns only &#39;target&#39; column by default.</span>
<span class="sd">        Returns all target columns when set to True.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_feature_data</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_target_data</span> <span class="k">if</span> <span class="n">multi_target</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_single_target_data</span>
        <span class="k">return</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span>

    <span class="k">def</span> <span class="nf">get_era_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">eras</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span>
                      <span class="n">convert_to_tf</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                      <span class="n">aemlp_batch</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                      <span class="n">features</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                      <span class="n">targets</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                      <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="s2">&quot;NumerFrame&quot;</span><span class="p">,</span> <span class="s2">&quot;NumerFrame&quot;</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get feature target pair batch of 1 or multiple eras. \n</span>
<span class="sd">        :param eras: Selection of era names that should be present in era_col. \n</span>
<span class="sd">        :param convert_to_tf: Convert to tf.Tensor. \n</span>
<span class="sd">        :param aemlp_batch: Specific target batch for autoencoder training. \n</span>
<span class="sd">        `y` output will contain three components: features, targets and targets. \n</span>
<span class="sd">        :param features: List of features to select. All by default \n</span>
<span class="sd">        :param targets: List of targets to select. All by default. \n</span>
<span class="sd">        *args, **kwargs are passed to initialization of Tensor.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">valid_eras</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">era</span> <span class="ow">in</span> <span class="n">eras</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">era</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">era_col</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">(),</span> <span class="sa">f</span><span class="s2">&quot;Era &#39;</span><span class="si">{</span><span class="n">era</span><span class="si">}</span><span class="s2">&#39; not found in era column (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">era_col</span><span class="si">}</span><span class="s2">)&quot;</span>
            <span class="n">valid_eras</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">era</span><span class="p">)</span>
        <span class="n">features</span> <span class="o">=</span> <span class="n">features</span> <span class="k">if</span> <span class="n">features</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_cols</span>
        <span class="n">targets</span> <span class="o">=</span> <span class="n">targets</span> <span class="k">if</span> <span class="n">targets</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_cols</span>
        <span class="n">X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">era_col</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">valid_eras</span><span class="p">)][</span><span class="n">features</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">era_col</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">valid_eras</span><span class="p">)][</span><span class="n">targets</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="k">if</span> <span class="n">aemlp_batch</span><span class="p">:</span>
            <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="n">X</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">y</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">y</span><span class="o">.</span><span class="n">copy</span><span class="p">()]</span>

        <span class="k">if</span> <span class="n">convert_to_tf</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
            <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s2">&quot;TensorFlow is not installed. Please make sure to have Tensorflow installed when setting `convert_to_tf=True`.&quot;</span><span class="p">)</span>
            <span class="n">X</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">aemlp_batch</span><span class="p">:</span>
                <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="n">tf</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">y</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">y</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">




<h3 id="numerblox.numerframe.NumerFrame.get_aux_data" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_aux_data</span><span class="p">:</span> <span class="n">NumerFrame</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>All columns that are not features, targets or predictions.</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">




<h3 id="numerblox.numerframe.NumerFrame.get_era_data" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_era_data</span><span class="p">:</span> <span class="n">NumerFrame</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Column of all eras.</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">




<h3 id="numerblox.numerframe.NumerFrame.get_feature_data" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_feature_data</span><span class="p">:</span> <span class="n">NumerFrame</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>All columns for which name starts with 'target'.</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">




<h3 id="numerblox.numerframe.NumerFrame.get_fncv3_feature_data" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_fncv3_feature_data</span><span class="p">:</span> <span class="n">NumerFrame</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Get FNCv3 features.</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">




<h3 id="numerblox.numerframe.NumerFrame.get_medium_feature_data" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_medium_feature_data</span><span class="p">:</span> <span class="n">NumerFrame</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Medium subset of the Numerai dataset for v4.2 data.</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">




<h3 id="numerblox.numerframe.NumerFrame.get_prediction_aux_data" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_prediction_aux_data</span><span class="p">:</span> <span class="n">NumerFrame</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>All predictions columns and aux columns (for ensembling, etc.).</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">




<h3 id="numerblox.numerframe.NumerFrame.get_prediction_data" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_prediction_data</span><span class="p">:</span> <span class="n">NumerFrame</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>All columns for which name starts with 'prediction'.</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">




<h3 id="numerblox.numerframe.NumerFrame.get_single_target_data" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_single_target_data</span><span class="p">:</span> <span class="n">NumerFrame</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Column with name 'target' (Main Numerai target column).</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">




<h3 id="numerblox.numerframe.NumerFrame.get_small_feature_data" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_small_feature_data</span><span class="p">:</span> <span class="n">NumerFrame</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Small subset of the Numerai dataset for v4.2 data.</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">




<h3 id="numerblox.numerframe.NumerFrame.get_target_data" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_target_data</span><span class="p">:</span> <span class="n">NumerFrame</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>All columns for which name starts with 'target'.</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">




<h3 id="numerblox.numerframe.NumerFrame.get_unique_eras" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_unique_eras</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Get all unique eras in the data.</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">




<h3 id="numerblox.numerframe.NumerFrame.get_v2_equivalent_feature_data" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_v2_equivalent_feature_data</span><span class="p">:</span> <span class="n">NumerFrame</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Features equivalent to the deprecated v2 Numerai data. For v4.2 data.</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">




<h3 id="numerblox.numerframe.NumerFrame.get_v3_equivalent_feature_data" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_v3_equivalent_feature_data</span><span class="p">:</span> <span class="n">NumerFrame</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Features equivalent to the deprecated v3 Numerai data. For v4.2 data.</p>
  </div>

</div>




<div class="doc doc-object doc-function">




<h3 id="numerblox.numerframe.NumerFrame.__init_meta_attrs" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">__init_meta_attrs</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Dynamically track column groups.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/numerframe.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">__init_meta_attrs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Dynamically track column groups. &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">feature_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">col</span><span class="p">)</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;feature&quot;</span><span class="p">)]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">target_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">col</span><span class="p">)</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;target&quot;</span><span class="p">)]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">prediction_cols</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">col</span><span class="p">)</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;prediction&quot;</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">not_aux_cols</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_cols</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_cols</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">prediction_cols</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">aux_cols</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">col</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">not_aux_cols</span>
    <span class="p">]</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="numerblox.numerframe.NumerFrame.__set_era_col" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">__set_era_col</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Each NumerFrame should have an era column to benefit from all functionality.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/numerframe.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">__set_era_col</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Each NumerFrame should have an era column to benefit from all functionality. &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s2">&quot;era&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">era_col</span> <span class="o">=</span> <span class="s2">&quot;era&quot;</span>
    <span class="k">elif</span> <span class="s2">&quot;friday_date&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">era_col</span> <span class="o">=</span> <span class="s2">&quot;friday_date&quot;</span>
    <span class="k">elif</span> <span class="s2">&quot;date&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">era_col</span> <span class="o">=</span> <span class="s2">&quot;date&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">era_col</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="numerblox.numerframe.NumerFrame.get_column_selection" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_column_selection</span><span class="p">(</span><span class="n">cols</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Return NumerFrame from selection of columns.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/numerframe.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_column_selection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cols</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s2">&quot;NumerFrame&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Return NumerFrame from selection of columns. &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">cols</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cols</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="n">cols</span><span class="p">]]</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="numerblox.numerframe.NumerFrame.get_era_batch" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_era_batch</span><span class="p">(</span><span class="n">eras</span><span class="p">,</span> <span class="n">convert_to_tf</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">aemlp_batch</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">targets</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Get feature target pair batch of 1 or multiple eras. </p>
<p>:param eras: Selection of era names that should be present in era_col. </p>
<p>:param convert_to_tf: Convert to tf.Tensor. </p>
<p>:param aemlp_batch: Specific target batch for autoencoder training. </p>
<p><code>y</code> output will contain three components: features, targets and targets. </p>
<p>:param features: List of features to select. All by default </p>
<p>:param targets: List of targets to select. All by default. </p>
<p><em>args, </em>*kwargs are passed to initialization of Tensor.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/numerframe.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_era_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">eras</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span>
                  <span class="n">convert_to_tf</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                  <span class="n">aemlp_batch</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                  <span class="n">features</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                  <span class="n">targets</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                  <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="s2">&quot;NumerFrame&quot;</span><span class="p">,</span> <span class="s2">&quot;NumerFrame&quot;</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get feature target pair batch of 1 or multiple eras. \n</span>
<span class="sd">    :param eras: Selection of era names that should be present in era_col. \n</span>
<span class="sd">    :param convert_to_tf: Convert to tf.Tensor. \n</span>
<span class="sd">    :param aemlp_batch: Specific target batch for autoencoder training. \n</span>
<span class="sd">    `y` output will contain three components: features, targets and targets. \n</span>
<span class="sd">    :param features: List of features to select. All by default \n</span>
<span class="sd">    :param targets: List of targets to select. All by default. \n</span>
<span class="sd">    *args, **kwargs are passed to initialization of Tensor.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">valid_eras</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">era</span> <span class="ow">in</span> <span class="n">eras</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">era</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">era_col</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">(),</span> <span class="sa">f</span><span class="s2">&quot;Era &#39;</span><span class="si">{</span><span class="n">era</span><span class="si">}</span><span class="s2">&#39; not found in era column (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">era_col</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="n">valid_eras</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">era</span><span class="p">)</span>
    <span class="n">features</span> <span class="o">=</span> <span class="n">features</span> <span class="k">if</span> <span class="n">features</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_cols</span>
    <span class="n">targets</span> <span class="o">=</span> <span class="n">targets</span> <span class="k">if</span> <span class="n">targets</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_cols</span>
    <span class="n">X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">era_col</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">valid_eras</span><span class="p">)][</span><span class="n">features</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">era_col</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">valid_eras</span><span class="p">)][</span><span class="n">targets</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="k">if</span> <span class="n">aemlp_batch</span><span class="p">:</span>
        <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="n">X</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">y</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">y</span><span class="o">.</span><span class="n">copy</span><span class="p">()]</span>

    <span class="k">if</span> <span class="n">convert_to_tf</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s2">&quot;TensorFlow is not installed. Please make sure to have Tensorflow installed when setting `convert_to_tf=True`.&quot;</span><span class="p">)</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">aemlp_batch</span><span class="p">:</span>
            <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="n">tf</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">y</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="numerblox.numerframe.NumerFrame.get_feature_group" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_feature_group</span><span class="p">(</span><span class="n">group</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Get feature group based on name or list of names.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/numerframe.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_feature_group</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;NumerFrame&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Get feature group based on name or list of names. &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">V4_2_FEATURE_GROUP_MAPPING</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> \
        <span class="sa">f</span><span class="s2">&quot;Group &#39;</span><span class="si">{</span><span class="n">group</span><span class="si">}</span><span class="s2">&#39; not found in </span><span class="si">{</span><span class="n">V4_2_FEATURE_GROUP_MAPPING</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_column_selection</span><span class="p">(</span><span class="n">cols</span><span class="o">=</span><span class="n">V4_2_FEATURE_GROUP_MAPPING</span><span class="p">[</span><span class="n">group</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="numerblox.numerframe.NumerFrame.get_feature_target_pair" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_feature_target_pair</span><span class="p">(</span><span class="n">multi_target</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Get split of feature and target columns.
:param multi_target: Returns only 'target' column by default.
Returns all target columns when set to True.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/numerframe.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_feature_target_pair</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multi_target</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="s2">&quot;NumerFrame&quot;</span><span class="p">,</span> <span class="s2">&quot;NumerFrame&quot;</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get split of feature and target columns.</span>
<span class="sd">    :param multi_target: Returns only &#39;target&#39; column by default.</span>
<span class="sd">    Returns all target columns when set to True.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_feature_data</span>
    <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_target_data</span> <span class="k">if</span> <span class="n">multi_target</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_single_target_data</span>
    <span class="k">return</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="numerblox.numerframe.NumerFrame.get_last_n_eras" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_last_n_eras</span><span class="p">(</span><span class="n">n</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Get data for the last n eras. 
Make sure eras are sorted in the way you prefer.
:param n: Number of eras to select.
:return: NumerFrame with last n eras.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/numerframe.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_last_n_eras</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;NumerFrame&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">    Get data for the last n eras. </span>
<span class="sd">    Make sure eras are sorted in the way you prefer.</span>
<span class="sd">    :param n: Number of eras to select.</span>
<span class="sd">    :return: NumerFrame with last n eras.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">eras</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">era_col</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()[</span><span class="o">-</span><span class="n">n</span><span class="p">:]</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">era_col</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">eras</span><span class="p">)]</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="numerblox.numerframe.NumerFrame.get_pattern_data" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_pattern_data</span><span class="p">(</span><span class="n">pattern</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Get columns based on pattern (for example '_20' to get all 20-day Numerai targets).
:param pattern: A 'like' pattern (pattern in column_name == True)</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/numerframe.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_pattern_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pattern</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;NumerFrame&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get columns based on pattern (for example &#39;_20&#39; to get all 20-day Numerai targets).</span>
<span class="sd">    :param pattern: A &#39;like&#39; pattern (pattern in column_name == True)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">like</span><span class="o">=</span><span class="n">pattern</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>



<div class="doc doc-object doc-function">




<h2 id="numerblox.numerframe.create_numerframe" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">create_numerframe</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Convenient function to initialize NumerFrame.
Support most used file formats for Pandas DataFrames </p>
<p>(.csv, .parquet, .xls, .pkl, etc.).
For more details check https://pandas.pydata.org/docs/reference/io.html</p>
<p>:param file_path: Relative or absolute path to data file. </p>
<p>:param columns: Which columns to read (All by default). </p>
<p><em>args, </em>*kwargs will be passed to Pandas loading function.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/numerframe.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">create_numerframe</span><span class="p">(</span><span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">columns</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NumerFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convenient function to initialize NumerFrame.</span>
<span class="sd">    Support most used file formats for Pandas DataFrames \n</span>
<span class="sd">    (.csv, .parquet, .xls, .pkl, etc.).</span>
<span class="sd">    For more details check https://pandas.pydata.org/docs/reference/io.html</span>

<span class="sd">    :param file_path: Relative or absolute path to data file. \n</span>
<span class="sd">    :param columns: Which columns to read (All by default). \n</span>
<span class="sd">    *args, **kwargs will be passed to Pandas loading function.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">Path</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span><span class="o">.</span><span class="n">is_file</span><span class="p">(),</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2"> does not point to file.&quot;</span>
    <span class="n">suffix</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span><span class="o">.</span><span class="n">suffix</span>
    <span class="k">if</span> <span class="n">suffix</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;.csv&quot;</span><span class="p">]:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="n">columns</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">suffix</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;.parquet&quot;</span><span class="p">]:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">suffix</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;.xls&quot;</span><span class="p">,</span> <span class="s2">&quot;.xlsx&quot;</span><span class="p">,</span> <span class="s2">&quot;.xlsm&quot;</span><span class="p">,</span> <span class="s2">&quot;xlsb&quot;</span><span class="p">,</span> <span class="s2">&quot;.odf&quot;</span><span class="p">,</span> <span class="s2">&quot;.ods&quot;</span><span class="p">,</span> <span class="s2">&quot;.odt&quot;</span><span class="p">]:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="n">columns</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">suffix</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;.pkl&#39;</span><span class="p">,</span> <span class="s1">&#39;.pickle&#39;</span><span class="p">]:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_pickle</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">columns</span><span class="p">]</span> <span class="k">if</span> <span class="n">columns</span> <span class="k">else</span> <span class="n">df</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Suffix &#39;</span><span class="si">{</span><span class="n">suffix</span><span class="si">}</span><span class="s2">&#39; is not supported.&quot;</span><span class="p">)</span>
    <span class="n">num_frame</span> <span class="o">=</span> <span class="n">NumerFrame</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">num_frame</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div><hr />


<div class="doc doc-object doc-module">



<a id="numerblox.preprocessing.base"></a>
  <div class="doc doc-contents first">

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">




<h2 id="numerblox.preprocessing.base.BasePreProcessor" class="doc doc-heading">
          <code>BasePreProcessor</code>


</h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><span title="sklearn.base.BaseEstimator">BaseEstimator</span></code>, <code><span title="sklearn.base.TransformerMixin">TransformerMixin</span></code></p>

  
      <p>Common functionality for preprocessors and postprocessors.</p>

            <details class="quote">
              <summary>Source code in <code>numerblox/preprocessing/base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">BasePreProcessor</span><span class="p">(</span><span class="n">BaseEstimator</span><span class="p">,</span> <span class="n">TransformerMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Common functionality for preprocessors and postprocessors.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="o">...</span>

    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="o">...</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">get_feature_names_out</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_features</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="o">...</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>




  </div>

  </div>

</div>

<div class="doc doc-object doc-module">



<a id="numerblox.preprocessing.classic"></a>
  <div class="doc doc-contents first">

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">




<h2 id="numerblox.preprocessing.classic.GroupStatsPreProcessor" class="doc doc-heading">
          <code>GroupStatsPreProcessor</code>


</h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="numerblox.preprocessing.base.BasePreProcessor" href="#numerblox.preprocessing.base.BasePreProcessor">BasePreProcessor</a></code></p>

  
      <p>WARNING: Only supported for v4.2 (Rain) data. The Rain dataset (re)introduced feature groups. </p>
<p>Note that this class only works with <code>pd.DataFrame</code> input.
We using in a Pipeline, make sure that the Pandas output API is set (<code>.set_output(transform="pandas")</code>.</p>
<p>Calculates group statistics for all data groups. </p>
<p>:param groups: Groups to create features for. All groups by default.</p>

            <details class="quote">
              <summary>Source code in <code>numerblox/preprocessing/classic.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">GroupStatsPreProcessor</span><span class="p">(</span><span class="n">BasePreProcessor</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    WARNING: Only supported for v4.2 (Rain) data. The Rain dataset (re)introduced feature groups. \n</span>
<span class="sd">    Note that this class only works with `pd.DataFrame` input.</span>
<span class="sd">    We using in a Pipeline, make sure that the Pandas output API is set (`.set_output(transform=&quot;pandas&quot;)`.</span>

<span class="sd">    Calculates group statistics for all data groups. \n</span>
<span class="sd">    :param groups: Groups to create features for. All groups by default. \n</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">groups</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">all_groups</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s1">&#39;intelligence&#39;</span><span class="p">,</span> 
            <span class="s1">&#39;charisma&#39;</span><span class="p">,</span> 
            <span class="s1">&#39;strength&#39;</span><span class="p">,</span> 
            <span class="s1">&#39;dexterity&#39;</span><span class="p">,</span> 
            <span class="s1">&#39;constitution&#39;</span><span class="p">,</span> 
            <span class="s1">&#39;wisdom&#39;</span><span class="p">,</span> 
            <span class="s1">&#39;agility&#39;</span><span class="p">,</span> 
            <span class="s1">&#39;serenity&#39;</span><span class="p">,</span> 
            <span class="s1">&#39;sunshine&#39;</span><span class="p">,</span> 
            <span class="s1">&#39;rain&#39;</span>
        <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">groups</span> <span class="o">=</span> <span class="n">groups</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">group_names</span> <span class="o">=</span> <span class="n">groups</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">groups</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_groups</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feature_group_mapping</span> <span class="o">=</span> <span class="n">V4_2_FEATURE_GROUP_MAPPING</span>

    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check validity and add group features.&quot;&quot;&quot;</span>
        <span class="n">dataf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_group_features</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">dataf</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_add_group_features</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Mean, standard deviation and skew for each group.&quot;&quot;&quot;</span>
        <span class="n">dataf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_names</span><span class="p">:</span>
            <span class="n">cols</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_group_mapping</span><span class="p">[</span><span class="n">group</span><span class="p">]</span>
            <span class="n">valid_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">cols</span> <span class="k">if</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">valid_cols</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;None of the columns of &#39;</span><span class="si">{</span><span class="n">group</span><span class="si">}</span><span class="s2">&#39; are in the input data. Output will be nans for the group features.&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">cols</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">valid_cols</span><span class="p">):</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Not all columns of &#39;</span><span class="si">{</span><span class="n">group</span><span class="si">}</span><span class="s2">&#39; are in the input data (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">valid_cols</span><span class="p">)</span><span class="si">}</span><span class="s2"> &lt; </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">cols</span><span class="p">)</span><span class="si">}</span><span class="s2">). Use remaining columns for stats features.&quot;</span><span class="p">)</span>
            <span class="n">dataf</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="sa">f</span><span class="s2">&quot;feature_</span><span class="si">{</span><span class="n">group</span><span class="si">}</span><span class="s2">_mean&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">valid_cols</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">dataf</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="sa">f</span><span class="s2">&quot;feature_</span><span class="si">{</span><span class="n">group</span><span class="si">}</span><span class="s2">_std&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">valid_cols</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">dataf</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="sa">f</span><span class="s2">&quot;feature_</span><span class="si">{</span><span class="n">group</span><span class="si">}</span><span class="s2">_skew&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">valid_cols</span><span class="p">]</span><span class="o">.</span><span class="n">skew</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">dataf</span>

    <span class="k">def</span> <span class="nf">get_feature_names_out</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_features</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return feature names.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">input_features</span><span class="p">:</span>
            <span class="n">feature_names</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_names</span><span class="p">:</span>
                <span class="n">feature_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;feature_</span><span class="si">{</span><span class="n">group</span><span class="si">}</span><span class="s2">_mean&quot;</span><span class="p">)</span>
                <span class="n">feature_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;feature_</span><span class="si">{</span><span class="n">group</span><span class="si">}</span><span class="s2">_std&quot;</span><span class="p">)</span>
                <span class="n">feature_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;feature_</span><span class="si">{</span><span class="n">group</span><span class="si">}</span><span class="s2">_skew&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">feature_names</span> <span class="o">=</span> <span class="n">input_features</span>
        <span class="k">return</span> <span class="n">feature_names</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">




<h3 id="numerblox.preprocessing.classic.GroupStatsPreProcessor.get_feature_names_out" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_feature_names_out</span><span class="p">(</span><span class="n">input_features</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Return feature names.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/preprocessing/classic.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_feature_names_out</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_features</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return feature names.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">input_features</span><span class="p">:</span>
        <span class="n">feature_names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_names</span><span class="p">:</span>
            <span class="n">feature_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;feature_</span><span class="si">{</span><span class="n">group</span><span class="si">}</span><span class="s2">_mean&quot;</span><span class="p">)</span>
            <span class="n">feature_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;feature_</span><span class="si">{</span><span class="n">group</span><span class="si">}</span><span class="s2">_std&quot;</span><span class="p">)</span>
            <span class="n">feature_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;feature_</span><span class="si">{</span><span class="n">group</span><span class="si">}</span><span class="s2">_skew&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">feature_names</span> <span class="o">=</span> <span class="n">input_features</span>
    <span class="k">return</span> <span class="n">feature_names</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="numerblox.preprocessing.classic.GroupStatsPreProcessor.transform" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Check validity and add group features.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/preprocessing/classic.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check validity and add group features.&quot;&quot;&quot;</span>
    <span class="n">dataf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_group_features</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">dataf</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>




  </div>

  </div>

</div>

<div class="doc doc-object doc-module">



<a id="numerblox.preprocessing.signals"></a>
  <div class="doc doc-contents first">

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">




<h2 id="numerblox.preprocessing.signals.DifferencePreProcessor" class="doc doc-heading">
          <code>DifferencePreProcessor</code>


</h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="numerblox.preprocessing.base.BasePreProcessor" href="#numerblox.preprocessing.base.BasePreProcessor">BasePreProcessor</a></code></p>

  
      <p>Add difference features based on given windows. Run LagPreProcessor first.
Usage in Pipeline works only with Pandas API. 
Run <code>.set_output("pandas")</code> on your pipeline first.</p>
<p>:param windows: All lag windows to process for all features. </p>
<p>:param feature_names: All features for which you want to create differences. All features that also have lags by default. </p>
<p>:param pct_change: Method to calculate differences. If True, will calculate differences with a percentage change. Otherwise calculates a simple difference. Defaults to False </p>
<p>:param abs_diff: Whether to also calculate the absolute value of all differences. Defaults to True</p>

            <details class="quote">
              <summary>Source code in <code>numerblox/preprocessing/signals.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">DifferencePreProcessor</span><span class="p">(</span><span class="n">BasePreProcessor</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add difference features based on given windows. Run LagPreProcessor first.</span>
<span class="sd">    Usage in Pipeline works only with Pandas API. </span>
<span class="sd">    Run `.set_output(&quot;pandas&quot;)` on your pipeline first.</span>

<span class="sd">    :param windows: All lag windows to process for all features. \n</span>
<span class="sd">    :param feature_names: All features for which you want to create differences. All features that also have lags by default. \n</span>
<span class="sd">    :param pct_change: Method to calculate differences. If True, will calculate differences with a percentage change. Otherwise calculates a simple difference. Defaults to False \n</span>
<span class="sd">    :param abs_diff: Whether to also calculate the absolute value of all differences. Defaults to True \n</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">windows</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">pct_diff</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">abs_diff</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">windows</span> <span class="o">=</span> <span class="n">windows</span> <span class="k">if</span> <span class="n">windows</span> <span class="k">else</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">20</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pct_diff</span> <span class="o">=</span> <span class="n">pct_diff</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">abs_diff</span> <span class="o">=</span> <span class="n">abs_diff</span>

    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create difference feature from lag features.</span>
<span class="sd">        :param X: DataFrame with lag features.</span>
<span class="sd">        NOTE: Make sure only lag features are present in the DataFrame.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">feature_names</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">feature_names</span><span class="p">:</span>
            <span class="k">assert</span> <span class="s2">&quot;_lag&quot;</span> <span class="ow">in</span> <span class="n">col</span><span class="p">,</span> <span class="s2">&quot;DifferencePreProcessor expects only lag features. Got feature: &#39;</span><span class="si">{col}</span><span class="s2">&#39;&quot;</span>
        <span class="n">output_features</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">feature_names</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Difference feature generation&quot;</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">day</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">windows</span><span class="p">:</span>
                <span class="n">differenced_values</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span> <span class="o">/</span> <span class="n">X</span><span class="p">[</span><span class="n">feature</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pct_diff</span>
                        <span class="k">else</span> <span class="n">X</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span> <span class="o">-</span> <span class="n">X</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span>
                    <span class="p">)</span>
                <span class="n">X</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">feature</span><span class="si">}</span><span class="s2">_diff</span><span class="si">{</span><span class="n">day</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">differenced_values</span>
                <span class="n">output_features</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">feature</span><span class="si">}</span><span class="s2">_diff</span><span class="si">{</span><span class="n">day</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">abs_diff</span><span class="p">:</span>
                    <span class="n">X</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">feature</span><span class="si">}</span><span class="s2">_absdiff</span><span class="si">{</span><span class="n">day</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span>
                            <span class="n">X</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">feature</span><span class="si">}</span><span class="s2">_diff</span><span class="si">{</span><span class="n">day</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
                        <span class="p">)</span>
                    <span class="n">output_features</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">feature</span><span class="si">}</span><span class="s2">_absdiff</span><span class="si">{</span><span class="n">day</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_features</span> <span class="o">=</span> <span class="n">output_features</span>
        <span class="k">return</span> <span class="n">X</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">output_features</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">get_feature_names_out</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_features</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_features</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">input_features</span> <span class="k">else</span> <span class="n">input_features</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">




<h3 id="numerblox.preprocessing.signals.DifferencePreProcessor.transform" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Create difference feature from lag features.
:param X: DataFrame with lag features.
NOTE: Make sure only lag features are present in the DataFrame.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/preprocessing/signals.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create difference feature from lag features.</span>
<span class="sd">    :param X: DataFrame with lag features.</span>
<span class="sd">    NOTE: Make sure only lag features are present in the DataFrame.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">feature_names</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">feature_names</span><span class="p">:</span>
        <span class="k">assert</span> <span class="s2">&quot;_lag&quot;</span> <span class="ow">in</span> <span class="n">col</span><span class="p">,</span> <span class="s2">&quot;DifferencePreProcessor expects only lag features. Got feature: &#39;</span><span class="si">{col}</span><span class="s2">&#39;&quot;</span>
    <span class="n">output_features</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">feature_names</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Difference feature generation&quot;</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">day</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">windows</span><span class="p">:</span>
            <span class="n">differenced_values</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span> <span class="o">/</span> <span class="n">X</span><span class="p">[</span><span class="n">feature</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pct_diff</span>
                    <span class="k">else</span> <span class="n">X</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span> <span class="o">-</span> <span class="n">X</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span>
                <span class="p">)</span>
            <span class="n">X</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">feature</span><span class="si">}</span><span class="s2">_diff</span><span class="si">{</span><span class="n">day</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">differenced_values</span>
            <span class="n">output_features</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">feature</span><span class="si">}</span><span class="s2">_diff</span><span class="si">{</span><span class="n">day</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">abs_diff</span><span class="p">:</span>
                <span class="n">X</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">feature</span><span class="si">}</span><span class="s2">_absdiff</span><span class="si">{</span><span class="n">day</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span>
                        <span class="n">X</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">feature</span><span class="si">}</span><span class="s2">_diff</span><span class="si">{</span><span class="n">day</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
                    <span class="p">)</span>
                <span class="n">output_features</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">feature</span><span class="si">}</span><span class="s2">_absdiff</span><span class="si">{</span><span class="n">day</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">output_features</span> <span class="o">=</span> <span class="n">output_features</span>
    <span class="k">return</span> <span class="n">X</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">output_features</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">




<h2 id="numerblox.preprocessing.signals.EraQuantileProcessor" class="doc doc-heading">
          <code>EraQuantileProcessor</code>


</h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="numerblox.preprocessing.base.BasePreProcessor" href="#numerblox.preprocessing.base.BasePreProcessor">BasePreProcessor</a></code></p>

  
      <p>Transform features into quantiles by era.
:param num_quantiles: Number of quantiles to use for quantile transformation. 
:param random_state: Random state for QuantileTransformer.</p>

            <details class="quote">
              <summary>Source code in <code>numerblox/preprocessing/signals.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">EraQuantileProcessor</span><span class="p">(</span><span class="n">BasePreProcessor</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Transform features into quantiles by era.</span>
<span class="sd">    :param num_quantiles: Number of quantiles to use for quantile transformation. </span>
<span class="sd">    :param random_state: Random state for QuantileTransformer.   </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">num_quantiles</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
        <span class="n">random_state</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_quantiles</span> <span class="o">=</span> <span class="n">num_quantiles</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">random_state</span> <span class="o">=</span> <span class="n">random_state</span>

    <span class="k">def</span> <span class="nf">_process_feature</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group_data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">:</span>
        <span class="n">quantizer</span> <span class="o">=</span> <span class="n">QuantileTransformer</span><span class="p">(</span>
            <span class="n">n_quantiles</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">num_quantiles</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">random_state</span>
        <span class="p">)</span>
        <span class="n">transformed_data</span> <span class="o">=</span> <span class="n">quantizer</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">group_data</span><span class="o">.</span><span class="n">to_frame</span><span class="p">())</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">transformed_data</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">group_data</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">],</span>
        <span class="n">eras</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">features</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Quantiling for </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">)</span><span class="si">}</span><span class="s2"> features.&quot;</span><span class="p">)</span>
        <span class="n">X</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;era&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">eras</span>
        <span class="n">date_groups</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;era&#39;</span><span class="p">,</span> <span class="n">group_keys</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">output_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">):</span>
            <span class="n">group_data</span> <span class="o">=</span> <span class="n">date_groups</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_feature</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
            <span class="n">output_df</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">feature</span><span class="si">}</span><span class="s2">_quantile</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">num_quantiles</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">group_data</span>
        <span class="k">return</span> <span class="n">output_df</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">get_feature_names_out</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_features</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return feature names.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">input_features</span><span class="p">:</span>
            <span class="n">feature_names</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">:</span>
                <span class="n">feature_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">feature</span><span class="si">}</span><span class="s2">_quantile</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">num_quantiles</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">feature_names</span> <span class="o">=</span> <span class="n">input_features</span>
        <span class="k">return</span> <span class="n">feature_names</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">




<h3 id="numerblox.preprocessing.signals.EraQuantileProcessor.get_feature_names_out" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_feature_names_out</span><span class="p">(</span><span class="n">input_features</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Return feature names.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/preprocessing/signals.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_feature_names_out</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_features</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return feature names.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">input_features</span><span class="p">:</span>
        <span class="n">feature_names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">:</span>
            <span class="n">feature_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">feature</span><span class="si">}</span><span class="s2">_quantile</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">num_quantiles</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">feature_names</span> <span class="o">=</span> <span class="n">input_features</span>
    <span class="k">return</span> <span class="n">feature_names</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">




<h2 id="numerblox.preprocessing.signals.HLOCVAdjuster" class="doc doc-heading">
          <code>HLOCVAdjuster</code>


</h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="numerblox.preprocessing.base.BasePreProcessor" href="#numerblox.preprocessing.base.BasePreProcessor">BasePreProcessor</a></code></p>

  
      <p>Adjust HLOCV data for splits and dividends based on ratio of unadjusted and adjusted close prices.
NOTE: This step only works with DataFrame input. 
Usage in intermediate steps of a scikit-learn Pipeline works with the Pandas set_output API.
i.e. pipeline.set_output(transform="pandas").</p>

            <details class="quote">
              <summary>Source code in <code>numerblox/preprocessing/signals.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">HLOCVAdjuster</span><span class="p">(</span><span class="n">BasePreProcessor</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">    Adjust HLOCV data for splits and dividends based on ratio of unadjusted and adjusted close prices.</span>
<span class="sd">    NOTE: This step only works with DataFrame input. </span>
<span class="sd">    Usage in intermediate steps of a scikit-learn Pipeline works with the Pandas set_output API.</span>
<span class="sd">    i.e. pipeline.set_output(transform=&quot;pandas&quot;).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">open_col</span><span class="o">=</span><span class="s2">&quot;open&quot;</span><span class="p">,</span> <span class="n">high_col</span><span class="o">=</span><span class="s2">&quot;high&quot;</span><span class="p">,</span> <span class="n">low_col</span><span class="o">=</span><span class="s2">&quot;low&quot;</span><span class="p">,</span> 
                 <span class="n">close_col</span><span class="o">=</span><span class="s2">&quot;close&quot;</span><span class="p">,</span> <span class="n">volume_col</span><span class="o">=</span><span class="s2">&quot;volume&quot;</span><span class="p">,</span> <span class="n">adj_close_col</span><span class="o">=</span><span class="s2">&quot;adjusted_close&quot;</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">open_col</span> <span class="o">=</span> <span class="n">open_col</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">high_col</span> <span class="o">=</span> <span class="n">high_col</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">low_col</span> <span class="o">=</span> <span class="n">low_col</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">close_col</span> <span class="o">=</span> <span class="n">close_col</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">volume_col</span> <span class="o">=</span> <span class="n">volume_col</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">adj_close_col</span> <span class="o">=</span> <span class="n">adj_close_col</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">adjusted_col_names</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;adjusted_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">high_col</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;adjusted_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">low_col</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                                   <span class="sa">f</span><span class="s2">&quot;adjusted_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">open_col</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">adj_close_col</span><span class="p">,</span> 
                                   <span class="sa">f</span><span class="s2">&quot;adjusted_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">volume_col</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ratio_</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">close_col</span><span class="p">]</span> <span class="o">/</span> <span class="n">X</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">adj_close_col</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adjust open, high, low, close and volume for splits and dividends.</span>
<span class="sd">        :param X: DataFrame with columns: [high, low, open, close, volume] (HLOCV)</span>
<span class="sd">        :return: Array with adjusted HLOCV columns</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">X_copy</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>  
        <span class="n">X_copy</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;adjusted_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">high_col</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">high_col</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">ratio_</span>
        <span class="n">X_copy</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;adjusted_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">low_col</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">low_col</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">ratio_</span>
        <span class="n">X_copy</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;adjusted_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">open_col</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">open_col</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">ratio_</span>
        <span class="n">X_copy</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;adjusted_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">volume_col</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">volume_col</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">ratio_</span>
        <span class="k">return</span> <span class="n">X_copy</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">adjusted_col_names</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">get_feature_names_out</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_features</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">adjusted_col_names</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">




<h3 id="numerblox.preprocessing.signals.HLOCVAdjuster.transform" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Adjust open, high, low, close and volume for splits and dividends.
:param X: DataFrame with columns: [high, low, open, close, volume] (HLOCV)
:return: Array with adjusted HLOCV columns</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/preprocessing/signals.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Adjust open, high, low, close and volume for splits and dividends.</span>
<span class="sd">    :param X: DataFrame with columns: [high, low, open, close, volume] (HLOCV)</span>
<span class="sd">    :return: Array with adjusted HLOCV columns</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">X_copy</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>  
    <span class="n">X_copy</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;adjusted_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">high_col</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">high_col</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">ratio_</span>
    <span class="n">X_copy</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;adjusted_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">low_col</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">low_col</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">ratio_</span>
    <span class="n">X_copy</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;adjusted_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">open_col</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">open_col</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">ratio_</span>
    <span class="n">X_copy</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;adjusted_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">volume_col</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">volume_col</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">ratio_</span>
    <span class="k">return</span> <span class="n">X_copy</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">adjusted_col_names</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">




<h2 id="numerblox.preprocessing.signals.KatsuFeatureGenerator" class="doc doc-heading">
          <code>KatsuFeatureGenerator</code>


</h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="numerblox.preprocessing.base.BasePreProcessor" href="#numerblox.preprocessing.base.BasePreProcessor">BasePreProcessor</a></code></p>

  
      <p>Effective feature engineering setup based on Katsu's starter notebook.
Based on source by Katsu1110: https://www.kaggle.com/code1110/numeraisignals-starter-for-beginners</p>
<p>:param windows: Time interval to apply for window features: </p>
<ol>
<li>
<p>Percentage Rate of change </p>
</li>
<li>
<p>Volatility </p>
</li>
<li>
<p>Moving Average gap </p>
</li>
</ol>
<p>:param ticker_col: Columns with tickers to iterate over. </p>
<p>:param close_col: Column name where you have closing price stored.
:param num_cores: Number of cores to use for multiprocessing. </p>
<p>:param verbose: Print additional information.</p>

            <details class="quote">
              <summary>Source code in <code>numerblox/preprocessing/signals.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">KatsuFeatureGenerator</span><span class="p">(</span><span class="n">BasePreProcessor</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Effective feature engineering setup based on Katsu&#39;s starter notebook.</span>
<span class="sd">    Based on source by Katsu1110: https://www.kaggle.com/code1110/numeraisignals-starter-for-beginners</span>

<span class="sd">    :param windows: Time interval to apply for window features: \n</span>
<span class="sd">    1. Percentage Rate of change \n</span>
<span class="sd">    2. Volatility \n</span>
<span class="sd">    3. Moving Average gap \n</span>
<span class="sd">    :param ticker_col: Columns with tickers to iterate over. \n</span>
<span class="sd">    :param close_col: Column name where you have closing price stored.</span>
<span class="sd">    :param num_cores: Number of cores to use for multiprocessing. \n</span>
<span class="sd">    :param verbose: Print additional information.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">windows</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
        <span class="n">ticker_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;ticker&quot;</span><span class="p">,</span>
        <span class="n">close_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;close&quot;</span><span class="p">,</span>
        <span class="n">num_cores</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">windows</span> <span class="o">=</span> <span class="n">windows</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ticker_col</span> <span class="o">=</span> <span class="n">ticker_col</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">close_col</span> <span class="o">=</span> <span class="n">close_col</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_cores</span> <span class="o">=</span> <span class="n">num_cores</span> <span class="k">if</span> <span class="n">num_cores</span> <span class="k">else</span> <span class="n">os</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>

    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Multiprocessing feature engineering.</span>

<span class="sd">        :param dataf: DataFrame with columns: [ticker, date, open, high, low, close, volume] \n</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tickers</span> <span class="o">=</span> <span class="n">dataf</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ticker_col</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Feature engineering for </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">tickers</span><span class="p">)</span><span class="si">}</span><span class="s2"> tickers using </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">num_cores</span><span class="si">}</span><span class="s2"> CPU cores.&quot;</span>
            <span class="p">)</span>
        <span class="n">dataf_list</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">x</span>
            <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span>
                <span class="n">dataf</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ticker_col</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Generating ticker DataFrames&quot;</span>
            <span class="p">)</span>
        <span class="p">]</span>
        <span class="n">dataf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_features</span><span class="p">(</span><span class="n">dataf_list</span><span class="o">=</span><span class="n">dataf_list</span><span class="p">)</span>
        <span class="n">output_cols</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_feature_names_out</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">dataf</span><span class="p">[</span><span class="n">output_cols</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">feature_engineering</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Feature engineering for single ticker.&quot;&quot;&quot;</span>
        <span class="n">close_series</span> <span class="o">=</span> <span class="n">dataf</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">close_col</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">windows</span><span class="p">:</span>
            <span class="n">dataf</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                <span class="p">:,</span> <span class="sa">f</span><span class="s2">&quot;feature_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">close_col</span><span class="si">}</span><span class="s2">_ROCP_</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">]</span> <span class="o">=</span> <span class="n">close_series</span><span class="o">.</span><span class="n">pct_change</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

            <span class="n">dataf</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="sa">f</span><span class="s2">&quot;feature_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">close_col</span><span class="si">}</span><span class="s2">_VOL_</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="n">close_series</span><span class="p">)</span><span class="o">.</span><span class="n">pct_change</span><span class="p">()</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
            <span class="p">)</span>

            <span class="n">dataf</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="sa">f</span><span class="s2">&quot;feature_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">close_col</span><span class="si">}</span><span class="s2">_MA_gap_</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">close_series</span> <span class="o">/</span> <span class="n">close_series</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
            <span class="p">)</span>

        <span class="n">dataf</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;feature_RSI&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rsi</span><span class="p">(</span><span class="n">close_series</span><span class="p">)</span>
        <span class="n">macd</span><span class="p">,</span> <span class="n">macd_signal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_macd</span><span class="p">(</span><span class="n">close_series</span><span class="p">)</span>
        <span class="n">dataf</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;feature_MACD&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">macd</span>
        <span class="n">dataf</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;feature_MACD_signal&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">macd_signal</span>
        <span class="k">return</span> <span class="n">dataf</span><span class="o">.</span><span class="n">bfill</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_generate_features</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataf_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add features for list of ticker DataFrames and concatenate.&quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">Pool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_cores</span><span class="p">)</span> <span class="k">as</span> <span class="n">p</span><span class="p">:</span>
            <span class="n">feature_datafs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                <span class="n">tqdm</span><span class="p">(</span>
                    <span class="n">p</span><span class="o">.</span><span class="n">imap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">feature_engineering</span><span class="p">,</span> <span class="n">dataf_list</span><span class="p">),</span>
                    <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Generating features&quot;</span><span class="p">,</span>
                    <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">dataf_list</span><span class="p">),</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">feature_datafs</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_rsi</span><span class="p">(</span><span class="n">close</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">period</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">14</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        See source https://github.com/peerchemist/finta</span>
<span class="sd">        and fix https://www.tradingview.com/wiki/Talk:Relative_Strength_Index_(RSI)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">delta</span> <span class="o">=</span> <span class="n">close</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span>
        <span class="n">up</span><span class="p">,</span> <span class="n">down</span> <span class="o">=</span> <span class="n">delta</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">delta</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">up</span><span class="p">[</span><span class="n">up</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">down</span><span class="p">[</span><span class="n">down</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">gain</span> <span class="o">=</span> <span class="n">up</span><span class="o">.</span><span class="n">ewm</span><span class="p">(</span><span class="n">com</span><span class="o">=</span><span class="p">(</span><span class="n">period</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="n">min_periods</span><span class="o">=</span><span class="n">period</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="n">loss</span> <span class="o">=</span> <span class="n">down</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span><span class="o">.</span><span class="n">ewm</span><span class="p">(</span><span class="n">com</span><span class="o">=</span><span class="p">(</span><span class="n">period</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="n">min_periods</span><span class="o">=</span><span class="n">period</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

        <span class="n">rs</span> <span class="o">=</span> <span class="n">gain</span> <span class="o">/</span> <span class="n">loss</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="mi">100</span> <span class="o">-</span> <span class="p">(</span><span class="mi">100</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">rs</span><span class="p">)))</span>

    <span class="k">def</span> <span class="nf">_macd</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">close</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">span1</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">span2</span><span class="o">=</span><span class="mi">26</span><span class="p">,</span> <span class="n">span3</span><span class="o">=</span><span class="mi">9</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Compute MACD and MACD signal.&quot;&quot;&quot;</span>
        <span class="n">exp1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ema1</span><span class="p">(</span><span class="n">close</span><span class="p">,</span> <span class="n">span1</span><span class="p">)</span>
        <span class="n">exp2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ema1</span><span class="p">(</span><span class="n">close</span><span class="p">,</span> <span class="n">span2</span><span class="p">)</span>
        <span class="n">macd</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">*</span> <span class="p">(</span><span class="n">exp1</span> <span class="o">-</span> <span class="n">exp2</span><span class="p">)</span> <span class="o">/</span> <span class="n">exp2</span>
        <span class="n">signal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ema1</span><span class="p">(</span><span class="n">macd</span><span class="p">,</span> <span class="n">span3</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">macd</span><span class="p">,</span> <span class="n">signal</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">__ema1</span><span class="p">(</span><span class="n">series</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">span</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Exponential moving average&quot;&quot;&quot;</span>
        <span class="n">a</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="n">span</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">series</span><span class="o">.</span><span class="n">ewm</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="n">a</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">get_feature_names_out</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_features</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return feature names.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">input_features</span><span class="p">:</span>
            <span class="n">feature_names</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">windows</span><span class="p">:</span>
                <span class="n">feature_names</span> <span class="o">+=</span> <span class="p">[</span>
                    <span class="sa">f</span><span class="s2">&quot;feature_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">close_col</span><span class="si">}</span><span class="s2">_ROCP_</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s2">&quot;feature_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">close_col</span><span class="si">}</span><span class="s2">_VOL_</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s2">&quot;feature_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">close_col</span><span class="si">}</span><span class="s2">_MA_gap_</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="p">]</span>
            <span class="n">feature_names</span> <span class="o">+=</span> <span class="p">[</span>
                <span class="s2">&quot;feature_RSI&quot;</span><span class="p">,</span>
                <span class="s2">&quot;feature_MACD&quot;</span><span class="p">,</span>
                <span class="s2">&quot;feature_MACD_signal&quot;</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">feature_names</span> <span class="o">=</span> <span class="n">input_features</span>
        <span class="k">return</span> <span class="n">feature_names</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">




<h3 id="numerblox.preprocessing.signals.KatsuFeatureGenerator.__ema1" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">__ema1</span><span class="p">(</span><span class="n">series</span><span class="p">,</span> <span class="n">span</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Exponential moving average</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/preprocessing/signals.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">__ema1</span><span class="p">(</span><span class="n">series</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">span</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Exponential moving average&quot;&quot;&quot;</span>
    <span class="n">a</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="n">span</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">series</span><span class="o">.</span><span class="n">ewm</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="n">a</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="numerblox.preprocessing.signals.KatsuFeatureGenerator.feature_engineering" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">feature_engineering</span><span class="p">(</span><span class="n">dataf</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Feature engineering for single ticker.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/preprocessing/signals.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">feature_engineering</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Feature engineering for single ticker.&quot;&quot;&quot;</span>
    <span class="n">close_series</span> <span class="o">=</span> <span class="n">dataf</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">close_col</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">windows</span><span class="p">:</span>
        <span class="n">dataf</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
            <span class="p">:,</span> <span class="sa">f</span><span class="s2">&quot;feature_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">close_col</span><span class="si">}</span><span class="s2">_ROCP_</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">]</span> <span class="o">=</span> <span class="n">close_series</span><span class="o">.</span><span class="n">pct_change</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

        <span class="n">dataf</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="sa">f</span><span class="s2">&quot;feature_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">close_col</span><span class="si">}</span><span class="s2">_VOL_</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="n">close_series</span><span class="p">)</span><span class="o">.</span><span class="n">pct_change</span><span class="p">()</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
        <span class="p">)</span>

        <span class="n">dataf</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="sa">f</span><span class="s2">&quot;feature_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">close_col</span><span class="si">}</span><span class="s2">_MA_gap_</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">close_series</span> <span class="o">/</span> <span class="n">close_series</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="p">)</span>

    <span class="n">dataf</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;feature_RSI&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rsi</span><span class="p">(</span><span class="n">close_series</span><span class="p">)</span>
    <span class="n">macd</span><span class="p">,</span> <span class="n">macd_signal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_macd</span><span class="p">(</span><span class="n">close_series</span><span class="p">)</span>
    <span class="n">dataf</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;feature_MACD&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">macd</span>
    <span class="n">dataf</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;feature_MACD_signal&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">macd_signal</span>
    <span class="k">return</span> <span class="n">dataf</span><span class="o">.</span><span class="n">bfill</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="numerblox.preprocessing.signals.KatsuFeatureGenerator.get_feature_names_out" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_feature_names_out</span><span class="p">(</span><span class="n">input_features</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Return feature names.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/preprocessing/signals.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_feature_names_out</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_features</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return feature names.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">input_features</span><span class="p">:</span>
        <span class="n">feature_names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">windows</span><span class="p">:</span>
            <span class="n">feature_names</span> <span class="o">+=</span> <span class="p">[</span>
                <span class="sa">f</span><span class="s2">&quot;feature_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">close_col</span><span class="si">}</span><span class="s2">_ROCP_</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">&quot;feature_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">close_col</span><span class="si">}</span><span class="s2">_VOL_</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">&quot;feature_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">close_col</span><span class="si">}</span><span class="s2">_MA_gap_</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="n">feature_names</span> <span class="o">+=</span> <span class="p">[</span>
            <span class="s2">&quot;feature_RSI&quot;</span><span class="p">,</span>
            <span class="s2">&quot;feature_MACD&quot;</span><span class="p">,</span>
            <span class="s2">&quot;feature_MACD_signal&quot;</span><span class="p">,</span>
        <span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">feature_names</span> <span class="o">=</span> <span class="n">input_features</span>
    <span class="k">return</span> <span class="n">feature_names</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="numerblox.preprocessing.signals.KatsuFeatureGenerator.transform" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">transform</span><span class="p">(</span><span class="n">dataf</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Multiprocessing feature engineering.</p>
<p>:param dataf: DataFrame with columns: [ticker, date, open, high, low, close, volume]</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/preprocessing/signals.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Multiprocessing feature engineering.</span>

<span class="sd">    :param dataf: DataFrame with columns: [ticker, date, open, high, low, close, volume] \n</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tickers</span> <span class="o">=</span> <span class="n">dataf</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ticker_col</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Feature engineering for </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">tickers</span><span class="p">)</span><span class="si">}</span><span class="s2"> tickers using </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">num_cores</span><span class="si">}</span><span class="s2"> CPU cores.&quot;</span>
        <span class="p">)</span>
    <span class="n">dataf_list</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">x</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span>
            <span class="n">dataf</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ticker_col</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Generating ticker DataFrames&quot;</span>
        <span class="p">)</span>
    <span class="p">]</span>
    <span class="n">dataf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_features</span><span class="p">(</span><span class="n">dataf_list</span><span class="o">=</span><span class="n">dataf_list</span><span class="p">)</span>
    <span class="n">output_cols</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_feature_names_out</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">dataf</span><span class="p">[</span><span class="n">output_cols</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">




<h2 id="numerblox.preprocessing.signals.LagPreProcessor" class="doc doc-heading">
          <code>LagPreProcessor</code>


</h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="numerblox.preprocessing.base.BasePreProcessor" href="#numerblox.preprocessing.base.BasePreProcessor">BasePreProcessor</a></code></p>

  
      <p>Add lag features based on given windows.</p>
<p>:param windows: All lag windows to process for all features. </p>
<p>[5, 10, 15, 20] by default (4 weeks lookback)</p>

            <details class="quote">
              <summary>Source code in <code>numerblox/preprocessing/signals.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">LagPreProcessor</span><span class="p">(</span><span class="n">BasePreProcessor</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add lag features based on given windows.</span>

<span class="sd">    :param windows: All lag windows to process for all features. \n</span>
<span class="sd">    [5, 10, 15, 20] by default (4 weeks lookback) \n</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">windows</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">windows</span> <span class="o">=</span> <span class="n">windows</span> <span class="k">if</span> <span class="n">windows</span> <span class="k">else</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">20</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">],</span> <span class="n">tickers</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
        <span class="n">feature_cols</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">X</span><span class="p">[</span><span class="s2">&quot;ticker&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tickers</span>
        <span class="n">ticker_groups</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;ticker&quot;</span><span class="p">)</span>
        <span class="n">output_features</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">feature_cols</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Lag feature generation&quot;</span><span class="p">):</span>
            <span class="n">feature_group</span> <span class="o">=</span> <span class="n">ticker_groups</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">day</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">windows</span><span class="p">:</span>
                <span class="n">shifted</span> <span class="o">=</span> <span class="n">feature_group</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="n">day</span><span class="p">)</span>
                <span class="n">X</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">feature</span><span class="si">}</span><span class="s2">_lag</span><span class="si">{</span><span class="n">day</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">shifted</span>
                <span class="n">output_features</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">feature</span><span class="si">}</span><span class="s2">_lag</span><span class="si">{</span><span class="n">day</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_features</span> <span class="o">=</span> <span class="n">output_features</span>
        <span class="k">return</span> <span class="n">X</span><span class="p">[</span><span class="n">output_features</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">get_feature_names_out</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_features</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return feature names.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_features</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">input_features</span> <span class="k">else</span> <span class="n">input_features</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">




<h3 id="numerblox.preprocessing.signals.LagPreProcessor.get_feature_names_out" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_feature_names_out</span><span class="p">(</span><span class="n">input_features</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Return feature names.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/preprocessing/signals.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_feature_names_out</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_features</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return feature names.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_features</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">input_features</span> <span class="k">else</span> <span class="n">input_features</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">




<h2 id="numerblox.preprocessing.signals.PandasTaFeatureGenerator" class="doc doc-heading">
          <code>PandasTaFeatureGenerator</code>


</h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="numerblox.preprocessing.base.BasePreProcessor" href="#numerblox.preprocessing.base.BasePreProcessor">BasePreProcessor</a></code></p>

  
      <p>Generate features with pandas-ta.
https://github.com/twopirllc/pandas-ta
Usage in Pipeline works only with Pandas API. 
Run <code>.set_output("pandas")</code> on your pipeline first.</p>
<p>:param strategy: Valid Pandas Ta strategy. </p>
<p>For more information on creating a strategy, see: </p>
<p>https://github.com/twopirllc/pandas-ta#pandas-ta-strategy </p>
<p>By default, a strategy with RSI(14) and RSI(60) is used. </p>
<p>:param ticker_col: Column name for grouping by tickers. </p>
<p>:param num_cores: Number of cores to use for multiprocessing. </p>
<p>By default, all available cores are used.</p>

            <details class="quote">
              <summary>Source code in <code>numerblox/preprocessing/signals.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">PandasTaFeatureGenerator</span><span class="p">(</span><span class="n">BasePreProcessor</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate features with pandas-ta.</span>
<span class="sd">    https://github.com/twopirllc/pandas-ta</span>
<span class="sd">    Usage in Pipeline works only with Pandas API. </span>
<span class="sd">    Run `.set_output(&quot;pandas&quot;)` on your pipeline first.</span>

<span class="sd">    :param strategy: Valid Pandas Ta strategy. \n</span>
<span class="sd">    For more information on creating a strategy, see: \n</span>
<span class="sd">    https://github.com/twopirllc/pandas-ta#pandas-ta-strategy \n</span>
<span class="sd">    By default, a strategy with RSI(14) and RSI(60) is used. \n</span>
<span class="sd">    :param ticker_col: Column name for grouping by tickers. \n</span>
<span class="sd">    :param num_cores: Number of cores to use for multiprocessing. \n</span>
<span class="sd">    By default, all available cores are used. \n</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
                 <span class="n">strategy</span><span class="p">:</span> <span class="n">ta</span><span class="o">.</span><span class="n">Strategy</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">ticker_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;ticker&quot;</span><span class="p">,</span>
                 <span class="n">num_cores</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ticker_col</span> <span class="o">=</span> <span class="n">ticker_col</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_cores</span> <span class="o">=</span> <span class="n">num_cores</span> <span class="k">if</span> <span class="n">num_cores</span> <span class="k">else</span> <span class="n">os</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">()</span>
        <span class="n">standard_strategy</span> <span class="o">=</span> <span class="n">ta</span><span class="o">.</span><span class="n">Strategy</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;standard&quot;</span><span class="p">,</span> 
                                        <span class="n">ta</span><span class="o">=</span><span class="p">[{</span><span class="s2">&quot;kind&quot;</span><span class="p">:</span> <span class="s2">&quot;rsi&quot;</span><span class="p">,</span> <span class="s2">&quot;length&quot;</span><span class="p">:</span> <span class="mi">14</span><span class="p">,</span> <span class="s2">&quot;col_names&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;feature_RSI_14&quot;</span><span class="p">)},</span>
                                            <span class="p">{</span><span class="s2">&quot;kind&quot;</span><span class="p">:</span> <span class="s2">&quot;rsi&quot;</span><span class="p">,</span> <span class="s2">&quot;length&quot;</span><span class="p">:</span> <span class="mi">60</span><span class="p">,</span> <span class="s2">&quot;col_names&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;feature_RSI_60&quot;</span><span class="p">)}])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">strategy</span> <span class="o">=</span> <span class="n">strategy</span> <span class="k">if</span> <span class="n">strategy</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">standard_strategy</span>


    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Main feature generation method. \n </span>
<span class="sd">        :param X: DataFrame with columns: [ticker, date, open, high, low, close, volume] \n</span>
<span class="sd">        :return: PandasTA features</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">initial_features</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">dataf_list</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">x</span>
            <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span>
                <span class="n">X</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ticker_col</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Generating ticker DataFrames&quot;</span>
            <span class="p">)</span>
        <span class="p">]</span>
        <span class="n">X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_features</span><span class="p">(</span><span class="n">dataf_list</span><span class="o">=</span><span class="n">dataf_list</span><span class="p">)</span>
        <span class="n">output_df</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">initial_features</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_cols</span> <span class="o">=</span> <span class="n">output_df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">output_df</span>

    <span class="k">def</span> <span class="nf">_generate_features</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataf_list</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add features for list of ticker DataFrames and concatenate.</span>
<span class="sd">        :param dataf_list: List of DataFrames for each ticker.</span>
<span class="sd">        :return: Concatenated DataFrame for all full list with features added.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">Pool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_cores</span><span class="p">)</span> <span class="k">as</span> <span class="n">p</span><span class="p">:</span>
            <span class="n">feature_datafs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                <span class="n">tqdm</span><span class="p">(</span>
                    <span class="n">p</span><span class="o">.</span><span class="n">imap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">add_features</span><span class="p">,</span> <span class="n">dataf_list</span><span class="p">),</span>
                    <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Generating pandas-ta features&quot;</span><span class="p">,</span>
                    <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">dataf_list</span><span class="p">),</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">feature_datafs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">add_features</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ticker_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        The TA strategy is applied to the DataFrame here.</span>
<span class="sd">        :param ticker_df: DataFrame for a single ticker.</span>
<span class="sd">        :return: DataFrame with features added.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># We use a different multiprocessing engine so shutting off pandas_ta&#39;s multiprocessing</span>
        <span class="n">ticker_df</span><span class="o">.</span><span class="n">ta</span><span class="o">.</span><span class="n">cores</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># Run strategy</span>
        <span class="n">ticker_df</span><span class="o">.</span><span class="n">ta</span><span class="o">.</span><span class="n">strategy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">strategy</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ticker_df</span>

    <span class="k">def</span> <span class="nf">get_feature_names_out</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_features</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_cols</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">input_features</span> <span class="k">else</span> <span class="n">input_features</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">




<h3 id="numerblox.preprocessing.signals.PandasTaFeatureGenerator.add_features" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">add_features</span><span class="p">(</span><span class="n">ticker_df</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>The TA strategy is applied to the DataFrame here.
:param ticker_df: DataFrame for a single ticker.
:return: DataFrame with features added.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/preprocessing/signals.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">add_features</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ticker_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">    The TA strategy is applied to the DataFrame here.</span>
<span class="sd">    :param ticker_df: DataFrame for a single ticker.</span>
<span class="sd">    :return: DataFrame with features added.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># We use a different multiprocessing engine so shutting off pandas_ta&#39;s multiprocessing</span>
    <span class="n">ticker_df</span><span class="o">.</span><span class="n">ta</span><span class="o">.</span><span class="n">cores</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1"># Run strategy</span>
    <span class="n">ticker_df</span><span class="o">.</span><span class="n">ta</span><span class="o">.</span><span class="n">strategy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">strategy</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ticker_df</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="numerblox.preprocessing.signals.PandasTaFeatureGenerator.transform" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Main feature generation method. </p>
<p>:param X: DataFrame with columns: [ticker, date, open, high, low, close, volume] </p>
<p>:return: PandasTA features</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/preprocessing/signals.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Main feature generation method. \n </span>
<span class="sd">    :param X: DataFrame with columns: [ticker, date, open, high, low, close, volume] \n</span>
<span class="sd">    :return: PandasTA features</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">initial_features</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">dataf_list</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">x</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span>
            <span class="n">X</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ticker_col</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Generating ticker DataFrames&quot;</span>
        <span class="p">)</span>
    <span class="p">]</span>
    <span class="n">X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_features</span><span class="p">(</span><span class="n">dataf_list</span><span class="o">=</span><span class="n">dataf_list</span><span class="p">)</span>
    <span class="n">output_df</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">initial_features</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">output_cols</span> <span class="o">=</span> <span class="n">output_df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">output_df</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">




<h2 id="numerblox.preprocessing.signals.ReduceMemoryProcessor" class="doc doc-heading">
          <code>ReduceMemoryProcessor</code>


</h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="numerblox.preprocessing.base.BasePreProcessor" href="#numerblox.preprocessing.base.BasePreProcessor">BasePreProcessor</a></code></p>

  
      <p>Reduce memory usage as much as possible.</p>
<p>Credits to kainsama and others for writing about memory usage reduction for Numerai data:
https://forum.numer.ai/t/reducing-memory/313</p>
<p>:param deep_mem_inspect: Introspect the data deeply by interrogating object dtypes.
Yields a more accurate representation of memory usage if you have complex object columns.
:param verbose: Print memory usage before and after optimization.</p>

            <details class="quote">
              <summary>Source code in <code>numerblox/preprocessing/signals.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">ReduceMemoryProcessor</span><span class="p">(</span><span class="n">BasePreProcessor</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reduce memory usage as much as possible.</span>

<span class="sd">    Credits to kainsama and others for writing about memory usage reduction for Numerai data:</span>
<span class="sd">    https://forum.numer.ai/t/reducing-memory/313</span>

<span class="sd">    :param deep_mem_inspect: Introspect the data deeply by interrogating object dtypes.</span>
<span class="sd">    Yields a more accurate representation of memory usage if you have complex object columns.</span>
<span class="sd">    :param verbose: Print memory usage before and after optimization.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">deep_mem_inspect</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deep_mem_inspect</span> <span class="o">=</span> <span class="n">deep_mem_inspect</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>

    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataf</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reduce_mem_usage</span><span class="p">(</span><span class="n">dataf</span><span class="p">)</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_reduce_mem_usage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataf</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Iterate through all columns and modify the numeric column types</span>
<span class="sd">        to reduce memory usage.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dataf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">dataf</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_cols</span> <span class="o">=</span> <span class="n">dataf</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">start_memory_usage</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">dataf</span><span class="o">.</span><span class="n">memory_usage</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">deep_mem_inspect</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">2</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Memory usage of DataFrame is </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">start_memory_usage</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2"> MB&quot;</span>
            <span class="p">)</span>

        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">dataf</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">col_type</span> <span class="o">=</span> <span class="n">dataf</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">name</span>

            <span class="k">if</span> <span class="n">col_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span>
                <span class="s2">&quot;object&quot;</span><span class="p">,</span>
                <span class="s2">&quot;category&quot;</span><span class="p">,</span>
                <span class="s2">&quot;datetime64[ns, UTC]&quot;</span><span class="p">,</span>
                <span class="s2">&quot;datetime64[ns]&quot;</span><span class="p">,</span>
            <span class="p">]:</span>
                <span class="n">c_min</span> <span class="o">=</span> <span class="n">dataf</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
                <span class="n">c_max</span> <span class="o">=</span> <span class="n">dataf</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
                <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">col_type</span><span class="p">)[:</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;int&quot;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">c_min</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">iinfo</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">)</span><span class="o">.</span><span class="n">min</span> <span class="ow">and</span> <span class="n">c_max</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">iinfo</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">:</span>
                        <span class="n">dataf</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">dataf</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int16</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="p">(</span>
                        <span class="n">c_min</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">iinfo</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int16</span><span class="p">)</span><span class="o">.</span><span class="n">min</span>
                        <span class="ow">and</span> <span class="n">c_max</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">iinfo</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int16</span><span class="p">)</span><span class="o">.</span><span class="n">max</span>
                    <span class="p">):</span>
                        <span class="n">dataf</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">dataf</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int16</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="p">(</span>
                        <span class="n">c_min</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">iinfo</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span><span class="o">.</span><span class="n">min</span>
                        <span class="ow">and</span> <span class="n">c_max</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">iinfo</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span><span class="o">.</span><span class="n">max</span>
                    <span class="p">):</span>
                        <span class="n">dataf</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">dataf</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="p">(</span>
                        <span class="n">c_min</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">iinfo</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span><span class="o">.</span><span class="n">min</span>
                        <span class="ow">and</span> <span class="n">c_max</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">iinfo</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span><span class="o">.</span><span class="n">max</span>
                    <span class="p">):</span>
                        <span class="n">dataf</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">dataf</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span>
                        <span class="n">c_min</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float16</span><span class="p">)</span><span class="o">.</span><span class="n">min</span>
                        <span class="ow">and</span> <span class="n">c_max</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float16</span><span class="p">)</span><span class="o">.</span><span class="n">max</span>
                    <span class="p">):</span>
                        <span class="n">dataf</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">dataf</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float16</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="p">(</span>
                        <span class="n">c_min</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span><span class="o">.</span><span class="n">min</span>
                        <span class="ow">and</span> <span class="n">c_max</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span><span class="o">.</span><span class="n">max</span>
                    <span class="p">):</span>
                        <span class="n">dataf</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">dataf</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">dataf</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">dataf</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>

        <span class="n">end_memory_usage</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">dataf</span><span class="o">.</span><span class="n">memory_usage</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">deep_mem_inspect</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">2</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Memory usage after optimization is: </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">end_memory_usage</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2"> MB&quot;</span>
            <span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Usage decreased by </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="mi">100</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">start_memory_usage</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">end_memory_usage</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">start_memory_usage</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2">%&quot;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">dataf</span>

    <span class="k">def</span> <span class="nf">get_feature_names_out</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_features</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return feature names.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_cols</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">input_features</span> <span class="k">else</span> <span class="n">input_features</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">




<h3 id="numerblox.preprocessing.signals.ReduceMemoryProcessor.get_feature_names_out" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_feature_names_out</span><span class="p">(</span><span class="n">input_features</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Return feature names.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/preprocessing/signals.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_feature_names_out</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_features</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return feature names.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_cols</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">input_features</span> <span class="k">else</span> <span class="n">input_features</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">




<h2 id="numerblox.preprocessing.signals.TickerMapper" class="doc doc-heading">
          <code>TickerMapper</code>


</h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="numerblox.preprocessing.base.BasePreProcessor" href="#numerblox.preprocessing.base.BasePreProcessor">BasePreProcessor</a></code></p>

  
      <p>Map ticker from one format to another. </p>
<p>:param ticker_col: Column used for mapping. Must already be present in the input data. </p>
<p>:param target_ticker_format: Format to map tickers to. Must be present in the ticker map. </p>
<p>For default mapper supported ticker formats are: ['ticker', 'bloomberg_ticker', 'yahoo'] </p>
<p>:param mapper_path: Path to CSV file containing at least ticker_col and target_ticker_format columns. </p>
<p>Can be either a web link of local path. Numerai Signals mapping by default.</p>

            <details class="quote">
              <summary>Source code in <code>numerblox/preprocessing/signals.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">TickerMapper</span><span class="p">(</span><span class="n">BasePreProcessor</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Map ticker from one format to another. \n</span>
<span class="sd">    :param ticker_col: Column used for mapping. Must already be present in the input data. \n</span>
<span class="sd">    :param target_ticker_format: Format to map tickers to. Must be present in the ticker map. \n</span>
<span class="sd">    For default mapper supported ticker formats are: [&#39;ticker&#39;, &#39;bloomberg_ticker&#39;, &#39;yahoo&#39;] \n</span>
<span class="sd">    :param mapper_path: Path to CSV file containing at least ticker_col and target_ticker_format columns. \n</span>
<span class="sd">    Can be either a web link of local path. Numerai Signals mapping by default.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">ticker_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;ticker&quot;</span><span class="p">,</span> <span class="n">target_ticker_format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;bloomberg_ticker&quot;</span><span class="p">,</span>
        <span class="n">mapper_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;https://numerai-signals-public-data.s3-us-west-2.amazonaws.com/signals_ticker_map_w_bbg.csv&quot;</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ticker_col</span> <span class="o">=</span> <span class="n">ticker_col</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target_ticker_format</span> <span class="o">=</span> <span class="n">target_ticker_format</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">signals_map_path</span> <span class="o">=</span> <span class="n">mapper_path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ticker_map</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">signals_map_path</span><span class="p">)</span>

        <span class="k">assert</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ticker_col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ticker_map</span><span class="o">.</span><span class="n">columns</span>
        <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Ticker column &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ticker_col</span><span class="si">}</span><span class="s2">&#39; is not available in ticker mapping.&quot;</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">target_ticker_format</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ticker_map</span><span class="o">.</span><span class="n">columns</span>
        <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Target ticker column &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">target_ticker_format</span><span class="si">}</span><span class="s2">&#39; is not available in ticker mapping.&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mapping</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ticker_map</span><span class="p">[[</span><span class="bp">self</span><span class="o">.</span><span class="n">ticker_col</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_ticker_format</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Transform ticker column.</span>
<span class="sd">        :param X: Ticker column</span>
<span class="sd">        :return tickers: Mapped tickers</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tickers</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ticker_col</span><span class="p">])[</span><span class="bp">self</span><span class="o">.</span><span class="n">ticker_col</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mapping</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">tickers</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">get_feature_names_out</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_features</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">target_ticker_format</span><span class="p">]</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">input_features</span> <span class="k">else</span> <span class="n">input_features</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">




<h3 id="numerblox.preprocessing.signals.TickerMapper.transform" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Transform ticker column.
:param X: Ticker column
:return tickers: Mapped tickers</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/preprocessing/signals.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Transform ticker column.</span>
<span class="sd">    :param X: Ticker column</span>
<span class="sd">    :return tickers: Mapped tickers</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tickers</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ticker_col</span><span class="p">])[</span><span class="bp">self</span><span class="o">.</span><span class="n">ticker_col</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mapping</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">tickers</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>




  </div>

  </div>

</div><hr />


<div class="doc doc-object doc-module">



<a id="numerblox.targets"></a>
  <div class="doc doc-contents first">

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">




<h2 id="numerblox.targets.BaseTargetProcessor" class="doc doc-heading">
          <code>BaseTargetProcessor</code>


</h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><span title="sklearn.base.BaseEstimator">BaseEstimator</span></code>, <code><span title="sklearn.base.TransformerMixin">TransformerMixin</span></code></p>

  
      <p>Common functionality for preprocessors and postprocessors.</p>

            <details class="quote">
              <summary>Source code in <code>numerblox/targets.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">BaseTargetProcessor</span><span class="p">(</span><span class="n">BaseEstimator</span><span class="p">,</span> <span class="n">TransformerMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Common functionality for preprocessors and postprocessors.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="o">...</span>

    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="o">...</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">get_feature_names_out</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_features</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="o">...</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">




<h2 id="numerblox.targets.BayesianGMMTargetProcessor" class="doc doc-heading">
          <code>BayesianGMMTargetProcessor</code>


</h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="numerblox.targets.BaseTargetProcessor" href="#numerblox.targets.BaseTargetProcessor">BaseTargetProcessor</a></code></p>

  
      <p>Generate synthetic (fake) target using a Bayesian Gaussian Mixture model. </p>
<p>Based on Michael Oliver's GitHub Gist implementation: </p>
<p>https://gist.github.com/the-moliver/dcdd2862dc2c78dda600f1b449071c93</p>
<p>:param n_components: Number of components for fitting Bayesian Gaussian Mixture Model.</p>

            <details class="quote">
              <summary>Source code in <code>numerblox/targets.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">BayesianGMMTargetProcessor</span><span class="p">(</span><span class="n">BaseTargetProcessor</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate synthetic (fake) target using a Bayesian Gaussian Mixture model. \n</span>
<span class="sd">    Based on Michael Oliver&#39;s GitHub Gist implementation: \n</span>
<span class="sd">    https://gist.github.com/the-moliver/dcdd2862dc2c78dda600f1b449071c93</span>

<span class="sd">    :param n_components: Number of components for fitting Bayesian Gaussian Mixture Model.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">n_components</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_components</span> <span class="o">=</span> <span class="n">n_components</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ridge</span> <span class="o">=</span> <span class="n">Ridge</span><span class="p">(</span><span class="n">fit_intercept</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bins</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">eras</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fit Bayesian Gaussian Mixture model on coefficients and normalize.</span>
<span class="sd">        :param X: DataFrame containing features.</span>
<span class="sd">        :param y: Series containing real target.</span>
<span class="sd">        :param eras: Series containing era information.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">bgmm</span> <span class="o">=</span> <span class="n">BayesianGaussianMixture</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n_components</span><span class="p">)</span>
        <span class="n">coefs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_coefs</span><span class="p">(</span><span class="n">dataf</span><span class="o">=</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">eras</span><span class="o">=</span><span class="n">eras</span><span class="p">)</span>
        <span class="n">bgmm</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">coefs</span><span class="p">)</span>
        <span class="c1"># make probability of sampling each component equal to better balance rare regimes</span>
        <span class="n">bgmm</span><span class="o">.</span><span class="n">weights_</span><span class="p">[:]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_components</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bgmm_</span> <span class="o">=</span> <span class="n">bgmm</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">eras</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Main method for generating fake target.</span>
<span class="sd">        :param X: DataFrame containing features.</span>
<span class="sd">        :param eras: Series containing era information.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;bgmm_&quot;</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">eras</span><span class="p">),</span> <span class="s2">&quot;X and eras must be same length.&quot;</span>
        <span class="n">all_eras</span> <span class="o">=</span> <span class="n">eras</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="c1"># Scale data between 0 and 1</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">X</span> <span class="o">/=</span> <span class="n">X</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="n">X</span> <span class="o">-=</span> <span class="mf">0.5</span>
        <span class="n">X</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;era&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">eras</span>

        <span class="n">fake_target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_target</span><span class="p">(</span><span class="n">dataf</span><span class="o">=</span><span class="n">X</span><span class="p">,</span> <span class="n">all_eras</span><span class="o">=</span><span class="n">all_eras</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fake_target</span>

    <span class="k">def</span> <span class="nf">_get_coefs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">eras</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate coefficients for BGMM.</span>
<span class="sd">        :param dataf: DataFrame containing features.</span>
<span class="sd">        :param y: Series containing real target.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">coefs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">dataf</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;era&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">eras</span>
        <span class="n">dataf</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;target&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span>
        <span class="n">all_eras</span> <span class="o">=</span> <span class="n">dataf</span><span class="p">[</span><span class="s1">&#39;era&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">era</span> <span class="ow">in</span> <span class="n">all_eras</span><span class="p">:</span>
            <span class="n">era_df</span> <span class="o">=</span> <span class="n">dataf</span><span class="p">[</span><span class="n">dataf</span><span class="p">[</span><span class="s1">&#39;era&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">era</span><span class="p">]</span>
            <span class="n">era_y</span> <span class="o">=</span> <span class="n">era_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;target&#39;</span><span class="p">]</span>
            <span class="n">era_df</span> <span class="o">=</span> <span class="n">era_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;era&quot;</span><span class="p">,</span> <span class="s2">&quot;target&quot;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ridge</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">era_df</span><span class="p">,</span> <span class="n">era_y</span><span class="p">)</span>
            <span class="n">coefs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ridge</span><span class="o">.</span><span class="n">coef_</span><span class="p">)</span>
        <span class="n">stacked_coefs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span><span class="n">coefs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">stacked_coefs</span>

    <span class="k">def</span> <span class="nf">_generate_target</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">all_eras</span><span class="p">:</span> <span class="nb">list</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate fake target using Bayesian Gaussian Mixture model.&quot;&quot;&quot;</span>
        <span class="n">fake_target</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">era</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">all_eras</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Generating fake target&quot;</span><span class="p">):</span>
            <span class="n">features</span> <span class="o">=</span> <span class="n">dataf</span><span class="p">[</span><span class="n">dataf</span><span class="p">[</span><span class="s1">&#39;era&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">era</span><span class="p">]</span>
            <span class="n">features</span> <span class="o">=</span> <span class="n">features</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;era&quot;</span><span class="p">,</span> <span class="s2">&quot;target&quot;</span><span class="p">])</span>
            <span class="c1"># Sample a set of weights from GMM</span>
            <span class="n">beta</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bgmm_</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="c1"># Create fake continuous target</span>
            <span class="n">fake_targ</span> <span class="o">=</span> <span class="n">features</span> <span class="o">@</span> <span class="n">beta</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="c1"># Bin fake target like real target</span>
            <span class="n">fake_targ</span> <span class="o">=</span> <span class="p">(</span><span class="n">rankdata</span><span class="p">(</span><span class="n">fake_targ</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">fake_targ</span><span class="p">)</span>
            <span class="n">fake_targ</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">digitize</span><span class="p">(</span><span class="n">fake_targ</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bins</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">4</span>
            <span class="n">fake_target</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fake_targ</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">fake_target</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_feature_names_out</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_features</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return feature names.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="s2">&quot;fake_target&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">input_features</span> <span class="k">else</span> <span class="n">input_features</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">




<h3 id="numerblox.targets.BayesianGMMTargetProcessor.fit" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">eras</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Fit Bayesian Gaussian Mixture model on coefficients and normalize.
:param X: DataFrame containing features.
:param y: Series containing real target.
:param eras: Series containing era information.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/targets.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">eras</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Fit Bayesian Gaussian Mixture model on coefficients and normalize.</span>
<span class="sd">    :param X: DataFrame containing features.</span>
<span class="sd">    :param y: Series containing real target.</span>
<span class="sd">    :param eras: Series containing era information.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">bgmm</span> <span class="o">=</span> <span class="n">BayesianGaussianMixture</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n_components</span><span class="p">)</span>
    <span class="n">coefs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_coefs</span><span class="p">(</span><span class="n">dataf</span><span class="o">=</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">eras</span><span class="o">=</span><span class="n">eras</span><span class="p">)</span>
    <span class="n">bgmm</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">coefs</span><span class="p">)</span>
    <span class="c1"># make probability of sampling each component equal to better balance rare regimes</span>
    <span class="n">bgmm</span><span class="o">.</span><span class="n">weights_</span><span class="p">[:]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_components</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">bgmm_</span> <span class="o">=</span> <span class="n">bgmm</span>
    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="numerblox.targets.BayesianGMMTargetProcessor.get_feature_names_out" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_feature_names_out</span><span class="p">(</span><span class="n">input_features</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Return feature names.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/targets.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_feature_names_out</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_features</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return feature names.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">[</span><span class="s2">&quot;fake_target&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">input_features</span> <span class="k">else</span> <span class="n">input_features</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="numerblox.targets.BayesianGMMTargetProcessor.transform" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">eras</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Main method for generating fake target.
:param X: DataFrame containing features.
:param eras: Series containing era information.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/targets.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">eras</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Main method for generating fake target.</span>
<span class="sd">    :param X: DataFrame containing features.</span>
<span class="sd">    :param eras: Series containing era information.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;bgmm_&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">eras</span><span class="p">),</span> <span class="s2">&quot;X and eras must be same length.&quot;</span>
    <span class="n">all_eras</span> <span class="o">=</span> <span class="n">eras</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="c1"># Scale data between 0 and 1</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">X</span> <span class="o">/=</span> <span class="n">X</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="n">X</span> <span class="o">-=</span> <span class="mf">0.5</span>
    <span class="n">X</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;era&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">eras</span>

    <span class="n">fake_target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_target</span><span class="p">(</span><span class="n">dataf</span><span class="o">=</span><span class="n">X</span><span class="p">,</span> <span class="n">all_eras</span><span class="o">=</span><span class="n">all_eras</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fake_target</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">




<h2 id="numerblox.targets.SignalsTargetProcessor" class="doc doc-heading">
          <code>SignalsTargetProcessor</code>


</h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="numerblox.targets.BaseTargetProcessor" href="#numerblox.targets.BaseTargetProcessor">BaseTargetProcessor</a></code></p>

  
      <p>Engineer targets for Numerai Signals. </p>
<p>More information on implements Numerai Signals targets: </p>
<p>https://forum.numer.ai/t/decoding-the-signals-target/2501</p>
<p>:param price_col: Column from which target will be derived. </p>
<p>:param windows: Timeframes to use for engineering targets. 10 and 20-day by default. </p>
<p>:param bins: Binning used to create group targets. Nomi binning by default. </p>
<p>:param labels: Scaling for binned target. Must be same length as resulting bins (bins-1). Numerai labels by default.</p>

            <details class="quote">
              <summary>Source code in <code>numerblox/targets.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">SignalsTargetProcessor</span><span class="p">(</span><span class="n">BaseTargetProcessor</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Engineer targets for Numerai Signals. \n</span>
<span class="sd">    More information on implements Numerai Signals targets: \n</span>
<span class="sd">    https://forum.numer.ai/t/decoding-the-signals-target/2501</span>

<span class="sd">    :param price_col: Column from which target will be derived. \n</span>
<span class="sd">    :param windows: Timeframes to use for engineering targets. 10 and 20-day by default. \n</span>
<span class="sd">    :param bins: Binning used to create group targets. Nomi binning by default. \n</span>
<span class="sd">    :param labels: Scaling for binned target. Must be same length as resulting bins (bins-1). Numerai labels by default.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">price_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;close&quot;</span><span class="p">,</span>
        <span class="n">windows</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">bins</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">labels</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">price_col</span> <span class="o">=</span> <span class="n">price_col</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">windows</span> <span class="o">=</span> <span class="n">windows</span> <span class="k">if</span> <span class="n">windows</span> <span class="k">else</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bins</span> <span class="o">=</span> <span class="n">bins</span> <span class="k">if</span> <span class="n">bins</span> <span class="k">else</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labels</span> <span class="o">=</span> <span class="n">labels</span> <span class="k">if</span> <span class="n">labels</span> <span class="k">else</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.50</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">eras</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">window</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">windows</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Signals target engineering windows&quot;</span><span class="p">):</span>
            <span class="n">dataf</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="sa">f</span><span class="s2">&quot;target_</span><span class="si">{</span><span class="n">window</span><span class="si">}</span><span class="s2">d_raw&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">dataf</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">price_col</span><span class="p">]</span><span class="o">.</span><span class="n">pct_change</span><span class="p">(</span><span class="n">periods</span><span class="o">=</span><span class="n">window</span><span class="p">)</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="o">-</span><span class="n">window</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">era_groups</span> <span class="o">=</span> <span class="n">dataf</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">eras</span><span class="p">)</span>

            <span class="n">dataf</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="sa">f</span><span class="s2">&quot;target_</span><span class="si">{</span><span class="n">window</span><span class="si">}</span><span class="s2">d_rank&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">era_groups</span><span class="p">[</span>
                <span class="sa">f</span><span class="s2">&quot;target_</span><span class="si">{</span><span class="n">window</span><span class="si">}</span><span class="s2">d_raw&quot;</span>
            <span class="p">]</span><span class="o">.</span><span class="n">rank</span><span class="p">(</span><span class="n">pct</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;first&quot;</span><span class="p">)</span>
            <span class="n">dataf</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="sa">f</span><span class="s2">&quot;target_</span><span class="si">{</span><span class="n">window</span><span class="si">}</span><span class="s2">d_group&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">era_groups</span><span class="p">[</span>
                <span class="sa">f</span><span class="s2">&quot;target_</span><span class="si">{</span><span class="n">window</span><span class="si">}</span><span class="s2">d_rank&quot;</span>
            <span class="p">]</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span>
                <span class="k">lambda</span> <span class="n">group</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span>
                    <span class="n">group</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bins</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">,</span> <span class="n">include_lowest</span><span class="o">=</span><span class="kc">True</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="n">output_cols</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_feature_names_out</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">dataf</span><span class="p">[</span><span class="n">output_cols</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">get_feature_names_out</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_features</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return feature names of Signals targets. &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">input_features</span><span class="p">:</span>
            <span class="n">feature_names</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">window</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">windows</span><span class="p">:</span>
                <span class="n">feature_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;target_</span><span class="si">{</span><span class="n">window</span><span class="si">}</span><span class="s2">d_raw&quot;</span><span class="p">)</span>
                <span class="n">feature_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;target_</span><span class="si">{</span><span class="n">window</span><span class="si">}</span><span class="s2">d_rank&quot;</span><span class="p">)</span>
                <span class="n">feature_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;target_</span><span class="si">{</span><span class="n">window</span><span class="si">}</span><span class="s2">d_group&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">feature_names</span> <span class="o">=</span> <span class="n">input_features</span>
        <span class="k">return</span> <span class="n">feature_names</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">




<h3 id="numerblox.targets.SignalsTargetProcessor.get_feature_names_out" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_feature_names_out</span><span class="p">(</span><span class="n">input_features</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Return feature names of Signals targets.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/targets.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_feature_names_out</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_features</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return feature names of Signals targets. &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">input_features</span><span class="p">:</span>
        <span class="n">feature_names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">window</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">windows</span><span class="p">:</span>
            <span class="n">feature_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;target_</span><span class="si">{</span><span class="n">window</span><span class="si">}</span><span class="s2">d_raw&quot;</span><span class="p">)</span>
            <span class="n">feature_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;target_</span><span class="si">{</span><span class="n">window</span><span class="si">}</span><span class="s2">d_rank&quot;</span><span class="p">)</span>
            <span class="n">feature_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;target_</span><span class="si">{</span><span class="n">window</span><span class="si">}</span><span class="s2">d_group&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">feature_names</span> <span class="o">=</span> <span class="n">input_features</span>
    <span class="k">return</span> <span class="n">feature_names</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>




  </div>

  </div>

</div><hr />


<div class="doc doc-object doc-module">



<a id="numerblox.meta"></a>
  <div class="doc doc-contents first">

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">




<h2 id="numerblox.meta.CrossValEstimator" class="doc doc-heading">
          <code>CrossValEstimator</code>


</h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><span title="sklearn.base.BaseEstimator">BaseEstimator</span></code>, <code><span title="sklearn.base.TransformerMixin">TransformerMixin</span></code></p>

  
      <p>Split your data into multiple folds and fit an estimator on each fold.
For transforms predictions are concatenated into a 2D array.
:param cv: Cross validation object that follows scikit-learn conventions.
:param estimator: Estimator to fit on each fold.
:param evaluation_func: Custom evaluation logic that is executed on validation data for each fold. Must accepts as input y_true and y_pred.
For example, evaluation_func can handle logging metrics for each fold.
Anything that evaluation_func returns is stored in <code>self.eval_results_</code>.
:param predict_func: Name of the function that will be used for prediction.
Must be one of 'predict', 'predict_proba', 'predict_log_proba'.
For example, XGBRegressor has 'predict' and 'predict_proba' functions.
:param verbose: Whether to print progress.</p>

            <details class="quote">
              <summary>Source code in <code>numerblox/meta.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">CrossValEstimator</span><span class="p">(</span><span class="n">BaseEstimator</span><span class="p">,</span> <span class="n">TransformerMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Split your data into multiple folds and fit an estimator on each fold.</span>
<span class="sd">    For transforms predictions are concatenated into a 2D array.</span>
<span class="sd">    :param cv: Cross validation object that follows scikit-learn conventions.</span>
<span class="sd">    :param estimator: Estimator to fit on each fold.</span>
<span class="sd">    :param evaluation_func: Custom evaluation logic that is executed on validation data for each fold. Must accepts as input y_true and y_pred.</span>
<span class="sd">    For example, evaluation_func can handle logging metrics for each fold.</span>
<span class="sd">    Anything that evaluation_func returns is stored in `self.eval_results_`.</span>
<span class="sd">    :param predict_func: Name of the function that will be used for prediction.</span>
<span class="sd">    Must be one of &#39;predict&#39;, &#39;predict_proba&#39;, &#39;predict_log_proba&#39;.</span>
<span class="sd">    For example, XGBRegressor has &#39;predict&#39; and &#39;predict_proba&#39; functions.</span>
<span class="sd">    :param verbose: Whether to print progress.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">estimator</span><span class="p">:</span> <span class="n">BaseEstimator</span><span class="p">,</span> <span class="n">cv</span><span class="p">:</span> <span class="n">BaseCrossValidator</span><span class="p">,</span> <span class="n">evaluation_func</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">predict_func</span><span class="o">=</span><span class="s2">&quot;predict&quot;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cv</span> <span class="o">=</span> <span class="n">cv</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cv</span><span class="p">,</span> <span class="s2">&quot;split&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cv</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;cv must be a valid sklearn cv object withat least a &#39;split&#39; function.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">estimator</span> <span class="o">=</span> <span class="n">estimator</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">estimator_name</span> <span class="o">=</span> <span class="n">estimator</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">evaluation_func</span> <span class="o">=</span> <span class="n">evaluation_func</span>

        <span class="k">if</span> <span class="n">predict_func</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;predict&quot;</span><span class="p">,</span> <span class="s2">&quot;predict_proba&quot;</span><span class="p">,</span> <span class="s2">&quot;predict_log_proba&quot;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;predict_func must be &#39;predict&#39;, &#39;predict_proba&#39;, or &#39;predict_log_proba&#39;.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">predict_func</span> <span class="o">=</span> <span class="n">predict_func</span>
        <span class="k">assert</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict_func</span><span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Estimator </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">estimator_name</span><span class="si">}</span><span class="s2"> does not have </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">predict_func</span><span class="si">}</span><span class="s2"> function.&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>

    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">],</span> <span class="n">y</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Use cross validation object to fit estimators. &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">estimators_</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eval_results_</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)):</span>
            <span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)):</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">train_idx</span><span class="p">,</span> <span class="n">val_idx</span><span class="p">)</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cv</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)),</span> 
                                            <span class="n">desc</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;CrossValEstimator Fitting. Estimator=&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">estimator_name</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">,</span> 
                                            <span class="n">total</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cv</span><span class="o">.</span><span class="n">get_n_splits</span><span class="p">(),</span> 
                                            <span class="n">disable</span><span class="o">=</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">):</span>
            <span class="n">estimator</span> <span class="o">=</span> <span class="n">clone</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fitting </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">estimator_name</span><span class="si">}</span><span class="s2"> on fold </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">estimators_</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>


            <span class="n">estimator</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">train_idx</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">train_idx</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

            <span class="c1"># Execute custom evaluation logic</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluation_func</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Running evaluation on fold </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">estimators_</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="n">y_pred</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">estimator</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict_func</span><span class="p">)(</span><span class="n">X</span><span class="p">[</span><span class="n">val_idx</span><span class="p">])</span>
                <span class="n">y_pred</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_postprocess_pred</span><span class="p">(</span><span class="n">y_pred</span><span class="p">)</span>
                <span class="n">eval_fold</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluation_func</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">val_idx</span><span class="p">],</span> <span class="n">y_pred</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;CrossValEstimator (estimator=&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">estimator_name</span><span class="si">}</span><span class="s2">&#39;): Fold &#39;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&#39; evaluation results: &#39;</span><span class="si">{</span><span class="n">eval_fold</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">eval_results_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">eval_fold</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">estimators_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">estimator</span><span class="p">)</span>

            <span class="c1"># Store output shape by doing inference on 1st sample of training set</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">sample_prediction</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">estimator</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict_func</span><span class="p">)(</span><span class="n">X</span><span class="p">[</span><span class="n">train_idx</span><span class="p">][:</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">sample_prediction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_postprocess_pred</span><span class="p">(</span><span class="n">sample_prediction</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">output_shape_</span> <span class="o">=</span> <span class="n">sample_prediction</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">multi_output_</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">n_outputs_per_model_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_shape_</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">model_idxs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        Use cross validation object to transform estimators. </span>
<span class="sd">        :param X: Input data for inference.</span>
<span class="sd">        :param y: Target data for inference.</span>
<span class="sd">        :param model_idxs: List of indices of models to use for inference. </span>
<span class="sd">        By default, all fitted models are used.</span>
<span class="sd">        :param kwargs: Additional arguments to pass to the estimator&#39;s predict function.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>        
        <span class="n">inference_estimators</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">estimators_</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">model_idxs</span><span class="p">]</span> <span class="k">if</span> <span class="n">model_idxs</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">estimators_</span>

        <span class="c1"># Create an empty array to store predictions</span>
        <span class="n">final_predictions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">len</span><span class="p">(</span><span class="n">inference_estimators</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_outputs_per_model_</span><span class="p">))</span>
        <span class="c1"># Iterate through models to get predictions</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">estimator</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">inference_estimators</span><span class="p">):</span>
            <span class="n">pred</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">estimator</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict_func</span><span class="p">)(</span><span class="n">X</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">pred</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_postprocess_pred</span><span class="p">(</span><span class="n">pred</span><span class="p">)</span>

            <span class="c1"># Calculate where to place these predictions in the final array</span>
            <span class="n">start_idx</span> <span class="o">=</span> <span class="n">idx</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_outputs_per_model_</span>
            <span class="n">end_idx</span> <span class="o">=</span> <span class="p">(</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_outputs_per_model_</span>

            <span class="n">final_predictions</span><span class="p">[:,</span> <span class="n">start_idx</span><span class="p">:</span><span class="n">end_idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">pred</span>

        <span class="k">return</span> <span class="n">final_predictions</span>

    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">model_idxs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">model_idxs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_feature_names_out</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_features</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">base_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;CrossValEstimator_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">estimator_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">predict_func</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="c1"># Single-output case</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_outputs_per_model_</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">feature_names</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_str</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">estimators_</span><span class="p">))]</span>
        <span class="c1"># Multi-output case</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">feature_names</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">estimators_</span><span class="p">)):</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_outputs_per_model_</span><span class="p">):</span>
                    <span class="n">feature_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_str</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">_output_</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">feature_names</span>

    <span class="k">def</span> <span class="nf">_postprocess_pred</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pred</span><span class="p">):</span>
        <span class="c1"># Make sure predictions are 2D</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pred</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">pred</span> <span class="o">=</span> <span class="n">pred</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pred</span>

    <span class="k">def</span> <span class="nf">__sklearn_is_fitted__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Check fitted status. &quot;&quot;&quot;</span>
        <span class="c1"># Must have a fitted estimator for each split.</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">estimators_</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv</span><span class="o">.</span><span class="n">get_n_splits</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">




<h3 id="numerblox.meta.CrossValEstimator.__sklearn_is_fitted__" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">__sklearn_is_fitted__</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Check fitted status.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/meta.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">__sklearn_is_fitted__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Check fitted status. &quot;&quot;&quot;</span>
    <span class="c1"># Must have a fitted estimator for each split.</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">estimators_</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv</span><span class="o">.</span><span class="n">get_n_splits</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="numerblox.meta.CrossValEstimator.fit" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Use cross validation object to fit estimators.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/meta.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">],</span> <span class="n">y</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Use cross validation object to fit estimators. &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">estimators_</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">eval_results_</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)):</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)):</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">train_idx</span><span class="p">,</span> <span class="n">val_idx</span><span class="p">)</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cv</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)),</span> 
                                        <span class="n">desc</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;CrossValEstimator Fitting. Estimator=&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">estimator_name</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">,</span> 
                                        <span class="n">total</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cv</span><span class="o">.</span><span class="n">get_n_splits</span><span class="p">(),</span> 
                                        <span class="n">disable</span><span class="o">=</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">):</span>
        <span class="n">estimator</span> <span class="o">=</span> <span class="n">clone</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fitting </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">estimator_name</span><span class="si">}</span><span class="s2"> on fold </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">estimators_</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>


        <span class="n">estimator</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">train_idx</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">train_idx</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c1"># Execute custom evaluation logic</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluation_func</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Running evaluation on fold </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">estimators_</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="n">y_pred</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">estimator</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict_func</span><span class="p">)(</span><span class="n">X</span><span class="p">[</span><span class="n">val_idx</span><span class="p">])</span>
            <span class="n">y_pred</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_postprocess_pred</span><span class="p">(</span><span class="n">y_pred</span><span class="p">)</span>
            <span class="n">eval_fold</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluation_func</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">val_idx</span><span class="p">],</span> <span class="n">y_pred</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;CrossValEstimator (estimator=&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">estimator_name</span><span class="si">}</span><span class="s2">&#39;): Fold &#39;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&#39; evaluation results: &#39;</span><span class="si">{</span><span class="n">eval_fold</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">eval_results_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">eval_fold</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">estimators_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">estimator</span><span class="p">)</span>

        <span class="c1"># Store output shape by doing inference on 1st sample of training set</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">sample_prediction</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">estimator</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict_func</span><span class="p">)(</span><span class="n">X</span><span class="p">[</span><span class="n">train_idx</span><span class="p">][:</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">sample_prediction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_postprocess_pred</span><span class="p">(</span><span class="n">sample_prediction</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">output_shape_</span> <span class="o">=</span> <span class="n">sample_prediction</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">multi_output_</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">n_outputs_per_model_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_shape_</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="numerblox.meta.CrossValEstimator.transform" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">model_idxs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Use cross validation object to transform estimators. 
:param X: Input data for inference.
:param y: Target data for inference.
:param model_idxs: List of indices of models to use for inference. 
By default, all fitted models are used.
:param kwargs: Additional arguments to pass to the estimator's predict function.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/meta.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">model_idxs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">    Use cross validation object to transform estimators. </span>
<span class="sd">    :param X: Input data for inference.</span>
<span class="sd">    :param y: Target data for inference.</span>
<span class="sd">    :param model_idxs: List of indices of models to use for inference. </span>
<span class="sd">    By default, all fitted models are used.</span>
<span class="sd">    :param kwargs: Additional arguments to pass to the estimator&#39;s predict function.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>        
    <span class="n">inference_estimators</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">estimators_</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">model_idxs</span><span class="p">]</span> <span class="k">if</span> <span class="n">model_idxs</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">estimators_</span>

    <span class="c1"># Create an empty array to store predictions</span>
    <span class="n">final_predictions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">len</span><span class="p">(</span><span class="n">inference_estimators</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_outputs_per_model_</span><span class="p">))</span>
    <span class="c1"># Iterate through models to get predictions</span>
    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">estimator</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">inference_estimators</span><span class="p">):</span>
        <span class="n">pred</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">estimator</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict_func</span><span class="p">)(</span><span class="n">X</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">pred</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_postprocess_pred</span><span class="p">(</span><span class="n">pred</span><span class="p">)</span>

        <span class="c1"># Calculate where to place these predictions in the final array</span>
        <span class="n">start_idx</span> <span class="o">=</span> <span class="n">idx</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_outputs_per_model_</span>
        <span class="n">end_idx</span> <span class="o">=</span> <span class="p">(</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_outputs_per_model_</span>

        <span class="n">final_predictions</span><span class="p">[:,</span> <span class="n">start_idx</span><span class="p">:</span><span class="n">end_idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">pred</span>

    <span class="k">return</span> <span class="n">final_predictions</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">




<h2 id="numerblox.meta.MetaEstimator" class="doc doc-heading">
          <code>MetaEstimator</code>


</h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><span title="sklearn.base.BaseEstimator">BaseEstimator</span></code>, <code><span title="sklearn.base.TransformerMixin">TransformerMixin</span></code>, <code><span title="sklearn.base.MetaEstimatorMixin">MetaEstimatorMixin</span></code></p>

  
      <p>Helper for NumeraiPipeline and NumeraiFeatureUnion to use a model as a transformer.</p>
<p>:param estimator: Underlying estimator like XGBoost, Catboost, scikit-learn, etc.
:param predict_func: Name of the function that will be used for prediction.
Must be one of 'predict', 'predict_proba', 'predict_log_proba'.
For example, XGBRegressor has 'predict' and 'predict_proba' functions.
:param model_type: "regressor" or "classifier". Used to determine if the estimator is multi output.</p>

            <details class="quote">
              <summary>Source code in <code>numerblox/meta.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">MetaEstimator</span><span class="p">(</span><span class="n">BaseEstimator</span><span class="p">,</span> <span class="n">TransformerMixin</span><span class="p">,</span> <span class="n">MetaEstimatorMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Helper for NumeraiPipeline and NumeraiFeatureUnion to use a model as a transformer.</span>

<span class="sd">    :param estimator: Underlying estimator like XGBoost, Catboost, scikit-learn, etc.</span>
<span class="sd">    :param predict_func: Name of the function that will be used for prediction.</span>
<span class="sd">    Must be one of &#39;predict&#39;, &#39;predict_proba&#39;, &#39;predict_log_proba&#39;.</span>
<span class="sd">    For example, XGBRegressor has &#39;predict&#39; and &#39;predict_proba&#39; functions.</span>
<span class="sd">    :param model_type: &quot;regressor&quot; or &quot;classifier&quot;. Used to determine if the estimator is multi output.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">estimator</span><span class="p">,</span> <span class="n">predict_func</span><span class="o">=</span><span class="s2">&quot;predict&quot;</span><span class="p">,</span> <span class="n">model_type</span><span class="o">=</span><span class="s2">&quot;regressor&quot;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">estimator</span> <span class="o">=</span> <span class="n">estimator</span>
        <span class="k">if</span> <span class="n">predict_func</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;predict&quot;</span><span class="p">,</span> <span class="s2">&quot;predict_proba&quot;</span><span class="p">,</span> <span class="s2">&quot;predict_log_proba&quot;</span><span class="p">,</span> <span class="s2">&quot;transform&quot;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;predict_func must be &#39;predict&#39;, &#39;predict_proba&#39;, &#39;predict_log_proba&#39; or &#39;transform&#39;.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">predict_func</span> <span class="o">=</span> <span class="n">predict_func</span>
        <span class="k">assert</span> <span class="n">model_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;regressor&quot;</span><span class="p">,</span> <span class="s2">&quot;classifier&quot;</span><span class="p">],</span> <span class="s2">&quot;model_type must be &#39;regressor&#39; or &#39;classifier&#39;.&quot;</span>
        <span class="k">assert</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict_func</span><span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Estimator </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> does not have </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">predict_func</span><span class="si">}</span><span class="s2"> function.&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_type</span> <span class="o">=</span> <span class="n">model_type</span>
        <span class="c1"># predict_proba for classifiers -&gt; multi output</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">proba_class_</span> <span class="o">=</span> <span class="n">predict_func</span> <span class="o">==</span> <span class="s2">&quot;predict_proba&quot;</span> <span class="ow">and</span> <span class="n">model_type</span> <span class="o">==</span> <span class="s2">&quot;classifier&quot;</span>

    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">],</span> <span class="n">y</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fit underlying estimator and set attributes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">check_X_y</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">estimator</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">FLOAT_DTYPES</span><span class="p">,</span> <span class="n">multi_output</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># Either multi target or outputs are probabilities</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">multi_output_</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">proba_class_</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">estimator_</span> <span class="o">=</span> <span class="n">clone</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">estimator_</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Apply the `predict_func` on the fitted estimator.</span>

<span class="sd">        Shape `(X.shape[0], )` if estimator is not multi output and else `(X.shape[0], y.shape[1])`.</span>
<span class="sd">        All additional kwargs are passed to the underlying estimator&#39;s predict function.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;estimator_&quot;</span><span class="p">)</span>
        <span class="n">output</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">estimator_</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict_func</span><span class="p">)(</span><span class="n">X</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">output</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">multi_output_</span> <span class="k">else</span> <span class="n">output</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        For if a MetaEstimator happens to be the last step in the pipeline. Has same behavior as transform.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_feature_names_out</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_features</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">feature_names</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">predict_func</span><span class="si">}</span><span class="s2">_output&quot;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">feature_names</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">input_features</span> <span class="k">else</span> <span class="n">input_features</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">




<h3 id="numerblox.meta.MetaEstimator.fit" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Fit underlying estimator and set attributes.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/meta.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">],</span> <span class="n">y</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Fit underlying estimator and set attributes.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">check_X_y</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">estimator</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">FLOAT_DTYPES</span><span class="p">,</span> <span class="n">multi_output</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># Either multi target or outputs are probabilities</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">multi_output_</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">proba_class_</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">estimator_</span> <span class="o">=</span> <span class="n">clone</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">estimator_</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="numerblox.meta.MetaEstimator.predict" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>For if a MetaEstimator happens to be the last step in the pipeline. Has same behavior as transform.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/meta.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">    For if a MetaEstimator happens to be the last step in the pipeline. Has same behavior as transform.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="numerblox.meta.MetaEstimator.transform" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Apply the <code>predict_func</code> on the fitted estimator.</p>
<p>Shape <code>(X.shape[0], )</code> if estimator is not multi output and else <code>(X.shape[0], y.shape[1])</code>.
All additional kwargs are passed to the underlying estimator's predict function.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/meta.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Apply the `predict_func` on the fitted estimator.</span>

<span class="sd">    Shape `(X.shape[0], )` if estimator is not multi output and else `(X.shape[0], y.shape[1])`.</span>
<span class="sd">    All additional kwargs are passed to the underlying estimator&#39;s predict function.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;estimator_&quot;</span><span class="p">)</span>
    <span class="n">output</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">estimator_</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict_func</span><span class="p">)(</span><span class="n">X</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">output</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">multi_output_</span> <span class="k">else</span> <span class="n">output</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">




<h2 id="numerblox.meta.MetaPipeline" class="doc doc-heading">
          <code>MetaPipeline</code>


</h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><span title="sklearn.pipeline.Pipeline">Pipeline</span></code></p>

  
      <p>Pipeline which turns all estimators into transformers by wrapping them in MetaEstimator.
This allows to have pipeline steps after models.
For example, a FeatureNeutralizer after an XGBRegressor.</p>
<p>:param steps: List of (name, transform) tuples (implementing fit/transform) that are chained, in the order in which they are chained, with the last object an instance of BaseNeutralizer.
:param memory: Used to cache the fitted transformers of the pipeline.
:param verbose: If True, the time elapsed while fitting each step will be printed as it is completed.
:param predict_func: Name of the function that will be used for prediction.</p>

            <details class="quote">
              <summary>Source code in <code>numerblox/meta.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">MetaPipeline</span><span class="p">(</span><span class="n">Pipeline</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Pipeline which turns all estimators into transformers by wrapping them in MetaEstimator.</span>
<span class="sd">    This allows to have pipeline steps after models.</span>
<span class="sd">    For example, a FeatureNeutralizer after an XGBRegressor.</span>

<span class="sd">    :param steps: List of (name, transform) tuples (implementing fit/transform) that are chained, in the order in which they are chained, with the last object an instance of BaseNeutralizer.</span>
<span class="sd">    :param memory: Used to cache the fitted transformers of the pipeline.</span>
<span class="sd">    :param verbose: If True, the time elapsed while fitting each step will be printed as it is completed.</span>
<span class="sd">    :param predict_func: Name of the function that will be used for prediction.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">steps</span><span class="p">,</span> <span class="n">memory</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">predict_func</span><span class="o">=</span><span class="s2">&quot;predict&quot;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">predict_func</span> <span class="o">=</span> <span class="n">predict_func</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modified_steps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wrap_estimators_as_transformers</span><span class="p">(</span><span class="n">steps</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">steps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">modified_steps</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">memory</span> <span class="o">=</span> <span class="n">memory</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>

    <span class="k">def</span> <span class="nf">wrap_estimators_as_transformers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">steps</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts all estimator steps (except the last step) into transformers by wrapping them in MetaEstimator.</span>
<span class="sd">        :param steps: List of (name, transform) tuples specifying the pipeline steps.</span>
<span class="sd">        :return: Modified steps with all estimators wrapped as transformers.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">transformed_steps</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">step_tuple</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">steps</span><span class="p">):</span>
            <span class="n">is_last_step</span> <span class="o">=</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">steps</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">step_tuple</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">name</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="n">step_tuple</span>
                <span class="n">transformed_steps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_wrap_step</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">columns</span><span class="p">,</span> <span class="n">is_last_step</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">name</span><span class="p">,</span> <span class="n">step</span> <span class="o">=</span> <span class="n">step_tuple</span>
                <span class="n">transformed_steps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_wrap_step</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">is_last_step</span><span class="o">=</span><span class="n">is_last_step</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">transformed_steps</span>

    <span class="k">def</span> <span class="nf">_wrap_step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">is_last_step</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot; Recursive function to wrap steps &quot;&quot;&quot;</span>
            <span class="c1"># Recursive call</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">step</span><span class="p">,</span> <span class="p">(</span><span class="n">Pipeline</span><span class="p">,</span> <span class="n">FeatureUnion</span><span class="p">,</span> <span class="n">ColumnTransformer</span><span class="p">)):</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">step</span><span class="p">,</span> <span class="n">Pipeline</span><span class="p">):</span>
                    <span class="n">transformed</span> <span class="o">=</span> <span class="n">step</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wrap_estimators_as_transformers</span><span class="p">(</span><span class="n">step</span><span class="o">.</span><span class="n">steps</span><span class="p">))</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">step</span><span class="p">,</span> <span class="n">FeatureUnion</span><span class="p">):</span>
                    <span class="n">transformed</span> <span class="o">=</span> <span class="n">FeatureUnion</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wrap_estimators_as_transformers</span><span class="p">(</span><span class="n">step</span><span class="o">.</span><span class="n">transformer_list</span><span class="p">))</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">step</span><span class="p">,</span> <span class="n">ColumnTransformer</span><span class="p">):</span>
                    <span class="n">transformed_transformers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wrap_estimators_as_transformers</span><span class="p">(</span><span class="n">step</span><span class="o">.</span><span class="n">transformers</span><span class="p">)</span>
                    <span class="n">transformed</span> <span class="o">=</span> <span class="n">ColumnTransformer</span><span class="p">(</span><span class="n">transformed_transformers</span><span class="p">)</span>
                <span class="k">return</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">transformed</span><span class="p">,</span> <span class="n">columns</span><span class="p">)</span> <span class="k">if</span> <span class="n">columns</span> <span class="k">else</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">transformed</span><span class="p">)</span>

            <span class="c1"># If it&#39;s the last step and it doesn&#39;t have a transform method, don&#39;t wrap it</span>
            <span class="k">if</span> <span class="n">is_last_step</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">step</span><span class="p">,</span> <span class="s1">&#39;transform&#39;</span><span class="p">):</span>
                <span class="k">return</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">columns</span><span class="p">)</span> <span class="k">if</span> <span class="n">columns</span> <span class="k">else</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>

            <span class="c1"># Wrap estimator that has the predict function but not the transform function</span>
            <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">step</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict_func</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">step</span><span class="p">,</span> <span class="s1">&#39;transform&#39;</span><span class="p">):</span>
                <span class="k">return</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">MetaEstimator</span><span class="p">(</span><span class="n">step</span><span class="p">,</span> <span class="n">predict_func</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">predict_func</span><span class="p">))</span>

            <span class="k">return</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">columns</span><span class="p">)</span> <span class="k">if</span> <span class="n">columns</span> <span class="k">else</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">fit_params_steps</span><span class="p">):</span>
        <span class="c1"># shallow copy of steps - this should really be steps_</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">steps</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">steps</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_steps</span><span class="p">()</span>
        <span class="c1"># Setup the memory</span>
        <span class="n">memory</span> <span class="o">=</span> <span class="n">check_memory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">memory</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">step_idx</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">transformer</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iter</span><span class="p">(</span>
            <span class="n">with_final</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">filter_passthrough</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">):</span>
            <span class="k">if</span> <span class="n">transformer</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">transformer</span> <span class="o">==</span> <span class="s2">&quot;passthrough&quot;</span><span class="p">:</span>
                <span class="k">with</span> <span class="n">_print_elapsed_time</span><span class="p">(</span><span class="s2">&quot;Pipeline&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log_message</span><span class="p">(</span><span class="n">step_idx</span><span class="p">)):</span>
                    <span class="k">continue</span>

            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">memory</span><span class="p">,</span> <span class="s2">&quot;location&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">memory</span><span class="o">.</span><span class="n">location</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># we do not clone when caching is disabled to</span>
                <span class="c1"># preserve backward compatibility</span>
                <span class="n">cloned_transformer</span> <span class="o">=</span> <span class="n">transformer</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cloned_transformer</span> <span class="o">=</span> <span class="n">clone</span><span class="p">(</span><span class="n">transformer</span><span class="p">)</span>
            <span class="c1"># Fit or load from cache the current transformer</span>
            <span class="n">X</span><span class="p">,</span> <span class="n">fitted_transformer</span> <span class="o">=</span> <span class="n">_fit_transform_one</span><span class="p">(</span>
                <span class="n">cloned_transformer</span><span class="p">,</span>
                <span class="n">X</span><span class="p">,</span>
                <span class="n">y</span><span class="p">,</span>
                <span class="kc">None</span><span class="p">,</span>
                <span class="n">message_clsname</span><span class="o">=</span><span class="s2">&quot;Pipeline&quot;</span><span class="p">,</span>
                <span class="n">message</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_log_message</span><span class="p">(</span><span class="n">step_idx</span><span class="p">),</span>
                <span class="o">**</span><span class="n">fit_params_steps</span><span class="p">[</span><span class="n">name</span><span class="p">],</span>
            <span class="p">)</span>
            <span class="c1"># Replace the transformer of the step with the fitted</span>
            <span class="c1"># transformer. This is necessary when loading the transformer</span>
            <span class="c1"># from the cache.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">steps</span><span class="p">[</span><span class="n">step_idx</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">fitted_transformer</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">X</span>

    <span class="nd">@available_if</span><span class="p">(</span><span class="n">_final_estimator_has</span><span class="p">(</span><span class="s2">&quot;predict&quot;</span><span class="p">))</span>
    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="o">**</span><span class="n">predict_params</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Overrides predict method in Pipeline so it also parses arguments to transforms.&quot;&quot;&quot;</span>
        <span class="n">Xt</span> <span class="o">=</span> <span class="n">X</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">transform</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iter</span><span class="p">(</span><span class="n">with_final</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
            <span class="c1"># Check if predict params is needed in transform. If so parse along</span>
            <span class="n">sig</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">signature</span><span class="p">(</span><span class="n">transform</span><span class="o">.</span><span class="n">transform</span><span class="p">)</span>
            <span class="n">params_needed</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">predict_params</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">sig</span><span class="o">.</span><span class="n">parameters</span><span class="p">}</span>
            <span class="c1"># Use the needed parameters when calling transform</span>
            <span class="n">Xt</span> <span class="o">=</span> <span class="n">transform</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">Xt</span><span class="p">,</span> <span class="o">**</span><span class="n">params_needed</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">steps</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">Xt</span><span class="p">,</span> <span class="o">**</span><span class="n">predict_params</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">




<h3 id="numerblox.meta.MetaPipeline.predict" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="o">**</span><span class="n">predict_params</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Overrides predict method in Pipeline so it also parses arguments to transforms.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/meta.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@available_if</span><span class="p">(</span><span class="n">_final_estimator_has</span><span class="p">(</span><span class="s2">&quot;predict&quot;</span><span class="p">))</span>
<span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="o">**</span><span class="n">predict_params</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Overrides predict method in Pipeline so it also parses arguments to transforms.&quot;&quot;&quot;</span>
    <span class="n">Xt</span> <span class="o">=</span> <span class="n">X</span>
    <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">transform</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iter</span><span class="p">(</span><span class="n">with_final</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="c1"># Check if predict params is needed in transform. If so parse along</span>
        <span class="n">sig</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">signature</span><span class="p">(</span><span class="n">transform</span><span class="o">.</span><span class="n">transform</span><span class="p">)</span>
        <span class="n">params_needed</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">predict_params</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">sig</span><span class="o">.</span><span class="n">parameters</span><span class="p">}</span>
        <span class="c1"># Use the needed parameters when calling transform</span>
        <span class="n">Xt</span> <span class="o">=</span> <span class="n">transform</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">Xt</span><span class="p">,</span> <span class="o">**</span><span class="n">params_needed</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">steps</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">Xt</span><span class="p">,</span> <span class="o">**</span><span class="n">predict_params</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="numerblox.meta.MetaPipeline.wrap_estimators_as_transformers" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">wrap_estimators_as_transformers</span><span class="p">(</span><span class="n">steps</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Converts all estimator steps (except the last step) into transformers by wrapping them in MetaEstimator.
:param steps: List of (name, transform) tuples specifying the pipeline steps.
:return: Modified steps with all estimators wrapped as transformers.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/meta.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">wrap_estimators_as_transformers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">steps</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts all estimator steps (except the last step) into transformers by wrapping them in MetaEstimator.</span>
<span class="sd">    :param steps: List of (name, transform) tuples specifying the pipeline steps.</span>
<span class="sd">    :return: Modified steps with all estimators wrapped as transformers.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">transformed_steps</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">step_tuple</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">steps</span><span class="p">):</span>
        <span class="n">is_last_step</span> <span class="o">=</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">steps</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">step_tuple</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">name</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="n">step_tuple</span>
            <span class="n">transformed_steps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_wrap_step</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">columns</span><span class="p">,</span> <span class="n">is_last_step</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">name</span><span class="p">,</span> <span class="n">step</span> <span class="o">=</span> <span class="n">step_tuple</span>
            <span class="n">transformed_steps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_wrap_step</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">is_last_step</span><span class="o">=</span><span class="n">is_last_step</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">transformed_steps</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>



<div class="doc doc-object doc-function">




<h2 id="numerblox.meta.make_meta_pipeline" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">make_meta_pipeline</span><span class="p">(</span><span class="o">*</span><span class="n">steps</span><span class="p">,</span> <span class="n">memory</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Convenience function for creating a MetaPipeline. 
:param steps: List of (name, transform) tuples (implementing fit/transform) that are chained, in the order in which they are chained, with the last object an instance of BaseNeutralizer.
:param memory: Used to cache the fitted transformers of the pipeline.
:param verbose: If True, the time elapsed while fitting each step will be printed as it is completed.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/meta.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">make_meta_pipeline</span><span class="p">(</span><span class="o">*</span><span class="n">steps</span><span class="p">,</span> <span class="n">memory</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MetaPipeline</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">    Convenience function for creating a MetaPipeline. </span>
<span class="sd">    :param steps: List of (name, transform) tuples (implementing fit/transform) that are chained, in the order in which they are chained, with the last object an instance of BaseNeutralizer.</span>
<span class="sd">    :param memory: Used to cache the fitted transformers of the pipeline.</span>
<span class="sd">    :param verbose: If True, the time elapsed while fitting each step will be printed as it is completed.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">MetaPipeline</span><span class="p">(</span><span class="n">_name_estimators</span><span class="p">(</span><span class="n">steps</span><span class="p">),</span> <span class="n">memory</span><span class="o">=</span><span class="n">memory</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div><hr />


<div class="doc doc-object doc-module">



<a id="numerblox.neutralizers"></a>
  <div class="doc doc-contents first">

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">




<h2 id="numerblox.neutralizers.BaseNeutralizer" class="doc doc-heading">
          <code>BaseNeutralizer</code>


</h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><span title="sklearn.base.BaseEstimator">BaseEstimator</span></code>, <code><span title="sklearn.base.TransformerMixin">TransformerMixin</span></code></p>

  
      <p>Base class for neutralization so it is compatible with scikit-learn.
:param new_col_name: Name of new neutralized column.</p>

            <details class="quote">
              <summary>Source code in <code>numerblox/neutralizers.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">BaseNeutralizer</span><span class="p">(</span><span class="n">BaseEstimator</span><span class="p">,</span> <span class="n">TransformerMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Base class for neutralization so it is compatible with scikit-learn.</span>
<span class="sd">    :param new_col_name: Name of new neutralized column.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_col_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">new_col_name</span> <span class="o">=</span> <span class="n">new_col_name</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">],</span> 
        <span class="n">features</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">eras</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
        <span class="o">...</span>

    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">features</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">eras</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Convenience function for scikit-learn compatibility. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="n">features</span><span class="p">,</span> <span class="n">eras</span><span class="o">=</span><span class="n">eras</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">fit_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">features</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">eras</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        Convenience function for scikit-learn compatibility.</span>
<span class="sd">        Needed because fit and transform except different arguments here.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="n">features</span><span class="p">,</span> <span class="n">eras</span><span class="o">=</span><span class="n">eras</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">],</span>
        <span class="n">features</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">eras</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="n">features</span><span class="p">,</span> <span class="n">eras</span><span class="o">=</span><span class="n">eras</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_feature_names_out</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_features</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        Get feature names for neutralized output.</span>

<span class="sd">        :param input_features: Optional list of input feature names.</span>
<span class="sd">        :return: List of feature names for neutralized output.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">input_features</span> <span class="k">if</span> <span class="n">input_features</span> <span class="k">else</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">new_col_name</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">




<h3 id="numerblox.neutralizers.BaseNeutralizer.fit_transform" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">features</span><span class="p">,</span> <span class="n">eras</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Convenience function for scikit-learn compatibility.
Needed because fit and transform except different arguments here.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/neutralizers.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">fit_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">features</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">eras</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">    Convenience function for scikit-learn compatibility.</span>
<span class="sd">    Needed because fit and transform except different arguments here.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="n">features</span><span class="p">,</span> <span class="n">eras</span><span class="o">=</span><span class="n">eras</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="numerblox.neutralizers.BaseNeutralizer.get_feature_names_out" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_feature_names_out</span><span class="p">(</span><span class="n">input_features</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Get feature names for neutralized output.</p>
<p>:param input_features: Optional list of input feature names.
:return: List of feature names for neutralized output.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/neutralizers.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_feature_names_out</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_features</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">    Get feature names for neutralized output.</span>

<span class="sd">    :param input_features: Optional list of input feature names.</span>
<span class="sd">    :return: List of feature names for neutralized output.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">input_features</span> <span class="k">if</span> <span class="n">input_features</span> <span class="k">else</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">new_col_name</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="numerblox.neutralizers.BaseNeutralizer.predict" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">features</span><span class="p">,</span> <span class="n">eras</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Convenience function for scikit-learn compatibility.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/neutralizers.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">features</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">eras</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Convenience function for scikit-learn compatibility. &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="n">features</span><span class="p">,</span> <span class="n">eras</span><span class="o">=</span><span class="n">eras</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">




<h2 id="numerblox.neutralizers.FeatureNeutralizer" class="doc doc-heading">
          <code>FeatureNeutralizer</code>


</h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="numerblox.neutralizers.BaseNeutralizer" href="#numerblox.neutralizers.BaseNeutralizer">BaseNeutralizer</a></code></p>

  
      <p>Classic feature neutralization by subtracting a linear model.</p>
<p>:param pred_name: Name of prediction column. For creating the new column name. </p>
<p>:param proportion: Number in range [0...1] indicating how much to neutralize. </p>
<p>:param suffix: Optional suffix that is added to new column name. </p>
<p>:param cuda: Do neutralization on the GPU </p>
<p>Make sure you have CuPy installed when setting cuda to True. </p>
<p>Installation docs: docs.cupy.dev/en/stable/install.html</p>

            <details class="quote">
              <summary>Source code in <code>numerblox/neutralizers.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">FeatureNeutralizer</span><span class="p">(</span><span class="n">BaseNeutralizer</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Classic feature neutralization by subtracting a linear model.</span>

<span class="sd">    :param pred_name: Name of prediction column. For creating the new column name. \n</span>
<span class="sd">    :param proportion: Number in range [0...1] indicating how much to neutralize. \n</span>
<span class="sd">    :param suffix: Optional suffix that is added to new column name. \n</span>
<span class="sd">    :param cuda: Do neutralization on the GPU \n</span>
<span class="sd">    Make sure you have CuPy installed when setting cuda to True. \n</span>
<span class="sd">    Installation docs: docs.cupy.dev/en/stable/install.html</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">pred_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;prediction&quot;</span><span class="p">,</span>
        <span class="n">proportion</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
        <span class="n">suffix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">cuda</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pred_name</span> <span class="o">=</span> <span class="n">pred_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">proportion</span> <span class="o">=</span> <span class="n">proportion</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="mf">0.0</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">proportion</span> <span class="o">&lt;=</span> <span class="mf">1.0</span>
        <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;&#39;proportion&#39; should be a float in range [0...1]. Got &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">proportion</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
        <span class="n">new_col_name</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">pred_name</span><span class="si">}</span><span class="s2">_neutralized_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">proportion</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">suffix</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">if</span> <span class="n">suffix</span>
            <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">pred_name</span><span class="si">}</span><span class="s2">_neutralized_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">proportion</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">new_col_name</span><span class="o">=</span><span class="n">new_col_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">suffix</span> <span class="o">=</span> <span class="n">suffix</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cuda</span> <span class="o">=</span> <span class="n">cuda</span>

    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">features</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">eras</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Main transform function.</span>
<span class="sd">        :param X: Input predictions to neutralize. \n</span>
<span class="sd">        :param features: DataFrame with features for neutralization. \n</span>
<span class="sd">        :param eras: Series with era labels for each row in features. \n</span>
<span class="sd">        Features, eras and the prediction column must all have the same length.</span>
<span class="sd">        :return: Neutralized predictions.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">features</span><span class="p">),</span> <span class="s2">&quot;Input predictions must have same length as features.&quot;</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">eras</span><span class="p">),</span> <span class="s2">&quot;Input predictions must have same length as eras.&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">features</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;prediction&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span>
        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;era&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">eras</span>
        <span class="n">neutralized_preds</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;era&quot;</span><span class="p">,</span> <span class="n">group_keys</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalize_and_neutralize</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;prediction&quot;</span><span class="p">],</span> <span class="nb">list</span><span class="p">(</span><span class="n">features</span><span class="o">.</span><span class="n">columns</span><span class="p">))</span>
        <span class="p">)</span>
        <span class="n">neutralized_preds</span> <span class="o">=</span> <span class="n">MinMaxScaler</span><span class="p">()</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span>
            <span class="n">neutralized_preds</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">neutralized_preds</span>

    <span class="k">def</span> <span class="nf">neutralize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">columns</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">by</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Neutralize on CPU. &quot;&quot;&quot;</span>
        <span class="n">scores</span> <span class="o">=</span> <span class="n">dataf</span><span class="p">[</span><span class="n">columns</span><span class="p">]</span>
        <span class="n">exposures</span> <span class="o">=</span> <span class="n">dataf</span><span class="p">[</span><span class="n">by</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="n">scores</span> <span class="o">=</span> <span class="n">scores</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">proportion</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_raw_exposures</span><span class="p">(</span><span class="n">exposures</span><span class="p">,</span> <span class="n">scores</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">scores</span> <span class="o">/</span> <span class="n">scores</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">neutralize_cuda</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">columns</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">by</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Neutralize on GPU. &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">cupy</span>
        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s2">&quot;CuPy not installed. Set cuda=False or install CuPy. Installation docs: docs.cupy.dev/en/stable/install.html&quot;</span><span class="p">)</span>
        <span class="n">scores</span> <span class="o">=</span> <span class="n">cupy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">dataf</span><span class="p">[</span><span class="n">columns</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
        <span class="n">exposures</span> <span class="o">=</span> <span class="n">cupy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">dataf</span><span class="p">[</span><span class="n">by</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
        <span class="n">scores</span> <span class="o">=</span> <span class="n">scores</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">proportion</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_raw_exposures_cuda</span><span class="p">(</span><span class="n">exposures</span><span class="p">,</span> <span class="n">scores</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cupy</span><span class="o">.</span><span class="n">asnumpy</span><span class="p">(</span><span class="n">scores</span> <span class="o">/</span> <span class="n">scores</span><span class="o">.</span><span class="n">std</span><span class="p">())</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">normalize</span><span class="p">(</span><span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="n">normalized_ranks</span> <span class="o">=</span> <span class="p">(</span><span class="n">dataf</span><span class="o">.</span><span class="n">rank</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;first&quot;</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">dataf</span><span class="p">)</span>
        <span class="c1"># Gaussianized</span>
        <span class="k">return</span> <span class="n">sp</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">normalized_ranks</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">normalize_and_neutralize</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">columns</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">by</span><span class="p">:</span> <span class="nb">list</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="n">dataf</span><span class="p">[</span><span class="n">columns</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="n">dataf</span><span class="p">[</span><span class="n">columns</span><span class="p">])</span>
        <span class="n">neutralization_func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">neutralize</span> <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">cuda</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">neutralize_cuda</span>
        <span class="n">dataf</span><span class="p">[</span><span class="n">columns</span><span class="p">]</span> <span class="o">=</span> <span class="n">neutralization_func</span><span class="p">(</span><span class="n">dataf</span><span class="p">,</span> <span class="n">columns</span><span class="p">,</span> <span class="n">by</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">dataf</span><span class="p">[</span><span class="n">columns</span><span class="p">]</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_get_raw_exposures</span><span class="p">(</span><span class="n">exposures</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">scores</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        Get raw feature exposures.</span>
<span class="sd">        Make sure predictions are normalized!</span>
<span class="sd">        :param exposures: Exposures for each era. </span>
<span class="sd">        :param scores: DataFrame with predictions.</span>
<span class="sd">        :return: Raw exposures for each era.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">exposures</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">pinv</span><span class="p">(</span><span class="n">exposures</span><span class="p">)</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">scores</span><span class="p">))</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_get_raw_exposures_cuda</span><span class="p">(</span><span class="n">exposures</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">scores</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        Get raw feature exposures.</span>
<span class="sd">        Make sure predictions are normalized!</span>
<span class="sd">        :param exposures: Exposures for each era. </span>
<span class="sd">        :param scores: DataFrame with predictions.</span>
<span class="sd">        :return: Raw exposures for each era.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">cupy</span>
        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s2">&quot;CuPy not installed. Set cuda=False or install CuPy. Installation docs: docs.cupy.dev/en/stable/install.html&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">exposures</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cupy</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">pinv</span><span class="p">(</span><span class="n">exposures</span><span class="p">)</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">scores</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">




<h3 id="numerblox.neutralizers.FeatureNeutralizer.neutralize" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">neutralize</span><span class="p">(</span><span class="n">dataf</span><span class="p">,</span> <span class="n">columns</span><span class="p">,</span> <span class="n">by</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Neutralize on CPU.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/neutralizers.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">neutralize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">columns</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">by</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Neutralize on CPU. &quot;&quot;&quot;</span>
    <span class="n">scores</span> <span class="o">=</span> <span class="n">dataf</span><span class="p">[</span><span class="n">columns</span><span class="p">]</span>
    <span class="n">exposures</span> <span class="o">=</span> <span class="n">dataf</span><span class="p">[</span><span class="n">by</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="n">scores</span> <span class="o">=</span> <span class="n">scores</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">proportion</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_raw_exposures</span><span class="p">(</span><span class="n">exposures</span><span class="p">,</span> <span class="n">scores</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">scores</span> <span class="o">/</span> <span class="n">scores</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="numerblox.neutralizers.FeatureNeutralizer.neutralize_cuda" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">neutralize_cuda</span><span class="p">(</span><span class="n">dataf</span><span class="p">,</span> <span class="n">columns</span><span class="p">,</span> <span class="n">by</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Neutralize on GPU.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/neutralizers.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">neutralize_cuda</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">columns</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">by</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Neutralize on GPU. &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">cupy</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s2">&quot;CuPy not installed. Set cuda=False or install CuPy. Installation docs: docs.cupy.dev/en/stable/install.html&quot;</span><span class="p">)</span>
    <span class="n">scores</span> <span class="o">=</span> <span class="n">cupy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">dataf</span><span class="p">[</span><span class="n">columns</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
    <span class="n">exposures</span> <span class="o">=</span> <span class="n">cupy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">dataf</span><span class="p">[</span><span class="n">by</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
    <span class="n">scores</span> <span class="o">=</span> <span class="n">scores</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">proportion</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_raw_exposures_cuda</span><span class="p">(</span><span class="n">exposures</span><span class="p">,</span> <span class="n">scores</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">cupy</span><span class="o">.</span><span class="n">asnumpy</span><span class="p">(</span><span class="n">scores</span> <span class="o">/</span> <span class="n">scores</span><span class="o">.</span><span class="n">std</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="numerblox.neutralizers.FeatureNeutralizer.transform" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">features</span><span class="p">,</span> <span class="n">eras</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Main transform function.
:param X: Input predictions to neutralize. </p>
<p>:param features: DataFrame with features for neutralization. </p>
<p>:param eras: Series with era labels for each row in features. </p>
<p>Features, eras and the prediction column must all have the same length.
:return: Neutralized predictions.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/neutralizers.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">features</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">eras</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Main transform function.</span>
<span class="sd">    :param X: Input predictions to neutralize. \n</span>
<span class="sd">    :param features: DataFrame with features for neutralization. \n</span>
<span class="sd">    :param eras: Series with era labels for each row in features. \n</span>
<span class="sd">    Features, eras and the prediction column must all have the same length.</span>
<span class="sd">    :return: Neutralized predictions.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">features</span><span class="p">),</span> <span class="s2">&quot;Input predictions must have same length as features.&quot;</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">eras</span><span class="p">),</span> <span class="s2">&quot;Input predictions must have same length as eras.&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">features</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;prediction&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;era&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">eras</span>
    <span class="n">neutralized_preds</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;era&quot;</span><span class="p">,</span> <span class="n">group_keys</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
        <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalize_and_neutralize</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;prediction&quot;</span><span class="p">],</span> <span class="nb">list</span><span class="p">(</span><span class="n">features</span><span class="o">.</span><span class="n">columns</span><span class="p">))</span>
    <span class="p">)</span>
    <span class="n">neutralized_preds</span> <span class="o">=</span> <span class="n">MinMaxScaler</span><span class="p">()</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span>
        <span class="n">neutralized_preds</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">neutralized_preds</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>




  </div>

  </div>

</div><hr />


<div class="doc doc-object doc-module">



<a id="numerblox.penalizers"></a>
  <div class="doc doc-contents first">

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">




<h2 id="numerblox.penalizers.BasePenalizer" class="doc doc-heading">
          <code>BasePenalizer</code>


</h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><span title="sklearn.base.BaseEstimator">BaseEstimator</span></code>, <code><span title="sklearn.base.TransformerMixin">TransformerMixin</span></code></p>

  
      <p>Base class for penalization so it is compatible with scikit-learn.
:param new_col_name: Name of new neutralized column.</p>

            <details class="quote">
              <summary>Source code in <code>numerblox/penalizers.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">BasePenalizer</span><span class="p">(</span><span class="n">BaseEstimator</span><span class="p">,</span> <span class="n">TransformerMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Base class for penalization so it is compatible with scikit-learn.</span>
<span class="sd">    :param new_col_name: Name of new neutralized column.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_col_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">new_col_name</span> <span class="o">=</span> <span class="n">new_col_name</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">],</span> 
        <span class="n">features</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">eras</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
        <span class="o">...</span>

    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">features</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">eras</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Convenience function for scikit-learn compatibility. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="n">features</span><span class="p">,</span> <span class="n">eras</span><span class="o">=</span><span class="n">eras</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">fit_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">features</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">eras</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        Convenience function for scikit-learn compatibility.</span>
<span class="sd">        Needed because fit and transform except different arguments here.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="n">features</span><span class="p">,</span> <span class="n">eras</span><span class="o">=</span><span class="n">eras</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">],</span>
        <span class="n">features</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">eras</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="n">features</span><span class="p">,</span> <span class="n">eras</span><span class="o">=</span><span class="n">eras</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_feature_names_out</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_features</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        Get feature names for neutralized output.</span>

<span class="sd">        :param input_features: Optional list of input feature names.</span>
<span class="sd">        :return: List of feature names for neutralized output.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">input_features</span> <span class="k">if</span> <span class="n">input_features</span> <span class="k">else</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">new_col_name</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">




<h3 id="numerblox.penalizers.BasePenalizer.fit_transform" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">features</span><span class="p">,</span> <span class="n">eras</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Convenience function for scikit-learn compatibility.
Needed because fit and transform except different arguments here.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/penalizers.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">fit_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">features</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">eras</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">    Convenience function for scikit-learn compatibility.</span>
<span class="sd">    Needed because fit and transform except different arguments here.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="n">features</span><span class="p">,</span> <span class="n">eras</span><span class="o">=</span><span class="n">eras</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="numerblox.penalizers.BasePenalizer.get_feature_names_out" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_feature_names_out</span><span class="p">(</span><span class="n">input_features</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Get feature names for neutralized output.</p>
<p>:param input_features: Optional list of input feature names.
:return: List of feature names for neutralized output.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/penalizers.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_feature_names_out</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_features</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">    Get feature names for neutralized output.</span>

<span class="sd">    :param input_features: Optional list of input feature names.</span>
<span class="sd">    :return: List of feature names for neutralized output.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">input_features</span> <span class="k">if</span> <span class="n">input_features</span> <span class="k">else</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">new_col_name</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="numerblox.penalizers.BasePenalizer.predict" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">features</span><span class="p">,</span> <span class="n">eras</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Convenience function for scikit-learn compatibility.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/penalizers.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">features</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">eras</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Convenience function for scikit-learn compatibility. &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="n">features</span><span class="p">,</span> <span class="n">eras</span><span class="o">=</span><span class="n">eras</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">




<h2 id="numerblox.penalizers.FeaturePenalizer" class="doc doc-heading">
          <code>FeaturePenalizer</code>


</h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="numerblox.penalizers.BasePenalizer" href="#numerblox.penalizers.BasePenalizer">BasePenalizer</a></code></p>

  
      <p>Feature penalization with TensorFlow.</p>
<p>Source (by jrb): https://github.com/jonrtaylor/twitch/blob/master/FE_Clipping_Script.ipynb</p>
<p>Source of first PyTorch implementation (by Michael Oliver / mdo): https://forum.numer.ai/t/model-diagnostics-feature-exposure/899/12</p>
<p>:param max_exposure: Number in range [0...1] indicating how much to reduce max feature exposure to.
:param pred_name: Prediction column name. Used for new column name. </p>
<p>:param suffix: Optional suffix that is added to new column name.</p>

            <details class="quote">
              <summary>Source code in <code>numerblox/penalizers.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">FeaturePenalizer</span><span class="p">(</span><span class="n">BasePenalizer</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Feature penalization with TensorFlow.</span>

<span class="sd">    Source (by jrb): https://github.com/jonrtaylor/twitch/blob/master/FE_Clipping_Script.ipynb</span>

<span class="sd">    Source of first PyTorch implementation (by Michael Oliver / mdo): https://forum.numer.ai/t/model-diagnostics-feature-exposure/899/12</span>

<span class="sd">    :param max_exposure: Number in range [0...1] indicating how much to reduce max feature exposure to.</span>
<span class="sd">    :param pred_name: Prediction column name. Used for new column name. \n</span>
<span class="sd">    :param suffix: Optional suffix that is added to new column name.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">max_exposure</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">pred_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;prediction&quot;</span><span class="p">,</span>
        <span class="n">suffix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_exposure</span> <span class="o">=</span> <span class="n">max_exposure</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pred_name</span> <span class="o">=</span> <span class="n">pred_name</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="mf">0.0</span> <span class="o">&lt;=</span> <span class="n">max_exposure</span> <span class="o">&lt;=</span> <span class="mf">1.0</span>
        <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;&#39;max_exposure&#39; should be a float in range [0...1]. Got &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">max_exposure</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
        <span class="n">new_col_name</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">pred_name</span><span class="si">}</span><span class="s2">_penalized_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">max_exposure</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">suffix</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">if</span> <span class="n">suffix</span>
            <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">pred_name</span><span class="si">}</span><span class="s2">_penalized_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">max_exposure</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">new_col_name</span><span class="o">=</span><span class="n">new_col_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">suffix</span> <span class="o">=</span> <span class="n">suffix</span>

    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">features</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">eras</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Main transform method.</span>
<span class="sd">        :param X: Input predictions to neutralize. </span>
<span class="sd">        :param features: DataFrame with features for neutralization. </span>
<span class="sd">        :param eras: Series with era labels for each row in features. </span>
<span class="sd">        Features, eras and the prediction column must all have the same length.</span>
<span class="sd">        :return: Penalized predictions.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">features</span><span class="p">),</span> <span class="s2">&quot;Input predictions must have same length as features.&quot;</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">eras</span><span class="p">),</span> <span class="s2">&quot;Input predictions must have same length as eras.&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">features</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;prediction&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span>
        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;era&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">eras</span>
        <span class="n">penalized_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reduce_all_exposures</span><span class="p">(</span>
            <span class="n">dataf</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pred_name</span><span class="p">,</span> <span class="n">neutralizers</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">features</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">penalized_data</span>

    <span class="k">def</span> <span class="nf">_reduce_all_exposures</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">column</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;prediction&quot;</span><span class="p">,</span>
        <span class="n">neutralizers</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">gaussianize</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="n">neutralized</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">era</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">dataf</span><span class="p">[</span><span class="s2">&quot;era&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()):</span>
            <span class="n">dataf_era</span> <span class="o">=</span> <span class="n">dataf</span><span class="p">[</span><span class="n">dataf</span><span class="p">[</span><span class="s2">&quot;era&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">era</span><span class="p">]</span>
            <span class="n">scores</span> <span class="o">=</span> <span class="n">dataf_era</span><span class="p">[[</span><span class="n">column</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span>
            <span class="n">exposure_values</span> <span class="o">=</span> <span class="n">dataf_era</span><span class="p">[</span><span class="n">neutralizers</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

            <span class="k">if</span> <span class="n">normalize</span><span class="p">:</span>
                <span class="n">scores2</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">scores</span><span class="o">.</span><span class="n">T</span><span class="p">:</span>
                    <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">rankdata</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;ordinal&quot;</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">gaussianize</span><span class="p">:</span>
                        <span class="n">x</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
                    <span class="n">scores2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
                <span class="n">scores</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">scores2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

            <span class="n">scores</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reduce_exposure</span><span class="p">(</span>
                <span class="n">scores</span><span class="p">,</span> <span class="n">exposure_values</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">neutralizers</span><span class="p">),</span> <span class="kc">None</span>
            <span class="p">)</span>

            <span class="n">scores</span> <span class="o">/=</span> <span class="n">tf</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">reduce_std</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span>
            <span class="n">scores</span> <span class="o">-=</span> <span class="n">tf</span><span class="o">.</span><span class="n">reduce_min</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span>
            <span class="n">scores</span> <span class="o">/=</span> <span class="n">tf</span><span class="o">.</span><span class="n">reduce_max</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span>
            <span class="n">neutralized</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scores</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span>

        <span class="n">predictions</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">neutralized</span><span class="p">),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="n">column</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="n">dataf</span><span class="o">.</span><span class="n">index</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">predictions</span>

    <span class="k">def</span> <span class="nf">_reduce_exposure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prediction</span><span class="p">,</span> <span class="n">features</span><span class="p">,</span> <span class="n">input_size</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Input</span><span class="p">(</span><span class="n">input_size</span><span class="p">),</span>
                <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">experimental</span><span class="o">.</span><span class="n">LinearModel</span><span class="p">(</span><span class="n">use_bias</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
            <span class="p">]</span>
        <span class="p">)</span>
        <span class="n">feats</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">features</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="n">pred</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">prediction</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">weights</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">optimizer</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">optimizers</span><span class="o">.</span><span class="n">Adamax</span><span class="p">()</span>
            <span class="n">start_exp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__exposures</span><span class="p">(</span><span class="n">feats</span><span class="p">,</span> <span class="n">pred</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">])</span>
            <span class="n">target_exps</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">clip_by_value</span><span class="p">(</span>
                <span class="n">start_exp</span><span class="p">,</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">max_exposure</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_exposure</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_train_loop</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">optimizer</span><span class="p">,</span> <span class="n">feats</span><span class="p">,</span> <span class="n">pred</span><span class="p">,</span> <span class="n">target_exps</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">model</span><span class="o">.</span><span class="n">set_weights</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pred</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">-</span> <span class="n">model</span><span class="p">(</span><span class="n">feats</span><span class="p">),</span> <span class="n">model</span><span class="o">.</span><span class="n">get_weights</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_train_loop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">optimizer</span><span class="p">,</span> <span class="n">feats</span><span class="p">,</span> <span class="n">pred</span><span class="p">,</span> <span class="n">target_exps</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000000</span><span class="p">):</span>
            <span class="n">loss</span><span class="p">,</span> <span class="n">grads</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__train_loop_body</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">feats</span><span class="p">,</span> <span class="n">pred</span><span class="p">,</span> <span class="n">target_exps</span><span class="p">)</span>
            <span class="n">optimizer</span><span class="o">.</span><span class="n">apply_gradients</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">grads</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">trainable_variables</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">loss</span> <span class="o">&lt;</span> <span class="mf">1e-7</span><span class="p">:</span>
                <span class="k">break</span>

    <span class="nd">@tf</span><span class="o">.</span><span class="n">function</span><span class="p">(</span><span class="n">experimental_relax_shapes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">__train_loop_body</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">feats</span><span class="p">,</span> <span class="n">pred</span><span class="p">,</span> <span class="n">target_exps</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">tf</span><span class="o">.</span><span class="n">GradientTape</span><span class="p">()</span> <span class="k">as</span> <span class="n">tape</span><span class="p">:</span>
            <span class="n">exps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__exposures</span><span class="p">(</span><span class="n">feats</span><span class="p">,</span> <span class="n">pred</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">-</span> <span class="n">model</span><span class="p">(</span><span class="n">feats</span><span class="p">,</span> <span class="n">training</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
            <span class="n">loss</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">reduce_sum</span><span class="p">(</span>
                <span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span><span class="n">exps</span><span class="p">)</span> <span class="o">-</span> <span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span><span class="n">target_exps</span><span class="p">))</span>
                <span class="o">+</span> <span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span><span class="o">-</span><span class="n">exps</span><span class="p">)</span> <span class="o">-</span> <span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span><span class="o">-</span><span class="n">target_exps</span><span class="p">))</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">loss</span><span class="p">,</span> <span class="n">tape</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="n">loss</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">trainable_variables</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="nd">@tf</span><span class="o">.</span><span class="n">function</span><span class="p">(</span><span class="n">experimental_relax_shapes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">experimental_compile</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">__exposures</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="n">tf</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">reduce_mean</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">/</span> <span class="n">tf</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">y</span> <span class="o">-</span> <span class="n">tf</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">reduce_mean</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">y</span> <span class="o">/</span> <span class="n">tf</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">tf</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">transpose_a</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">




<h3 id="numerblox.penalizers.FeaturePenalizer.transform" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">features</span><span class="p">,</span> <span class="n">eras</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Main transform method.
:param X: Input predictions to neutralize. 
:param features: DataFrame with features for neutralization. 
:param eras: Series with era labels for each row in features. 
Features, eras and the prediction column must all have the same length.
:return: Penalized predictions.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/penalizers.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">features</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">eras</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Main transform method.</span>
<span class="sd">    :param X: Input predictions to neutralize. </span>
<span class="sd">    :param features: DataFrame with features for neutralization. </span>
<span class="sd">    :param eras: Series with era labels for each row in features. </span>
<span class="sd">    Features, eras and the prediction column must all have the same length.</span>
<span class="sd">    :return: Penalized predictions.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">features</span><span class="p">),</span> <span class="s2">&quot;Input predictions must have same length as features.&quot;</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">eras</span><span class="p">),</span> <span class="s2">&quot;Input predictions must have same length as eras.&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">features</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;prediction&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;era&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">eras</span>
    <span class="n">penalized_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reduce_all_exposures</span><span class="p">(</span>
        <span class="n">dataf</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pred_name</span><span class="p">,</span> <span class="n">neutralizers</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">features</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">penalized_data</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>




  </div>

  </div>

</div><hr />


<div class="doc doc-object doc-module">



<a id="numerblox.prediction_loaders"></a>
  <div class="doc doc-contents first">

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">




<h2 id="numerblox.prediction_loaders.BasePredictionLoader" class="doc doc-heading">
          <code>BasePredictionLoader</code>


</h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><span title="sklearn.base.BaseEstimator">BaseEstimator</span></code>, <code><span title="sklearn.base.TransformerMixin">TransformerMixin</span></code></p>

  
      <p>Shared functionality for all Prediction Loaders.</p>

            <details class="quote">
              <summary>Source code in <code>numerblox/prediction_loaders.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">BasePredictionLoader</span><span class="p">(</span><span class="n">BaseEstimator</span><span class="p">,</span> <span class="n">TransformerMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Shared functionality for all Prediction Loaders. &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="o">...</span>

    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Return Predictions generated by model. &quot;&quot;&quot;</span>
        <span class="o">...</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">get_feature_names_out</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_features</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Return feature names. &quot;&quot;&quot;</span>
        <span class="o">...</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">




<h3 id="numerblox.prediction_loaders.BasePredictionLoader.get_feature_names_out" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_feature_names_out</span><span class="p">(</span><span class="n">input_features</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Return feature names.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/prediction_loaders.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="k">def</span> <span class="nf">get_feature_names_out</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_features</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Return feature names. &quot;&quot;&quot;</span>
    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="numerblox.prediction_loaders.BasePredictionLoader.transform" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Return Predictions generated by model.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/prediction_loaders.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Return Predictions generated by model. &quot;&quot;&quot;</span>
    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">




<h2 id="numerblox.prediction_loaders.ExamplePredictions" class="doc doc-heading">
          <code>ExamplePredictions</code>


</h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="numerblox.prediction_loaders.BasePredictionLoader" href="#numerblox.prediction_loaders.BasePredictionLoader">BasePredictionLoader</a></code></p>

  
      <p>Load example predictions.
:param file_name: File to download from NumerAPI.
By default this is example predictions for v4.2 data.
'v4.2/live_example_preds.parquet' by default. 
Example predictions in previous versions:
- v4.2. validation examples -&gt; "v4.2/validation_example_preds.parquet"
- v4.2. live benchmark models -&gt; "v4.2/live_benchmark_models.parquet"
- v4.2. validation benchmark models -&gt; "v4.2/validation_benchmark_models.parquet"
:param round_num: Optional round number. Downloads most recent round by default.</p>

            <details class="quote">
              <summary>Source code in <code>numerblox/prediction_loaders.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">ExamplePredictions</span><span class="p">(</span><span class="n">BasePredictionLoader</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Load example predictions.</span>
<span class="sd">    :param file_name: File to download from NumerAPI.</span>
<span class="sd">    By default this is example predictions for v4.2 data.</span>
<span class="sd">    &#39;v4.2/live_example_preds.parquet&#39; by default. </span>
<span class="sd">    Example predictions in previous versions:</span>
<span class="sd">    - v4.2. validation examples -&gt; &quot;v4.2/validation_example_preds.parquet&quot;</span>
<span class="sd">    - v4.2. live benchmark models -&gt; &quot;v4.2/live_benchmark_models.parquet&quot;</span>
<span class="sd">    - v4.2. validation benchmark models -&gt; &quot;v4.2/validation_benchmark_models.parquet&quot;</span>
<span class="sd">    :param round_num: Optional round number. Downloads most recent round by default.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;v4.2/live_example_preds.parquet&quot;</span><span class="p">,</span>
                 <span class="n">round_num</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_name</span> <span class="o">=</span> <span class="n">file_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">round_num</span> <span class="o">=</span> <span class="n">round_num</span>

    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Return example predictions. &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_download_example_preds</span><span class="p">()</span>
        <span class="n">example_preds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_example_preds</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">downloader</span><span class="o">.</span><span class="n">remove_base_directory</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">example_preds</span>

    <span class="k">def</span> <span class="nf">_download_example_preds</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">data_directory</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;example_predictions_loader_</span><span class="si">{</span><span class="n">uuid4</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">downloader</span> <span class="o">=</span> <span class="n">NumeraiClassicDownloader</span><span class="p">(</span><span class="n">directory_path</span><span class="o">=</span><span class="n">data_directory</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dest_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">downloader</span><span class="o">.</span><span class="n">dir</span><span class="p">)</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">file_name</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">downloader</span><span class="o">.</span><span class="n">download_single_dataset</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">file_name</span><span class="p">,</span>
                                                <span class="n">dest_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dest_path</span><span class="p">,</span>
                                                <span class="n">round_num</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">round_num</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_load_example_preds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dest_path</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_feature_names_out</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_features</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_name</span><span class="p">)</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">as_posix</span><span class="p">()]</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">input_features</span> <span class="k">else</span> <span class="n">input_features</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">




<h3 id="numerblox.prediction_loaders.ExamplePredictions.transform" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Return example predictions.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/prediction_loaders.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Return example predictions. &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_download_example_preds</span><span class="p">()</span>
    <span class="n">example_preds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_example_preds</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">downloader</span><span class="o">.</span><span class="n">remove_base_directory</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">example_preds</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>




  </div>

  </div>

</div><hr />


<div class="doc doc-object doc-module">



<a id="numerblox.evaluation"></a>
  <div class="doc doc-contents first">

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">




<h2 id="numerblox.evaluation.BaseEvaluator" class="doc doc-heading">
          <code>BaseEvaluator</code>


</h2>


  <div class="doc doc-contents ">

  
      <p>Evaluation functionality that is relevant for both
Numerai Classic and Numerai Signals.</p>
<p>Metrics include:
- Mean, Standard Deviation and Sharpe for era returns.
- Max drawdown.
- Annual Percentage Yield (APY).
- Correlation with example predictions.
- Max feature exposure: https://forum.numer.ai/t/model-diagnostics-feature-exposure/899.
- Feature Neutral Mean, Standard deviation and Sharpe: https://docs.numer.ai/tournament/feature-neutral-correlation.
- Smart Sharpe
- Exposure Dissimilarity: https://forum.numer.ai/t/true-contribution-details/5128/4.
- Autocorrelation (1st order).
- Calmar Ratio.
- Outperformance vs. Example predictions.
- Mean, Standard Deviation and Sharpe for TB200 (Buy top 200 stocks and sell bottom 200 stocks).
- Mean, Standard Deviation and Sharpe for TB500 (Buy top 500 stocks and sell bottom 500 stocks).
- Example Prediction Contribution (EPC)</p>
<p>:param era_col: Column name pointing to eras. </p>
<p>Most commonly "era" for Numerai Classic and "friday_date" for Numerai Signals. </p>
<p>:param fast_mode: Will skip compute intensive metrics if set to True,
namely max_exposure, feature neutral mean, TB200 and TB500.</p>
<p>Note that we calculate the sample standard deviation with ddof=0. 
It may differ slightly from the standard Pandas calculation, but 
is consistent with how NumPy computes standard deviation. 
More info: 
https://stackoverflow.com/questions/24984178/different-std-in-pandas-vs-numpy</p>

            <details class="quote">
              <summary>Source code in <code>numerblox/evaluation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">BaseEvaluator</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Evaluation functionality that is relevant for both</span>
<span class="sd">    Numerai Classic and Numerai Signals.</span>

<span class="sd">    Metrics include:</span>
<span class="sd">    - Mean, Standard Deviation and Sharpe for era returns.</span>
<span class="sd">    - Max drawdown.</span>
<span class="sd">    - Annual Percentage Yield (APY).</span>
<span class="sd">    - Correlation with example predictions.</span>
<span class="sd">    - Max feature exposure: https://forum.numer.ai/t/model-diagnostics-feature-exposure/899.</span>
<span class="sd">    - Feature Neutral Mean, Standard deviation and Sharpe: https://docs.numer.ai/tournament/feature-neutral-correlation.</span>
<span class="sd">    - Smart Sharpe</span>
<span class="sd">    - Exposure Dissimilarity: https://forum.numer.ai/t/true-contribution-details/5128/4.</span>
<span class="sd">    - Autocorrelation (1st order).</span>
<span class="sd">    - Calmar Ratio.</span>
<span class="sd">    - Outperformance vs. Example predictions.</span>
<span class="sd">    - Mean, Standard Deviation and Sharpe for TB200 (Buy top 200 stocks and sell bottom 200 stocks).</span>
<span class="sd">    - Mean, Standard Deviation and Sharpe for TB500 (Buy top 500 stocks and sell bottom 500 stocks).</span>
<span class="sd">    - Example Prediction Contribution (EPC)</span>

<span class="sd">    :param era_col: Column name pointing to eras. \n</span>
<span class="sd">    Most commonly &quot;era&quot; for Numerai Classic and &quot;friday_date&quot; for Numerai Signals. \n</span>
<span class="sd">    :param fast_mode: Will skip compute intensive metrics if set to True,</span>
<span class="sd">    namely max_exposure, feature neutral mean, TB200 and TB500.</span>

<span class="sd">    Note that we calculate the sample standard deviation with ddof=0. </span>
<span class="sd">    It may differ slightly from the standard Pandas calculation, but </span>
<span class="sd">    is consistent with how NumPy computes standard deviation. </span>
<span class="sd">    More info: </span>
<span class="sd">    https://stackoverflow.com/questions/24984178/different-std-in-pandas-vs-numpy</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">era_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;era&quot;</span><span class="p">,</span> <span class="n">fast_mode</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">era_col</span> <span class="o">=</span> <span class="n">era_col</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fast_mode</span> <span class="o">=</span> <span class="n">fast_mode</span>

    <span class="k">def</span> <span class="nf">full_evaluation</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">example_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">pred_cols</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;target&quot;</span><span class="p">,</span>
        <span class="n">benchmark_cols</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Perform evaluation for each prediction column in pred_cols.</span>
<span class="sd">        By default only the &quot;prediction&quot; column is evaluated.</span>
<span class="sd">        Evaluation is done against given target and example prediction column.</span>
<span class="sd">        :param dataf: DataFrame containing era_col, example_col, pred_cols, target_col and optional benchmark_cols.</span>
<span class="sd">        :param example_col: Example prediction column to calculate correlation with.</span>
<span class="sd">        :param pred_cols: List of prediction columns to calculate evaluation metrics for.</span>
<span class="sd">        :param target_col: Target column to evaluate against.</span>
<span class="sd">        :param benchmark_cols: Optional list of benchmark columns to calculate evaluation metrics for.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">era_col</span> <span class="ow">in</span> <span class="n">dataf</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Era column &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">era_col</span><span class="si">}</span><span class="s2">&#39; not found in DataFrame. Make sure to set the correct era_col.&quot;</span>
        <span class="k">for</span> <span class="n">pred_col</span> <span class="ow">in</span> <span class="n">pred_cols</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">pred_col</span> <span class="ow">in</span> <span class="n">dataf</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Prediction column &#39;</span><span class="si">{</span><span class="n">pred_col</span><span class="si">}</span><span class="s2">&#39; not found in DataFrame. Make sure to set the correct pred_cols.&quot;</span>
        <span class="k">assert</span> <span class="n">target_col</span> <span class="ow">in</span> <span class="n">dataf</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Target column &#39;</span><span class="si">{</span><span class="n">target_col</span><span class="si">}</span><span class="s2">&#39; not found in DataFrame. Make sure to set the correct target_col.&quot;</span>
        <span class="k">assert</span> <span class="n">example_col</span> <span class="ow">in</span> <span class="n">dataf</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Example column &#39;</span><span class="si">{</span><span class="n">example_col</span><span class="si">}</span><span class="s2">&#39; not found in DataFrame. Make sure to set the correct example_col.&quot;</span>
        <span class="k">if</span> <span class="n">benchmark_cols</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">benchmark_cols</span><span class="p">:</span>
                <span class="k">assert</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">dataf</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Benchmark column &#39;</span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s2">&#39; not found in DataFrame. Make sure to set the correct benchmark_cols.&quot;</span>

        <span class="n">val_stats</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
        <span class="n">feature_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">dataf</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">col</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;feature&quot;</span><span class="p">)]</span>
        <span class="n">cat_cols</span> <span class="o">=</span> <span class="n">dataf</span><span class="p">[</span><span class="n">feature_cols</span><span class="p">]</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;category&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">cat_cols</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;WARNING: Categorical features detected that cannot be used for neutralization. Removing columns: &#39;</span><span class="si">{</span><span class="n">cat_cols</span><span class="si">}</span><span class="s2">&#39; for evaluation.&quot;</span><span class="p">)</span>
            <span class="n">dataf</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">feature_cols</span><span class="p">]</span> <span class="o">=</span> <span class="n">dataf</span><span class="p">[</span><span class="n">feature_cols</span><span class="p">]</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">exclude</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;category&#39;</span><span class="p">])</span>
        <span class="n">dataf</span> <span class="o">=</span> <span class="n">dataf</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">pred_cols</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Evaluation: &quot;</span><span class="p">):</span>
            <span class="n">col_stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluation_one_col</span><span class="p">(</span>
                <span class="n">dataf</span><span class="o">=</span><span class="n">dataf</span><span class="p">,</span>
                <span class="n">pred_col</span><span class="o">=</span><span class="n">col</span><span class="p">,</span>
                <span class="n">feature_cols</span><span class="o">=</span><span class="n">feature_cols</span><span class="p">,</span>
                <span class="n">target_col</span><span class="o">=</span><span class="n">target_col</span><span class="p">,</span>
                <span class="n">example_col</span><span class="o">=</span><span class="n">example_col</span><span class="p">,</span>
                <span class="n">benchmark_cols</span><span class="o">=</span><span class="n">benchmark_cols</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">val_stats</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">val_stats</span><span class="p">,</span> <span class="n">col_stats</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">val_stats</span>

    <span class="k">def</span> <span class="nf">evaluation_one_col</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">feature_cols</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
        <span class="n">pred_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">example_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">benchmark_cols</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Perform evaluation for one prediction column</span>
<span class="sd">        against given target and example prediction column.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">col_stats</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
        <span class="n">col_stats</span><span class="p">[</span><span class="s2">&quot;target&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>
        <span class="c1"># Compute stats</span>
        <span class="n">val_corrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">per_era_corrs</span><span class="p">(</span>
            <span class="n">dataf</span><span class="o">=</span><span class="n">dataf</span><span class="p">,</span> <span class="n">pred_col</span><span class="o">=</span><span class="n">pred_col</span><span class="p">,</span> <span class="n">target_col</span><span class="o">=</span><span class="n">target_col</span>
        <span class="p">)</span>
        <span class="n">val_numerai_corrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">per_era_numerai_corrs</span><span class="p">(</span>
            <span class="n">dataf</span><span class="o">=</span><span class="n">dataf</span><span class="p">,</span> <span class="n">pred_col</span><span class="o">=</span><span class="n">pred_col</span><span class="p">,</span> <span class="n">target_col</span><span class="o">=</span><span class="n">target_col</span>
        <span class="p">)</span>
        <span class="n">val_example_corrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">per_era_numerai_corrs</span><span class="p">(</span>
            <span class="n">dataf</span><span class="o">=</span><span class="n">dataf</span><span class="p">,</span> <span class="n">pred_col</span><span class="o">=</span><span class="n">example_col</span><span class="p">,</span> <span class="n">target_col</span><span class="o">=</span><span class="n">target_col</span>
        <span class="p">)</span>
        <span class="n">mean</span><span class="p">,</span> <span class="n">std</span><span class="p">,</span> <span class="n">sharpe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean_std_sharpe</span><span class="p">(</span><span class="n">era_corrs</span><span class="o">=</span><span class="n">val_numerai_corrs</span><span class="p">)</span>
        <span class="n">smart_sharpe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">smart_sharpe</span><span class="p">(</span><span class="n">era_corrs</span><span class="o">=</span><span class="n">val_numerai_corrs</span><span class="p">)</span>
        <span class="n">legacy_mean</span><span class="p">,</span> <span class="n">legacy_std</span><span class="p">,</span> <span class="n">legacy_sharpe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean_std_sharpe</span><span class="p">(</span><span class="n">era_corrs</span><span class="o">=</span><span class="n">val_corrs</span><span class="p">)</span>
        <span class="n">max_drawdown</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_drawdown</span><span class="p">(</span><span class="n">era_corrs</span><span class="o">=</span><span class="n">val_numerai_corrs</span><span class="p">)</span>
        <span class="n">apy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apy</span><span class="p">(</span><span class="n">era_corrs</span><span class="o">=</span><span class="n">val_numerai_corrs</span><span class="p">)</span>
        <span class="c1"># Max. drawdown should have an additional minus because we use negative numbers for max. drawdown.</span>
        <span class="n">calmar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="k">if</span> <span class="n">max_drawdown</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">apy</span> <span class="o">/</span> <span class="o">-</span><span class="n">max_drawdown</span>
        <span class="n">autocorrelation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">autocorr1</span><span class="p">(</span><span class="n">val_numerai_corrs</span><span class="p">)</span>
        <span class="n">example_corr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cross_correlation</span><span class="p">(</span>
            <span class="n">dataf</span><span class="o">=</span><span class="n">dataf</span><span class="p">,</span> <span class="n">pred_col</span><span class="o">=</span><span class="n">pred_col</span><span class="p">,</span> <span class="n">other_col</span><span class="o">=</span><span class="n">example_col</span>
        <span class="p">)</span>
        <span class="n">example_mean</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">example_sharpe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean_std_sharpe</span><span class="p">(</span><span class="n">era_corrs</span><span class="o">=</span><span class="n">val_example_corrs</span><span class="p">)</span>
        <span class="n">example_smart_sharpe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">smart_sharpe</span><span class="p">(</span><span class="n">era_corrs</span><span class="o">=</span><span class="n">val_example_corrs</span><span class="p">)</span>
        <span class="n">legacy_epc_mean</span><span class="p">,</span> <span class="n">legacy_epc_std</span><span class="p">,</span> <span class="n">legacy_epc_sharpe</span><span class="p">,</span> <span class="n">legacy_epc_plus_corr_sharpe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_contribution</span><span class="p">(</span>
                <span class="n">dataf</span><span class="o">=</span><span class="n">dataf</span><span class="p">,</span> <span class="n">pred_col</span><span class="o">=</span><span class="n">pred_col</span><span class="p">,</span> <span class="n">target_col</span><span class="o">=</span><span class="n">target_col</span><span class="p">,</span>
                <span class="n">other_col</span><span class="o">=</span><span class="n">example_col</span>
            <span class="p">)</span>

        <span class="n">col_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pred_col</span><span class="p">,</span> <span class="s2">&quot;target&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">target_col</span>
        <span class="n">col_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pred_col</span><span class="p">,</span> <span class="s2">&quot;mean&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean</span>
        <span class="n">col_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pred_col</span><span class="p">,</span> <span class="s2">&quot;std&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">std</span>
        <span class="n">col_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pred_col</span><span class="p">,</span> <span class="s2">&quot;sharpe&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sharpe</span>
        <span class="n">col_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pred_col</span><span class="p">,</span> <span class="s2">&quot;smart_sharpe&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">smart_sharpe</span>
        <span class="n">col_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pred_col</span><span class="p">,</span> <span class="s2">&quot;max_drawdown&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">max_drawdown</span>
        <span class="n">col_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pred_col</span><span class="p">,</span> <span class="s2">&quot;apy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">apy</span>
        <span class="n">col_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pred_col</span><span class="p">,</span> <span class="s2">&quot;calmar_ratio&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">calmar</span>
        <span class="n">col_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pred_col</span><span class="p">,</span> <span class="s2">&quot;autocorrelation&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">autocorrelation</span>
        <span class="n">col_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pred_col</span><span class="p">,</span> <span class="s2">&quot;corr_with_example_preds&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">example_corr</span>
        <span class="n">col_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pred_col</span><span class="p">,</span> <span class="s2">&quot;mean_outperformance_vs_example_preds&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean</span> <span class="o">-</span> <span class="n">example_mean</span>
        <span class="n">col_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pred_col</span><span class="p">,</span> <span class="s2">&quot;sharpe_outperformance_vs_example_preds&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sharpe</span> <span class="o">-</span> <span class="n">example_sharpe</span>
        <span class="n">col_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pred_col</span><span class="p">,</span> <span class="s2">&quot;smart_sharpe_outperformance_vs_example_preds&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">smart_sharpe</span> <span class="o">-</span> <span class="n">example_smart_sharpe</span>
        <span class="n">col_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pred_col</span><span class="p">,</span> <span class="s2">&quot;legacy_mean&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">legacy_mean</span>
        <span class="n">col_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pred_col</span><span class="p">,</span> <span class="s2">&quot;legacy_std&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">legacy_std</span>
        <span class="n">col_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pred_col</span><span class="p">,</span> <span class="s2">&quot;legacy_sharpe&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">legacy_sharpe</span>
        <span class="n">col_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pred_col</span><span class="p">,</span> <span class="s2">&quot;legacy_epc_mean&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">legacy_epc_mean</span>
        <span class="n">col_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pred_col</span><span class="p">,</span> <span class="s2">&quot;legacy_epc_std&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">legacy_epc_std</span>
        <span class="n">col_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pred_col</span><span class="p">,</span> <span class="s2">&quot;legacy_epc_sharpe&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">legacy_epc_sharpe</span>
        <span class="n">col_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pred_col</span><span class="p">,</span> <span class="s2">&quot;legacy_epc_plus_corr_sharpe&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">legacy_epc_plus_corr_sharpe</span>

        <span class="k">if</span> <span class="n">benchmark_cols</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">bench_col</span> <span class="ow">in</span> <span class="n">benchmark_cols</span><span class="p">:</span>
                <span class="n">val_bench_corrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">per_era_numerai_corrs</span><span class="p">(</span>
                    <span class="n">dataf</span><span class="o">=</span><span class="n">dataf</span><span class="p">,</span> <span class="n">pred_col</span><span class="o">=</span><span class="n">bench_col</span><span class="p">,</span> <span class="n">target_col</span><span class="o">=</span><span class="n">target_col</span>
                <span class="p">)</span>
                <span class="n">bench_mean</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">bench_sharpe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean_std_sharpe</span><span class="p">(</span><span class="n">era_corrs</span><span class="o">=</span><span class="n">val_bench_corrs</span><span class="p">)</span>
                <span class="n">bench_smart_sharpe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">smart_sharpe</span><span class="p">(</span><span class="n">era_corrs</span><span class="o">=</span><span class="n">val_bench_corrs</span><span class="p">)</span>
                <span class="n">bench_corr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cross_correlation</span><span class="p">(</span>
                    <span class="n">dataf</span><span class="o">=</span><span class="n">dataf</span><span class="p">,</span> <span class="n">pred_col</span><span class="o">=</span><span class="n">bench_col</span><span class="p">,</span> <span class="n">other_col</span><span class="o">=</span><span class="n">bench_col</span>
                <span class="p">)</span>
                <span class="n">legacy_bmc_mean</span><span class="p">,</span> <span class="n">legacy_bmc_std</span><span class="p">,</span> <span class="n">legacy_bmc_sharpe</span><span class="p">,</span> <span class="n">legacy_bmc_plus_corr_sharpe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_contribution</span><span class="p">(</span>
                <span class="n">dataf</span><span class="o">=</span><span class="n">dataf</span><span class="p">,</span> <span class="n">pred_col</span><span class="o">=</span><span class="n">pred_col</span><span class="p">,</span> <span class="n">target_col</span><span class="o">=</span><span class="n">target_col</span><span class="p">,</span>
                <span class="n">other_col</span><span class="o">=</span><span class="n">bench_col</span>
            <span class="p">)</span>
                <span class="n">col_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pred_col</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;corr_with_</span><span class="si">{</span><span class="n">bench_col</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bench_corr</span>
                <span class="n">col_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pred_col</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;mean_outperformance_vs_</span><span class="si">{</span><span class="n">bench_col</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean</span> <span class="o">-</span> <span class="n">bench_mean</span>
                <span class="n">col_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pred_col</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;sharpe_outperformance_vs_</span><span class="si">{</span><span class="n">bench_col</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sharpe</span> <span class="o">-</span> <span class="n">bench_sharpe</span>
                <span class="n">col_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pred_col</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;smart_sharpe_outperformance_vs_</span><span class="si">{</span><span class="n">bench_col</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">smart_sharpe</span> <span class="o">-</span> <span class="n">bench_smart_sharpe</span>
                <span class="n">col_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pred_col</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;legacy_bmc_</span><span class="si">{</span><span class="n">bench_col</span><span class="si">}</span><span class="s2">_mean&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">legacy_bmc_mean</span>
                <span class="n">col_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pred_col</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;legacy_bmc_</span><span class="si">{</span><span class="n">bench_col</span><span class="si">}</span><span class="s2">_std&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">legacy_bmc_std</span>
                <span class="n">col_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pred_col</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;legacy_bmc_</span><span class="si">{</span><span class="n">bench_col</span><span class="si">}</span><span class="s2">_sharpe&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">legacy_bmc_sharpe</span>
                <span class="n">col_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pred_col</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;legacy_bmc_</span><span class="si">{</span><span class="n">bench_col</span><span class="si">}</span><span class="s2">_plus_corr_sharpe&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">legacy_bmc_plus_corr_sharpe</span>

        <span class="c1"># Compute intensive stats</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">fast_mode</span><span class="p">:</span>
            <span class="n">max_feature_exposure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_feature_exposure</span><span class="p">(</span>
                <span class="n">dataf</span><span class="o">=</span><span class="n">dataf</span><span class="p">,</span> <span class="n">feature_cols</span><span class="o">=</span><span class="n">feature_cols</span><span class="p">,</span>
                <span class="n">pred_col</span><span class="o">=</span><span class="n">pred_col</span>
            <span class="p">)</span>
            <span class="c1"># Using all features for plain FNC</span>
            <span class="n">fn_mean</span><span class="p">,</span> <span class="n">fn_std</span><span class="p">,</span> <span class="n">fn_sharpe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_neutral_mean_std_sharpe</span><span class="p">(</span>
                <span class="n">dataf</span><span class="o">=</span><span class="n">dataf</span><span class="p">,</span> <span class="n">pred_col</span><span class="o">=</span><span class="n">pred_col</span><span class="p">,</span> <span class="n">target_col</span><span class="o">=</span><span class="n">target_col</span><span class="p">,</span> <span class="n">feature_names</span><span class="o">=</span><span class="n">feature_cols</span>
            <span class="p">)</span>
            <span class="n">tb200_mean</span><span class="p">,</span> <span class="n">tb200_std</span><span class="p">,</span> <span class="n">tb200_sharpe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tbx_mean_std_sharpe</span><span class="p">(</span>
                <span class="n">dataf</span><span class="o">=</span><span class="n">dataf</span><span class="p">,</span> <span class="n">pred_col</span><span class="o">=</span><span class="n">pred_col</span><span class="p">,</span> <span class="n">target_col</span><span class="o">=</span><span class="n">target_col</span><span class="p">,</span> <span class="n">tb</span><span class="o">=</span><span class="mi">200</span>
            <span class="p">)</span>
            <span class="n">tb500_mean</span><span class="p">,</span> <span class="n">tb500_std</span><span class="p">,</span> <span class="n">tb500_sharpe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tbx_mean_std_sharpe</span><span class="p">(</span>
                <span class="n">dataf</span><span class="o">=</span><span class="n">dataf</span><span class="p">,</span> <span class="n">pred_col</span><span class="o">=</span><span class="n">pred_col</span><span class="p">,</span> <span class="n">target_col</span><span class="o">=</span><span class="n">target_col</span><span class="p">,</span> <span class="n">tb</span><span class="o">=</span><span class="mi">500</span>
            <span class="p">)</span>
            <span class="n">ex_diss</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exposure_dissimilarity</span><span class="p">(</span>
                <span class="n">dataf</span><span class="o">=</span><span class="n">dataf</span><span class="p">,</span> <span class="n">pred_col</span><span class="o">=</span><span class="n">pred_col</span><span class="p">,</span> <span class="n">example_col</span><span class="o">=</span><span class="n">example_col</span>
            <span class="p">)</span>

            <span class="n">col_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pred_col</span><span class="p">,</span> <span class="s2">&quot;max_feature_exposure&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">max_feature_exposure</span>
            <span class="n">col_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pred_col</span><span class="p">,</span> <span class="s2">&quot;feature_neutral_mean&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fn_mean</span>
            <span class="n">col_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pred_col</span><span class="p">,</span> <span class="s2">&quot;feature_neutral_std&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fn_std</span>
            <span class="n">col_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pred_col</span><span class="p">,</span> <span class="s2">&quot;feature_neutral_sharpe&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fn_sharpe</span>
            <span class="n">col_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pred_col</span><span class="p">,</span> <span class="s2">&quot;tb200_mean&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tb200_mean</span>
            <span class="n">col_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pred_col</span><span class="p">,</span> <span class="s2">&quot;tb200_std&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tb200_std</span>
            <span class="n">col_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pred_col</span><span class="p">,</span> <span class="s2">&quot;tb200_sharpe&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tb200_sharpe</span>
            <span class="n">col_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pred_col</span><span class="p">,</span> <span class="s2">&quot;tb500_mean&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tb500_mean</span>
            <span class="n">col_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pred_col</span><span class="p">,</span> <span class="s2">&quot;tb500_std&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tb500_std</span>
            <span class="n">col_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pred_col</span><span class="p">,</span> <span class="s2">&quot;tb500_sharpe&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tb500_sharpe</span>
            <span class="n">col_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pred_col</span><span class="p">,</span> <span class="s2">&quot;exposure_dissimilarity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ex_diss</span>
        <span class="k">return</span> <span class="n">col_stats</span>

    <span class="k">def</span> <span class="nf">per_era_corrs</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">pred_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Correlation between prediction and target for each era.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">dataf</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">era_col</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normalize_uniform</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">pred_col</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.5</span><span class="p">))</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span>
                <span class="n">d</span><span class="p">[</span><span class="n">target_col</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">per_era_numerai_corrs</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">pred_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Numerai Corr between prediction and target for each era.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">dataf</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">era_col</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">numerai_corr</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.5</span><span class="p">),</span> <span class="n">pred_col</span><span class="p">,</span> <span class="n">target_col</span><span class="p">)</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">mean_std_sharpe</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">era_corrs</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Average, standard deviation and Sharpe ratio for</span>
<span class="sd">        correlations per era.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mean</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">era_corrs</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
        <span class="n">std</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">era_corrs</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">ddof</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
        <span class="n">sharpe</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="k">if</span> <span class="n">std</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">mean</span> <span class="o">/</span> <span class="n">std</span>
        <span class="k">return</span> <span class="n">mean</span><span class="p">,</span> <span class="n">std</span><span class="p">,</span> <span class="n">sharpe</span>

    <span class="k">def</span> <span class="nf">numerai_corr</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">pred_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Computes &#39;Numerai Corr&#39; aka &#39;Corrv2&#39;.</span>
<span class="sd">        More info: https://forum.numer.ai/t/target-cyrus-new-primary-target/6303</span>

<span class="sd">        Assumes original target col as input (i.e. in [0, 1] range).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Rank and gaussianize predictions</span>
        <span class="n">ranked_preds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normalize_uniform</span><span class="p">(</span><span class="n">dataf</span><span class="p">[</span><span class="n">pred_col</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.5</span><span class="p">),</span> 
                                               <span class="n">method</span><span class="o">=</span><span class="s2">&quot;average&quot;</span><span class="p">)</span>
        <span class="n">gauss_ranked_preds</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">ranked_preds</span><span class="p">)</span>
        <span class="c1"># Center target from [0...1] to [-0.5...0.5] range</span>
        <span class="n">targets</span> <span class="o">=</span> <span class="n">dataf</span><span class="p">[</span><span class="n">target_col</span><span class="p">]</span>
        <span class="n">centered_target</span> <span class="o">=</span> <span class="n">targets</span> <span class="o">-</span> <span class="n">targets</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="c1"># Accentuate tails of predictions and targets</span>
        <span class="n">preds_p15</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">gauss_ranked_preds</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">gauss_ranked_preds</span><span class="p">)</span> <span class="o">**</span> <span class="mf">1.5</span>
        <span class="n">target_p15</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">centered_target</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">centered_target</span><span class="p">)</span> <span class="o">**</span> <span class="mf">1.5</span>
        <span class="c1"># Pearson correlation</span>
        <span class="n">corr</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">pearsonr</span><span class="p">(</span><span class="n">preds_p15</span><span class="p">,</span> <span class="n">target_p15</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">corr</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">max_drawdown</span><span class="p">(</span><span class="n">era_corrs</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Maximum drawdown per era.&quot;&quot;&quot;</span>
        <span class="c1"># Arbitrarily large window</span>
        <span class="n">rolling_max</span> <span class="o">=</span> <span class="p">(</span>
            <span class="p">(</span><span class="n">era_corrs</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">cumprod</span><span class="p">()</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="mi">9000</span><span class="p">,</span> <span class="n">min_periods</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="n">daily_value</span> <span class="o">=</span> <span class="p">(</span><span class="n">era_corrs</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">cumprod</span><span class="p">()</span>
        <span class="n">max_drawdown</span> <span class="o">=</span> <span class="o">-</span><span class="p">((</span><span class="n">rolling_max</span> <span class="o">-</span> <span class="n">daily_value</span><span class="p">)</span> <span class="o">/</span> <span class="n">rolling_max</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">max_drawdown</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">apy</span><span class="p">(</span><span class="n">era_corrs</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">stake_compounding_lag</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">4</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Annual percentage yield.</span>
<span class="sd">        :param era_corrs: Correlation scores by era</span>
<span class="sd">        :param stake_compounding_lag: Compounding lag for Numerai rounds (4 for Numerai Classic)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">payout_scores</span> <span class="o">=</span> <span class="n">era_corrs</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="o">-</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">)</span>
        <span class="n">payout_product</span> <span class="o">=</span> <span class="p">(</span><span class="n">payout_scores</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">prod</span><span class="p">()</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="n">payout_product</span> <span class="o">**</span> <span class="p">(</span>
                <span class="c1"># 52 weeks of compounding minus n for stake compounding lag</span>
                <span class="p">(</span><span class="mi">52</span> <span class="o">-</span> <span class="n">stake_compounding_lag</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">payout_scores</span><span class="p">))</span>
            <span class="o">-</span> <span class="mi">1</span>
        <span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>

    <span class="k">def</span> <span class="nf">cross_correlation</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">pred_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">other_col</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Corrv2 correlation with other predictions (like another model, example predictions or meta model prediction).</span>
<span class="sd">        :param dataf: DataFrame containing both pred_col and other_col.</span>
<span class="sd">        :param pred_col: Main Prediction.</span>
<span class="sd">        :param other_col: Other prediction column to calculate correlation with pred_col.</span>

<span class="sd">        :return: Correlation between Corrv2&#39;s of pred_col and other_col.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">per_era_numerai_corrs</span><span class="p">(</span>
            <span class="n">dataf</span><span class="o">=</span><span class="n">dataf</span><span class="p">,</span>
            <span class="n">pred_col</span><span class="o">=</span><span class="n">pred_col</span><span class="p">,</span>
            <span class="n">target_col</span><span class="o">=</span><span class="n">other_col</span><span class="p">,</span>
        <span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">max_feature_exposure</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> 
        <span class="n">feature_cols</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">pred_col</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Maximum exposure over all features.&quot;&quot;&quot;</span>
        <span class="n">max_per_era</span> <span class="o">=</span> <span class="n">dataf</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">era_col</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="n">d</span><span class="p">[</span><span class="n">feature_cols</span><span class="p">]</span><span class="o">.</span><span class="n">corrwith</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">pred_col</span><span class="p">])</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="n">max_feature_exposure</span> <span class="o">=</span> <span class="n">max_per_era</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">max_feature_exposure</span>

    <span class="k">def</span> <span class="nf">feature_neutral_mean_std_sharpe</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">pred_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">feature_names</span><span class="p">:</span> <span class="nb">list</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Feature neutralized mean performance.</span>
<span class="sd">        More info: https://docs.numer.ai/tournament/feature-neutral-correlation</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fn</span> <span class="o">=</span> <span class="n">FeatureNeutralizer</span><span class="p">(</span><span class="n">pred_name</span><span class="o">=</span><span class="n">pred_col</span><span class="p">,</span> <span class="n">proportion</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
        <span class="n">neutralized_preds</span> <span class="o">=</span> <span class="n">fn</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">dataf</span><span class="p">[</span><span class="n">pred_col</span><span class="p">],</span> <span class="n">features</span><span class="o">=</span><span class="n">dataf</span><span class="p">[</span><span class="n">feature_names</span><span class="p">],</span>
                               <span class="n">eras</span><span class="o">=</span><span class="n">dataf</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">era_col</span><span class="p">])</span>
        <span class="c1"># Construct new DataFrame with era col, target col and preds</span>
        <span class="n">neutralized_dataf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">era_col</span><span class="p">,</span> <span class="n">target_col</span><span class="p">,</span> <span class="n">pred_col</span><span class="p">])</span>
        <span class="n">neutralized_dataf</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">era_col</span><span class="p">]</span> <span class="o">=</span> <span class="n">dataf</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">era_col</span><span class="p">]</span>
        <span class="n">neutralized_dataf</span><span class="p">[</span><span class="n">target_col</span><span class="p">]</span> <span class="o">=</span> <span class="n">dataf</span><span class="p">[</span><span class="n">target_col</span><span class="p">]</span>
        <span class="n">neutralized_dataf</span><span class="p">[</span><span class="n">pred_col</span><span class="p">]</span> <span class="o">=</span> <span class="n">neutralized_preds</span>

        <span class="n">neutral_corrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">per_era_numerai_corrs</span><span class="p">(</span>
            <span class="n">dataf</span><span class="o">=</span><span class="n">neutralized_dataf</span><span class="p">,</span>
            <span class="n">pred_col</span><span class="o">=</span><span class="n">pred_col</span><span class="p">,</span>
            <span class="n">target_col</span><span class="o">=</span><span class="n">target_col</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">mean</span><span class="p">,</span> <span class="n">std</span><span class="p">,</span> <span class="n">sharpe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean_std_sharpe</span><span class="p">(</span><span class="n">era_corrs</span><span class="o">=</span><span class="n">neutral_corrs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">mean</span><span class="p">,</span> <span class="n">std</span><span class="p">,</span> <span class="n">sharpe</span>

    <span class="k">def</span> <span class="nf">tbx_mean_std_sharpe</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">pred_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">tb</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">200</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate Mean, Standard deviation and Sharpe ratio</span>
<span class="sd">        when we focus on the x top and x bottom predictions.</span>
<span class="sd">        :param tb: How many of top and bottom predictions to focus on.</span>
<span class="sd">        TB200 and TB500 are the most common situations.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tb_val_corrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_score_by_date</span><span class="p">(</span>
            <span class="n">dataf</span><span class="o">=</span><span class="n">dataf</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="n">pred_col</span><span class="p">],</span> <span class="n">target</span><span class="o">=</span><span class="n">target_col</span><span class="p">,</span> <span class="n">tb</span><span class="o">=</span><span class="n">tb</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean_std_sharpe</span><span class="p">(</span><span class="n">era_corrs</span><span class="o">=</span><span class="n">tb_val_corrs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">exposure_dissimilarity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">pred_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">example_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Model pattern of feature exposure to the example column.</span>
<span class="sd">        See TC details forum post: https://forum.numer.ai/t/true-contribution-details/5128/4</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">feature_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">dataf</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">col</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;feature&quot;</span><span class="p">)]</span>
        <span class="n">U</span> <span class="o">=</span> <span class="n">dataf</span><span class="p">[</span><span class="n">feature_cols</span><span class="p">]</span><span class="o">.</span><span class="n">corrwith</span><span class="p">(</span><span class="n">dataf</span><span class="p">[</span><span class="n">pred_col</span><span class="p">])</span><span class="o">.</span><span class="n">values</span>
        <span class="n">E</span> <span class="o">=</span> <span class="n">dataf</span><span class="p">[</span><span class="n">feature_cols</span><span class="p">]</span><span class="o">.</span><span class="n">corrwith</span><span class="p">(</span><span class="n">dataf</span><span class="p">[</span><span class="n">example_col</span><span class="p">])</span><span class="o">.</span><span class="n">values</span>

        <span class="n">denominator</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">E</span><span class="p">,</span> <span class="n">E</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">denominator</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">exp_dis</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">exp_dis</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">U</span><span class="p">,</span> <span class="n">E</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">E</span><span class="p">,</span> <span class="n">E</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">exp_dis</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_neutralize_series</span><span class="p">(</span><span class="n">series</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">by</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">proportion</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">:</span>
        <span class="n">scores</span> <span class="o">=</span> <span class="n">series</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">exposures</span> <span class="o">=</span> <span class="n">by</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c1"># This line makes series neutral to a constant column so that it&#39;s centered and for sure gets corr 0 with exposures</span>
        <span class="n">exposures</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span>
            <span class="p">(</span><span class="n">exposures</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">series</span><span class="p">)]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">exposures</span><span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="p">)</span>

        <span class="n">correction</span> <span class="o">=</span> <span class="n">proportion</span> <span class="o">*</span> <span class="p">(</span>
            <span class="n">exposures</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">lstsq</span><span class="p">(</span><span class="n">exposures</span><span class="p">,</span> <span class="n">scores</span><span class="p">,</span> <span class="n">rcond</span><span class="o">=</span><span class="kc">None</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        <span class="p">)</span>
        <span class="n">corrected_scores</span> <span class="o">=</span> <span class="n">scores</span> <span class="o">-</span> <span class="n">correction</span>
        <span class="n">neutralized</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">corrected_scores</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">index</span><span class="o">=</span><span class="n">series</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">neutralized</span>

    <span class="k">def</span> <span class="nf">_score_by_date</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">columns</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">tb</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get era correlation based on given TB (x top and bottom predictions).</span>
<span class="sd">        :param tb: How many of top and bottom predictions to focus on.</span>
<span class="sd">        TB200 is the most common situation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">unique_eras</span> <span class="o">=</span> <span class="n">dataf</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">era_col</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
        <span class="n">computed</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">unique_eras</span><span class="p">:</span>
            <span class="n">df_era</span> <span class="o">=</span> <span class="n">dataf</span><span class="p">[</span><span class="n">dataf</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">era_col</span><span class="p">]</span> <span class="o">==</span> <span class="n">u</span><span class="p">]</span>
            <span class="n">era_pred</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">df_era</span><span class="p">[</span><span class="n">columns</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
            <span class="n">era_target</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">df_era</span><span class="p">[</span><span class="n">target</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">tb</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">ccs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">corrcoef</span><span class="p">(</span><span class="n">era_target</span><span class="p">,</span> <span class="n">era_pred</span><span class="p">)[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">:]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">tbidx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">era_pred</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">tbidx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">tbidx</span><span class="p">[:,</span> <span class="p">:</span><span class="n">tb</span><span class="p">],</span> <span class="n">tbidx</span><span class="p">[:,</span> <span class="o">-</span><span class="n">tb</span><span class="p">:]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">ccs</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">corrcoef</span><span class="p">(</span><span class="n">era_target</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">pred</span><span class="p">[</span><span class="n">idx</span><span class="p">])[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">pred</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">tbidx</span><span class="p">,</span> <span class="n">era_pred</span><span class="p">)</span>
                <span class="p">]</span>
                <span class="n">ccs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ccs</span><span class="p">)</span>
            <span class="n">computed</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ccs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">computed</span><span class="p">),</span> <span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">dataf</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">era_col</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
        <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_normalize_uniform</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;first&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Normalize predictions uniformly using ranks.&quot;&quot;&quot;</span>
        <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">rank</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_feature_exposures_pearson</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">pred_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">feature_list</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">cpu_cores</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate feature exposures for each era using Pearson correlation.</span>

<span class="sd">        :param dataf: DataFrame containing predictions, features, and eras.</span>
<span class="sd">        :param pred_col: Prediction column to calculate feature exposures for.</span>
<span class="sd">        :param feature_list: List of feature columns in X.</span>
<span class="sd">        :param cpu_cores: Number of CPU cores to use for parallelization.</span>
<span class="sd">        :return: DataFrame with Pearson feature exposures by era for each feature.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="nf">calculate_era_pearson_exposure</span><span class="p">(</span><span class="n">era</span><span class="p">,</span> <span class="n">group</span><span class="p">,</span> <span class="n">feature_list</span><span class="p">,</span> <span class="n">pred_col_normalized</span><span class="p">):</span>
            <span class="n">data_matrix</span> <span class="o">=</span> <span class="n">group</span><span class="p">[</span><span class="n">feature_list</span> <span class="o">+</span> <span class="p">[</span><span class="n">pred_col_normalized</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span>
            <span class="n">correlations</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">corrcoef</span><span class="p">(</span><span class="n">data_matrix</span><span class="p">,</span> <span class="n">rowvar</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

            <span class="c1"># Get the correlations of all features with the predictions (which is the last column)</span>
            <span class="n">feature_correlations</span> <span class="o">=</span> <span class="n">correlations</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">era</span><span class="p">,</span> <span class="n">feature_correlations</span>

        <span class="n">normalized_ranks</span> <span class="o">=</span> <span class="p">(</span><span class="n">dataf</span><span class="p">[[</span><span class="n">pred_col</span><span class="p">]]</span><span class="o">.</span><span class="n">rank</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;first&quot;</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">dataf</span><span class="p">)</span>
        <span class="n">dataf</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">pred_col</span><span class="si">}</span><span class="s2">_normalized&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">normalized_ranks</span><span class="p">)</span>
        <span class="n">feature_exposure_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">dataf</span><span class="p">[</span><span class="s2">&quot;era&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">(),</span> <span class="n">columns</span><span class="o">=</span><span class="n">feature_list</span><span class="p">)</span>

        <span class="n">grouped_data</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">dataf</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;era&quot;</span><span class="p">))</span>

        <span class="n">results</span> <span class="o">=</span> <span class="n">Parallel</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=</span><span class="n">cpu_cores</span><span class="p">)(</span><span class="n">delayed</span><span class="p">(</span><span class="n">calculate_era_pearson_exposure</span><span class="p">)(</span><span class="n">era</span><span class="p">,</span> <span class="n">group</span><span class="p">,</span> <span class="n">feature_list</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">pred_col</span><span class="si">}</span><span class="s2">_normalized&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">era</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">grouped_data</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">era</span><span class="p">,</span> <span class="n">feature_correlations</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
            <span class="n">feature_exposure_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">era</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">feature_correlations</span>
        <span class="k">return</span> <span class="n">feature_exposure_data</span>

    <span class="k">def</span> <span class="nf">get_feature_exposures_corrv2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">pred_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">feature_list</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">cpu_cores</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate feature exposures for each era using &#39;Numerai Corr&#39;.</span>
<span class="sd">        Results will be similar to get_feature_exposures() but more accurate.</span>
<span class="sd">        This method will take longer to compute.</span>

<span class="sd">        :param dataf: DataFrame containing predictions, features, and eras.</span>
<span class="sd">        :param pred_col: Prediction column to calculate feature exposures for.</span>
<span class="sd">        :param feature_list: List of feature columns in X.</span>
<span class="sd">        :param cpu_cores: Number of CPU cores to use for parallelization.</span>
<span class="sd">        Default: -1 (all cores).</span>
<span class="sd">        :return: DataFrame with Corrv2 feature exposures by era for each feature.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="nf">calculate_era_feature_exposure</span><span class="p">(</span><span class="n">era</span><span class="p">,</span> <span class="n">group</span><span class="p">,</span> <span class="n">pred_col</span><span class="p">,</span> <span class="n">feature_list</span><span class="p">):</span>
            <span class="n">exposures</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">feature_list</span><span class="p">:</span>
                <span class="n">corr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">numerai_corr</span><span class="p">(</span><span class="n">group</span><span class="p">,</span> <span class="n">pred_col</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">pred_col</span><span class="si">}</span><span class="s2">_normalized&quot;</span><span class="p">,</span> <span class="n">target_col</span><span class="o">=</span><span class="n">feature</span><span class="p">)</span>
                <span class="n">exposures</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span> <span class="o">=</span> <span class="n">corr</span>
            <span class="k">return</span> <span class="n">era</span><span class="p">,</span> <span class="n">exposures</span>

        <span class="n">normalized_ranks</span> <span class="o">=</span> <span class="p">(</span><span class="n">dataf</span><span class="p">[[</span><span class="n">pred_col</span><span class="p">]]</span><span class="o">.</span><span class="n">rank</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;first&quot;</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">dataf</span><span class="p">)</span>
        <span class="n">dataf</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">pred_col</span><span class="si">}</span><span class="s2">_normalized&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">normalized_ranks</span><span class="p">)</span>
        <span class="n">feature_exposure_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">dataf</span><span class="p">[</span><span class="s2">&quot;era&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">(),</span> <span class="n">columns</span><span class="o">=</span><span class="n">feature_list</span><span class="p">)</span>

        <span class="n">grouped_data</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">dataf</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;era&quot;</span><span class="p">))</span>

        <span class="n">results</span> <span class="o">=</span> <span class="n">Parallel</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=</span><span class="n">cpu_cores</span><span class="p">)(</span><span class="n">delayed</span><span class="p">(</span><span class="n">calculate_era_feature_exposure</span><span class="p">)(</span><span class="n">era</span><span class="p">,</span> <span class="n">group</span><span class="p">,</span> <span class="n">pred_col</span><span class="p">,</span> <span class="n">feature_list</span><span class="p">)</span> <span class="k">for</span> <span class="n">era</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">grouped_data</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">era</span><span class="p">,</span> <span class="n">exposures</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
            <span class="n">feature_exposure_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">era</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">exposures</span>
        <span class="k">return</span> <span class="n">feature_exposure_data</span>

    <span class="k">def</span> <span class="nf">smart_sharpe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">era_corrs</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        Sharpe adjusted for autocorrelation.</span>
<span class="sd">        :param era_corrs: Correlation scores by era</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">era_corrs</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">era_corrs</span><span class="p">,</span> <span class="n">ddof</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">autocorr_penalty</span><span class="p">(</span><span class="n">era_corrs</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">autocorr_penalty</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">era_corrs</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        Adjusting factor for autocorrelation. Used in Smart Sharpe.</span>
<span class="sd">        :param era_corrs: Correlation scores by era.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">era_corrs</span><span class="p">)</span>
        <span class="c1"># 1st order autocorrelation</span>
        <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">autocorr1</span><span class="p">(</span><span class="n">era_corrs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([((</span><span class="n">n</span> <span class="o">-</span> <span class="n">i</span><span class="p">)</span> <span class="o">/</span> <span class="n">n</span><span class="p">)</span> <span class="o">*</span> <span class="n">p</span><span class="o">**</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">)]))</span>

    <span class="k">def</span> <span class="nf">autocorr1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">era_corrs</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        1st order autocorrelation.</span>
<span class="sd">        :param era_corrs: Correlation scores by era.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">corrcoef</span><span class="p">(</span><span class="n">era_corrs</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">era_corrs</span><span class="p">[</span><span class="mi">1</span><span class="p">:])[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">model_contribution</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">pred_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
        <span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">other_col</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Legacy contibution Mean, standard deviation and Sharpe ratio.</span>
<span class="sd">        More info: https://forum.numer.ai/t/mmc2-announcement/93</span>
<span class="sd">        if other_col == meta_model_col -&gt; MMC (Meta Model Contribution)</span>
<span class="sd">        if other_col == example_col -&gt; EPC (Example Prediction Contribution)</span>

<span class="sd">        :param dataf: DataFrame containing era_col, pred_col, target_col and other_col.</span>
<span class="sd">        :param pred_col: Prediction column to calculate MMC for.</span>
<span class="sd">        :param target_col: Target column to calculate MMC against.</span>
<span class="sd">        :param other_col: Meta model column containing predictions to neutralize against.</span>

<span class="sd">        :return: Tuple of contribution mean, standard deviation, Sharpe ratio </span>
<span class="sd">        and Sharpe ratio of contribution + (Pearson) correlation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mmc_scores</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">corr_scores</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># Standard deviation of a uniform distribution</span>
        <span class="n">COVARIANCE_FACTOR</span> <span class="o">=</span> <span class="mf">0.29</span> <span class="o">**</span> <span class="mi">2</span>
        <span class="c1"># Calculate MMC for each era</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">dataf</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">era_col</span><span class="p">):</span>
            <span class="n">series</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_neutralize_series</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_normalize_uniform</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">pred_col</span><span class="p">]),</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">other_col</span><span class="p">])</span>
            <span class="p">)</span>
            <span class="n">mmc_scores</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cov</span><span class="p">(</span><span class="n">series</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="n">target_col</span><span class="p">])[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">COVARIANCE_FACTOR</span><span class="p">)</span>
            <span class="n">corr_scores</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_normalize_uniform</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">pred_col</span><span class="p">])</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">target_col</span><span class="p">]))</span>

        <span class="c1"># Contribution</span>
        <span class="n">c_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">mmc_scores</span><span class="p">)</span>
        <span class="n">c_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">mmc_scores</span><span class="p">)</span>
        <span class="n">c_sharpe</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="k">if</span> <span class="n">c_std</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">c_mean</span> <span class="o">/</span> <span class="n">c_std</span>

        <span class="c1"># MMC + Pearson correlation</span>
        <span class="n">corr_plus_cs</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="o">+</span> <span class="n">m</span> <span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">corr_scores</span><span class="p">,</span> <span class="n">mmc_scores</span><span class="p">)]</span>
        <span class="n">corr_plus_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">corr_plus_cs</span><span class="p">)</span>
        <span class="n">corr_plus_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">corr_plus_cs</span><span class="p">)</span>
        <span class="n">corr_plus_c_sharpe</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="k">if</span> <span class="n">corr_plus_std</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">corr_plus_mean</span> <span class="o">/</span> <span class="n">corr_plus_std</span>
        <span class="k">return</span> <span class="n">c_mean</span><span class="p">,</span> <span class="n">c_std</span><span class="p">,</span> <span class="n">c_sharpe</span><span class="p">,</span> <span class="n">corr_plus_c_sharpe</span>

    <span class="k">def</span> <span class="nf">plot_correlations</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">pred_cols</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">corr_cols</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;target&quot;</span><span class="p">,</span>
        <span class="n">roll_mean</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot per era correlations over time.</span>
<span class="sd">        :param dataf: DataFrame that contains at least all pred_cols, target_col and corr_cols.</span>
<span class="sd">        :param pred_cols: List of prediction columns to calculate per era correlations for and plot.</span>
<span class="sd">        :param corr_cols: Per era correlations already prepared to include in the plot.</span>
<span class="sd">        This is optional for if you already have per era correlations prepared in your input dataf.</span>
<span class="sd">        :param target_col: Target column name to compute per era correlations against.</span>
<span class="sd">        :param roll_mean: How many eras should be averaged to compute a rolling score.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">validation_by_eras</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
        <span class="c1"># Compute per era correlation for each prediction column.</span>
        <span class="k">for</span> <span class="n">pred_col</span> <span class="ow">in</span> <span class="n">pred_cols</span><span class="p">:</span>
            <span class="n">per_era_corrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">per_era_numerai_corrs</span><span class="p">(</span>
                <span class="n">dataf</span><span class="p">,</span> <span class="n">pred_col</span><span class="o">=</span><span class="n">pred_col</span><span class="p">,</span> <span class="n">target_col</span><span class="o">=</span><span class="n">target_col</span>
            <span class="p">)</span>
            <span class="n">validation_by_eras</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">pred_col</span><span class="p">]</span> <span class="o">=</span> <span class="n">per_era_corrs</span>

        <span class="c1"># Add prepared per era correlation if any.</span>
        <span class="k">if</span> <span class="n">corr_cols</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">corr_col</span> <span class="ow">in</span> <span class="n">corr_cols</span><span class="p">:</span>
                <span class="n">validation_by_eras</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">corr_col</span><span class="p">]</span> <span class="o">=</span> <span class="n">dataf</span><span class="p">[</span><span class="n">corr_col</span><span class="p">]</span>

        <span class="n">validation_by_eras</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">roll_mean</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;line&quot;</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span>
            <span class="n">ms</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
            <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Rolling Per Era Correlation Mean (rolling window size: </span><span class="si">{</span><span class="n">roll_mean</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>
            <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span>
            <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper center&quot;</span><span class="p">,</span>
            <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.05</span><span class="p">),</span>
            <span class="n">fancybox</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">shadow</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">ncol</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="n">validation_by_eras</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Cumulative Sum of Era Correlations&quot;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span>
            <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper center&quot;</span><span class="p">,</span>
            <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.05</span><span class="p">),</span>
            <span class="n">fancybox</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">shadow</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">ncol</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">return</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">plot_correlation_heatmap</span><span class="p">(</span><span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">pred_cols</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>
        <span class="n">corr_matrix</span> <span class="o">=</span> <span class="n">dataf</span><span class="p">[</span><span class="n">pred_cols</span><span class="p">]</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">))</span>

        <span class="c1"># Create heatmap</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">corr_matrix</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;coolwarm&quot;</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>

        <span class="c1"># Add ticks and labels</span>
        <span class="n">ticks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">pred_cols</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">ticks</span><span class="p">,</span> <span class="n">pred_cols</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">ticks</span><span class="p">,</span> <span class="n">pred_cols</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">return</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">




<h3 id="numerblox.evaluation.BaseEvaluator.apy" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">apy</span><span class="p">(</span><span class="n">era_corrs</span><span class="p">,</span> <span class="n">stake_compounding_lag</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Annual percentage yield.
:param era_corrs: Correlation scores by era
:param stake_compounding_lag: Compounding lag for Numerai rounds (4 for Numerai Classic)</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/evaluation.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">apy</span><span class="p">(</span><span class="n">era_corrs</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">stake_compounding_lag</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">4</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Annual percentage yield.</span>
<span class="sd">    :param era_corrs: Correlation scores by era</span>
<span class="sd">    :param stake_compounding_lag: Compounding lag for Numerai rounds (4 for Numerai Classic)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">payout_scores</span> <span class="o">=</span> <span class="n">era_corrs</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="o">-</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">)</span>
    <span class="n">payout_product</span> <span class="o">=</span> <span class="p">(</span><span class="n">payout_scores</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">prod</span><span class="p">()</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="n">payout_product</span> <span class="o">**</span> <span class="p">(</span>
            <span class="c1"># 52 weeks of compounding minus n for stake compounding lag</span>
            <span class="p">(</span><span class="mi">52</span> <span class="o">-</span> <span class="n">stake_compounding_lag</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">payout_scores</span><span class="p">))</span>
        <span class="o">-</span> <span class="mi">1</span>
    <span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="numerblox.evaluation.BaseEvaluator.autocorr1" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">autocorr1</span><span class="p">(</span><span class="n">era_corrs</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>1st order autocorrelation.
:param era_corrs: Correlation scores by era.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/evaluation.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">autocorr1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">era_corrs</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">    1st order autocorrelation.</span>
<span class="sd">    :param era_corrs: Correlation scores by era.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">corrcoef</span><span class="p">(</span><span class="n">era_corrs</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">era_corrs</span><span class="p">[</span><span class="mi">1</span><span class="p">:])[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="numerblox.evaluation.BaseEvaluator.autocorr_penalty" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">autocorr_penalty</span><span class="p">(</span><span class="n">era_corrs</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Adjusting factor for autocorrelation. Used in Smart Sharpe.
:param era_corrs: Correlation scores by era.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/evaluation.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">autocorr_penalty</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">era_corrs</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">    Adjusting factor for autocorrelation. Used in Smart Sharpe.</span>
<span class="sd">    :param era_corrs: Correlation scores by era.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">era_corrs</span><span class="p">)</span>
    <span class="c1"># 1st order autocorrelation</span>
    <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">autocorr1</span><span class="p">(</span><span class="n">era_corrs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([((</span><span class="n">n</span> <span class="o">-</span> <span class="n">i</span><span class="p">)</span> <span class="o">/</span> <span class="n">n</span><span class="p">)</span> <span class="o">*</span> <span class="n">p</span><span class="o">**</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">)]))</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="numerblox.evaluation.BaseEvaluator.cross_correlation" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">cross_correlation</span><span class="p">(</span><span class="n">dataf</span><span class="p">,</span> <span class="n">pred_col</span><span class="p">,</span> <span class="n">other_col</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Corrv2 correlation with other predictions (like another model, example predictions or meta model prediction).
:param dataf: DataFrame containing both pred_col and other_col.
:param pred_col: Main Prediction.
:param other_col: Other prediction column to calculate correlation with pred_col.</p>
<p>:return: Correlation between Corrv2's of pred_col and other_col.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/evaluation.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">cross_correlation</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">pred_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">other_col</span><span class="p">:</span> <span class="nb">str</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Corrv2 correlation with other predictions (like another model, example predictions or meta model prediction).</span>
<span class="sd">    :param dataf: DataFrame containing both pred_col and other_col.</span>
<span class="sd">    :param pred_col: Main Prediction.</span>
<span class="sd">    :param other_col: Other prediction column to calculate correlation with pred_col.</span>

<span class="sd">    :return: Correlation between Corrv2&#39;s of pred_col and other_col.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">per_era_numerai_corrs</span><span class="p">(</span>
        <span class="n">dataf</span><span class="o">=</span><span class="n">dataf</span><span class="p">,</span>
        <span class="n">pred_col</span><span class="o">=</span><span class="n">pred_col</span><span class="p">,</span>
        <span class="n">target_col</span><span class="o">=</span><span class="n">other_col</span><span class="p">,</span>
    <span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="numerblox.evaluation.BaseEvaluator.evaluation_one_col" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">evaluation_one_col</span><span class="p">(</span><span class="n">dataf</span><span class="p">,</span> <span class="n">feature_cols</span><span class="p">,</span> <span class="n">pred_col</span><span class="p">,</span> <span class="n">target_col</span><span class="p">,</span> <span class="n">example_col</span><span class="p">,</span> <span class="n">benchmark_cols</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Perform evaluation for one prediction column
against given target and example prediction column.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/evaluation.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">evaluation_one_col</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">feature_cols</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
    <span class="n">pred_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">example_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">benchmark_cols</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Perform evaluation for one prediction column</span>
<span class="sd">    against given target and example prediction column.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">col_stats</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
    <span class="n">col_stats</span><span class="p">[</span><span class="s2">&quot;target&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>
    <span class="c1"># Compute stats</span>
    <span class="n">val_corrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">per_era_corrs</span><span class="p">(</span>
        <span class="n">dataf</span><span class="o">=</span><span class="n">dataf</span><span class="p">,</span> <span class="n">pred_col</span><span class="o">=</span><span class="n">pred_col</span><span class="p">,</span> <span class="n">target_col</span><span class="o">=</span><span class="n">target_col</span>
    <span class="p">)</span>
    <span class="n">val_numerai_corrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">per_era_numerai_corrs</span><span class="p">(</span>
        <span class="n">dataf</span><span class="o">=</span><span class="n">dataf</span><span class="p">,</span> <span class="n">pred_col</span><span class="o">=</span><span class="n">pred_col</span><span class="p">,</span> <span class="n">target_col</span><span class="o">=</span><span class="n">target_col</span>
    <span class="p">)</span>
    <span class="n">val_example_corrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">per_era_numerai_corrs</span><span class="p">(</span>
        <span class="n">dataf</span><span class="o">=</span><span class="n">dataf</span><span class="p">,</span> <span class="n">pred_col</span><span class="o">=</span><span class="n">example_col</span><span class="p">,</span> <span class="n">target_col</span><span class="o">=</span><span class="n">target_col</span>
    <span class="p">)</span>
    <span class="n">mean</span><span class="p">,</span> <span class="n">std</span><span class="p">,</span> <span class="n">sharpe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean_std_sharpe</span><span class="p">(</span><span class="n">era_corrs</span><span class="o">=</span><span class="n">val_numerai_corrs</span><span class="p">)</span>
    <span class="n">smart_sharpe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">smart_sharpe</span><span class="p">(</span><span class="n">era_corrs</span><span class="o">=</span><span class="n">val_numerai_corrs</span><span class="p">)</span>
    <span class="n">legacy_mean</span><span class="p">,</span> <span class="n">legacy_std</span><span class="p">,</span> <span class="n">legacy_sharpe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean_std_sharpe</span><span class="p">(</span><span class="n">era_corrs</span><span class="o">=</span><span class="n">val_corrs</span><span class="p">)</span>
    <span class="n">max_drawdown</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_drawdown</span><span class="p">(</span><span class="n">era_corrs</span><span class="o">=</span><span class="n">val_numerai_corrs</span><span class="p">)</span>
    <span class="n">apy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apy</span><span class="p">(</span><span class="n">era_corrs</span><span class="o">=</span><span class="n">val_numerai_corrs</span><span class="p">)</span>
    <span class="c1"># Max. drawdown should have an additional minus because we use negative numbers for max. drawdown.</span>
    <span class="n">calmar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="k">if</span> <span class="n">max_drawdown</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">apy</span> <span class="o">/</span> <span class="o">-</span><span class="n">max_drawdown</span>
    <span class="n">autocorrelation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">autocorr1</span><span class="p">(</span><span class="n">val_numerai_corrs</span><span class="p">)</span>
    <span class="n">example_corr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cross_correlation</span><span class="p">(</span>
        <span class="n">dataf</span><span class="o">=</span><span class="n">dataf</span><span class="p">,</span> <span class="n">pred_col</span><span class="o">=</span><span class="n">pred_col</span><span class="p">,</span> <span class="n">other_col</span><span class="o">=</span><span class="n">example_col</span>
    <span class="p">)</span>
    <span class="n">example_mean</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">example_sharpe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean_std_sharpe</span><span class="p">(</span><span class="n">era_corrs</span><span class="o">=</span><span class="n">val_example_corrs</span><span class="p">)</span>
    <span class="n">example_smart_sharpe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">smart_sharpe</span><span class="p">(</span><span class="n">era_corrs</span><span class="o">=</span><span class="n">val_example_corrs</span><span class="p">)</span>
    <span class="n">legacy_epc_mean</span><span class="p">,</span> <span class="n">legacy_epc_std</span><span class="p">,</span> <span class="n">legacy_epc_sharpe</span><span class="p">,</span> <span class="n">legacy_epc_plus_corr_sharpe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_contribution</span><span class="p">(</span>
            <span class="n">dataf</span><span class="o">=</span><span class="n">dataf</span><span class="p">,</span> <span class="n">pred_col</span><span class="o">=</span><span class="n">pred_col</span><span class="p">,</span> <span class="n">target_col</span><span class="o">=</span><span class="n">target_col</span><span class="p">,</span>
            <span class="n">other_col</span><span class="o">=</span><span class="n">example_col</span>
        <span class="p">)</span>

    <span class="n">col_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pred_col</span><span class="p">,</span> <span class="s2">&quot;target&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">target_col</span>
    <span class="n">col_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pred_col</span><span class="p">,</span> <span class="s2">&quot;mean&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean</span>
    <span class="n">col_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pred_col</span><span class="p">,</span> <span class="s2">&quot;std&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">std</span>
    <span class="n">col_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pred_col</span><span class="p">,</span> <span class="s2">&quot;sharpe&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sharpe</span>
    <span class="n">col_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pred_col</span><span class="p">,</span> <span class="s2">&quot;smart_sharpe&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">smart_sharpe</span>
    <span class="n">col_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pred_col</span><span class="p">,</span> <span class="s2">&quot;max_drawdown&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">max_drawdown</span>
    <span class="n">col_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pred_col</span><span class="p">,</span> <span class="s2">&quot;apy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">apy</span>
    <span class="n">col_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pred_col</span><span class="p">,</span> <span class="s2">&quot;calmar_ratio&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">calmar</span>
    <span class="n">col_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pred_col</span><span class="p">,</span> <span class="s2">&quot;autocorrelation&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">autocorrelation</span>
    <span class="n">col_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pred_col</span><span class="p">,</span> <span class="s2">&quot;corr_with_example_preds&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">example_corr</span>
    <span class="n">col_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pred_col</span><span class="p">,</span> <span class="s2">&quot;mean_outperformance_vs_example_preds&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean</span> <span class="o">-</span> <span class="n">example_mean</span>
    <span class="n">col_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pred_col</span><span class="p">,</span> <span class="s2">&quot;sharpe_outperformance_vs_example_preds&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sharpe</span> <span class="o">-</span> <span class="n">example_sharpe</span>
    <span class="n">col_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pred_col</span><span class="p">,</span> <span class="s2">&quot;smart_sharpe_outperformance_vs_example_preds&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">smart_sharpe</span> <span class="o">-</span> <span class="n">example_smart_sharpe</span>
    <span class="n">col_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pred_col</span><span class="p">,</span> <span class="s2">&quot;legacy_mean&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">legacy_mean</span>
    <span class="n">col_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pred_col</span><span class="p">,</span> <span class="s2">&quot;legacy_std&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">legacy_std</span>
    <span class="n">col_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pred_col</span><span class="p">,</span> <span class="s2">&quot;legacy_sharpe&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">legacy_sharpe</span>
    <span class="n">col_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pred_col</span><span class="p">,</span> <span class="s2">&quot;legacy_epc_mean&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">legacy_epc_mean</span>
    <span class="n">col_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pred_col</span><span class="p">,</span> <span class="s2">&quot;legacy_epc_std&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">legacy_epc_std</span>
    <span class="n">col_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pred_col</span><span class="p">,</span> <span class="s2">&quot;legacy_epc_sharpe&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">legacy_epc_sharpe</span>
    <span class="n">col_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pred_col</span><span class="p">,</span> <span class="s2">&quot;legacy_epc_plus_corr_sharpe&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">legacy_epc_plus_corr_sharpe</span>

    <span class="k">if</span> <span class="n">benchmark_cols</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">bench_col</span> <span class="ow">in</span> <span class="n">benchmark_cols</span><span class="p">:</span>
            <span class="n">val_bench_corrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">per_era_numerai_corrs</span><span class="p">(</span>
                <span class="n">dataf</span><span class="o">=</span><span class="n">dataf</span><span class="p">,</span> <span class="n">pred_col</span><span class="o">=</span><span class="n">bench_col</span><span class="p">,</span> <span class="n">target_col</span><span class="o">=</span><span class="n">target_col</span>
            <span class="p">)</span>
            <span class="n">bench_mean</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">bench_sharpe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean_std_sharpe</span><span class="p">(</span><span class="n">era_corrs</span><span class="o">=</span><span class="n">val_bench_corrs</span><span class="p">)</span>
            <span class="n">bench_smart_sharpe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">smart_sharpe</span><span class="p">(</span><span class="n">era_corrs</span><span class="o">=</span><span class="n">val_bench_corrs</span><span class="p">)</span>
            <span class="n">bench_corr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cross_correlation</span><span class="p">(</span>
                <span class="n">dataf</span><span class="o">=</span><span class="n">dataf</span><span class="p">,</span> <span class="n">pred_col</span><span class="o">=</span><span class="n">bench_col</span><span class="p">,</span> <span class="n">other_col</span><span class="o">=</span><span class="n">bench_col</span>
            <span class="p">)</span>
            <span class="n">legacy_bmc_mean</span><span class="p">,</span> <span class="n">legacy_bmc_std</span><span class="p">,</span> <span class="n">legacy_bmc_sharpe</span><span class="p">,</span> <span class="n">legacy_bmc_plus_corr_sharpe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_contribution</span><span class="p">(</span>
            <span class="n">dataf</span><span class="o">=</span><span class="n">dataf</span><span class="p">,</span> <span class="n">pred_col</span><span class="o">=</span><span class="n">pred_col</span><span class="p">,</span> <span class="n">target_col</span><span class="o">=</span><span class="n">target_col</span><span class="p">,</span>
            <span class="n">other_col</span><span class="o">=</span><span class="n">bench_col</span>
        <span class="p">)</span>
            <span class="n">col_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pred_col</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;corr_with_</span><span class="si">{</span><span class="n">bench_col</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bench_corr</span>
            <span class="n">col_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pred_col</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;mean_outperformance_vs_</span><span class="si">{</span><span class="n">bench_col</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean</span> <span class="o">-</span> <span class="n">bench_mean</span>
            <span class="n">col_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pred_col</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;sharpe_outperformance_vs_</span><span class="si">{</span><span class="n">bench_col</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sharpe</span> <span class="o">-</span> <span class="n">bench_sharpe</span>
            <span class="n">col_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pred_col</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;smart_sharpe_outperformance_vs_</span><span class="si">{</span><span class="n">bench_col</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">smart_sharpe</span> <span class="o">-</span> <span class="n">bench_smart_sharpe</span>
            <span class="n">col_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pred_col</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;legacy_bmc_</span><span class="si">{</span><span class="n">bench_col</span><span class="si">}</span><span class="s2">_mean&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">legacy_bmc_mean</span>
            <span class="n">col_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pred_col</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;legacy_bmc_</span><span class="si">{</span><span class="n">bench_col</span><span class="si">}</span><span class="s2">_std&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">legacy_bmc_std</span>
            <span class="n">col_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pred_col</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;legacy_bmc_</span><span class="si">{</span><span class="n">bench_col</span><span class="si">}</span><span class="s2">_sharpe&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">legacy_bmc_sharpe</span>
            <span class="n">col_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pred_col</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;legacy_bmc_</span><span class="si">{</span><span class="n">bench_col</span><span class="si">}</span><span class="s2">_plus_corr_sharpe&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">legacy_bmc_plus_corr_sharpe</span>

    <span class="c1"># Compute intensive stats</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">fast_mode</span><span class="p">:</span>
        <span class="n">max_feature_exposure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_feature_exposure</span><span class="p">(</span>
            <span class="n">dataf</span><span class="o">=</span><span class="n">dataf</span><span class="p">,</span> <span class="n">feature_cols</span><span class="o">=</span><span class="n">feature_cols</span><span class="p">,</span>
            <span class="n">pred_col</span><span class="o">=</span><span class="n">pred_col</span>
        <span class="p">)</span>
        <span class="c1"># Using all features for plain FNC</span>
        <span class="n">fn_mean</span><span class="p">,</span> <span class="n">fn_std</span><span class="p">,</span> <span class="n">fn_sharpe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_neutral_mean_std_sharpe</span><span class="p">(</span>
            <span class="n">dataf</span><span class="o">=</span><span class="n">dataf</span><span class="p">,</span> <span class="n">pred_col</span><span class="o">=</span><span class="n">pred_col</span><span class="p">,</span> <span class="n">target_col</span><span class="o">=</span><span class="n">target_col</span><span class="p">,</span> <span class="n">feature_names</span><span class="o">=</span><span class="n">feature_cols</span>
        <span class="p">)</span>
        <span class="n">tb200_mean</span><span class="p">,</span> <span class="n">tb200_std</span><span class="p">,</span> <span class="n">tb200_sharpe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tbx_mean_std_sharpe</span><span class="p">(</span>
            <span class="n">dataf</span><span class="o">=</span><span class="n">dataf</span><span class="p">,</span> <span class="n">pred_col</span><span class="o">=</span><span class="n">pred_col</span><span class="p">,</span> <span class="n">target_col</span><span class="o">=</span><span class="n">target_col</span><span class="p">,</span> <span class="n">tb</span><span class="o">=</span><span class="mi">200</span>
        <span class="p">)</span>
        <span class="n">tb500_mean</span><span class="p">,</span> <span class="n">tb500_std</span><span class="p">,</span> <span class="n">tb500_sharpe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tbx_mean_std_sharpe</span><span class="p">(</span>
            <span class="n">dataf</span><span class="o">=</span><span class="n">dataf</span><span class="p">,</span> <span class="n">pred_col</span><span class="o">=</span><span class="n">pred_col</span><span class="p">,</span> <span class="n">target_col</span><span class="o">=</span><span class="n">target_col</span><span class="p">,</span> <span class="n">tb</span><span class="o">=</span><span class="mi">500</span>
        <span class="p">)</span>
        <span class="n">ex_diss</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exposure_dissimilarity</span><span class="p">(</span>
            <span class="n">dataf</span><span class="o">=</span><span class="n">dataf</span><span class="p">,</span> <span class="n">pred_col</span><span class="o">=</span><span class="n">pred_col</span><span class="p">,</span> <span class="n">example_col</span><span class="o">=</span><span class="n">example_col</span>
        <span class="p">)</span>

        <span class="n">col_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pred_col</span><span class="p">,</span> <span class="s2">&quot;max_feature_exposure&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">max_feature_exposure</span>
        <span class="n">col_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pred_col</span><span class="p">,</span> <span class="s2">&quot;feature_neutral_mean&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fn_mean</span>
        <span class="n">col_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pred_col</span><span class="p">,</span> <span class="s2">&quot;feature_neutral_std&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fn_std</span>
        <span class="n">col_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pred_col</span><span class="p">,</span> <span class="s2">&quot;feature_neutral_sharpe&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fn_sharpe</span>
        <span class="n">col_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pred_col</span><span class="p">,</span> <span class="s2">&quot;tb200_mean&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tb200_mean</span>
        <span class="n">col_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pred_col</span><span class="p">,</span> <span class="s2">&quot;tb200_std&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tb200_std</span>
        <span class="n">col_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pred_col</span><span class="p">,</span> <span class="s2">&quot;tb200_sharpe&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tb200_sharpe</span>
        <span class="n">col_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pred_col</span><span class="p">,</span> <span class="s2">&quot;tb500_mean&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tb500_mean</span>
        <span class="n">col_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pred_col</span><span class="p">,</span> <span class="s2">&quot;tb500_std&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tb500_std</span>
        <span class="n">col_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pred_col</span><span class="p">,</span> <span class="s2">&quot;tb500_sharpe&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tb500_sharpe</span>
        <span class="n">col_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pred_col</span><span class="p">,</span> <span class="s2">&quot;exposure_dissimilarity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ex_diss</span>
    <span class="k">return</span> <span class="n">col_stats</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="numerblox.evaluation.BaseEvaluator.exposure_dissimilarity" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">exposure_dissimilarity</span><span class="p">(</span><span class="n">dataf</span><span class="p">,</span> <span class="n">pred_col</span><span class="p">,</span> <span class="n">example_col</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Model pattern of feature exposure to the example column.
See TC details forum post: https://forum.numer.ai/t/true-contribution-details/5128/4</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/evaluation.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">exposure_dissimilarity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">pred_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">example_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Model pattern of feature exposure to the example column.</span>
<span class="sd">    See TC details forum post: https://forum.numer.ai/t/true-contribution-details/5128/4</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">feature_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">dataf</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">col</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;feature&quot;</span><span class="p">)]</span>
    <span class="n">U</span> <span class="o">=</span> <span class="n">dataf</span><span class="p">[</span><span class="n">feature_cols</span><span class="p">]</span><span class="o">.</span><span class="n">corrwith</span><span class="p">(</span><span class="n">dataf</span><span class="p">[</span><span class="n">pred_col</span><span class="p">])</span><span class="o">.</span><span class="n">values</span>
    <span class="n">E</span> <span class="o">=</span> <span class="n">dataf</span><span class="p">[</span><span class="n">feature_cols</span><span class="p">]</span><span class="o">.</span><span class="n">corrwith</span><span class="p">(</span><span class="n">dataf</span><span class="p">[</span><span class="n">example_col</span><span class="p">])</span><span class="o">.</span><span class="n">values</span>

    <span class="n">denominator</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">E</span><span class="p">,</span> <span class="n">E</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">denominator</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">exp_dis</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">exp_dis</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">U</span><span class="p">,</span> <span class="n">E</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">E</span><span class="p">,</span> <span class="n">E</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">exp_dis</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="numerblox.evaluation.BaseEvaluator.feature_neutral_mean_std_sharpe" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">feature_neutral_mean_std_sharpe</span><span class="p">(</span><span class="n">dataf</span><span class="p">,</span> <span class="n">pred_col</span><span class="p">,</span> <span class="n">target_col</span><span class="p">,</span> <span class="n">feature_names</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Feature neutralized mean performance.
More info: https://docs.numer.ai/tournament/feature-neutral-correlation</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/evaluation.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">feature_neutral_mean_std_sharpe</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">pred_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">feature_names</span><span class="p">:</span> <span class="nb">list</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Feature neutralized mean performance.</span>
<span class="sd">    More info: https://docs.numer.ai/tournament/feature-neutral-correlation</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fn</span> <span class="o">=</span> <span class="n">FeatureNeutralizer</span><span class="p">(</span><span class="n">pred_name</span><span class="o">=</span><span class="n">pred_col</span><span class="p">,</span> <span class="n">proportion</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
    <span class="n">neutralized_preds</span> <span class="o">=</span> <span class="n">fn</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">dataf</span><span class="p">[</span><span class="n">pred_col</span><span class="p">],</span> <span class="n">features</span><span class="o">=</span><span class="n">dataf</span><span class="p">[</span><span class="n">feature_names</span><span class="p">],</span>
                           <span class="n">eras</span><span class="o">=</span><span class="n">dataf</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">era_col</span><span class="p">])</span>
    <span class="c1"># Construct new DataFrame with era col, target col and preds</span>
    <span class="n">neutralized_dataf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">era_col</span><span class="p">,</span> <span class="n">target_col</span><span class="p">,</span> <span class="n">pred_col</span><span class="p">])</span>
    <span class="n">neutralized_dataf</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">era_col</span><span class="p">]</span> <span class="o">=</span> <span class="n">dataf</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">era_col</span><span class="p">]</span>
    <span class="n">neutralized_dataf</span><span class="p">[</span><span class="n">target_col</span><span class="p">]</span> <span class="o">=</span> <span class="n">dataf</span><span class="p">[</span><span class="n">target_col</span><span class="p">]</span>
    <span class="n">neutralized_dataf</span><span class="p">[</span><span class="n">pred_col</span><span class="p">]</span> <span class="o">=</span> <span class="n">neutralized_preds</span>

    <span class="n">neutral_corrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">per_era_numerai_corrs</span><span class="p">(</span>
        <span class="n">dataf</span><span class="o">=</span><span class="n">neutralized_dataf</span><span class="p">,</span>
        <span class="n">pred_col</span><span class="o">=</span><span class="n">pred_col</span><span class="p">,</span>
        <span class="n">target_col</span><span class="o">=</span><span class="n">target_col</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">mean</span><span class="p">,</span> <span class="n">std</span><span class="p">,</span> <span class="n">sharpe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean_std_sharpe</span><span class="p">(</span><span class="n">era_corrs</span><span class="o">=</span><span class="n">neutral_corrs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">mean</span><span class="p">,</span> <span class="n">std</span><span class="p">,</span> <span class="n">sharpe</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="numerblox.evaluation.BaseEvaluator.full_evaluation" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">full_evaluation</span><span class="p">(</span><span class="n">dataf</span><span class="p">,</span> <span class="n">example_col</span><span class="p">,</span> <span class="n">pred_cols</span><span class="p">,</span> <span class="n">target_col</span><span class="o">=</span><span class="s1">&#39;target&#39;</span><span class="p">,</span> <span class="n">benchmark_cols</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Perform evaluation for each prediction column in pred_cols.
By default only the "prediction" column is evaluated.
Evaluation is done against given target and example prediction column.
:param dataf: DataFrame containing era_col, example_col, pred_cols, target_col and optional benchmark_cols.
:param example_col: Example prediction column to calculate correlation with.
:param pred_cols: List of prediction columns to calculate evaluation metrics for.
:param target_col: Target column to evaluate against.
:param benchmark_cols: Optional list of benchmark columns to calculate evaluation metrics for.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/evaluation.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">full_evaluation</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">example_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">pred_cols</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;target&quot;</span><span class="p">,</span>
    <span class="n">benchmark_cols</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Perform evaluation for each prediction column in pred_cols.</span>
<span class="sd">    By default only the &quot;prediction&quot; column is evaluated.</span>
<span class="sd">    Evaluation is done against given target and example prediction column.</span>
<span class="sd">    :param dataf: DataFrame containing era_col, example_col, pred_cols, target_col and optional benchmark_cols.</span>
<span class="sd">    :param example_col: Example prediction column to calculate correlation with.</span>
<span class="sd">    :param pred_cols: List of prediction columns to calculate evaluation metrics for.</span>
<span class="sd">    :param target_col: Target column to evaluate against.</span>
<span class="sd">    :param benchmark_cols: Optional list of benchmark columns to calculate evaluation metrics for.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">era_col</span> <span class="ow">in</span> <span class="n">dataf</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Era column &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">era_col</span><span class="si">}</span><span class="s2">&#39; not found in DataFrame. Make sure to set the correct era_col.&quot;</span>
    <span class="k">for</span> <span class="n">pred_col</span> <span class="ow">in</span> <span class="n">pred_cols</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">pred_col</span> <span class="ow">in</span> <span class="n">dataf</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Prediction column &#39;</span><span class="si">{</span><span class="n">pred_col</span><span class="si">}</span><span class="s2">&#39; not found in DataFrame. Make sure to set the correct pred_cols.&quot;</span>
    <span class="k">assert</span> <span class="n">target_col</span> <span class="ow">in</span> <span class="n">dataf</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Target column &#39;</span><span class="si">{</span><span class="n">target_col</span><span class="si">}</span><span class="s2">&#39; not found in DataFrame. Make sure to set the correct target_col.&quot;</span>
    <span class="k">assert</span> <span class="n">example_col</span> <span class="ow">in</span> <span class="n">dataf</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Example column &#39;</span><span class="si">{</span><span class="n">example_col</span><span class="si">}</span><span class="s2">&#39; not found in DataFrame. Make sure to set the correct example_col.&quot;</span>
    <span class="k">if</span> <span class="n">benchmark_cols</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">benchmark_cols</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">dataf</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Benchmark column &#39;</span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s2">&#39; not found in DataFrame. Make sure to set the correct benchmark_cols.&quot;</span>

    <span class="n">val_stats</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
    <span class="n">feature_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">dataf</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">col</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;feature&quot;</span><span class="p">)]</span>
    <span class="n">cat_cols</span> <span class="o">=</span> <span class="n">dataf</span><span class="p">[</span><span class="n">feature_cols</span><span class="p">]</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;category&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">cat_cols</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;WARNING: Categorical features detected that cannot be used for neutralization. Removing columns: &#39;</span><span class="si">{</span><span class="n">cat_cols</span><span class="si">}</span><span class="s2">&#39; for evaluation.&quot;</span><span class="p">)</span>
        <span class="n">dataf</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">feature_cols</span><span class="p">]</span> <span class="o">=</span> <span class="n">dataf</span><span class="p">[</span><span class="n">feature_cols</span><span class="p">]</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">exclude</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;category&#39;</span><span class="p">])</span>
    <span class="n">dataf</span> <span class="o">=</span> <span class="n">dataf</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">pred_cols</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Evaluation: &quot;</span><span class="p">):</span>
        <span class="n">col_stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluation_one_col</span><span class="p">(</span>
            <span class="n">dataf</span><span class="o">=</span><span class="n">dataf</span><span class="p">,</span>
            <span class="n">pred_col</span><span class="o">=</span><span class="n">col</span><span class="p">,</span>
            <span class="n">feature_cols</span><span class="o">=</span><span class="n">feature_cols</span><span class="p">,</span>
            <span class="n">target_col</span><span class="o">=</span><span class="n">target_col</span><span class="p">,</span>
            <span class="n">example_col</span><span class="o">=</span><span class="n">example_col</span><span class="p">,</span>
            <span class="n">benchmark_cols</span><span class="o">=</span><span class="n">benchmark_cols</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">val_stats</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">val_stats</span><span class="p">,</span> <span class="n">col_stats</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">val_stats</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="numerblox.evaluation.BaseEvaluator.get_feature_exposures_corrv2" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_feature_exposures_corrv2</span><span class="p">(</span><span class="n">dataf</span><span class="p">,</span> <span class="n">pred_col</span><span class="p">,</span> <span class="n">feature_list</span><span class="p">,</span> <span class="n">cpu_cores</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Calculate feature exposures for each era using 'Numerai Corr'.
Results will be similar to get_feature_exposures() but more accurate.
This method will take longer to compute.</p>
<p>:param dataf: DataFrame containing predictions, features, and eras.
:param pred_col: Prediction column to calculate feature exposures for.
:param feature_list: List of feature columns in X.
:param cpu_cores: Number of CPU cores to use for parallelization.
Default: -1 (all cores).
:return: DataFrame with Corrv2 feature exposures by era for each feature.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/evaluation.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_feature_exposures_corrv2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">pred_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">feature_list</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">cpu_cores</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate feature exposures for each era using &#39;Numerai Corr&#39;.</span>
<span class="sd">    Results will be similar to get_feature_exposures() but more accurate.</span>
<span class="sd">    This method will take longer to compute.</span>

<span class="sd">    :param dataf: DataFrame containing predictions, features, and eras.</span>
<span class="sd">    :param pred_col: Prediction column to calculate feature exposures for.</span>
<span class="sd">    :param feature_list: List of feature columns in X.</span>
<span class="sd">    :param cpu_cores: Number of CPU cores to use for parallelization.</span>
<span class="sd">    Default: -1 (all cores).</span>
<span class="sd">    :return: DataFrame with Corrv2 feature exposures by era for each feature.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">calculate_era_feature_exposure</span><span class="p">(</span><span class="n">era</span><span class="p">,</span> <span class="n">group</span><span class="p">,</span> <span class="n">pred_col</span><span class="p">,</span> <span class="n">feature_list</span><span class="p">):</span>
        <span class="n">exposures</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">feature_list</span><span class="p">:</span>
            <span class="n">corr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">numerai_corr</span><span class="p">(</span><span class="n">group</span><span class="p">,</span> <span class="n">pred_col</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">pred_col</span><span class="si">}</span><span class="s2">_normalized&quot;</span><span class="p">,</span> <span class="n">target_col</span><span class="o">=</span><span class="n">feature</span><span class="p">)</span>
            <span class="n">exposures</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span> <span class="o">=</span> <span class="n">corr</span>
        <span class="k">return</span> <span class="n">era</span><span class="p">,</span> <span class="n">exposures</span>

    <span class="n">normalized_ranks</span> <span class="o">=</span> <span class="p">(</span><span class="n">dataf</span><span class="p">[[</span><span class="n">pred_col</span><span class="p">]]</span><span class="o">.</span><span class="n">rank</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;first&quot;</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">dataf</span><span class="p">)</span>
    <span class="n">dataf</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">pred_col</span><span class="si">}</span><span class="s2">_normalized&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">normalized_ranks</span><span class="p">)</span>
    <span class="n">feature_exposure_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">dataf</span><span class="p">[</span><span class="s2">&quot;era&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">(),</span> <span class="n">columns</span><span class="o">=</span><span class="n">feature_list</span><span class="p">)</span>

    <span class="n">grouped_data</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">dataf</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;era&quot;</span><span class="p">))</span>

    <span class="n">results</span> <span class="o">=</span> <span class="n">Parallel</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=</span><span class="n">cpu_cores</span><span class="p">)(</span><span class="n">delayed</span><span class="p">(</span><span class="n">calculate_era_feature_exposure</span><span class="p">)(</span><span class="n">era</span><span class="p">,</span> <span class="n">group</span><span class="p">,</span> <span class="n">pred_col</span><span class="p">,</span> <span class="n">feature_list</span><span class="p">)</span> <span class="k">for</span> <span class="n">era</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">grouped_data</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">era</span><span class="p">,</span> <span class="n">exposures</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
        <span class="n">feature_exposure_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">era</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">exposures</span>
    <span class="k">return</span> <span class="n">feature_exposure_data</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="numerblox.evaluation.BaseEvaluator.get_feature_exposures_pearson" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_feature_exposures_pearson</span><span class="p">(</span><span class="n">dataf</span><span class="p">,</span> <span class="n">pred_col</span><span class="p">,</span> <span class="n">feature_list</span><span class="p">,</span> <span class="n">cpu_cores</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Calculate feature exposures for each era using Pearson correlation.</p>
<p>:param dataf: DataFrame containing predictions, features, and eras.
:param pred_col: Prediction column to calculate feature exposures for.
:param feature_list: List of feature columns in X.
:param cpu_cores: Number of CPU cores to use for parallelization.
:return: DataFrame with Pearson feature exposures by era for each feature.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/evaluation.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_feature_exposures_pearson</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">pred_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">feature_list</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">cpu_cores</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate feature exposures for each era using Pearson correlation.</span>

<span class="sd">    :param dataf: DataFrame containing predictions, features, and eras.</span>
<span class="sd">    :param pred_col: Prediction column to calculate feature exposures for.</span>
<span class="sd">    :param feature_list: List of feature columns in X.</span>
<span class="sd">    :param cpu_cores: Number of CPU cores to use for parallelization.</span>
<span class="sd">    :return: DataFrame with Pearson feature exposures by era for each feature.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">calculate_era_pearson_exposure</span><span class="p">(</span><span class="n">era</span><span class="p">,</span> <span class="n">group</span><span class="p">,</span> <span class="n">feature_list</span><span class="p">,</span> <span class="n">pred_col_normalized</span><span class="p">):</span>
        <span class="n">data_matrix</span> <span class="o">=</span> <span class="n">group</span><span class="p">[</span><span class="n">feature_list</span> <span class="o">+</span> <span class="p">[</span><span class="n">pred_col_normalized</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span>
        <span class="n">correlations</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">corrcoef</span><span class="p">(</span><span class="n">data_matrix</span><span class="p">,</span> <span class="n">rowvar</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Get the correlations of all features with the predictions (which is the last column)</span>
        <span class="n">feature_correlations</span> <span class="o">=</span> <span class="n">correlations</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">era</span><span class="p">,</span> <span class="n">feature_correlations</span>

    <span class="n">normalized_ranks</span> <span class="o">=</span> <span class="p">(</span><span class="n">dataf</span><span class="p">[[</span><span class="n">pred_col</span><span class="p">]]</span><span class="o">.</span><span class="n">rank</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;first&quot;</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">dataf</span><span class="p">)</span>
    <span class="n">dataf</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">pred_col</span><span class="si">}</span><span class="s2">_normalized&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">normalized_ranks</span><span class="p">)</span>
    <span class="n">feature_exposure_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">dataf</span><span class="p">[</span><span class="s2">&quot;era&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">(),</span> <span class="n">columns</span><span class="o">=</span><span class="n">feature_list</span><span class="p">)</span>

    <span class="n">grouped_data</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">dataf</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;era&quot;</span><span class="p">))</span>

    <span class="n">results</span> <span class="o">=</span> <span class="n">Parallel</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=</span><span class="n">cpu_cores</span><span class="p">)(</span><span class="n">delayed</span><span class="p">(</span><span class="n">calculate_era_pearson_exposure</span><span class="p">)(</span><span class="n">era</span><span class="p">,</span> <span class="n">group</span><span class="p">,</span> <span class="n">feature_list</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">pred_col</span><span class="si">}</span><span class="s2">_normalized&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">era</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">grouped_data</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">era</span><span class="p">,</span> <span class="n">feature_correlations</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
        <span class="n">feature_exposure_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">era</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">feature_correlations</span>
    <span class="k">return</span> <span class="n">feature_exposure_data</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="numerblox.evaluation.BaseEvaluator.max_drawdown" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">max_drawdown</span><span class="p">(</span><span class="n">era_corrs</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Maximum drawdown per era.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/evaluation.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">max_drawdown</span><span class="p">(</span><span class="n">era_corrs</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Maximum drawdown per era.&quot;&quot;&quot;</span>
    <span class="c1"># Arbitrarily large window</span>
    <span class="n">rolling_max</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">era_corrs</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">cumprod</span><span class="p">()</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="mi">9000</span><span class="p">,</span> <span class="n">min_periods</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="p">)</span>
    <span class="n">daily_value</span> <span class="o">=</span> <span class="p">(</span><span class="n">era_corrs</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">cumprod</span><span class="p">()</span>
    <span class="n">max_drawdown</span> <span class="o">=</span> <span class="o">-</span><span class="p">((</span><span class="n">rolling_max</span> <span class="o">-</span> <span class="n">daily_value</span><span class="p">)</span> <span class="o">/</span> <span class="n">rolling_max</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">max_drawdown</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="numerblox.evaluation.BaseEvaluator.max_feature_exposure" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">max_feature_exposure</span><span class="p">(</span><span class="n">dataf</span><span class="p">,</span> <span class="n">feature_cols</span><span class="p">,</span> <span class="n">pred_col</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Maximum exposure over all features.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/evaluation.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">max_feature_exposure</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> 
    <span class="n">feature_cols</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">pred_col</span><span class="p">:</span> <span class="nb">str</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Maximum exposure over all features.&quot;&quot;&quot;</span>
    <span class="n">max_per_era</span> <span class="o">=</span> <span class="n">dataf</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">era_col</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
        <span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="n">d</span><span class="p">[</span><span class="n">feature_cols</span><span class="p">]</span><span class="o">.</span><span class="n">corrwith</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">pred_col</span><span class="p">])</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="p">)</span>
    <span class="n">max_feature_exposure</span> <span class="o">=</span> <span class="n">max_per_era</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">max_feature_exposure</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="numerblox.evaluation.BaseEvaluator.mean_std_sharpe" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">mean_std_sharpe</span><span class="p">(</span><span class="n">era_corrs</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Average, standard deviation and Sharpe ratio for
correlations per era.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/evaluation.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">mean_std_sharpe</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">era_corrs</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Average, standard deviation and Sharpe ratio for</span>
<span class="sd">    correlations per era.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">mean</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">era_corrs</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
    <span class="n">std</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">era_corrs</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">ddof</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
    <span class="n">sharpe</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="k">if</span> <span class="n">std</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">mean</span> <span class="o">/</span> <span class="n">std</span>
    <span class="k">return</span> <span class="n">mean</span><span class="p">,</span> <span class="n">std</span><span class="p">,</span> <span class="n">sharpe</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="numerblox.evaluation.BaseEvaluator.model_contribution" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">model_contribution</span><span class="p">(</span><span class="n">dataf</span><span class="p">,</span> <span class="n">pred_col</span><span class="p">,</span> <span class="n">target_col</span><span class="p">,</span> <span class="n">other_col</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Legacy contibution Mean, standard deviation and Sharpe ratio.
More info: https://forum.numer.ai/t/mmc2-announcement/93
if other_col == meta_model_col -&gt; MMC (Meta Model Contribution)
if other_col == example_col -&gt; EPC (Example Prediction Contribution)</p>
<p>:param dataf: DataFrame containing era_col, pred_col, target_col and other_col.
:param pred_col: Prediction column to calculate MMC for.
:param target_col: Target column to calculate MMC against.
:param other_col: Meta model column containing predictions to neutralize against.</p>
<p>:return: Tuple of contribution mean, standard deviation, Sharpe ratio 
and Sharpe ratio of contribution + (Pearson) correlation.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/evaluation.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">model_contribution</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">pred_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
    <span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">other_col</span><span class="p">:</span> <span class="nb">str</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Legacy contibution Mean, standard deviation and Sharpe ratio.</span>
<span class="sd">    More info: https://forum.numer.ai/t/mmc2-announcement/93</span>
<span class="sd">    if other_col == meta_model_col -&gt; MMC (Meta Model Contribution)</span>
<span class="sd">    if other_col == example_col -&gt; EPC (Example Prediction Contribution)</span>

<span class="sd">    :param dataf: DataFrame containing era_col, pred_col, target_col and other_col.</span>
<span class="sd">    :param pred_col: Prediction column to calculate MMC for.</span>
<span class="sd">    :param target_col: Target column to calculate MMC against.</span>
<span class="sd">    :param other_col: Meta model column containing predictions to neutralize against.</span>

<span class="sd">    :return: Tuple of contribution mean, standard deviation, Sharpe ratio </span>
<span class="sd">    and Sharpe ratio of contribution + (Pearson) correlation.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">mmc_scores</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">corr_scores</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># Standard deviation of a uniform distribution</span>
    <span class="n">COVARIANCE_FACTOR</span> <span class="o">=</span> <span class="mf">0.29</span> <span class="o">**</span> <span class="mi">2</span>
    <span class="c1"># Calculate MMC for each era</span>
    <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">dataf</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">era_col</span><span class="p">):</span>
        <span class="n">series</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_neutralize_series</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_normalize_uniform</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">pred_col</span><span class="p">]),</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">other_col</span><span class="p">])</span>
        <span class="p">)</span>
        <span class="n">mmc_scores</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cov</span><span class="p">(</span><span class="n">series</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="n">target_col</span><span class="p">])[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">COVARIANCE_FACTOR</span><span class="p">)</span>
        <span class="n">corr_scores</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_normalize_uniform</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">pred_col</span><span class="p">])</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">target_col</span><span class="p">]))</span>

    <span class="c1"># Contribution</span>
    <span class="n">c_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">mmc_scores</span><span class="p">)</span>
    <span class="n">c_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">mmc_scores</span><span class="p">)</span>
    <span class="n">c_sharpe</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="k">if</span> <span class="n">c_std</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">c_mean</span> <span class="o">/</span> <span class="n">c_std</span>

    <span class="c1"># MMC + Pearson correlation</span>
    <span class="n">corr_plus_cs</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="o">+</span> <span class="n">m</span> <span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">corr_scores</span><span class="p">,</span> <span class="n">mmc_scores</span><span class="p">)]</span>
    <span class="n">corr_plus_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">corr_plus_cs</span><span class="p">)</span>
    <span class="n">corr_plus_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">corr_plus_cs</span><span class="p">)</span>
    <span class="n">corr_plus_c_sharpe</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="k">if</span> <span class="n">corr_plus_std</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">corr_plus_mean</span> <span class="o">/</span> <span class="n">corr_plus_std</span>
    <span class="k">return</span> <span class="n">c_mean</span><span class="p">,</span> <span class="n">c_std</span><span class="p">,</span> <span class="n">c_sharpe</span><span class="p">,</span> <span class="n">corr_plus_c_sharpe</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="numerblox.evaluation.BaseEvaluator.numerai_corr" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">numerai_corr</span><span class="p">(</span><span class="n">dataf</span><span class="p">,</span> <span class="n">pred_col</span><span class="p">,</span> <span class="n">target_col</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Computes 'Numerai Corr' aka 'Corrv2'.
More info: https://forum.numer.ai/t/target-cyrus-new-primary-target/6303</p>
<p>Assumes original target col as input (i.e. in [0, 1] range).</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/evaluation.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">numerai_corr</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">pred_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Computes &#39;Numerai Corr&#39; aka &#39;Corrv2&#39;.</span>
<span class="sd">    More info: https://forum.numer.ai/t/target-cyrus-new-primary-target/6303</span>

<span class="sd">    Assumes original target col as input (i.e. in [0, 1] range).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Rank and gaussianize predictions</span>
    <span class="n">ranked_preds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normalize_uniform</span><span class="p">(</span><span class="n">dataf</span><span class="p">[</span><span class="n">pred_col</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.5</span><span class="p">),</span> 
                                           <span class="n">method</span><span class="o">=</span><span class="s2">&quot;average&quot;</span><span class="p">)</span>
    <span class="n">gauss_ranked_preds</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">ranked_preds</span><span class="p">)</span>
    <span class="c1"># Center target from [0...1] to [-0.5...0.5] range</span>
    <span class="n">targets</span> <span class="o">=</span> <span class="n">dataf</span><span class="p">[</span><span class="n">target_col</span><span class="p">]</span>
    <span class="n">centered_target</span> <span class="o">=</span> <span class="n">targets</span> <span class="o">-</span> <span class="n">targets</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="c1"># Accentuate tails of predictions and targets</span>
    <span class="n">preds_p15</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">gauss_ranked_preds</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">gauss_ranked_preds</span><span class="p">)</span> <span class="o">**</span> <span class="mf">1.5</span>
    <span class="n">target_p15</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">centered_target</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">centered_target</span><span class="p">)</span> <span class="o">**</span> <span class="mf">1.5</span>
    <span class="c1"># Pearson correlation</span>
    <span class="n">corr</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">pearsonr</span><span class="p">(</span><span class="n">preds_p15</span><span class="p">,</span> <span class="n">target_p15</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">corr</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="numerblox.evaluation.BaseEvaluator.per_era_corrs" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">per_era_corrs</span><span class="p">(</span><span class="n">dataf</span><span class="p">,</span> <span class="n">pred_col</span><span class="p">,</span> <span class="n">target_col</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Correlation between prediction and target for each era.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/evaluation.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">per_era_corrs</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">pred_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Correlation between prediction and target for each era.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">dataf</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">era_col</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
        <span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normalize_uniform</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">pred_col</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.5</span><span class="p">))</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span>
            <span class="n">d</span><span class="p">[</span><span class="n">target_col</span><span class="p">]</span>
        <span class="p">)</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="numerblox.evaluation.BaseEvaluator.per_era_numerai_corrs" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">per_era_numerai_corrs</span><span class="p">(</span><span class="n">dataf</span><span class="p">,</span> <span class="n">pred_col</span><span class="p">,</span> <span class="n">target_col</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Numerai Corr between prediction and target for each era.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/evaluation.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">per_era_numerai_corrs</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">pred_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Numerai Corr between prediction and target for each era.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">dataf</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">era_col</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
        <span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">numerai_corr</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.5</span><span class="p">),</span> <span class="n">pred_col</span><span class="p">,</span> <span class="n">target_col</span><span class="p">)</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="numerblox.evaluation.BaseEvaluator.plot_correlations" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">plot_correlations</span><span class="p">(</span><span class="n">dataf</span><span class="p">,</span> <span class="n">pred_cols</span><span class="p">,</span> <span class="n">corr_cols</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">target_col</span><span class="o">=</span><span class="s1">&#39;target&#39;</span><span class="p">,</span> <span class="n">roll_mean</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Plot per era correlations over time.
:param dataf: DataFrame that contains at least all pred_cols, target_col and corr_cols.
:param pred_cols: List of prediction columns to calculate per era correlations for and plot.
:param corr_cols: Per era correlations already prepared to include in the plot.
This is optional for if you already have per era correlations prepared in your input dataf.
:param target_col: Target column name to compute per era correlations against.
:param roll_mean: How many eras should be averaged to compute a rolling score.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/evaluation.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">plot_correlations</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">pred_cols</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">corr_cols</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;target&quot;</span><span class="p">,</span>
    <span class="n">roll_mean</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot per era correlations over time.</span>
<span class="sd">    :param dataf: DataFrame that contains at least all pred_cols, target_col and corr_cols.</span>
<span class="sd">    :param pred_cols: List of prediction columns to calculate per era correlations for and plot.</span>
<span class="sd">    :param corr_cols: Per era correlations already prepared to include in the plot.</span>
<span class="sd">    This is optional for if you already have per era correlations prepared in your input dataf.</span>
<span class="sd">    :param target_col: Target column name to compute per era correlations against.</span>
<span class="sd">    :param roll_mean: How many eras should be averaged to compute a rolling score.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">validation_by_eras</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
    <span class="c1"># Compute per era correlation for each prediction column.</span>
    <span class="k">for</span> <span class="n">pred_col</span> <span class="ow">in</span> <span class="n">pred_cols</span><span class="p">:</span>
        <span class="n">per_era_corrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">per_era_numerai_corrs</span><span class="p">(</span>
            <span class="n">dataf</span><span class="p">,</span> <span class="n">pred_col</span><span class="o">=</span><span class="n">pred_col</span><span class="p">,</span> <span class="n">target_col</span><span class="o">=</span><span class="n">target_col</span>
        <span class="p">)</span>
        <span class="n">validation_by_eras</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">pred_col</span><span class="p">]</span> <span class="o">=</span> <span class="n">per_era_corrs</span>

    <span class="c1"># Add prepared per era correlation if any.</span>
    <span class="k">if</span> <span class="n">corr_cols</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">corr_col</span> <span class="ow">in</span> <span class="n">corr_cols</span><span class="p">:</span>
            <span class="n">validation_by_eras</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">corr_col</span><span class="p">]</span> <span class="o">=</span> <span class="n">dataf</span><span class="p">[</span><span class="n">corr_col</span><span class="p">]</span>

    <span class="n">validation_by_eras</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">roll_mean</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
        <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;line&quot;</span><span class="p">,</span>
        <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span>
        <span class="n">ms</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
        <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Rolling Per Era Correlation Mean (rolling window size: </span><span class="si">{</span><span class="n">roll_mean</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>
        <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span>
        <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper center&quot;</span><span class="p">,</span>
        <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.05</span><span class="p">),</span>
        <span class="n">fancybox</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">shadow</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">ncol</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="n">validation_by_eras</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Cumulative Sum of Era Correlations&quot;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span>
        <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper center&quot;</span><span class="p">,</span>
        <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.05</span><span class="p">),</span>
        <span class="n">fancybox</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">shadow</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">ncol</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">return</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="numerblox.evaluation.BaseEvaluator.smart_sharpe" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">smart_sharpe</span><span class="p">(</span><span class="n">era_corrs</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Sharpe adjusted for autocorrelation.
:param era_corrs: Correlation scores by era</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/evaluation.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">smart_sharpe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">era_corrs</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">    Sharpe adjusted for autocorrelation.</span>
<span class="sd">    :param era_corrs: Correlation scores by era</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">era_corrs</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">era_corrs</span><span class="p">,</span> <span class="n">ddof</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">autocorr_penalty</span><span class="p">(</span><span class="n">era_corrs</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="numerblox.evaluation.BaseEvaluator.tbx_mean_std_sharpe" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">tbx_mean_std_sharpe</span><span class="p">(</span><span class="n">dataf</span><span class="p">,</span> <span class="n">pred_col</span><span class="p">,</span> <span class="n">target_col</span><span class="p">,</span> <span class="n">tb</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Calculate Mean, Standard deviation and Sharpe ratio
when we focus on the x top and x bottom predictions.
:param tb: How many of top and bottom predictions to focus on.
TB200 and TB500 are the most common situations.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/evaluation.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">tbx_mean_std_sharpe</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">pred_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">tb</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">200</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate Mean, Standard deviation and Sharpe ratio</span>
<span class="sd">    when we focus on the x top and x bottom predictions.</span>
<span class="sd">    :param tb: How many of top and bottom predictions to focus on.</span>
<span class="sd">    TB200 and TB500 are the most common situations.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tb_val_corrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_score_by_date</span><span class="p">(</span>
        <span class="n">dataf</span><span class="o">=</span><span class="n">dataf</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="n">pred_col</span><span class="p">],</span> <span class="n">target</span><span class="o">=</span><span class="n">target_col</span><span class="p">,</span> <span class="n">tb</span><span class="o">=</span><span class="n">tb</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean_std_sharpe</span><span class="p">(</span><span class="n">era_corrs</span><span class="o">=</span><span class="n">tb_val_corrs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">




<h2 id="numerblox.evaluation.NumeraiClassicEvaluator" class="doc doc-heading">
          <code>NumeraiClassicEvaluator</code>


</h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="numerblox.evaluation.BaseEvaluator" href="#numerblox.evaluation.BaseEvaluator">BaseEvaluator</a></code></p>

  
      <p>Evaluator for all metrics that are relevant in Numerai Classic.</p>
<p>:param meta_model_col: Optional column name pointing to meta model predictions. Will be used to calculate
correlation to the metamodel.</p>

            <details class="quote">
              <summary>Source code in <code>numerblox/evaluation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">NumeraiClassicEvaluator</span><span class="p">(</span><span class="n">BaseEvaluator</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Evaluator for all metrics that are relevant in Numerai Classic.</span>

<span class="sd">    :param meta_model_col: Optional column name pointing to meta model predictions. Will be used to calculate</span>
<span class="sd">    correlation to the metamodel.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">era_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;era&quot;</span><span class="p">,</span> <span class="n">fast_mode</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">era_col</span><span class="o">=</span><span class="n">era_col</span><span class="p">,</span> <span class="n">fast_mode</span><span class="o">=</span><span class="n">fast_mode</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fncv3_features</span> <span class="o">=</span> <span class="n">FNCV3_FEATURES</span>

    <span class="k">def</span> <span class="nf">full_evaluation</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">example_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">pred_cols</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;target&quot;</span><span class="p">,</span>
        <span class="n">meta_model_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">benchmark_cols</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="n">val_stats</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
        <span class="n">dataf</span> <span class="o">=</span> <span class="n">dataf</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">feature_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">dataf</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">col</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;feature&quot;</span><span class="p">)]</span>

        <span class="c1"># Check if sufficient columns are present in dataf to compute FNC</span>
        <span class="n">feature_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">dataf</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fncv3_features</span><span class="p">)</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="n">feature_set</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Using &#39;v4.2/features.json/fncv3_features&#39; feature set to calculate FNC metrics.&quot;</span><span class="p">)</span>
            <span class="n">valid_features</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fncv3_features</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;WARNING: No suitable feature set defined for FNC. Skipping calculation of FNC.&quot;</span><span class="p">)</span>
            <span class="n">valid_features</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">pred_cols</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Evaluation: &quot;</span><span class="p">):</span>
            <span class="c1"># Metrics that can be calculated for both Numerai Classic and Signals</span>
            <span class="n">col_stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluation_one_col</span><span class="p">(</span>
                <span class="n">dataf</span><span class="o">=</span><span class="n">dataf</span><span class="p">,</span>
                <span class="n">feature_cols</span><span class="o">=</span><span class="n">feature_cols</span><span class="p">,</span>
                <span class="n">pred_col</span><span class="o">=</span><span class="n">col</span><span class="p">,</span>
                <span class="n">target_col</span><span class="o">=</span><span class="n">target_col</span><span class="p">,</span>
                <span class="n">example_col</span><span class="o">=</span><span class="n">example_col</span><span class="p">,</span>
                <span class="n">benchmark_cols</span><span class="o">=</span><span class="n">benchmark_cols</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="c1"># Numerai Classic specific metrics</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">fast_mode</span> <span class="ow">and</span> <span class="n">valid_features</span><span class="p">:</span>
                <span class="c1"># Using only valid features defined in FNCV3_FEATURES</span>
                <span class="n">fnc_v3</span><span class="p">,</span> <span class="n">fn_std_v3</span><span class="p">,</span> <span class="n">fn_sharpe_v3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_neutral_mean_std_sharpe</span><span class="p">(</span>
                    <span class="n">dataf</span><span class="o">=</span><span class="n">dataf</span><span class="p">,</span> <span class="n">pred_col</span><span class="o">=</span><span class="n">col</span><span class="p">,</span> <span class="n">target_col</span><span class="o">=</span><span class="n">target_col</span><span class="p">,</span> <span class="n">feature_names</span><span class="o">=</span><span class="n">valid_features</span>
                <span class="p">)</span>
                <span class="n">col_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">col</span><span class="p">,</span> <span class="s2">&quot;feature_neutral_mean_v3&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fnc_v3</span>
                <span class="n">col_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">col</span><span class="p">,</span> <span class="s2">&quot;feature_neutral_std_v3&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fn_std_v3</span>
                <span class="n">col_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">col</span><span class="p">,</span> <span class="s2">&quot;feature_neutral_sharpe_v3&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fn_sharpe_v3</span>
            <span class="n">val_stats</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">val_stats</span><span class="p">,</span> <span class="n">col_stats</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

            <span class="c1"># Meta model specific metrics</span>
            <span class="k">if</span> <span class="n">meta_model_col</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">meta_model_corr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cross_correlation</span><span class="p">(</span>
                <span class="n">dataf</span><span class="o">=</span><span class="n">dataf</span><span class="p">,</span> <span class="n">pred_col</span><span class="o">=</span><span class="n">col</span><span class="p">,</span> <span class="n">other_col</span><span class="o">=</span><span class="n">meta_model_col</span>
                <span class="p">)</span>
                <span class="n">legacy_mmc_mean</span><span class="p">,</span> <span class="n">legacy_mmc_std</span><span class="p">,</span> <span class="n">legacy_mmc_sharpe</span><span class="p">,</span> <span class="n">legacy_mmc_plus_corr_sharpe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_contribution</span><span class="p">(</span>
                    <span class="n">dataf</span><span class="o">=</span><span class="n">dataf</span><span class="p">,</span> <span class="n">pred_col</span><span class="o">=</span><span class="n">col</span><span class="p">,</span> <span class="n">target_col</span><span class="o">=</span><span class="n">target_col</span><span class="p">,</span>
                    <span class="n">other_col</span><span class="o">=</span><span class="n">meta_model_col</span>
                <span class="p">)</span>
                <span class="n">col_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">col</span><span class="p">,</span> <span class="s2">&quot;corr_with_meta_model&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_model_corr</span>
                <span class="n">col_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">col</span><span class="p">,</span> <span class="s2">&quot;legacy_mmc_mean&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">legacy_mmc_mean</span>
                <span class="n">col_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">col</span><span class="p">,</span> <span class="s2">&quot;legacy_mmc_std&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">legacy_mmc_std</span>
                <span class="n">col_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">col</span><span class="p">,</span> <span class="s2">&quot;legacy_mmc_sharpe&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">legacy_mmc_sharpe</span>
                <span class="n">col_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">col</span><span class="p">,</span> <span class="s2">&quot;legacy_mmc_plus_corr_sharpe&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">legacy_mmc_plus_corr_sharpe</span>

            <span class="n">val_stats</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">val_stats</span><span class="p">,</span> <span class="n">col_stats</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">val_stats</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">




<h2 id="numerblox.evaluation.NumeraiSignalsEvaluator" class="doc doc-heading">
          <code>NumeraiSignalsEvaluator</code>


</h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="numerblox.evaluation.BaseEvaluator" href="#numerblox.evaluation.BaseEvaluator">BaseEvaluator</a></code></p>

  
      <p>Evaluator for all metrics that are relevant in Numerai Signals.</p>

            <details class="quote">
              <summary>Source code in <code>numerblox/evaluation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">NumeraiSignalsEvaluator</span><span class="p">(</span><span class="n">BaseEvaluator</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Evaluator for all metrics that are relevant in Numerai Signals.&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">era_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;friday_date&quot;</span><span class="p">,</span> <span class="n">fast_mode</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">era_col</span><span class="o">=</span><span class="n">era_col</span><span class="p">,</span> <span class="n">fast_mode</span><span class="o">=</span><span class="n">fast_mode</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_neutralized_corr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val_dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="n">Key</span><span class="p">,</span> <span class="n">timeout_min</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieved neutralized validation correlation by era. \n</span>
<span class="sd">        Calculated on Numerai servers. \n</span>
<span class="sd">        :param val_dataf: A DataFrame containing prediction, friday_date, ticker and data_type columns. \n</span>
<span class="sd">        data_type column should contain &#39;validation&#39; instances. \n</span>
<span class="sd">        :param model_name: Any model name for which you have authentication credentials. \n</span>
<span class="sd">        :param key: Key object to authenticate upload of diagnostics. \n</span>
<span class="sd">        :param timeout_min: How many minutes to wait on diagnostics processing on Numerai servers before timing out. \n</span>
<span class="sd">        2 minutes by default. \n</span>
<span class="sd">        :return: Pandas Series with era as index and neutralized validation correlations (validationCorr).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">api</span> <span class="o">=</span> <span class="n">SignalsAPI</span><span class="p">(</span><span class="n">public_id</span><span class="o">=</span><span class="n">key</span><span class="o">.</span><span class="n">pub_id</span><span class="p">,</span> <span class="n">secret_key</span><span class="o">=</span><span class="n">key</span><span class="o">.</span><span class="n">secret_key</span><span class="p">)</span>
        <span class="n">model_id</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">get_models</span><span class="p">()[</span><span class="n">model_name</span><span class="p">]</span>
        <span class="n">diagnostics_id</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">upload_diagnostics</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">val_dataf</span><span class="p">,</span> <span class="n">model_id</span><span class="o">=</span><span class="n">model_id</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__await_diagnostics</span><span class="p">(</span><span class="n">api</span><span class="o">=</span><span class="n">api</span><span class="p">,</span> <span class="n">model_id</span><span class="o">=</span><span class="n">model_id</span><span class="p">,</span> <span class="n">diagnostics_id</span><span class="o">=</span><span class="n">diagnostics_id</span><span class="p">,</span> <span class="n">timeout_min</span><span class="o">=</span><span class="n">timeout_min</span><span class="p">)</span>
        <span class="n">dataf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;perEraDiagnostics&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;era&quot;</span><span class="p">)[</span><span class="s1">&#39;validationCorr&#39;</span><span class="p">]</span>
        <span class="n">dataf</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">dataf</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">dataf</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">__await_diagnostics</span><span class="p">(</span><span class="n">api</span><span class="p">:</span> <span class="n">SignalsAPI</span><span class="p">,</span> <span class="n">model_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">diagnostics_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">timeout_min</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">interval_sec</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">15</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Wait for diagnostics to be uploaded.</span>
<span class="sd">        Try every &#39;interval_sec&#39; seconds until &#39;timeout_min&#39; minutes have passed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">timeout</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">+</span> <span class="mi">60</span> <span class="o">*</span> <span class="n">timeout_min</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;not_done&quot;</span><span class="p">}</span>
        <span class="k">while</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">timeout</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">diagnostics</span><span class="p">(</span><span class="n">model_id</span><span class="o">=</span><span class="n">model_id</span><span class="p">,</span> <span class="n">diagnostics_id</span><span class="o">=</span><span class="n">diagnostics_id</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;done&#39;</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Diagnostics not processed yet. Sleeping for another </span><span class="si">{</span><span class="n">interval_sec</span><span class="si">}</span><span class="s2"> seconds.&quot;</span><span class="p">)</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">interval_sec</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">break</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;done&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Diagnostics couldn&#39;t be retrieved within </span><span class="si">{</span><span class="n">timeout_min</span><span class="si">}</span><span class="s2"> minutes after uploading. Check if Numerai API is offline.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">data</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">




<h3 id="numerblox.evaluation.NumeraiSignalsEvaluator.__await_diagnostics" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">__await_diagnostics</span><span class="p">(</span><span class="n">api</span><span class="p">,</span> <span class="n">model_id</span><span class="p">,</span> <span class="n">diagnostics_id</span><span class="p">,</span> <span class="n">timeout_min</span><span class="p">,</span> <span class="n">interval_sec</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Wait for diagnostics to be uploaded.
Try every 'interval_sec' seconds until 'timeout_min' minutes have passed.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/evaluation.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">__await_diagnostics</span><span class="p">(</span><span class="n">api</span><span class="p">:</span> <span class="n">SignalsAPI</span><span class="p">,</span> <span class="n">model_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">diagnostics_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">timeout_min</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">interval_sec</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">15</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Wait for diagnostics to be uploaded.</span>
<span class="sd">    Try every &#39;interval_sec&#39; seconds until &#39;timeout_min&#39; minutes have passed.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">timeout</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">+</span> <span class="mi">60</span> <span class="o">*</span> <span class="n">timeout_min</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;not_done&quot;</span><span class="p">}</span>
    <span class="k">while</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">timeout</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">diagnostics</span><span class="p">(</span><span class="n">model_id</span><span class="o">=</span><span class="n">model_id</span><span class="p">,</span> <span class="n">diagnostics_id</span><span class="o">=</span><span class="n">diagnostics_id</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;done&#39;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Diagnostics not processed yet. Sleeping for another </span><span class="si">{</span><span class="n">interval_sec</span><span class="si">}</span><span class="s2"> seconds.&quot;</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">interval_sec</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">break</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;done&#39;</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Diagnostics couldn&#39;t be retrieved within </span><span class="si">{</span><span class="n">timeout_min</span><span class="si">}</span><span class="s2"> minutes after uploading. Check if Numerai API is offline.&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">data</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="numerblox.evaluation.NumeraiSignalsEvaluator.get_neutralized_corr" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_neutralized_corr</span><span class="p">(</span><span class="n">val_dataf</span><span class="p">,</span> <span class="n">model_name</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">timeout_min</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Retrieved neutralized validation correlation by era. </p>
<p>Calculated on Numerai servers. </p>
<p>:param val_dataf: A DataFrame containing prediction, friday_date, ticker and data_type columns. </p>
<p>data_type column should contain 'validation' instances. </p>
<p>:param model_name: Any model name for which you have authentication credentials. </p>
<p>:param key: Key object to authenticate upload of diagnostics. </p>
<p>:param timeout_min: How many minutes to wait on diagnostics processing on Numerai servers before timing out. </p>
<p>2 minutes by default. </p>
<p>:return: Pandas Series with era as index and neutralized validation correlations (validationCorr).</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/evaluation.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_neutralized_corr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val_dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="n">Key</span><span class="p">,</span> <span class="n">timeout_min</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieved neutralized validation correlation by era. \n</span>
<span class="sd">    Calculated on Numerai servers. \n</span>
<span class="sd">    :param val_dataf: A DataFrame containing prediction, friday_date, ticker and data_type columns. \n</span>
<span class="sd">    data_type column should contain &#39;validation&#39; instances. \n</span>
<span class="sd">    :param model_name: Any model name for which you have authentication credentials. \n</span>
<span class="sd">    :param key: Key object to authenticate upload of diagnostics. \n</span>
<span class="sd">    :param timeout_min: How many minutes to wait on diagnostics processing on Numerai servers before timing out. \n</span>
<span class="sd">    2 minutes by default. \n</span>
<span class="sd">    :return: Pandas Series with era as index and neutralized validation correlations (validationCorr).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">api</span> <span class="o">=</span> <span class="n">SignalsAPI</span><span class="p">(</span><span class="n">public_id</span><span class="o">=</span><span class="n">key</span><span class="o">.</span><span class="n">pub_id</span><span class="p">,</span> <span class="n">secret_key</span><span class="o">=</span><span class="n">key</span><span class="o">.</span><span class="n">secret_key</span><span class="p">)</span>
    <span class="n">model_id</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">get_models</span><span class="p">()[</span><span class="n">model_name</span><span class="p">]</span>
    <span class="n">diagnostics_id</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">upload_diagnostics</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">val_dataf</span><span class="p">,</span> <span class="n">model_id</span><span class="o">=</span><span class="n">model_id</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__await_diagnostics</span><span class="p">(</span><span class="n">api</span><span class="o">=</span><span class="n">api</span><span class="p">,</span> <span class="n">model_id</span><span class="o">=</span><span class="n">model_id</span><span class="p">,</span> <span class="n">diagnostics_id</span><span class="o">=</span><span class="n">diagnostics_id</span><span class="p">,</span> <span class="n">timeout_min</span><span class="o">=</span><span class="n">timeout_min</span><span class="p">)</span>
    <span class="n">dataf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;perEraDiagnostics&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;era&quot;</span><span class="p">)[</span><span class="s1">&#39;validationCorr&#39;</span><span class="p">]</span>
    <span class="n">dataf</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">dataf</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">dataf</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>




  </div>

  </div>

</div><hr />


<div class="doc doc-object doc-module">



<a id="numerblox.submission"></a>
  <div class="doc doc-contents first">

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">




<h2 id="numerblox.submission.BaseSubmitter" class="doc doc-heading">
          <code>BaseSubmitter</code>


</h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="numerblox.download.BaseIO" href="#numerblox.download.BaseIO">BaseIO</a></code></p>

  
      <p>Basic functionality for submitting to Numerai. 
Uses numerapi under the hood.
More info: https://numerapi.readthedocs.io/ </p>
<p>:param directory_path: Directory to store and read submissions from. 
:param api: NumerAPI or SignalsAPI
:param max_retries: Maximum number of retries for uploading predictions to Numerai. 
:param sleep_time: Time to sleep between uploading retries.
:param fail_silently: Whether to skip uploading to Numerai without raising an error. 
Useful for if you are uploading many models in a loop and want to skip models that fail to upload.</p>

            <details class="quote">
              <summary>Source code in <code>numerblox/submission.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">BaseSubmitter</span><span class="p">(</span><span class="n">BaseIO</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Basic functionality for submitting to Numerai. </span>
<span class="sd">    Uses numerapi under the hood.</span>
<span class="sd">    More info: https://numerapi.readthedocs.io/ </span>

<span class="sd">    :param directory_path: Directory to store and read submissions from. </span>
<span class="sd">    :param api: NumerAPI or SignalsAPI</span>
<span class="sd">    :param max_retries: Maximum number of retries for uploading predictions to Numerai. </span>
<span class="sd">    :param sleep_time: Time to sleep between uploading retries.</span>
<span class="sd">    :param fail_silently: Whether to skip uploading to Numerai without raising an error. </span>
<span class="sd">    Useful for if you are uploading many models in a loop and want to skip models that fail to upload.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">api</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">NumerAPI</span><span class="p">,</span> <span class="n">SignalsAPI</span><span class="p">],</span> <span class="n">max_retries</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> 
                 <span class="n">sleep_time</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">fail_silently</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">directory_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">api</span> <span class="o">=</span> <span class="n">api</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_retries</span> <span class="o">=</span> <span class="n">max_retries</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sleep_time</span> <span class="o">=</span> <span class="n">sleep_time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fail_silently</span> <span class="o">=</span> <span class="n">fail_silently</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">save_csv</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">cols</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">],</span>
        <span class="o">*</span><span class="n">args</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        For Numerai Classic: Save index column + &#39;cols&#39; (targets) to CSV.</span>
<span class="sd">        For Numerai Signals: Save ticker, friday_date, data_type and signal columns to CSV.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="o">...</span>

    <span class="k">def</span> <span class="nf">upload_predictions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Upload CSV file to Numerai for given model name.</span>
<span class="sd">        :param file_name: File name/path relative to directory_path.</span>
<span class="sd">        :param model_name: Lowercase raw model name (For example, &#39;integration_test&#39;).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">full_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dir</span> <span class="o">/</span> <span class="n">file_name</span><span class="p">)</span>
        <span class="n">model_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_model_id</span><span class="p">(</span><span class="n">model_name</span><span class="o">=</span><span class="n">model_name</span><span class="p">)</span>
        <span class="n">api_type</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">api_type</span><span class="si">}</span><span class="s2">: Uploading predictions from &#39;</span><span class="si">{</span><span class="n">full_path</span><span class="si">}</span><span class="s2">&#39; for model &#39;</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">&#39; (model_id=&#39;</span><span class="si">{</span><span class="n">model_id</span><span class="si">}</span><span class="s2">&#39;)&quot;</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">attempt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_retries</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">upload_predictions</span><span class="p">(</span>
                    <span class="n">file_path</span><span class="o">=</span><span class="n">full_path</span><span class="p">,</span> <span class="n">model_id</span><span class="o">=</span><span class="n">model_id</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
                <span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">api_type</span><span class="si">}</span><span class="s2"> submission of &#39;</span><span class="si">{</span><span class="n">full_path</span><span class="si">}</span><span class="s2">&#39; for &#39;</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">&#39; is successful!&quot;</span>
                <span class="p">)</span>
                <span class="k">return</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">attempt</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_retries</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># i.e. not the last attempt</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to upload &#39;</span><span class="si">{</span><span class="n">full_path</span><span class="si">}</span><span class="s2">&#39; for &#39;</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">&#39; to Numerai. Retrying in </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">sleep_time</span><span class="si">}</span><span class="s2"> seconds...&quot;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sleep_time</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fail_silently</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to upload&#39;</span><span class="si">{</span><span class="n">full_path</span><span class="si">}</span><span class="s2">&#39; for &#39;</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">&#39; to Numerai. Skipping...&quot;</span><span class="p">)</span>
                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to upload &#39;</span><span class="si">{</span><span class="n">full_path</span><span class="si">}</span><span class="s2">&#39; for &#39;</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">&#39; to Numerai after </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">max_retries</span><span class="si">}</span><span class="s2"> attempts.&quot;</span><span class="p">)</span>
                        <span class="k">raise</span> <span class="n">e</span>

    <span class="k">def</span> <span class="nf">full_submission</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">cols</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">],</span>
        <span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;submission.csv&#39;</span><span class="p">,</span>
        <span class="o">*</span><span class="n">args</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save DataFrame to csv and upload predictions through API.</span>

<span class="sd">        :param dataf: Main DataFrame containing `cols`.</span>
<span class="sd">        :param model_name: Lowercase Numerai model name.</span>
<span class="sd">        :param file_name: path to save model to relative to base directory.</span>
<span class="sd">        :param cols: Columns to be saved in submission file.</span>
<span class="sd">        1 prediction column for Numerai Classic.</span>
<span class="sd">        At least 1 prediction column and 1 ticker column for Numerai Signals.</span>
<span class="sd">        *args, **kwargs are passed to numerapi API.</span>
<span class="sd">        For example `version` argument in Numerai Classic submissions.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_csv</span><span class="p">(</span><span class="n">dataf</span><span class="o">=</span><span class="n">dataf</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="n">file_name</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="n">cols</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">upload_predictions</span><span class="p">(</span>
            <span class="n">file_name</span><span class="o">=</span><span class="n">file_name</span><span class="p">,</span> <span class="n">model_name</span><span class="o">=</span><span class="n">model_name</span><span class="p">,</span>
            <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">combine_csvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">csv_paths</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
                     <span class="n">aux_cols</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
                     <span class="n">era_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                     <span class="n">pred_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;prediction&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read in csv files and combine all predictions with a rank mean. \n</span>
<span class="sd">        Multi-target predictions will be averaged out. \n</span>
<span class="sd">        :param csv_paths: List of full paths to .csv prediction files. \n</span>
<span class="sd">        :param aux_cols: [&#39;id&#39;] for Numerai Classic. \n</span>
<span class="sd">        [&#39;ticker&#39;, &#39;last_friday&#39;, &#39;data_type&#39;], for example, with Numerai Signals. \n</span>
<span class="sd">        :param era_col: Column indicating era (&#39;era&#39; or &#39;last_friday&#39;). \n</span>
<span class="sd">        Will be used for Grouping the rank mean if given. Skip groupby if no era_col provided. \n</span>
<span class="sd">        :param pred_col: &#39;prediction&#39; for Numerai Classic and &#39;signal&#39; for Numerai Signals.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">all_datafs</span> <span class="o">=</span> <span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="n">aux_cols</span><span class="p">)</span> <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">csv_paths</span><span class="p">)]</span>
        <span class="n">final_dataf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">all_datafs</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s2">&quot;columns&quot;</span><span class="p">)</span>
        <span class="c1"># Remove issue of duplicate columns</span>
        <span class="n">numeric_cols</span> <span class="o">=</span> <span class="n">final_dataf</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">number</span><span class="p">)</span><span class="o">.</span><span class="n">columns</span>
        <span class="n">final_dataf</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="n">k</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">numeric_cols</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">numeric_cols</span><span class="p">)))},</span>
                           <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                           <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># Combine all numeric columns with rank mean</span>
        <span class="n">num_dataf</span> <span class="o">=</span> <span class="n">final_dataf</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">number</span><span class="p">)</span>
        <span class="n">num_dataf</span> <span class="o">=</span> <span class="n">num_dataf</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">era_col</span><span class="p">)</span> <span class="k">if</span> <span class="n">era_col</span> <span class="k">else</span> <span class="n">num_dataf</span>
        <span class="n">final_dataf</span><span class="p">[</span><span class="n">pred_col</span><span class="p">]</span> <span class="o">=</span> <span class="n">num_dataf</span><span class="o">.</span><span class="n">rank</span><span class="p">(</span><span class="n">pct</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;first&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">final_dataf</span><span class="p">[[</span><span class="n">pred_col</span><span class="p">]]</span>

    <span class="k">def</span> <span class="nf">_get_model_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get ID needed for prediction uploading.</span>
<span class="sd">        :param model_name: Raw lowercase model name</span>
<span class="sd">        of Numerai model that you have access to.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_model_mapping</span><span class="p">[</span><span class="n">model_name</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">get_model_mapping</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Mapping between raw model names and model IDs.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">get_models</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_check_value_range</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">cols</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Check if all predictions are in range (0...1). &quot;&quot;&quot;</span>
        <span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">cols</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cols</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">cols</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">dataf</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">between</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                <span class="n">min_val</span><span class="p">,</span> <span class="n">max_val</span> <span class="o">=</span> <span class="n">dataf</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">dataf</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Values must be between 0 and 1. </span><span class="se">\</span>
<span class="s2">Found min value of &#39;</span><span class="si">{</span><span class="n">min_val</span><span class="si">}</span><span class="s2">&#39; and max value of &#39;</span><span class="si">{</span><span class="n">max_val</span><span class="si">}</span><span class="s2">&#39; for column &#39;</span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
                <span class="p">)</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
            <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
            <span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;submission.csv&quot;</span><span class="p">,</span>
            <span class="n">cols</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;prediction&quot;</span><span class="p">,</span>
            <span class="o">*</span><span class="n">args</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The most common use case will be to create a CSV and submit it immediately after that.</span>
<span class="sd">        full_submission handles this.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">full_submission</span><span class="p">(</span>
            <span class="n">dataf</span><span class="o">=</span><span class="n">dataf</span><span class="p">,</span>
            <span class="n">file_name</span><span class="o">=</span><span class="n">file_name</span><span class="p">,</span>
            <span class="n">model_name</span><span class="o">=</span><span class="n">model_name</span><span class="p">,</span>
            <span class="n">cols</span><span class="o">=</span><span class="n">cols</span><span class="p">,</span>
            <span class="o">*</span><span class="n">args</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">




<h3 id="numerblox.submission.BaseSubmitter.get_model_mapping" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_model_mapping</span><span class="p">:</span> <span class="nb">dict</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Mapping between raw model names and model IDs.</p>
  </div>

</div>




<div class="doc doc-object doc-function">




<h3 id="numerblox.submission.BaseSubmitter.__call__" class="doc doc-heading">
          <code class="highlight language-python"><span class="fm">__call__</span><span class="p">(</span><span class="n">dataf</span><span class="p">,</span> <span class="n">model_name</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="s1">&#39;submission.csv&#39;</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="s1">&#39;prediction&#39;</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>The most common use case will be to create a CSV and submit it immediately after that.
full_submission handles this.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/submission.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;submission.csv&quot;</span><span class="p">,</span>
        <span class="n">cols</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;prediction&quot;</span><span class="p">,</span>
        <span class="o">*</span><span class="n">args</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The most common use case will be to create a CSV and submit it immediately after that.</span>
<span class="sd">    full_submission handles this.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">full_submission</span><span class="p">(</span>
        <span class="n">dataf</span><span class="o">=</span><span class="n">dataf</span><span class="p">,</span>
        <span class="n">file_name</span><span class="o">=</span><span class="n">file_name</span><span class="p">,</span>
        <span class="n">model_name</span><span class="o">=</span><span class="n">model_name</span><span class="p">,</span>
        <span class="n">cols</span><span class="o">=</span><span class="n">cols</span><span class="p">,</span>
        <span class="o">*</span><span class="n">args</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="numerblox.submission.BaseSubmitter.combine_csvs" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">combine_csvs</span><span class="p">(</span><span class="n">csv_paths</span><span class="p">,</span> <span class="n">aux_cols</span><span class="p">,</span> <span class="n">era_col</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pred_col</span><span class="o">=</span><span class="s1">&#39;prediction&#39;</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Read in csv files and combine all predictions with a rank mean. </p>
<p>Multi-target predictions will be averaged out. </p>
<p>:param csv_paths: List of full paths to .csv prediction files. </p>
<p>:param aux_cols: ['id'] for Numerai Classic. </p>
<p>['ticker', 'last_friday', 'data_type'], for example, with Numerai Signals. </p>
<p>:param era_col: Column indicating era ('era' or 'last_friday'). </p>
<p>Will be used for Grouping the rank mean if given. Skip groupby if no era_col provided. </p>
<p>:param pred_col: 'prediction' for Numerai Classic and 'signal' for Numerai Signals.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/submission.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">combine_csvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">csv_paths</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
                 <span class="n">aux_cols</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
                 <span class="n">era_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">pred_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;prediction&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read in csv files and combine all predictions with a rank mean. \n</span>
<span class="sd">    Multi-target predictions will be averaged out. \n</span>
<span class="sd">    :param csv_paths: List of full paths to .csv prediction files. \n</span>
<span class="sd">    :param aux_cols: [&#39;id&#39;] for Numerai Classic. \n</span>
<span class="sd">    [&#39;ticker&#39;, &#39;last_friday&#39;, &#39;data_type&#39;], for example, with Numerai Signals. \n</span>
<span class="sd">    :param era_col: Column indicating era (&#39;era&#39; or &#39;last_friday&#39;). \n</span>
<span class="sd">    Will be used for Grouping the rank mean if given. Skip groupby if no era_col provided. \n</span>
<span class="sd">    :param pred_col: &#39;prediction&#39; for Numerai Classic and &#39;signal&#39; for Numerai Signals.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">all_datafs</span> <span class="o">=</span> <span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="n">aux_cols</span><span class="p">)</span> <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">csv_paths</span><span class="p">)]</span>
    <span class="n">final_dataf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">all_datafs</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s2">&quot;columns&quot;</span><span class="p">)</span>
    <span class="c1"># Remove issue of duplicate columns</span>
    <span class="n">numeric_cols</span> <span class="o">=</span> <span class="n">final_dataf</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">number</span><span class="p">)</span><span class="o">.</span><span class="n">columns</span>
    <span class="n">final_dataf</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="n">k</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">numeric_cols</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">numeric_cols</span><span class="p">)))},</span>
                       <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                       <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># Combine all numeric columns with rank mean</span>
    <span class="n">num_dataf</span> <span class="o">=</span> <span class="n">final_dataf</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">number</span><span class="p">)</span>
    <span class="n">num_dataf</span> <span class="o">=</span> <span class="n">num_dataf</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">era_col</span><span class="p">)</span> <span class="k">if</span> <span class="n">era_col</span> <span class="k">else</span> <span class="n">num_dataf</span>
    <span class="n">final_dataf</span><span class="p">[</span><span class="n">pred_col</span><span class="p">]</span> <span class="o">=</span> <span class="n">num_dataf</span><span class="o">.</span><span class="n">rank</span><span class="p">(</span><span class="n">pct</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;first&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">final_dataf</span><span class="p">[[</span><span class="n">pred_col</span><span class="p">]]</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="numerblox.submission.BaseSubmitter.full_submission" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">full_submission</span><span class="p">(</span><span class="n">dataf</span><span class="p">,</span> <span class="n">model_name</span><span class="p">,</span> <span class="n">cols</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="s1">&#39;submission.csv&#39;</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Save DataFrame to csv and upload predictions through API.</p>
<p>:param dataf: Main DataFrame containing <code>cols</code>.
:param model_name: Lowercase Numerai model name.
:param file_name: path to save model to relative to base directory.
:param cols: Columns to be saved in submission file.
1 prediction column for Numerai Classic.
At least 1 prediction column and 1 ticker column for Numerai Signals.
<em>args, </em>*kwargs are passed to numerapi API.
For example <code>version</code> argument in Numerai Classic submissions.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/submission.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">full_submission</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">cols</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">],</span>
    <span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;submission.csv&#39;</span><span class="p">,</span>
    <span class="o">*</span><span class="n">args</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Save DataFrame to csv and upload predictions through API.</span>

<span class="sd">    :param dataf: Main DataFrame containing `cols`.</span>
<span class="sd">    :param model_name: Lowercase Numerai model name.</span>
<span class="sd">    :param file_name: path to save model to relative to base directory.</span>
<span class="sd">    :param cols: Columns to be saved in submission file.</span>
<span class="sd">    1 prediction column for Numerai Classic.</span>
<span class="sd">    At least 1 prediction column and 1 ticker column for Numerai Signals.</span>
<span class="sd">    *args, **kwargs are passed to numerapi API.</span>
<span class="sd">    For example `version` argument in Numerai Classic submissions.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">save_csv</span><span class="p">(</span><span class="n">dataf</span><span class="o">=</span><span class="n">dataf</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="n">file_name</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="n">cols</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">upload_predictions</span><span class="p">(</span>
        <span class="n">file_name</span><span class="o">=</span><span class="n">file_name</span><span class="p">,</span> <span class="n">model_name</span><span class="o">=</span><span class="n">model_name</span><span class="p">,</span>
        <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="numerblox.submission.BaseSubmitter.save_csv" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">save_csv</span><span class="p">(</span><span class="n">dataf</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">cols</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>For Numerai Classic: Save index column + 'cols' (targets) to CSV.
For Numerai Signals: Save ticker, friday_date, data_type and signal columns to CSV.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/submission.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="k">def</span> <span class="nf">save_csv</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">cols</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">],</span>
    <span class="o">*</span><span class="n">args</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    For Numerai Classic: Save index column + &#39;cols&#39; (targets) to CSV.</span>
<span class="sd">    For Numerai Signals: Save ticker, friday_date, data_type and signal columns to CSV.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="numerblox.submission.BaseSubmitter.upload_predictions" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">upload_predictions</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">model_name</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Upload CSV file to Numerai for given model name.
:param file_name: File name/path relative to directory_path.
:param model_name: Lowercase raw model name (For example, 'integration_test').</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/submission.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">upload_predictions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Upload CSV file to Numerai for given model name.</span>
<span class="sd">    :param file_name: File name/path relative to directory_path.</span>
<span class="sd">    :param model_name: Lowercase raw model name (For example, &#39;integration_test&#39;).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">full_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dir</span> <span class="o">/</span> <span class="n">file_name</span><span class="p">)</span>
    <span class="n">model_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_model_id</span><span class="p">(</span><span class="n">model_name</span><span class="o">=</span><span class="n">model_name</span><span class="p">)</span>
    <span class="n">api_type</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">api_type</span><span class="si">}</span><span class="s2">: Uploading predictions from &#39;</span><span class="si">{</span><span class="n">full_path</span><span class="si">}</span><span class="s2">&#39; for model &#39;</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">&#39; (model_id=&#39;</span><span class="si">{</span><span class="n">model_id</span><span class="si">}</span><span class="s2">&#39;)&quot;</span>
    <span class="p">)</span>
    <span class="k">for</span> <span class="n">attempt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_retries</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">upload_predictions</span><span class="p">(</span>
                <span class="n">file_path</span><span class="o">=</span><span class="n">full_path</span><span class="p">,</span> <span class="n">model_id</span><span class="o">=</span><span class="n">model_id</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
            <span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">api_type</span><span class="si">}</span><span class="s2"> submission of &#39;</span><span class="si">{</span><span class="n">full_path</span><span class="si">}</span><span class="s2">&#39; for &#39;</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">&#39; is successful!&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">attempt</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_retries</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># i.e. not the last attempt</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to upload &#39;</span><span class="si">{</span><span class="n">full_path</span><span class="si">}</span><span class="s2">&#39; for &#39;</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">&#39; to Numerai. Retrying in </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">sleep_time</span><span class="si">}</span><span class="s2"> seconds...&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sleep_time</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fail_silently</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to upload&#39;</span><span class="si">{</span><span class="n">full_path</span><span class="si">}</span><span class="s2">&#39; for &#39;</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">&#39; to Numerai. Skipping...&quot;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to upload &#39;</span><span class="si">{</span><span class="n">full_path</span><span class="si">}</span><span class="s2">&#39; for &#39;</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">&#39; to Numerai after </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">max_retries</span><span class="si">}</span><span class="s2"> attempts.&quot;</span><span class="p">)</span>
                    <span class="k">raise</span> <span class="n">e</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">




<h2 id="numerblox.submission.NumerBaySubmitter" class="doc doc-heading">
          <code>NumerBaySubmitter</code>


</h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="numerblox.submission.BaseSubmitter" href="#numerblox.submission.BaseSubmitter">BaseSubmitter</a></code></p>

  
      <p>Submit to NumerBay to fulfill sale orders, in addition to submission to Numerai.</p>
<p>:param tournament_submitter: Base tournament submitter (NumeraiClassicSubmitter or NumeraiSignalsSubmitter). This submitter will use the same directory path.
:param upload_to_numerai: Whether to also submit to Numerai using the tournament submitter. Defaults to True, set to False to only upload to NumerBay.
:param numerbay_username: NumerBay username
:param numerbay_password: NumerBay password</p>

            <details class="quote">
              <summary>Source code in <code>numerblox/submission.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">NumerBaySubmitter</span><span class="p">(</span><span class="n">BaseSubmitter</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Submit to NumerBay to fulfill sale orders, in addition to submission to Numerai.</span>

<span class="sd">    :param tournament_submitter: Base tournament submitter (NumeraiClassicSubmitter or NumeraiSignalsSubmitter). This submitter will use the same directory path.</span>
<span class="sd">    :param upload_to_numerai: Whether to also submit to Numerai using the tournament submitter. Defaults to True, set to False to only upload to NumerBay.</span>
<span class="sd">    :param numerbay_username: NumerBay username</span>
<span class="sd">    :param numerbay_password: NumerBay password</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">tournament_submitter</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">NumeraiClassicSubmitter</span><span class="p">,</span> <span class="n">NumeraiSignalsSubmitter</span><span class="p">],</span>
                 <span class="n">upload_to_numerai</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                 <span class="n">numerbay_username</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">numerbay_password</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">directory_path</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">tournament_submitter</span><span class="o">.</span><span class="n">dir</span><span class="p">),</span> <span class="n">api</span><span class="o">=</span><span class="n">tournament_submitter</span><span class="o">.</span><span class="n">api</span><span class="p">,</span>
            <span class="n">max_retries</span><span class="o">=</span><span class="n">tournament_submitter</span><span class="o">.</span><span class="n">max_retries</span><span class="p">,</span> <span class="n">sleep_time</span><span class="o">=</span><span class="n">tournament_submitter</span><span class="o">.</span><span class="n">sleep_time</span><span class="p">,</span>
            <span class="n">fail_silently</span><span class="o">=</span><span class="n">tournament_submitter</span><span class="o">.</span><span class="n">fail_silently</span>
        <span class="p">)</span>
        <span class="kn">from</span> <span class="nn">numerbay</span> <span class="kn">import</span> <span class="n">NumerBay</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">numerbay_api</span> <span class="o">=</span> <span class="n">NumerBay</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="n">numerbay_username</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">numerbay_password</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tournament_submitter</span> <span class="o">=</span> <span class="n">tournament_submitter</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">upload_to_numerai</span> <span class="o">=</span> <span class="n">upload_to_numerai</span>

    <span class="k">def</span> <span class="nf">upload_predictions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                           <span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                           <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                           <span class="n">numerbay_product_full_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                           <span class="o">*</span><span class="n">args</span><span class="p">,</span>
                           <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Upload CSV file to NumerBay (and Numerai if &#39;upload_to_numerai&#39; is True) for given model name and NumerBay product full name.</span>
<span class="sd">        :param file_name: File name/path relative to directory_path.</span>
<span class="sd">        :param model_name: Lowercase raw model name (For example, &#39;integration_test&#39;).</span>
<span class="sd">        :param numerbay_product_full_name: NumerBay product full name in the format of [category]-[product name], e.g. &#39;numerai-predictions-numerbay&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">upload_to_numerai</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tournament_submitter</span><span class="o">.</span><span class="n">upload_predictions</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">model_name</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">full_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dir</span> <span class="o">/</span> <span class="n">file_name</span><span class="p">)</span>
        <span class="n">api_type</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">numerbay_api</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">api_type</span><span class="si">}</span><span class="s2">: Uploading predictions from &#39;</span><span class="si">{</span><span class="n">full_path</span><span class="si">}</span><span class="s2">&#39; for NumerBay product &#39;</span><span class="si">{</span><span class="n">numerbay_product_full_name</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
        <span class="p">)</span>
        <span class="n">artifact</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">numerbay_api</span><span class="o">.</span><span class="n">upload_artifact</span><span class="p">(</span>
            <span class="nb">str</span><span class="p">(</span><span class="n">full_path</span><span class="p">),</span> <span class="n">product_full_name</span><span class="o">=</span><span class="n">numerbay_product_full_name</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">artifact</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">api_type</span><span class="si">}</span><span class="s2"> submission of &#39;</span><span class="si">{</span><span class="n">full_path</span><span class="si">}</span><span class="s2">&#39; for NumerBay product [bold blue]</span><span class="si">{</span><span class="n">numerbay_product_full_name</span><span class="si">}</span><span class="s2"> is successful!&quot;</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;WARNING: Upload skipped for NumerBay product &#39;</span><span class="si">{</span><span class="n">numerbay_product_full_name</span><span class="si">}</span><span class="s2">&#39;, </span>
<span class="s2">                  the product uses buyer-side encryption but does not have any active sale order to upload for.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">full_submission</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">cols</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">],</span>
        <span class="n">numerbay_product_full_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;submission.csv&#39;</span><span class="p">,</span>
        <span class="o">*</span><span class="n">args</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save DataFrame to csv and upload predictions through API.</span>

<span class="sd">        :param dataf: Main DataFrame containing `cols`.</span>
<span class="sd">        :param model_name: Lowercase Numerai model name.</span>
<span class="sd">        :param numerbay_product_full_name: NumerBay product full name in the format of [category]-[product name], e.g. &#39;numerai-predictions-numerbay&#39;</span>
<span class="sd">        :param file_name: path to save model to relative to base directory.</span>
<span class="sd">        :param cols: Columns to be saved in submission file.</span>
<span class="sd">        1 prediction column for Numerai Classic.</span>
<span class="sd">        At least 1 prediction column and 1 ticker column for Numerai Signals.</span>
<span class="sd">        *args, **kwargs are passed to numerapi API.</span>
<span class="sd">        For example `version` argument in Numerai Classic submissions.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_csv</span><span class="p">(</span><span class="n">dataf</span><span class="o">=</span><span class="n">dataf</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="n">file_name</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="n">cols</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">upload_predictions</span><span class="p">(</span>
            <span class="n">file_name</span><span class="o">=</span><span class="n">file_name</span><span class="p">,</span> <span class="n">model_name</span><span class="o">=</span><span class="n">model_name</span><span class="p">,</span> <span class="n">numerbay_product_full_name</span><span class="o">=</span><span class="n">numerbay_product_full_name</span><span class="p">,</span>
            <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">combine_csvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tournament_submitter</span><span class="o">.</span><span class="n">combine_csvs</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">save_csv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tournament_submitter</span><span class="o">.</span><span class="n">save_csv</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">get_model_mapping</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tournament_submitter</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">get_models</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
            <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
            <span class="n">numerbay_product_full_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
            <span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;submission.csv&quot;</span><span class="p">,</span>
            <span class="n">cols</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;prediction&quot;</span><span class="p">,</span>
            <span class="o">*</span><span class="n">args</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The most common use case will be to create a CSV and submit it immediately after that.</span>
<span class="sd">        full_submission handles this.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">full_submission</span><span class="p">(</span>
            <span class="n">dataf</span><span class="o">=</span><span class="n">dataf</span><span class="p">,</span>
            <span class="n">file_name</span><span class="o">=</span><span class="n">file_name</span><span class="p">,</span>
            <span class="n">model_name</span><span class="o">=</span><span class="n">model_name</span><span class="p">,</span>
            <span class="n">numerbay_product_full_name</span><span class="o">=</span><span class="n">numerbay_product_full_name</span><span class="p">,</span>
            <span class="n">cols</span><span class="o">=</span><span class="n">cols</span><span class="p">,</span>
            <span class="o">*</span><span class="n">args</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">




<h3 id="numerblox.submission.NumerBaySubmitter.__call__" class="doc doc-heading">
          <code class="highlight language-python"><span class="fm">__call__</span><span class="p">(</span><span class="n">dataf</span><span class="p">,</span> <span class="n">model_name</span><span class="p">,</span> <span class="n">numerbay_product_full_name</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="s1">&#39;submission.csv&#39;</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="s1">&#39;prediction&#39;</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>The most common use case will be to create a CSV and submit it immediately after that.
full_submission handles this.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/submission.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">numerbay_product_full_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;submission.csv&quot;</span><span class="p">,</span>
        <span class="n">cols</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;prediction&quot;</span><span class="p">,</span>
        <span class="o">*</span><span class="n">args</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The most common use case will be to create a CSV and submit it immediately after that.</span>
<span class="sd">    full_submission handles this.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">full_submission</span><span class="p">(</span>
        <span class="n">dataf</span><span class="o">=</span><span class="n">dataf</span><span class="p">,</span>
        <span class="n">file_name</span><span class="o">=</span><span class="n">file_name</span><span class="p">,</span>
        <span class="n">model_name</span><span class="o">=</span><span class="n">model_name</span><span class="p">,</span>
        <span class="n">numerbay_product_full_name</span><span class="o">=</span><span class="n">numerbay_product_full_name</span><span class="p">,</span>
        <span class="n">cols</span><span class="o">=</span><span class="n">cols</span><span class="p">,</span>
        <span class="o">*</span><span class="n">args</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="numerblox.submission.NumerBaySubmitter.full_submission" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">full_submission</span><span class="p">(</span><span class="n">dataf</span><span class="p">,</span> <span class="n">model_name</span><span class="p">,</span> <span class="n">cols</span><span class="p">,</span> <span class="n">numerbay_product_full_name</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="s1">&#39;submission.csv&#39;</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Save DataFrame to csv and upload predictions through API.</p>
<p>:param dataf: Main DataFrame containing <code>cols</code>.
:param model_name: Lowercase Numerai model name.
:param numerbay_product_full_name: NumerBay product full name in the format of [category]-[product name], e.g. 'numerai-predictions-numerbay'
:param file_name: path to save model to relative to base directory.
:param cols: Columns to be saved in submission file.
1 prediction column for Numerai Classic.
At least 1 prediction column and 1 ticker column for Numerai Signals.
<em>args, </em>*kwargs are passed to numerapi API.
For example <code>version</code> argument in Numerai Classic submissions.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/submission.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">full_submission</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">cols</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">],</span>
    <span class="n">numerbay_product_full_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;submission.csv&#39;</span><span class="p">,</span>
    <span class="o">*</span><span class="n">args</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Save DataFrame to csv and upload predictions through API.</span>

<span class="sd">    :param dataf: Main DataFrame containing `cols`.</span>
<span class="sd">    :param model_name: Lowercase Numerai model name.</span>
<span class="sd">    :param numerbay_product_full_name: NumerBay product full name in the format of [category]-[product name], e.g. &#39;numerai-predictions-numerbay&#39;</span>
<span class="sd">    :param file_name: path to save model to relative to base directory.</span>
<span class="sd">    :param cols: Columns to be saved in submission file.</span>
<span class="sd">    1 prediction column for Numerai Classic.</span>
<span class="sd">    At least 1 prediction column and 1 ticker column for Numerai Signals.</span>
<span class="sd">    *args, **kwargs are passed to numerapi API.</span>
<span class="sd">    For example `version` argument in Numerai Classic submissions.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">save_csv</span><span class="p">(</span><span class="n">dataf</span><span class="o">=</span><span class="n">dataf</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="n">file_name</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="n">cols</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">upload_predictions</span><span class="p">(</span>
        <span class="n">file_name</span><span class="o">=</span><span class="n">file_name</span><span class="p">,</span> <span class="n">model_name</span><span class="o">=</span><span class="n">model_name</span><span class="p">,</span> <span class="n">numerbay_product_full_name</span><span class="o">=</span><span class="n">numerbay_product_full_name</span><span class="p">,</span>
        <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="numerblox.submission.NumerBaySubmitter.upload_predictions" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">upload_predictions</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">model_name</span><span class="p">,</span> <span class="n">numerbay_product_full_name</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Upload CSV file to NumerBay (and Numerai if 'upload_to_numerai' is True) for given model name and NumerBay product full name.
:param file_name: File name/path relative to directory_path.
:param model_name: Lowercase raw model name (For example, 'integration_test').
:param numerbay_product_full_name: NumerBay product full name in the format of [category]-[product name], e.g. 'numerai-predictions-numerbay'</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/submission.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">upload_predictions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                       <span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                       <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                       <span class="n">numerbay_product_full_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                       <span class="o">*</span><span class="n">args</span><span class="p">,</span>
                       <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Upload CSV file to NumerBay (and Numerai if &#39;upload_to_numerai&#39; is True) for given model name and NumerBay product full name.</span>
<span class="sd">    :param file_name: File name/path relative to directory_path.</span>
<span class="sd">    :param model_name: Lowercase raw model name (For example, &#39;integration_test&#39;).</span>
<span class="sd">    :param numerbay_product_full_name: NumerBay product full name in the format of [category]-[product name], e.g. &#39;numerai-predictions-numerbay&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">upload_to_numerai</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tournament_submitter</span><span class="o">.</span><span class="n">upload_predictions</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">model_name</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="n">full_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dir</span> <span class="o">/</span> <span class="n">file_name</span><span class="p">)</span>
    <span class="n">api_type</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">numerbay_api</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">api_type</span><span class="si">}</span><span class="s2">: Uploading predictions from &#39;</span><span class="si">{</span><span class="n">full_path</span><span class="si">}</span><span class="s2">&#39; for NumerBay product &#39;</span><span class="si">{</span><span class="n">numerbay_product_full_name</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
    <span class="p">)</span>
    <span class="n">artifact</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">numerbay_api</span><span class="o">.</span><span class="n">upload_artifact</span><span class="p">(</span>
        <span class="nb">str</span><span class="p">(</span><span class="n">full_path</span><span class="p">),</span> <span class="n">product_full_name</span><span class="o">=</span><span class="n">numerbay_product_full_name</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">artifact</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">api_type</span><span class="si">}</span><span class="s2"> submission of &#39;</span><span class="si">{</span><span class="n">full_path</span><span class="si">}</span><span class="s2">&#39; for NumerBay product [bold blue]</span><span class="si">{</span><span class="n">numerbay_product_full_name</span><span class="si">}</span><span class="s2"> is successful!&quot;</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;WARNING: Upload skipped for NumerBay product &#39;</span><span class="si">{</span><span class="n">numerbay_product_full_name</span><span class="si">}</span><span class="s2">&#39;, </span>
<span class="s2">              the product uses buyer-side encryption but does not have any active sale order to upload for.&quot;&quot;&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">




<h2 id="numerblox.submission.NumeraiClassicSubmitter" class="doc doc-heading">
          <code>NumeraiClassicSubmitter</code>


</h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="numerblox.submission.BaseSubmitter" href="#numerblox.submission.BaseSubmitter">BaseSubmitter</a></code></p>

  
      <p>Submit for Numerai Classic.</p>
<p>:param directory_path: Base directory to save and read prediction files from. </p>
<p>:param key: Key object containing valid credentials for Numerai Classic. </p>
<p>:param max_retries: Maximum number of retries for uploading predictions to Numerai. 
:param sleep_time: Time to sleep between uploading retries.
:param fail_silently: Whether to skip uploading to Numerai without raising an error. 
Useful for if you are uploading many models in a loop and want to skip models that fail to upload.
<em>args, </em>*kwargs will be passed to NumerAPI initialization.</p>

            <details class="quote">
              <summary>Source code in <code>numerblox/submission.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">NumeraiClassicSubmitter</span><span class="p">(</span><span class="n">BaseSubmitter</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Submit for Numerai Classic.</span>

<span class="sd">    :param directory_path: Base directory to save and read prediction files from. \n</span>
<span class="sd">    :param key: Key object containing valid credentials for Numerai Classic. \n</span>
<span class="sd">    :param max_retries: Maximum number of retries for uploading predictions to Numerai. </span>
<span class="sd">    :param sleep_time: Time to sleep between uploading retries.</span>
<span class="sd">    :param fail_silently: Whether to skip uploading to Numerai without raising an error. </span>
<span class="sd">    Useful for if you are uploading many models in a loop and want to skip models that fail to upload.</span>
<span class="sd">    *args, **kwargs will be passed to NumerAPI initialization.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="n">Key</span><span class="p">,</span> 
                 <span class="n">max_retries</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">sleep_time</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> 
                 <span class="n">fail_silently</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">api</span> <span class="o">=</span> <span class="n">NumerAPI</span><span class="p">(</span><span class="n">public_id</span><span class="o">=</span><span class="n">key</span><span class="o">.</span><span class="n">pub_id</span><span class="p">,</span> <span class="n">secret_key</span><span class="o">=</span><span class="n">key</span><span class="o">.</span><span class="n">secret_key</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">directory_path</span><span class="o">=</span><span class="n">directory_path</span><span class="p">,</span> <span class="n">api</span><span class="o">=</span><span class="n">api</span><span class="p">,</span>
            <span class="n">max_retries</span><span class="o">=</span><span class="n">max_retries</span><span class="p">,</span> <span class="n">sleep_time</span><span class="o">=</span><span class="n">sleep_time</span><span class="p">,</span> 
            <span class="n">fail_silently</span><span class="o">=</span><span class="n">fail_silently</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">save_csv</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
            <span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;submission.csv&quot;</span><span class="p">,</span>
            <span class="n">cols</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;prediction&#39;</span><span class="p">,</span>
            <span class="o">*</span><span class="n">args</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param dataf: DataFrame which should have at least the following columns:</span>
<span class="sd">        1. id (as index column)</span>
<span class="sd">        2. cols (for example, &#39;prediction_mymodel&#39;). Will be saved in &#39;prediction&#39; column</span>
<span class="sd">        :param file_name: .csv file path.</span>
<span class="sd">        :param cols: Prediction column name.</span>
<span class="sd">        For example, &#39;prediction&#39; or &#39;prediction_mymodel&#39;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sub_dataf</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">dataf</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_value_range</span><span class="p">(</span><span class="n">dataf</span><span class="o">=</span><span class="n">sub_dataf</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="n">cols</span><span class="p">)</span>

        <span class="n">full_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dir</span> <span class="o">/</span> <span class="n">file_name</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Saving predictions CSV to &#39;</span><span class="si">{</span><span class="n">full_path</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
        <span class="p">)</span>
        <span class="n">sub_dataf</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;prediction&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sub_dataf</span><span class="p">[</span><span class="n">cols</span><span class="p">]</span>
        <span class="n">sub_dataf</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;prediction&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">full_path</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">




<h3 id="numerblox.submission.NumeraiClassicSubmitter.save_csv" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">save_csv</span><span class="p">(</span><span class="n">dataf</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="s1">&#39;submission.csv&#39;</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="s1">&#39;prediction&#39;</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>:param dataf: DataFrame which should have at least the following columns:
1. id (as index column)
2. cols (for example, 'prediction_mymodel'). Will be saved in 'prediction' column
:param file_name: .csv file path.
:param cols: Prediction column name.
For example, 'prediction' or 'prediction_mymodel'.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/submission.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">save_csv</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;submission.csv&quot;</span><span class="p">,</span>
        <span class="n">cols</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;prediction&#39;</span><span class="p">,</span>
        <span class="o">*</span><span class="n">args</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param dataf: DataFrame which should have at least the following columns:</span>
<span class="sd">    1. id (as index column)</span>
<span class="sd">    2. cols (for example, &#39;prediction_mymodel&#39;). Will be saved in &#39;prediction&#39; column</span>
<span class="sd">    :param file_name: .csv file path.</span>
<span class="sd">    :param cols: Prediction column name.</span>
<span class="sd">    For example, &#39;prediction&#39; or &#39;prediction_mymodel&#39;.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sub_dataf</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">dataf</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_check_value_range</span><span class="p">(</span><span class="n">dataf</span><span class="o">=</span><span class="n">sub_dataf</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="n">cols</span><span class="p">)</span>

    <span class="n">full_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dir</span> <span class="o">/</span> <span class="n">file_name</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Saving predictions CSV to &#39;</span><span class="si">{</span><span class="n">full_path</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
    <span class="p">)</span>
    <span class="n">sub_dataf</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;prediction&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sub_dataf</span><span class="p">[</span><span class="n">cols</span><span class="p">]</span>
    <span class="n">sub_dataf</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;prediction&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">full_path</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">




<h2 id="numerblox.submission.NumeraiSignalsSubmitter" class="doc doc-heading">
          <code>NumeraiSignalsSubmitter</code>


</h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="numerblox.submission.BaseSubmitter" href="#numerblox.submission.BaseSubmitter">BaseSubmitter</a></code></p>

  
      <p>Submit for Numerai Signals.</p>
<p>:param directory_path: Base directory to save and read prediction files from. </p>
<p>:param key: Key object containing valid credentials for Numerai Signals. </p>
<p>:param max_retries: Maximum number of retries for uploading predictions to Numerai. 
:param sleep_time: Time to sleep between uploading retries.
:param fail_silently: Whether to skip uploading to Numerai without raising an error. 
Useful for if you are uploading many models in a loop and want to skip models that fail to upload.
<em>args, </em>*kwargs will be passed to SignalsAPI initialization.</p>

            <details class="quote">
              <summary>Source code in <code>numerblox/submission.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">NumeraiSignalsSubmitter</span><span class="p">(</span><span class="n">BaseSubmitter</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Submit for Numerai Signals.</span>

<span class="sd">    :param directory_path: Base directory to save and read prediction files from. \n</span>
<span class="sd">    :param key: Key object containing valid credentials for Numerai Signals. \n</span>
<span class="sd">    :param max_retries: Maximum number of retries for uploading predictions to Numerai. </span>
<span class="sd">    :param sleep_time: Time to sleep between uploading retries.</span>
<span class="sd">    :param fail_silently: Whether to skip uploading to Numerai without raising an error. </span>
<span class="sd">    Useful for if you are uploading many models in a loop and want to skip models that fail to upload.</span>
<span class="sd">    *args, **kwargs will be passed to SignalsAPI initialization.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="n">Key</span><span class="p">,</span> 
                 <span class="n">max_retries</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">sleep_time</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> 
                 <span class="n">fail_silently</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">api</span> <span class="o">=</span> <span class="n">SignalsAPI</span><span class="p">(</span>
            <span class="n">public_id</span><span class="o">=</span><span class="n">key</span><span class="o">.</span><span class="n">pub_id</span><span class="p">,</span> <span class="n">secret_key</span><span class="o">=</span><span class="n">key</span><span class="o">.</span><span class="n">secret_key</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">directory_path</span><span class="o">=</span><span class="n">directory_path</span><span class="p">,</span> <span class="n">api</span><span class="o">=</span><span class="n">api</span><span class="p">,</span>
            <span class="n">max_retries</span><span class="o">=</span><span class="n">max_retries</span><span class="p">,</span> <span class="n">sleep_time</span><span class="o">=</span><span class="n">sleep_time</span><span class="p">,</span>
            <span class="n">fail_silently</span><span class="o">=</span><span class="n">fail_silently</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">supported_ticker_formats</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;cusip&quot;</span><span class="p">,</span>
            <span class="s2">&quot;sedol&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ticker&quot;</span><span class="p">,</span>
            <span class="s2">&quot;numerai_ticker&quot;</span><span class="p">,</span>
            <span class="s2">&quot;bloomberg_ticker&quot;</span><span class="p">,</span>
        <span class="p">]</span>

    <span class="k">def</span> <span class="nf">save_csv</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
            <span class="n">cols</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
            <span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;submission.csv&quot;</span><span class="p">,</span>
            <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param dataf: DataFrame which should have at least the following columns:</span>
<span class="sd">         1. One of supported ticker formats (cusip, sedol, ticker, numerai_ticker or bloomberg_ticker)</span>
<span class="sd">         2. signal (Values between 0 and 1 (exclusive))</span>
<span class="sd">         Additional columns for if you include validation data (optional):</span>
<span class="sd">         3. friday_date (YYYYMMDD format date indication)</span>
<span class="sd">         4. data_type (&#39;val&#39; and &#39;live&#39; partitions)</span>

<span class="sd">         :param cols: All cols that are saved in CSV.</span>
<span class="sd">         cols should contain at least 1 ticker column and a &#39;signal&#39; column.</span>
<span class="sd">         For example: [&#39;bloomberg_ticker&#39;, &#39;signal&#39;]</span>
<span class="sd">         :param file_name: .csv file path.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_ticker_format</span><span class="p">(</span><span class="n">cols</span><span class="o">=</span><span class="n">cols</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_value_range</span><span class="p">(</span><span class="n">dataf</span><span class="o">=</span><span class="n">dataf</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="s2">&quot;signal&quot;</span><span class="p">)</span>

        <span class="n">full_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dir</span> <span class="o">/</span> <span class="n">file_name</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Saving Signals predictions CSV to &#39;</span><span class="si">{</span><span class="n">full_path</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
        <span class="p">)</span>
        <span class="n">dataf</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">cols</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span>
            <span class="n">full_path</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_check_ticker_format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cols</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Check for valid ticker format. &quot;&quot;&quot;</span>
        <span class="n">valid_tickers</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">cols</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">supported_ticker_formats</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">valid_tickers</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;No supported ticker format in </span><span class="si">{</span><span class="n">cols</span><span class="si">}</span><span class="s2">). </span><span class="se">\</span>
<span class="s2">Supported: &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">supported_ticker_formats</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
            <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">




<h3 id="numerblox.submission.NumeraiSignalsSubmitter.save_csv" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">save_csv</span><span class="p">(</span><span class="n">dataf</span><span class="p">,</span> <span class="n">cols</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="s1">&#39;submission.csv&#39;</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>:param dataf: DataFrame which should have at least the following columns:
 1. One of supported ticker formats (cusip, sedol, ticker, numerai_ticker or bloomberg_ticker)
 2. signal (Values between 0 and 1 (exclusive))
 Additional columns for if you include validation data (optional):
 3. friday_date (YYYYMMDD format date indication)
 4. data_type ('val' and 'live' partitions)</p>
<p>:param cols: All cols that are saved in CSV.
 cols should contain at least 1 ticker column and a 'signal' column.
 For example: ['bloomberg_ticker', 'signal']
 :param file_name: .csv file path.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/submission.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">save_csv</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">cols</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
        <span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;submission.csv&quot;</span><span class="p">,</span>
        <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param dataf: DataFrame which should have at least the following columns:</span>
<span class="sd">     1. One of supported ticker formats (cusip, sedol, ticker, numerai_ticker or bloomberg_ticker)</span>
<span class="sd">     2. signal (Values between 0 and 1 (exclusive))</span>
<span class="sd">     Additional columns for if you include validation data (optional):</span>
<span class="sd">     3. friday_date (YYYYMMDD format date indication)</span>
<span class="sd">     4. data_type (&#39;val&#39; and &#39;live&#39; partitions)</span>

<span class="sd">     :param cols: All cols that are saved in CSV.</span>
<span class="sd">     cols should contain at least 1 ticker column and a &#39;signal&#39; column.</span>
<span class="sd">     For example: [&#39;bloomberg_ticker&#39;, &#39;signal&#39;]</span>
<span class="sd">     :param file_name: .csv file path.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_check_ticker_format</span><span class="p">(</span><span class="n">cols</span><span class="o">=</span><span class="n">cols</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_check_value_range</span><span class="p">(</span><span class="n">dataf</span><span class="o">=</span><span class="n">dataf</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="s2">&quot;signal&quot;</span><span class="p">)</span>

    <span class="n">full_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dir</span> <span class="o">/</span> <span class="n">file_name</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Saving Signals predictions CSV to &#39;</span><span class="si">{</span><span class="n">full_path</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
    <span class="p">)</span>
    <span class="n">dataf</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">cols</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span>
        <span class="n">full_path</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>




  </div>

  </div>

</div><hr />





                
              </article>
            </div>
          
          
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.top", "navigation.tabs", "navigation.tracking", "navigation.tabs.sticky", "navigation.expand", "content.code.copy"], "search": "../assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.81fa17fe.min.js"></script>
      
    
  </body>
</html>