
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../submission/">
      
      
        <link rel="next" href="../contributing/">
      
      
      <link rel="icon" href="../assets/.icons/favicon.ico">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.14">
    
    
      
        <title>API Reference - numerblox</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.10ba22f1.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="cyan">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#full-api-reference" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="numerblox" class="md-header__button md-logo" aria-label="numerblox" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" width="1291" height="1361" viewBox="0 0 1291 1361" version="1.1"><path d="M 636.005 118.611 C 627.343 121.752, 619.115 128.910, 615.125 136.778 C 613.382 140.213, 611.355 148.147, 610.751 153.891 C 610.514 156.147, 603.824 158.460, 491.500 195.116 C 426.050 216.476, 372.133 233.962, 371.685 233.976 C 371.237 233.989, 368.661 231.732, 365.960 228.959 C 362.928 225.846, 358.474 222.713, 354.315 220.766 C 348.491 218.041, 346.490 217.617, 339.539 217.633 C 329.185 217.658, 321.919 220.393, 314.713 226.979 C 301.756 238.822, 298.869 256.746, 307.382 272.500 L 310.625 278.500 236.755 380.500 C 167.959 475.493, 162.700 482.480, 160.192 482.215 C 158.712 482.059, 153.450 481.834, 148.500 481.715 C 140.567 481.526, 138.822 481.818, 133.782 484.180 C 126.229 487.720, 119.035 494.595, 115.426 501.722 C 112.744 507.018, 112.500 508.376, 112.500 518 C 112.500 527.544, 112.756 529.001, 115.315 534 C 119.169 541.532, 126.088 548.318, 133.140 551.482 L 139 554.112 139 681 L 139 807.888 133.140 810.518 C 126.088 813.682, 119.169 820.468, 115.315 828 C 112.756 832.999, 112.500 834.456, 112.500 844 C 112.500 853.624, 112.744 854.982, 115.426 860.278 C 119.035 867.405, 126.229 874.280, 133.782 877.820 C 138.800 880.172, 140.601 880.477, 148.500 880.314 C 153.450 880.212, 158.715 879.987, 160.201 879.814 C 162.728 879.520, 167.665 886.079, 236.761 981.500 L 310.621 1083.500 307.381 1089.500 C 294.626 1113.115, 308.461 1140.498, 335.170 1144.503 C 345.174 1146.003, 358.034 1141.179, 366.096 1132.902 C 368.722 1130.206, 371.237 1128.010, 371.685 1128.023 C 372.133 1128.035, 426.050 1145.525, 491.500 1166.890 C 603.672 1203.505, 610.514 1205.871, 610.751 1208.117 C 612.038 1220.320, 615.982 1229, 623.182 1235.474 C 631.402 1242.864, 635.865 1244.484, 648 1244.484 C 660.135 1244.484, 664.598 1242.864, 672.818 1235.474 C 680.018 1229.001, 683.962 1220.320, 685.249 1208.118 C 685.486 1205.871, 692.731 1203.376, 812.283 1164.374 L 939.067 1123.013 944.157 1126.515 C 959.346 1136.962, 980.470 1134.423, 992.479 1120.707 C 1003.197 1108.465, 1004.849 1089.695, 996.356 1076.661 C 994.980 1074.550, 994.066 1072.300, 994.325 1071.661 C 994.584 1071.023, 1025.919 1027.525, 1063.958 975 C 1128.531 885.837, 1133.299 879.521, 1135.810 879.814 C 1137.290 879.987, 1142.550 880.212, 1147.500 880.314 C 1155.399 880.477, 1157.200 880.172, 1162.218 877.820 C 1169.771 874.280, 1176.965 867.405, 1180.574 860.278 C 1183.256 854.982, 1183.500 853.624, 1183.500 844 C 1183.500 834.376, 1183.256 833.018, 1180.574 827.722 C 1176.984 820.633, 1169.742 813.687, 1162.468 810.357 L 1157 807.853 1157 680.983 L 1157 554.112 1162.860 551.482 C 1169.912 548.318, 1176.831 541.532, 1180.685 534 C 1183.244 529.001, 1183.500 527.544, 1183.500 518 C 1183.500 508.376, 1183.256 507.018, 1180.574 501.722 C 1176.965 494.595, 1169.771 487.720, 1162.218 484.180 C 1157.178 481.818, 1155.433 481.526, 1147.500 481.715 C 1142.550 481.834, 1137.288 482.059, 1135.807 482.215 C 1133.299 482.480, 1128.051 475.503, 1059.246 380.430 L 985.377 278.361 988.631 272.484 C 997.163 257.076, 994.212 238.792, 981.287 226.979 C 974.081 220.393, 966.815 217.658, 956.461 217.633 C 949.510 217.617, 947.509 218.041, 941.685 220.766 C 937.526 222.713, 933.072 225.846, 930.040 228.959 C 927.339 231.732, 924.763 233.989, 924.315 233.976 C 923.867 233.962, 869.950 216.476, 804.500 195.116 C 692.176 158.460, 685.486 156.147, 685.249 153.891 C 684.558 147.315, 682.529 140.010, 680.184 135.652 C 677.041 129.810, 669.799 123.084, 663.280 119.951 C 656.934 116.901, 642.658 116.199, 636.005 118.611 M 499.500 211.631 C 436.250 232.285, 384.178 249.487, 383.784 249.857 C 383.391 250.228, 434.016 256.756, 496.284 264.364 C 558.553 271.971, 610.431 278.405, 611.570 278.661 C 613.208 279.029, 614.015 278.293, 615.445 275.122 C 618.085 269.267, 625.605 262.164, 632.750 258.775 L 639 255.811 639 222.640 L 639 189.469 633.875 187.649 C 630.406 186.417, 626.786 183.919, 622.669 179.915 C 619.324 176.662, 616.117 174.018, 615.543 174.040 C 614.970 174.061, 562.750 190.977, 499.500 211.631 M 672.848 180.087 C 668.920 184.091, 665.642 186.400, 662.098 187.659 L 657 189.469 657 222.640 L 657 255.811 663.250 258.775 C 670.395 262.164, 677.915 269.267, 680.555 275.122 C 681.985 278.293, 682.792 279.029, 684.430 278.661 C 685.569 278.405, 737.447 271.971, 799.716 264.364 C 861.984 256.756, 912.609 250.228, 912.216 249.857 C 911.143 248.845, 681.209 173.974, 679.755 174.163 C 679.065 174.252, 675.957 176.918, 672.848 180.087 M 371.501 271.998 C 369.834 275.695, 361.687 284.388, 357.851 286.564 C 356.366 287.406, 357.137 291.546, 365.531 327.847 C 370.663 350.038, 375.005 368.275, 375.181 368.374 C 375.356 368.473, 378.628 369.341, 382.452 370.302 C 389.979 372.195, 397.569 376.510, 401.417 381.083 L 403.838 383.961 507.658 340.766 C 602.665 301.237, 611.182 297.505, 607.989 296.806 C 604.890 296.128, 376.676 268, 374.271 268 C 373.739 268, 372.493 269.799, 371.501 271.998 M 801.653 282.531 C 737.937 290.412, 685.609 297.058, 685.367 297.300 C 685.125 297.541, 731.555 317.139, 788.545 340.850 L 892.162 383.961 894.583 381.083 C 898.431 376.510, 906.021 372.195, 913.548 370.302 C 917.372 369.341, 920.644 368.473, 920.819 368.374 C 920.995 368.275, 925.337 350.038, 930.469 327.847 C 938.863 291.546, 939.634 287.406, 938.149 286.564 C 934.313 284.388, 926.166 275.695, 924.499 271.998 C 923.039 268.760, 922.202 268.019, 920.098 268.101 C 918.669 268.157, 865.369 274.650, 801.653 282.531 M 253 389.124 C 213.125 444.232, 179.919 490.139, 179.208 491.139 C 177.573 493.440, 187.111 488.872, 271.006 447.175 L 337.512 414.119 337.623 406.310 C 337.780 395.375, 340.647 388.293, 347.889 380.956 C 350.975 377.829, 354.358 374.815, 355.408 374.257 C 357.233 373.288, 356.910 371.488, 347.891 332.372 L 338.468 291.500 334.484 290.900 C 332.293 290.571, 329.375 289.991, 328 289.613 C 325.635 288.963, 321.581 294.343, 253 389.124 M 967.799 289.534 C 967.467 289.866, 965.021 290.449, 962.362 290.829 L 957.529 291.521 948.107 332.382 C 939.090 371.488, 938.767 373.288, 940.592 374.257 C 941.642 374.815, 945.025 377.829, 948.111 380.956 C 955.353 388.293, 958.220 395.375, 958.377 406.310 L 958.488 414.119 1024.994 447.175 C 1061.572 465.355, 1097.500 483.102, 1104.834 486.613 L 1118.168 492.997 1114.700 488.249 C 1112.792 485.637, 1079.655 439.850, 1041.063 386.500 C 1002.470 333.150, 970.334 289.372, 969.649 289.215 C 968.963 289.059, 968.131 289.202, 967.799 289.534 M 514 357.827 L 411.500 400.530 410.886 408.064 C 410.534 412.376, 409.344 417.695, 408.101 420.504 L 405.931 425.411 424.643 444.143 L 443.356 462.876 447.428 460.523 C 453.731 456.882, 461.593 455, 470.500 455 C 480.127 455, 486.446 456.692, 494.157 461.335 L 499.813 464.742 551.306 443.287 L 602.798 421.832 603.458 417.433 C 603.821 415.014, 605.688 409.895, 607.607 406.059 C 613.149 394.982, 622.187 386.898, 633.472 382.924 L 638.500 381.154 638.766 354.768 L 639.032 328.381 633.519 326.096 C 630.487 324.840, 625.802 321.829, 623.106 319.406 C 620.411 316.983, 617.822 315.028, 617.353 315.062 C 616.884 315.096, 570.375 334.340, 514 357.827 M 672.766 319.437 C 670.163 321.834, 665.550 324.824, 662.516 326.082 L 657 328.368 657 354.495 L 657 380.621 663.087 382.445 C 673.392 385.532, 682.932 393.061, 689.132 403 C 691.409 406.651, 695 416.701, 695 419.424 C 695 421.581, 699.206 423.520, 746.661 443.244 L 798.323 464.717 802.911 461.879 C 816.722 453.338, 836.890 452.598, 849.926 460.155 L 853.353 462.141 871.713 443.780 L 890.073 425.420 887.901 420.509 C 886.656 417.694, 885.466 412.379, 885.114 408.059 L 884.500 400.520 782 357.822 C 725.625 334.338, 679.050 315.114, 678.500 315.102 C 677.950 315.089, 675.370 317.040, 672.766 319.437 M 265 470.457 L 185.500 509.873 184.935 519.187 C 184.382 528.314, 181.762 536.069, 177.566 541 C 176.487 542.267, 181.821 550.538, 211.894 594.232 C 245.403 642.916, 247.647 645.927, 250 645.337 C 251.375 644.993, 255.650 644.438, 259.500 644.105 L 266.500 643.500 309.348 539.616 L 352.196 435.732 349.348 433.402 C 347.782 432.120, 346.050 431.065, 345.500 431.057 C 344.950 431.048, 308.725 448.778, 265 470.457 M 946.647 433.406 L 943.794 435.739 986.647 539.620 L 1029.500 643.500 1036.500 644.105 C 1040.350 644.438, 1044.625 644.993, 1046 645.337 C 1048.353 645.927, 1050.597 642.916, 1084.106 594.232 C 1114.179 550.538, 1119.513 542.267, 1118.434 541 C 1114.238 536.069, 1111.618 528.314, 1111.065 519.187 L 1110.500 509.873 1031 470.457 C 987.275 448.778, 951.050 431.048, 950.500 431.057 C 949.950 431.065, 948.216 432.122, 946.647 433.406 M 388.020 440.222 C 385.525 441.366, 380.249 442.547, 376.112 442.888 L 368.684 443.500 325.878 547.286 L 283.072 651.072 287.135 655.135 C 289.369 657.369, 292.549 662.085, 294.201 665.615 L 297.204 672.032 323.671 671.766 L 350.139 671.500 351.836 666.487 C 357.115 650.887, 371.515 637.700, 385.757 635.423 C 388.070 635.053, 390.379 634.244, 390.889 633.625 C 391.398 633.006, 401.256 609.609, 412.794 581.632 L 433.773 530.763 430.978 526.623 C 423.924 516.170, 421.848 499.967, 425.901 486.986 C 427.020 483.403, 428.575 479.596, 429.357 478.526 C 430.682 476.715, 429.497 475.245, 412.235 457.290 C 402.034 446.681, 393.421 438.038, 393.094 438.084 C 392.768 438.131, 390.484 439.093, 388.020 440.222 M 884.573 456.466 L 866.866 474.933 869.878 481.245 C 878.944 500.241, 874.342 522.616, 858.457 536.770 L 853.149 541.500 874.268 592.620 L 895.388 643.741 903.033 644.265 C 917.126 645.231, 928.206 652.805, 934.170 665.549 L 937.189 672 968 672 L 998.811 672 1001.807 665.599 C 1003.455 662.078, 1006.634 657.366, 1008.871 655.129 L 1012.940 651.060 970.129 547.280 L 927.317 443.500 919.860 442.886 C 915.684 442.542, 910.279 441.332, 907.574 440.136 C 904.919 438.961, 902.641 438, 902.513 438 C 902.384 438, 894.311 446.310, 884.573 456.466 M 567.527 485.278 L 516.553 506.500 515.805 510.892 C 513.069 526.940, 498.447 542.403, 482 546.640 L 475.096 548.418 454.404 598.459 C 443.023 625.982, 433.512 649.238, 433.268 650.139 C 433.024 651.041, 433.975 653.516, 435.381 655.640 C 444.747 669.793, 444.785 692.148, 435.468 706.227 C 434.111 708.279, 433 710.334, 433 710.796 C 433 711.661, 474.725 813.127, 475.222 813.469 C 475.375 813.574, 478.550 814.465, 482.279 815.449 C 498.604 819.757, 513.082 835.153, 515.805 851.104 L 516.554 855.491 567.936 876.881 C 618.734 898.027, 619.347 898.251, 621.909 896.576 C 627.307 893.047, 635.361 889.932, 642.058 888.783 C 652.935 886.918, 665.839 889.876, 676.110 896.588 C 678.696 898.278, 679.182 898.100, 730.033 876.896 L 781.347 855.500 782.645 849.773 C 786.027 834.851, 797.531 821.793, 812.043 816.402 C 814.494 815.491, 820.983 814.465, 826.463 814.123 L 836.426 813.500 857.630 762.116 L 878.834 710.732 876.020 708.363 C 869.483 702.863, 864 690.380, 864 681 C 864 671.620, 869.483 659.137, 876.020 653.637 L 878.834 651.268 857.630 599.884 L 836.426 548.500 826.463 547.877 C 820.983 547.535, 814.494 546.509, 812.043 545.598 C 797.531 540.207, 786.029 527.151, 782.644 512.227 L 781.345 506.500 742.423 490.253 C 721.015 481.317, 697.845 471.694, 690.934 468.867 L 678.368 463.728 674.368 466.375 C 659.972 475.902, 638.117 475.961, 623.837 466.511 C 621.750 465.130, 619.696 464.013, 619.271 464.028 C 618.847 464.044, 595.562 473.606, 567.527 485.278 M 158.490 554.176 C 158.212 554.904, 158.101 612.425, 158.243 682 C 158.483 799.904, 158.615 808.500, 160.187 808.500 C 161.288 808.500, 174.210 790.610, 197.388 757 C 230.693 708.705, 232.810 705.376, 231.417 703.500 C 230.601 702.400, 228.715 699.025, 227.226 696 C 224.861 691.192, 224.521 689.304, 224.521 681 C 224.521 672.696, 224.861 670.808, 227.226 666 C 228.715 662.975, 230.601 659.600, 231.417 658.500 C 232.810 656.624, 230.693 653.295, 197.400 605 C 177.874 576.675, 161.245 553.354, 160.446 553.176 C 159.647 552.998, 158.767 553.448, 158.490 554.176 M 1098.798 604.724 C 1065.328 653.269, 1063.193 656.625, 1064.584 658.500 C 1065.400 659.600, 1067.285 662.975, 1068.774 666 C 1071.139 670.808, 1071.479 672.696, 1071.479 681 C 1071.479 689.304, 1071.139 691.192, 1068.774 696 C 1067.285 699.025, 1065.399 702.400, 1064.583 703.500 C 1063.190 705.376, 1065.307 708.705, 1098.612 757 C 1121.790 790.610, 1134.712 808.500, 1135.813 808.500 C 1137.387 808.500, 1137.500 799.944, 1137.500 681.014 C 1137.500 568.405, 1137.325 553.494, 1135.998 553.238 C 1135.003 553.047, 1122.439 570.436, 1098.798 604.724 M 294.201 696.385 C 292.549 699.915, 289.369 704.631, 287.135 706.865 L 283.072 710.928 325.878 814.714 L 368.684 918.500 376.141 919.114 C 380.433 919.468, 385.698 920.664, 388.549 921.933 L 393.500 924.138 412.090 904.855 L 430.680 885.572 428.918 882.536 C 421.476 869.718, 422.422 848.054, 430.978 835.377 L 433.773 831.237 412.794 780.368 C 401.256 752.391, 391.398 728.994, 390.889 728.375 C 390.379 727.756, 388.070 726.947, 385.757 726.577 C 371.515 724.300, 357.115 711.113, 351.836 695.513 L 350.139 690.500 323.671 690.234 L 297.204 689.968 294.201 696.385 M 934.589 695.586 C 933.183 698.658, 930.673 702.887, 929.013 704.984 C 923.063 712.497, 911.053 717.995, 900.568 718.005 L 895.500 718.010 874.318 769.255 L 853.137 820.500 858.451 825.230 C 874.859 839.834, 879.174 864.169, 868.727 883.188 L 866.701 886.877 884.508 905.438 C 894.302 915.647, 902.412 924, 902.530 924 C 902.649 924, 904.919 923.039, 907.574 921.864 C 910.279 920.668, 915.684 919.458, 919.860 919.114 L 927.317 918.500 970.129 814.720 L 1012.940 710.940 1008.871 706.871 C 1006.634 704.634, 1003.455 699.922, 1001.807 696.401 L 998.811 690 967.979 690 L 937.147 690 934.589 695.586 M 211.894 767.783 C 181.821 811.465, 176.487 819.733, 177.566 821 C 181.761 825.930, 184.382 833.686, 184.935 842.809 L 185.500 852.119 265 891.543 C 308.725 913.227, 344.950 930.959, 345.500 930.948 C 346.050 930.937, 347.782 929.880, 349.348 928.598 L 352.196 926.268 309.348 822.384 L 266.500 718.500 260 717.913 C 256.425 717.590, 252.150 717.042, 250.500 716.696 C 247.510 716.069, 247.378 716.244, 211.894 767.783 M 1045.798 716.536 C 1045.503 716.830, 1041.719 717.393, 1037.390 717.786 L 1029.517 718.500 986.658 822.382 L 943.798 926.264 946.649 928.596 C 948.217 929.879, 949.950 930.937, 950.500 930.948 C 951.050 930.959, 987.275 913.227, 1031 891.543 L 1110.500 852.119 1111.065 842.809 C 1111.618 833.686, 1114.239 825.930, 1118.434 821 C 1119.513 819.733, 1114.179 811.468, 1084.106 767.800 C 1064.522 739.365, 1048.013 716.077, 1047.417 716.050 C 1046.821 716.022, 1046.092 716.241, 1045.798 716.536 M 181.301 873.747 C 183.214 876.361, 216.365 922.150, 254.971 975.500 C 303.203 1042.152, 325.686 1072.445, 326.832 1072.326 C 327.749 1072.230, 330.743 1071.775, 333.486 1071.315 L 338.471 1070.479 347.893 1029.618 C 356.910 990.512, 357.233 988.712, 355.408 987.743 C 354.358 987.185, 350.975 984.171, 347.889 981.044 C 340.646 973.706, 337.780 966.626, 337.623 955.685 L 337.511 947.870 269.006 913.822 C 231.328 895.095, 195.398 877.347, 189.162 874.383 L 177.825 868.993 181.301 873.747 M 1038.038 908.417 L 958.576 947.833 958.410 955.667 C 958.170 967.061, 955.305 973.868, 947.438 981.742 L 941.202 987.983 951.620 1021.742 C 957.349 1040.309, 962.284 1056.287, 962.586 1057.250 C 962.962 1058.449, 964.166 1059, 966.408 1059 C 968.209 1059, 971.711 1059.611, 974.191 1060.357 L 978.701 1061.714 1047.100 967.189 C 1126.461 857.517, 1118.191 869, 1117.807 869.001 C 1117.638 869.001, 1081.742 886.739, 1038.038 908.417 M 494 900.692 C 486.499 905.290, 480.127 907, 470.500 907 C 461.593 907, 453.731 905.118, 447.428 901.477 L 443.356 899.124 424.643 917.857 L 405.931 936.589 408.101 941.496 C 409.344 944.306, 410.534 949.624, 410.886 953.940 L 411.500 961.477 483 991.223 C 522.325 1007.583, 568.766 1026.886, 586.202 1034.120 L 617.904 1047.272 622.955 1042.730 C 625.734 1040.232, 630.487 1037.160, 633.519 1035.904 L 639.032 1033.619 638.766 1007.232 L 638.500 980.846 633.472 979.076 C 622.187 975.102, 613.149 967.018, 607.607 955.941 C 605.688 952.105, 603.820 946.983, 603.457 944.560 L 602.796 940.154 554.148 919.913 C 527.392 908.781, 504.150 899.143, 502.500 898.496 C 499.790 897.434, 498.968 897.646, 494 900.692 M 746.668 918.762 C 699.229 938.476, 695 940.425, 695 942.579 C 695 945.300, 691.408 955.350, 689.132 959 C 682.932 968.939, 673.392 976.468, 663.087 979.555 L 657 981.379 657 1007.505 L 657 1033.632 662.497 1035.910 C 665.520 1037.163, 670.266 1040.232, 673.044 1042.730 L 678.096 1047.271 721.798 1029.122 C 745.834 1019.141, 792.275 999.838, 825 986.227 L 884.500 961.481 885.114 953.942 C 885.466 949.621, 886.655 944.307, 887.901 941.491 L 890.073 936.580 871.713 918.220 L 853.353 899.859 849.926 901.845 C 836.892 909.400, 816.722 908.662, 802.918 900.125 L 798.336 897.292 746.668 918.762 M 401.672 980.569 C 398.605 984.787, 389.906 989.834, 382.500 991.691 C 378.650 992.656, 375.356 993.527, 375.181 993.626 C 375.005 993.725, 370.663 1011.962, 365.531 1034.153 C 357.137 1070.454, 356.366 1074.594, 357.851 1075.436 C 361.687 1077.612, 369.834 1086.305, 371.501 1090.002 C 372.493 1092.201, 373.798 1093.999, 374.402 1093.997 C 377.175 1093.988, 610.258 1065.075, 610.642 1064.692 C 610.965 1064.368, 411.927 981.040, 404.791 978.511 C 404.081 978.260, 402.677 979.185, 401.672 980.569 M 789.109 1020.823 C 732.795 1044.296, 687.345 1063.612, 688.109 1063.749 C 688.874 1063.886, 741.025 1068.264, 804 1073.478 C 866.975 1078.692, 921.058 1083.233, 924.184 1083.569 L 929.867 1084.181 932.066 1079.871 C 935.217 1073.694, 937.985 1070.195, 942.139 1067.134 L 945.778 1064.453 934.722 1028.726 L 923.665 993 920.514 993 C 912.528 993, 899.726 987.029, 894.567 980.897 C 893.226 979.304, 891.988 978.033, 891.815 978.073 C 891.642 978.114, 845.424 997.351, 789.109 1020.823 M 680.599 1086.750 C 677.284 1093.219, 669.684 1100.361, 662.750 1103.524 L 657 1106.147 657 1139.339 L 657 1172.531 662.125 1174.351 C 665.594 1175.583, 669.214 1178.081, 673.331 1182.085 C 676.676 1185.338, 679.769 1188, 680.204 1188 C 680.639 1188, 734.883 1170.430, 800.747 1148.956 C 866.611 1127.482, 922.572 1109.243, 925.105 1108.424 C 929.187 1107.105, 929.657 1106.655, 929.239 1104.468 C 928.929 1102.848, 928.096 1102, 926.816 1102 C 925.743 1102, 870.926 1097.500, 805 1092 C 739.074 1086.500, 684.662 1082, 684.085 1082 C 683.507 1082, 681.938 1084.138, 680.599 1086.750 M 497.286 1097.346 C 434.468 1105.115, 383.393 1111.774, 383.786 1112.144 C 384.527 1112.842, 614.405 1188, 615.798 1188 C 616.232 1188, 619.324 1185.338, 622.669 1182.085 C 626.786 1178.081, 630.406 1175.583, 633.875 1174.351 L 639 1172.531 639 1139.360 L 639 1106.189 632.750 1103.225 C 625.632 1099.849, 618.087 1092.738, 615.473 1086.941 C 614.496 1084.773, 613.202 1083.050, 612.598 1083.111 C 611.994 1083.171, 560.104 1089.577, 497.286 1097.346" stroke="none" fill="#ffffff" fill-rule="evenodd"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            numerblox
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              API Reference
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="cyan"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="cyan"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/crowdcent/numerblox/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    crowdcent/numerblox
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="numerblox" class="md-nav__button md-logo" aria-label="numerblox" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" width="1291" height="1361" viewBox="0 0 1291 1361" version="1.1"><path d="M 636.005 118.611 C 627.343 121.752, 619.115 128.910, 615.125 136.778 C 613.382 140.213, 611.355 148.147, 610.751 153.891 C 610.514 156.147, 603.824 158.460, 491.500 195.116 C 426.050 216.476, 372.133 233.962, 371.685 233.976 C 371.237 233.989, 368.661 231.732, 365.960 228.959 C 362.928 225.846, 358.474 222.713, 354.315 220.766 C 348.491 218.041, 346.490 217.617, 339.539 217.633 C 329.185 217.658, 321.919 220.393, 314.713 226.979 C 301.756 238.822, 298.869 256.746, 307.382 272.500 L 310.625 278.500 236.755 380.500 C 167.959 475.493, 162.700 482.480, 160.192 482.215 C 158.712 482.059, 153.450 481.834, 148.500 481.715 C 140.567 481.526, 138.822 481.818, 133.782 484.180 C 126.229 487.720, 119.035 494.595, 115.426 501.722 C 112.744 507.018, 112.500 508.376, 112.500 518 C 112.500 527.544, 112.756 529.001, 115.315 534 C 119.169 541.532, 126.088 548.318, 133.140 551.482 L 139 554.112 139 681 L 139 807.888 133.140 810.518 C 126.088 813.682, 119.169 820.468, 115.315 828 C 112.756 832.999, 112.500 834.456, 112.500 844 C 112.500 853.624, 112.744 854.982, 115.426 860.278 C 119.035 867.405, 126.229 874.280, 133.782 877.820 C 138.800 880.172, 140.601 880.477, 148.500 880.314 C 153.450 880.212, 158.715 879.987, 160.201 879.814 C 162.728 879.520, 167.665 886.079, 236.761 981.500 L 310.621 1083.500 307.381 1089.500 C 294.626 1113.115, 308.461 1140.498, 335.170 1144.503 C 345.174 1146.003, 358.034 1141.179, 366.096 1132.902 C 368.722 1130.206, 371.237 1128.010, 371.685 1128.023 C 372.133 1128.035, 426.050 1145.525, 491.500 1166.890 C 603.672 1203.505, 610.514 1205.871, 610.751 1208.117 C 612.038 1220.320, 615.982 1229, 623.182 1235.474 C 631.402 1242.864, 635.865 1244.484, 648 1244.484 C 660.135 1244.484, 664.598 1242.864, 672.818 1235.474 C 680.018 1229.001, 683.962 1220.320, 685.249 1208.118 C 685.486 1205.871, 692.731 1203.376, 812.283 1164.374 L 939.067 1123.013 944.157 1126.515 C 959.346 1136.962, 980.470 1134.423, 992.479 1120.707 C 1003.197 1108.465, 1004.849 1089.695, 996.356 1076.661 C 994.980 1074.550, 994.066 1072.300, 994.325 1071.661 C 994.584 1071.023, 1025.919 1027.525, 1063.958 975 C 1128.531 885.837, 1133.299 879.521, 1135.810 879.814 C 1137.290 879.987, 1142.550 880.212, 1147.500 880.314 C 1155.399 880.477, 1157.200 880.172, 1162.218 877.820 C 1169.771 874.280, 1176.965 867.405, 1180.574 860.278 C 1183.256 854.982, 1183.500 853.624, 1183.500 844 C 1183.500 834.376, 1183.256 833.018, 1180.574 827.722 C 1176.984 820.633, 1169.742 813.687, 1162.468 810.357 L 1157 807.853 1157 680.983 L 1157 554.112 1162.860 551.482 C 1169.912 548.318, 1176.831 541.532, 1180.685 534 C 1183.244 529.001, 1183.500 527.544, 1183.500 518 C 1183.500 508.376, 1183.256 507.018, 1180.574 501.722 C 1176.965 494.595, 1169.771 487.720, 1162.218 484.180 C 1157.178 481.818, 1155.433 481.526, 1147.500 481.715 C 1142.550 481.834, 1137.288 482.059, 1135.807 482.215 C 1133.299 482.480, 1128.051 475.503, 1059.246 380.430 L 985.377 278.361 988.631 272.484 C 997.163 257.076, 994.212 238.792, 981.287 226.979 C 974.081 220.393, 966.815 217.658, 956.461 217.633 C 949.510 217.617, 947.509 218.041, 941.685 220.766 C 937.526 222.713, 933.072 225.846, 930.040 228.959 C 927.339 231.732, 924.763 233.989, 924.315 233.976 C 923.867 233.962, 869.950 216.476, 804.500 195.116 C 692.176 158.460, 685.486 156.147, 685.249 153.891 C 684.558 147.315, 682.529 140.010, 680.184 135.652 C 677.041 129.810, 669.799 123.084, 663.280 119.951 C 656.934 116.901, 642.658 116.199, 636.005 118.611 M 499.500 211.631 C 436.250 232.285, 384.178 249.487, 383.784 249.857 C 383.391 250.228, 434.016 256.756, 496.284 264.364 C 558.553 271.971, 610.431 278.405, 611.570 278.661 C 613.208 279.029, 614.015 278.293, 615.445 275.122 C 618.085 269.267, 625.605 262.164, 632.750 258.775 L 639 255.811 639 222.640 L 639 189.469 633.875 187.649 C 630.406 186.417, 626.786 183.919, 622.669 179.915 C 619.324 176.662, 616.117 174.018, 615.543 174.040 C 614.970 174.061, 562.750 190.977, 499.500 211.631 M 672.848 180.087 C 668.920 184.091, 665.642 186.400, 662.098 187.659 L 657 189.469 657 222.640 L 657 255.811 663.250 258.775 C 670.395 262.164, 677.915 269.267, 680.555 275.122 C 681.985 278.293, 682.792 279.029, 684.430 278.661 C 685.569 278.405, 737.447 271.971, 799.716 264.364 C 861.984 256.756, 912.609 250.228, 912.216 249.857 C 911.143 248.845, 681.209 173.974, 679.755 174.163 C 679.065 174.252, 675.957 176.918, 672.848 180.087 M 371.501 271.998 C 369.834 275.695, 361.687 284.388, 357.851 286.564 C 356.366 287.406, 357.137 291.546, 365.531 327.847 C 370.663 350.038, 375.005 368.275, 375.181 368.374 C 375.356 368.473, 378.628 369.341, 382.452 370.302 C 389.979 372.195, 397.569 376.510, 401.417 381.083 L 403.838 383.961 507.658 340.766 C 602.665 301.237, 611.182 297.505, 607.989 296.806 C 604.890 296.128, 376.676 268, 374.271 268 C 373.739 268, 372.493 269.799, 371.501 271.998 M 801.653 282.531 C 737.937 290.412, 685.609 297.058, 685.367 297.300 C 685.125 297.541, 731.555 317.139, 788.545 340.850 L 892.162 383.961 894.583 381.083 C 898.431 376.510, 906.021 372.195, 913.548 370.302 C 917.372 369.341, 920.644 368.473, 920.819 368.374 C 920.995 368.275, 925.337 350.038, 930.469 327.847 C 938.863 291.546, 939.634 287.406, 938.149 286.564 C 934.313 284.388, 926.166 275.695, 924.499 271.998 C 923.039 268.760, 922.202 268.019, 920.098 268.101 C 918.669 268.157, 865.369 274.650, 801.653 282.531 M 253 389.124 C 213.125 444.232, 179.919 490.139, 179.208 491.139 C 177.573 493.440, 187.111 488.872, 271.006 447.175 L 337.512 414.119 337.623 406.310 C 337.780 395.375, 340.647 388.293, 347.889 380.956 C 350.975 377.829, 354.358 374.815, 355.408 374.257 C 357.233 373.288, 356.910 371.488, 347.891 332.372 L 338.468 291.500 334.484 290.900 C 332.293 290.571, 329.375 289.991, 328 289.613 C 325.635 288.963, 321.581 294.343, 253 389.124 M 967.799 289.534 C 967.467 289.866, 965.021 290.449, 962.362 290.829 L 957.529 291.521 948.107 332.382 C 939.090 371.488, 938.767 373.288, 940.592 374.257 C 941.642 374.815, 945.025 377.829, 948.111 380.956 C 955.353 388.293, 958.220 395.375, 958.377 406.310 L 958.488 414.119 1024.994 447.175 C 1061.572 465.355, 1097.500 483.102, 1104.834 486.613 L 1118.168 492.997 1114.700 488.249 C 1112.792 485.637, 1079.655 439.850, 1041.063 386.500 C 1002.470 333.150, 970.334 289.372, 969.649 289.215 C 968.963 289.059, 968.131 289.202, 967.799 289.534 M 514 357.827 L 411.500 400.530 410.886 408.064 C 410.534 412.376, 409.344 417.695, 408.101 420.504 L 405.931 425.411 424.643 444.143 L 443.356 462.876 447.428 460.523 C 453.731 456.882, 461.593 455, 470.500 455 C 480.127 455, 486.446 456.692, 494.157 461.335 L 499.813 464.742 551.306 443.287 L 602.798 421.832 603.458 417.433 C 603.821 415.014, 605.688 409.895, 607.607 406.059 C 613.149 394.982, 622.187 386.898, 633.472 382.924 L 638.500 381.154 638.766 354.768 L 639.032 328.381 633.519 326.096 C 630.487 324.840, 625.802 321.829, 623.106 319.406 C 620.411 316.983, 617.822 315.028, 617.353 315.062 C 616.884 315.096, 570.375 334.340, 514 357.827 M 672.766 319.437 C 670.163 321.834, 665.550 324.824, 662.516 326.082 L 657 328.368 657 354.495 L 657 380.621 663.087 382.445 C 673.392 385.532, 682.932 393.061, 689.132 403 C 691.409 406.651, 695 416.701, 695 419.424 C 695 421.581, 699.206 423.520, 746.661 443.244 L 798.323 464.717 802.911 461.879 C 816.722 453.338, 836.890 452.598, 849.926 460.155 L 853.353 462.141 871.713 443.780 L 890.073 425.420 887.901 420.509 C 886.656 417.694, 885.466 412.379, 885.114 408.059 L 884.500 400.520 782 357.822 C 725.625 334.338, 679.050 315.114, 678.500 315.102 C 677.950 315.089, 675.370 317.040, 672.766 319.437 M 265 470.457 L 185.500 509.873 184.935 519.187 C 184.382 528.314, 181.762 536.069, 177.566 541 C 176.487 542.267, 181.821 550.538, 211.894 594.232 C 245.403 642.916, 247.647 645.927, 250 645.337 C 251.375 644.993, 255.650 644.438, 259.500 644.105 L 266.500 643.500 309.348 539.616 L 352.196 435.732 349.348 433.402 C 347.782 432.120, 346.050 431.065, 345.500 431.057 C 344.950 431.048, 308.725 448.778, 265 470.457 M 946.647 433.406 L 943.794 435.739 986.647 539.620 L 1029.500 643.500 1036.500 644.105 C 1040.350 644.438, 1044.625 644.993, 1046 645.337 C 1048.353 645.927, 1050.597 642.916, 1084.106 594.232 C 1114.179 550.538, 1119.513 542.267, 1118.434 541 C 1114.238 536.069, 1111.618 528.314, 1111.065 519.187 L 1110.500 509.873 1031 470.457 C 987.275 448.778, 951.050 431.048, 950.500 431.057 C 949.950 431.065, 948.216 432.122, 946.647 433.406 M 388.020 440.222 C 385.525 441.366, 380.249 442.547, 376.112 442.888 L 368.684 443.500 325.878 547.286 L 283.072 651.072 287.135 655.135 C 289.369 657.369, 292.549 662.085, 294.201 665.615 L 297.204 672.032 323.671 671.766 L 350.139 671.500 351.836 666.487 C 357.115 650.887, 371.515 637.700, 385.757 635.423 C 388.070 635.053, 390.379 634.244, 390.889 633.625 C 391.398 633.006, 401.256 609.609, 412.794 581.632 L 433.773 530.763 430.978 526.623 C 423.924 516.170, 421.848 499.967, 425.901 486.986 C 427.020 483.403, 428.575 479.596, 429.357 478.526 C 430.682 476.715, 429.497 475.245, 412.235 457.290 C 402.034 446.681, 393.421 438.038, 393.094 438.084 C 392.768 438.131, 390.484 439.093, 388.020 440.222 M 884.573 456.466 L 866.866 474.933 869.878 481.245 C 878.944 500.241, 874.342 522.616, 858.457 536.770 L 853.149 541.500 874.268 592.620 L 895.388 643.741 903.033 644.265 C 917.126 645.231, 928.206 652.805, 934.170 665.549 L 937.189 672 968 672 L 998.811 672 1001.807 665.599 C 1003.455 662.078, 1006.634 657.366, 1008.871 655.129 L 1012.940 651.060 970.129 547.280 L 927.317 443.500 919.860 442.886 C 915.684 442.542, 910.279 441.332, 907.574 440.136 C 904.919 438.961, 902.641 438, 902.513 438 C 902.384 438, 894.311 446.310, 884.573 456.466 M 567.527 485.278 L 516.553 506.500 515.805 510.892 C 513.069 526.940, 498.447 542.403, 482 546.640 L 475.096 548.418 454.404 598.459 C 443.023 625.982, 433.512 649.238, 433.268 650.139 C 433.024 651.041, 433.975 653.516, 435.381 655.640 C 444.747 669.793, 444.785 692.148, 435.468 706.227 C 434.111 708.279, 433 710.334, 433 710.796 C 433 711.661, 474.725 813.127, 475.222 813.469 C 475.375 813.574, 478.550 814.465, 482.279 815.449 C 498.604 819.757, 513.082 835.153, 515.805 851.104 L 516.554 855.491 567.936 876.881 C 618.734 898.027, 619.347 898.251, 621.909 896.576 C 627.307 893.047, 635.361 889.932, 642.058 888.783 C 652.935 886.918, 665.839 889.876, 676.110 896.588 C 678.696 898.278, 679.182 898.100, 730.033 876.896 L 781.347 855.500 782.645 849.773 C 786.027 834.851, 797.531 821.793, 812.043 816.402 C 814.494 815.491, 820.983 814.465, 826.463 814.123 L 836.426 813.500 857.630 762.116 L 878.834 710.732 876.020 708.363 C 869.483 702.863, 864 690.380, 864 681 C 864 671.620, 869.483 659.137, 876.020 653.637 L 878.834 651.268 857.630 599.884 L 836.426 548.500 826.463 547.877 C 820.983 547.535, 814.494 546.509, 812.043 545.598 C 797.531 540.207, 786.029 527.151, 782.644 512.227 L 781.345 506.500 742.423 490.253 C 721.015 481.317, 697.845 471.694, 690.934 468.867 L 678.368 463.728 674.368 466.375 C 659.972 475.902, 638.117 475.961, 623.837 466.511 C 621.750 465.130, 619.696 464.013, 619.271 464.028 C 618.847 464.044, 595.562 473.606, 567.527 485.278 M 158.490 554.176 C 158.212 554.904, 158.101 612.425, 158.243 682 C 158.483 799.904, 158.615 808.500, 160.187 808.500 C 161.288 808.500, 174.210 790.610, 197.388 757 C 230.693 708.705, 232.810 705.376, 231.417 703.500 C 230.601 702.400, 228.715 699.025, 227.226 696 C 224.861 691.192, 224.521 689.304, 224.521 681 C 224.521 672.696, 224.861 670.808, 227.226 666 C 228.715 662.975, 230.601 659.600, 231.417 658.500 C 232.810 656.624, 230.693 653.295, 197.400 605 C 177.874 576.675, 161.245 553.354, 160.446 553.176 C 159.647 552.998, 158.767 553.448, 158.490 554.176 M 1098.798 604.724 C 1065.328 653.269, 1063.193 656.625, 1064.584 658.500 C 1065.400 659.600, 1067.285 662.975, 1068.774 666 C 1071.139 670.808, 1071.479 672.696, 1071.479 681 C 1071.479 689.304, 1071.139 691.192, 1068.774 696 C 1067.285 699.025, 1065.399 702.400, 1064.583 703.500 C 1063.190 705.376, 1065.307 708.705, 1098.612 757 C 1121.790 790.610, 1134.712 808.500, 1135.813 808.500 C 1137.387 808.500, 1137.500 799.944, 1137.500 681.014 C 1137.500 568.405, 1137.325 553.494, 1135.998 553.238 C 1135.003 553.047, 1122.439 570.436, 1098.798 604.724 M 294.201 696.385 C 292.549 699.915, 289.369 704.631, 287.135 706.865 L 283.072 710.928 325.878 814.714 L 368.684 918.500 376.141 919.114 C 380.433 919.468, 385.698 920.664, 388.549 921.933 L 393.500 924.138 412.090 904.855 L 430.680 885.572 428.918 882.536 C 421.476 869.718, 422.422 848.054, 430.978 835.377 L 433.773 831.237 412.794 780.368 C 401.256 752.391, 391.398 728.994, 390.889 728.375 C 390.379 727.756, 388.070 726.947, 385.757 726.577 C 371.515 724.300, 357.115 711.113, 351.836 695.513 L 350.139 690.500 323.671 690.234 L 297.204 689.968 294.201 696.385 M 934.589 695.586 C 933.183 698.658, 930.673 702.887, 929.013 704.984 C 923.063 712.497, 911.053 717.995, 900.568 718.005 L 895.500 718.010 874.318 769.255 L 853.137 820.500 858.451 825.230 C 874.859 839.834, 879.174 864.169, 868.727 883.188 L 866.701 886.877 884.508 905.438 C 894.302 915.647, 902.412 924, 902.530 924 C 902.649 924, 904.919 923.039, 907.574 921.864 C 910.279 920.668, 915.684 919.458, 919.860 919.114 L 927.317 918.500 970.129 814.720 L 1012.940 710.940 1008.871 706.871 C 1006.634 704.634, 1003.455 699.922, 1001.807 696.401 L 998.811 690 967.979 690 L 937.147 690 934.589 695.586 M 211.894 767.783 C 181.821 811.465, 176.487 819.733, 177.566 821 C 181.761 825.930, 184.382 833.686, 184.935 842.809 L 185.500 852.119 265 891.543 C 308.725 913.227, 344.950 930.959, 345.500 930.948 C 346.050 930.937, 347.782 929.880, 349.348 928.598 L 352.196 926.268 309.348 822.384 L 266.500 718.500 260 717.913 C 256.425 717.590, 252.150 717.042, 250.500 716.696 C 247.510 716.069, 247.378 716.244, 211.894 767.783 M 1045.798 716.536 C 1045.503 716.830, 1041.719 717.393, 1037.390 717.786 L 1029.517 718.500 986.658 822.382 L 943.798 926.264 946.649 928.596 C 948.217 929.879, 949.950 930.937, 950.500 930.948 C 951.050 930.959, 987.275 913.227, 1031 891.543 L 1110.500 852.119 1111.065 842.809 C 1111.618 833.686, 1114.239 825.930, 1118.434 821 C 1119.513 819.733, 1114.179 811.468, 1084.106 767.800 C 1064.522 739.365, 1048.013 716.077, 1047.417 716.050 C 1046.821 716.022, 1046.092 716.241, 1045.798 716.536 M 181.301 873.747 C 183.214 876.361, 216.365 922.150, 254.971 975.500 C 303.203 1042.152, 325.686 1072.445, 326.832 1072.326 C 327.749 1072.230, 330.743 1071.775, 333.486 1071.315 L 338.471 1070.479 347.893 1029.618 C 356.910 990.512, 357.233 988.712, 355.408 987.743 C 354.358 987.185, 350.975 984.171, 347.889 981.044 C 340.646 973.706, 337.780 966.626, 337.623 955.685 L 337.511 947.870 269.006 913.822 C 231.328 895.095, 195.398 877.347, 189.162 874.383 L 177.825 868.993 181.301 873.747 M 1038.038 908.417 L 958.576 947.833 958.410 955.667 C 958.170 967.061, 955.305 973.868, 947.438 981.742 L 941.202 987.983 951.620 1021.742 C 957.349 1040.309, 962.284 1056.287, 962.586 1057.250 C 962.962 1058.449, 964.166 1059, 966.408 1059 C 968.209 1059, 971.711 1059.611, 974.191 1060.357 L 978.701 1061.714 1047.100 967.189 C 1126.461 857.517, 1118.191 869, 1117.807 869.001 C 1117.638 869.001, 1081.742 886.739, 1038.038 908.417 M 494 900.692 C 486.499 905.290, 480.127 907, 470.500 907 C 461.593 907, 453.731 905.118, 447.428 901.477 L 443.356 899.124 424.643 917.857 L 405.931 936.589 408.101 941.496 C 409.344 944.306, 410.534 949.624, 410.886 953.940 L 411.500 961.477 483 991.223 C 522.325 1007.583, 568.766 1026.886, 586.202 1034.120 L 617.904 1047.272 622.955 1042.730 C 625.734 1040.232, 630.487 1037.160, 633.519 1035.904 L 639.032 1033.619 638.766 1007.232 L 638.500 980.846 633.472 979.076 C 622.187 975.102, 613.149 967.018, 607.607 955.941 C 605.688 952.105, 603.820 946.983, 603.457 944.560 L 602.796 940.154 554.148 919.913 C 527.392 908.781, 504.150 899.143, 502.500 898.496 C 499.790 897.434, 498.968 897.646, 494 900.692 M 746.668 918.762 C 699.229 938.476, 695 940.425, 695 942.579 C 695 945.300, 691.408 955.350, 689.132 959 C 682.932 968.939, 673.392 976.468, 663.087 979.555 L 657 981.379 657 1007.505 L 657 1033.632 662.497 1035.910 C 665.520 1037.163, 670.266 1040.232, 673.044 1042.730 L 678.096 1047.271 721.798 1029.122 C 745.834 1019.141, 792.275 999.838, 825 986.227 L 884.500 961.481 885.114 953.942 C 885.466 949.621, 886.655 944.307, 887.901 941.491 L 890.073 936.580 871.713 918.220 L 853.353 899.859 849.926 901.845 C 836.892 909.400, 816.722 908.662, 802.918 900.125 L 798.336 897.292 746.668 918.762 M 401.672 980.569 C 398.605 984.787, 389.906 989.834, 382.500 991.691 C 378.650 992.656, 375.356 993.527, 375.181 993.626 C 375.005 993.725, 370.663 1011.962, 365.531 1034.153 C 357.137 1070.454, 356.366 1074.594, 357.851 1075.436 C 361.687 1077.612, 369.834 1086.305, 371.501 1090.002 C 372.493 1092.201, 373.798 1093.999, 374.402 1093.997 C 377.175 1093.988, 610.258 1065.075, 610.642 1064.692 C 610.965 1064.368, 411.927 981.040, 404.791 978.511 C 404.081 978.260, 402.677 979.185, 401.672 980.569 M 789.109 1020.823 C 732.795 1044.296, 687.345 1063.612, 688.109 1063.749 C 688.874 1063.886, 741.025 1068.264, 804 1073.478 C 866.975 1078.692, 921.058 1083.233, 924.184 1083.569 L 929.867 1084.181 932.066 1079.871 C 935.217 1073.694, 937.985 1070.195, 942.139 1067.134 L 945.778 1064.453 934.722 1028.726 L 923.665 993 920.514 993 C 912.528 993, 899.726 987.029, 894.567 980.897 C 893.226 979.304, 891.988 978.033, 891.815 978.073 C 891.642 978.114, 845.424 997.351, 789.109 1020.823 M 680.599 1086.750 C 677.284 1093.219, 669.684 1100.361, 662.750 1103.524 L 657 1106.147 657 1139.339 L 657 1172.531 662.125 1174.351 C 665.594 1175.583, 669.214 1178.081, 673.331 1182.085 C 676.676 1185.338, 679.769 1188, 680.204 1188 C 680.639 1188, 734.883 1170.430, 800.747 1148.956 C 866.611 1127.482, 922.572 1109.243, 925.105 1108.424 C 929.187 1107.105, 929.657 1106.655, 929.239 1104.468 C 928.929 1102.848, 928.096 1102, 926.816 1102 C 925.743 1102, 870.926 1097.500, 805 1092 C 739.074 1086.500, 684.662 1082, 684.085 1082 C 683.507 1082, 681.938 1084.138, 680.599 1086.750 M 497.286 1097.346 C 434.468 1105.115, 383.393 1111.774, 383.786 1112.144 C 384.527 1112.842, 614.405 1188, 615.798 1188 C 616.232 1188, 619.324 1185.338, 622.669 1182.085 C 626.786 1178.081, 630.406 1175.583, 633.875 1174.351 L 639 1172.531 639 1139.360 L 639 1106.189 632.750 1103.225 C 625.632 1099.849, 618.087 1092.738, 615.473 1086.941 C 614.496 1084.773, 613.202 1083.050, 612.598 1083.111 C 611.994 1083.171, 560.104 1089.577, 497.286 1097.346" stroke="none" fill="#ffffff" fill-rule="evenodd"/></svg>

    </a>
    numerblox
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/crowdcent/numerblox/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    crowdcent/numerblox
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../end_to_end/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    End-To-End Examples
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Blox
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Blox
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../download/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Downloaders
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../numerframe/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    NumerFrame
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../preprocessing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Preprocessing
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../targets/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Target Engineering
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../postprocessing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Postprocessing
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../meta/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Meta Pipelines
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../prediction_loaders/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Prediction Loaders
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../models/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Models
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../evaluation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Evaluation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../submission/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Submitters
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  <span class="md-ellipsis">
    API
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            API
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    API Reference
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    API Reference
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#numerblox.download" class="md-nav__link">
    <span class="md-ellipsis">
      download
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.download.BaseDownloader" class="md-nav__link">
    <span class="md-ellipsis">
      BaseDownloader
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BaseDownloader">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.download.BaseDownloader.__call__" class="md-nav__link">
    <span class="md-ellipsis">
      __call__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.download.BaseDownloader.download_live_data" class="md-nav__link">
    <span class="md-ellipsis">
      download_live_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.download.BaseDownloader.download_training_data" class="md-nav__link">
    <span class="md-ellipsis">
      download_training_data
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.download.BaseIO" class="md-nav__link">
    <span class="md-ellipsis">
      BaseIO
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BaseIO">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.download.BaseIO.get_all_files" class="md-nav__link">
    <span class="md-ellipsis">
      get_all_files
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.download.BaseIO.is_empty" class="md-nav__link">
    <span class="md-ellipsis">
      is_empty
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.download.BaseIO.download_directory_from_gcs" class="md-nav__link">
    <span class="md-ellipsis">
      download_directory_from_gcs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.download.BaseIO.download_file_from_gcs" class="md-nav__link">
    <span class="md-ellipsis">
      download_file_from_gcs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.download.BaseIO.remove_base_directory" class="md-nav__link">
    <span class="md-ellipsis">
      remove_base_directory
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.download.BaseIO.upload_directory_to_gcs" class="md-nav__link">
    <span class="md-ellipsis">
      upload_directory_to_gcs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.download.BaseIO.upload_file_to_gcs" class="md-nav__link">
    <span class="md-ellipsis">
      upload_file_to_gcs
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.download.EODDownloader" class="md-nav__link">
    <span class="md-ellipsis">
      EODDownloader
    </span>
  </a>
  
    <nav class="md-nav" aria-label="EODDownloader">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.download.EODDownloader.download_live_data" class="md-nav__link">
    <span class="md-ellipsis">
      download_live_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.download.EODDownloader.download_training_data" class="md-nav__link">
    <span class="md-ellipsis">
      download_training_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.download.EODDownloader.generate_full_dataf" class="md-nav__link">
    <span class="md-ellipsis">
      generate_full_dataf
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.download.EODDownloader.generate_stock_dataf" class="md-nav__link">
    <span class="md-ellipsis">
      generate_stock_dataf
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.download.EODDownloader.get_numerframe_data" class="md-nav__link">
    <span class="md-ellipsis">
      get_numerframe_data
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.download.KaggleDownloader" class="md-nav__link">
    <span class="md-ellipsis">
      KaggleDownloader
    </span>
  </a>
  
    <nav class="md-nav" aria-label="KaggleDownloader">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.download.KaggleDownloader.download_live_data" class="md-nav__link">
    <span class="md-ellipsis">
      download_live_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.download.KaggleDownloader.download_training_data" class="md-nav__link">
    <span class="md-ellipsis">
      download_training_data
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.download.NumeraiClassicDownloader" class="md-nav__link">
    <span class="md-ellipsis">
      NumeraiClassicDownloader
    </span>
  </a>
  
    <nav class="md-nav" aria-label="NumeraiClassicDownloader">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.download.NumeraiClassicDownloader.download_example_data" class="md-nav__link">
    <span class="md-ellipsis">
      download_example_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.download.NumeraiClassicDownloader.download_live_data" class="md-nav__link">
    <span class="md-ellipsis">
      download_live_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.download.NumeraiClassicDownloader.download_meta_model_preds" class="md-nav__link">
    <span class="md-ellipsis">
      download_meta_model_preds
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.download.NumeraiClassicDownloader.download_single_dataset" class="md-nav__link">
    <span class="md-ellipsis">
      download_single_dataset
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.download.NumeraiClassicDownloader.download_training_data" class="md-nav__link">
    <span class="md-ellipsis">
      download_training_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.download.NumeraiClassicDownloader.get_classic_features" class="md-nav__link">
    <span class="md-ellipsis">
      get_classic_features
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.download.NumeraiSignalsDownloader" class="md-nav__link">
    <span class="md-ellipsis">
      NumeraiSignalsDownloader
    </span>
  </a>
  
    <nav class="md-nav" aria-label="NumeraiSignalsDownloader">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.download.NumeraiSignalsDownloader.download_example_data" class="md-nav__link">
    <span class="md-ellipsis">
      download_example_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.download.NumeraiSignalsDownloader.download_live_data" class="md-nav__link">
    <span class="md-ellipsis">
      download_live_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.download.NumeraiSignalsDownloader.download_single_dataset" class="md-nav__link">
    <span class="md-ellipsis">
      download_single_dataset
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.download.NumeraiSignalsDownloader.download_training_data" class="md-nav__link">
    <span class="md-ellipsis">
      download_training_data
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.numerframe" class="md-nav__link">
    <span class="md-ellipsis">
      numerframe
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.numerframe.NumerFrame" class="md-nav__link">
    <span class="md-ellipsis">
      NumerFrame
    </span>
  </a>
  
    <nav class="md-nav" aria-label="NumerFrame">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.numerframe.NumerFrame.get_aux_data" class="md-nav__link">
    <span class="md-ellipsis">
      get_aux_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.numerframe.NumerFrame.get_dates_from_era_col" class="md-nav__link">
    <span class="md-ellipsis">
      get_dates_from_era_col
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.numerframe.NumerFrame.get_era_data" class="md-nav__link">
    <span class="md-ellipsis">
      get_era_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.numerframe.NumerFrame.get_eras_from_date_col" class="md-nav__link">
    <span class="md-ellipsis">
      get_eras_from_date_col
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.numerframe.NumerFrame.get_feature_data" class="md-nav__link">
    <span class="md-ellipsis">
      get_feature_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.numerframe.NumerFrame.get_fncv3_feature_data" class="md-nav__link">
    <span class="md-ellipsis">
      get_fncv3_feature_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.numerframe.NumerFrame.get_medium_feature_data" class="md-nav__link">
    <span class="md-ellipsis">
      get_medium_feature_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.numerframe.NumerFrame.get_prediction_aux_data" class="md-nav__link">
    <span class="md-ellipsis">
      get_prediction_aux_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.numerframe.NumerFrame.get_prediction_data" class="md-nav__link">
    <span class="md-ellipsis">
      get_prediction_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.numerframe.NumerFrame.get_single_target_data" class="md-nav__link">
    <span class="md-ellipsis">
      get_single_target_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.numerframe.NumerFrame.get_small_feature_data" class="md-nav__link">
    <span class="md-ellipsis">
      get_small_feature_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.numerframe.NumerFrame.get_target_data" class="md-nav__link">
    <span class="md-ellipsis">
      get_target_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.numerframe.NumerFrame.get_unique_eras" class="md-nav__link">
    <span class="md-ellipsis">
      get_unique_eras
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.numerframe.NumerFrame.get_v2_equivalent_feature_data" class="md-nav__link">
    <span class="md-ellipsis">
      get_v2_equivalent_feature_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.numerframe.NumerFrame.get_v3_equivalent_feature_data" class="md-nav__link">
    <span class="md-ellipsis">
      get_v3_equivalent_feature_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.numerframe.NumerFrame.__init_meta_attrs" class="md-nav__link">
    <span class="md-ellipsis">
      __init_meta_attrs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.numerframe.NumerFrame.__set_era_col" class="md-nav__link">
    <span class="md-ellipsis">
      __set_era_col
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.numerframe.NumerFrame.get_column_selection" class="md-nav__link">
    <span class="md-ellipsis">
      get_column_selection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.numerframe.NumerFrame.get_date_from_era" class="md-nav__link">
    <span class="md-ellipsis">
      get_date_from_era
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.numerframe.NumerFrame.get_date_range" class="md-nav__link">
    <span class="md-ellipsis">
      get_date_range
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.numerframe.NumerFrame.get_era_batch" class="md-nav__link">
    <span class="md-ellipsis">
      get_era_batch
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.numerframe.NumerFrame.get_era_from_date" class="md-nav__link">
    <span class="md-ellipsis">
      get_era_from_date
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.numerframe.NumerFrame.get_era_range" class="md-nav__link">
    <span class="md-ellipsis">
      get_era_range
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.numerframe.NumerFrame.get_feature_group" class="md-nav__link">
    <span class="md-ellipsis">
      get_feature_group
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.numerframe.NumerFrame.get_feature_target_pair" class="md-nav__link">
    <span class="md-ellipsis">
      get_feature_target_pair
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.numerframe.NumerFrame.get_last_n_eras" class="md-nav__link">
    <span class="md-ellipsis">
      get_last_n_eras
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.numerframe.NumerFrame.get_pattern_data" class="md-nav__link">
    <span class="md-ellipsis">
      get_pattern_data
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.numerframe.create_numerframe" class="md-nav__link">
    <span class="md-ellipsis">
      create_numerframe
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.preprocessing.base" class="md-nav__link">
    <span class="md-ellipsis">
      base
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.preprocessing.base.BasePreProcessor" class="md-nav__link">
    <span class="md-ellipsis">
      BasePreProcessor
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.preprocessing.classic" class="md-nav__link">
    <span class="md-ellipsis">
      classic
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.preprocessing.classic.GroupStatsPreProcessor" class="md-nav__link">
    <span class="md-ellipsis">
      GroupStatsPreProcessor
    </span>
  </a>
  
    <nav class="md-nav" aria-label="GroupStatsPreProcessor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.preprocessing.classic.GroupStatsPreProcessor.get_feature_names_out" class="md-nav__link">
    <span class="md-ellipsis">
      get_feature_names_out
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.preprocessing.classic.GroupStatsPreProcessor.transform" class="md-nav__link">
    <span class="md-ellipsis">
      transform
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.preprocessing.signals" class="md-nav__link">
    <span class="md-ellipsis">
      signals
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.preprocessing.signals.DifferencePreProcessor" class="md-nav__link">
    <span class="md-ellipsis">
      DifferencePreProcessor
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DifferencePreProcessor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.preprocessing.signals.DifferencePreProcessor.transform" class="md-nav__link">
    <span class="md-ellipsis">
      transform
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.preprocessing.signals.EraQuantileProcessor" class="md-nav__link">
    <span class="md-ellipsis">
      EraQuantileProcessor
    </span>
  </a>
  
    <nav class="md-nav" aria-label="EraQuantileProcessor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.preprocessing.signals.EraQuantileProcessor.get_feature_names_out" class="md-nav__link">
    <span class="md-ellipsis">
      get_feature_names_out
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.preprocessing.signals.EraQuantileProcessor.transform" class="md-nav__link">
    <span class="md-ellipsis">
      transform
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.preprocessing.signals.HLOCVAdjuster" class="md-nav__link">
    <span class="md-ellipsis">
      HLOCVAdjuster
    </span>
  </a>
  
    <nav class="md-nav" aria-label="HLOCVAdjuster">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.preprocessing.signals.HLOCVAdjuster.transform" class="md-nav__link">
    <span class="md-ellipsis">
      transform
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.preprocessing.signals.KatsuFeatureGenerator" class="md-nav__link">
    <span class="md-ellipsis">
      KatsuFeatureGenerator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="KatsuFeatureGenerator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.preprocessing.signals.KatsuFeatureGenerator.__ema1" class="md-nav__link">
    <span class="md-ellipsis">
      __ema1
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.preprocessing.signals.KatsuFeatureGenerator.feature_engineering" class="md-nav__link">
    <span class="md-ellipsis">
      feature_engineering
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.preprocessing.signals.KatsuFeatureGenerator.get_feature_names_out" class="md-nav__link">
    <span class="md-ellipsis">
      get_feature_names_out
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.preprocessing.signals.KatsuFeatureGenerator.transform" class="md-nav__link">
    <span class="md-ellipsis">
      transform
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.preprocessing.signals.LagPreProcessor" class="md-nav__link">
    <span class="md-ellipsis">
      LagPreProcessor
    </span>
  </a>
  
    <nav class="md-nav" aria-label="LagPreProcessor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.preprocessing.signals.LagPreProcessor.get_feature_names_out" class="md-nav__link">
    <span class="md-ellipsis">
      get_feature_names_out
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.preprocessing.signals.MinimumDataFilter" class="md-nav__link">
    <span class="md-ellipsis">
      MinimumDataFilter
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MinimumDataFilter">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.preprocessing.signals.MinimumDataFilter.transform" class="md-nav__link">
    <span class="md-ellipsis">
      transform
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.preprocessing.signals.PandasTaFeatureGenerator" class="md-nav__link">
    <span class="md-ellipsis">
      PandasTaFeatureGenerator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PandasTaFeatureGenerator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.preprocessing.signals.PandasTaFeatureGenerator.add_features" class="md-nav__link">
    <span class="md-ellipsis">
      add_features
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.preprocessing.signals.PandasTaFeatureGenerator.transform" class="md-nav__link">
    <span class="md-ellipsis">
      transform
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.preprocessing.signals.ReduceMemoryProcessor" class="md-nav__link">
    <span class="md-ellipsis">
      ReduceMemoryProcessor
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ReduceMemoryProcessor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.preprocessing.signals.ReduceMemoryProcessor.get_feature_names_out" class="md-nav__link">
    <span class="md-ellipsis">
      get_feature_names_out
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.preprocessing.signals.TickerMapper" class="md-nav__link">
    <span class="md-ellipsis">
      TickerMapper
    </span>
  </a>
  
    <nav class="md-nav" aria-label="TickerMapper">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.preprocessing.signals.TickerMapper.transform" class="md-nav__link">
    <span class="md-ellipsis">
      transform
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.targets" class="md-nav__link">
    <span class="md-ellipsis">
      targets
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.targets.BaseTargetProcessor" class="md-nav__link">
    <span class="md-ellipsis">
      BaseTargetProcessor
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.targets.BayesianGMMTargetProcessor" class="md-nav__link">
    <span class="md-ellipsis">
      BayesianGMMTargetProcessor
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BayesianGMMTargetProcessor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.targets.BayesianGMMTargetProcessor.fit" class="md-nav__link">
    <span class="md-ellipsis">
      fit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.targets.BayesianGMMTargetProcessor.get_feature_names_out" class="md-nav__link">
    <span class="md-ellipsis">
      get_feature_names_out
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.targets.BayesianGMMTargetProcessor.transform" class="md-nav__link">
    <span class="md-ellipsis">
      transform
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.targets.SignalsTargetProcessor" class="md-nav__link">
    <span class="md-ellipsis">
      SignalsTargetProcessor
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SignalsTargetProcessor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.targets.SignalsTargetProcessor.get_feature_names_out" class="md-nav__link">
    <span class="md-ellipsis">
      get_feature_names_out
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.meta" class="md-nav__link">
    <span class="md-ellipsis">
      meta
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.meta.CrossValEstimator" class="md-nav__link">
    <span class="md-ellipsis">
      CrossValEstimator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CrossValEstimator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.meta.CrossValEstimator.__sklearn_is_fitted__" class="md-nav__link">
    <span class="md-ellipsis">
      __sklearn_is_fitted__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.meta.CrossValEstimator.fit" class="md-nav__link">
    <span class="md-ellipsis">
      fit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.meta.CrossValEstimator.transform" class="md-nav__link">
    <span class="md-ellipsis">
      transform
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.meta.MetaEstimator" class="md-nav__link">
    <span class="md-ellipsis">
      MetaEstimator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MetaEstimator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.meta.MetaEstimator.fit" class="md-nav__link">
    <span class="md-ellipsis">
      fit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.meta.MetaEstimator.predict" class="md-nav__link">
    <span class="md-ellipsis">
      predict
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.meta.MetaEstimator.transform" class="md-nav__link">
    <span class="md-ellipsis">
      transform
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.meta.MetaPipeline" class="md-nav__link">
    <span class="md-ellipsis">
      MetaPipeline
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MetaPipeline">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.meta.MetaPipeline.predict" class="md-nav__link">
    <span class="md-ellipsis">
      predict
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.meta.MetaPipeline.wrap_estimators_as_transformers" class="md-nav__link">
    <span class="md-ellipsis">
      wrap_estimators_as_transformers
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.meta.make_meta_pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      make_meta_pipeline
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.neutralizers" class="md-nav__link">
    <span class="md-ellipsis">
      neutralizers
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.neutralizers.BaseNeutralizer" class="md-nav__link">
    <span class="md-ellipsis">
      BaseNeutralizer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BaseNeutralizer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.neutralizers.BaseNeutralizer.fit_transform" class="md-nav__link">
    <span class="md-ellipsis">
      fit_transform
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.neutralizers.BaseNeutralizer.get_feature_names_out" class="md-nav__link">
    <span class="md-ellipsis">
      get_feature_names_out
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.neutralizers.BaseNeutralizer.predict" class="md-nav__link">
    <span class="md-ellipsis">
      predict
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.neutralizers.FeatureNeutralizer" class="md-nav__link">
    <span class="md-ellipsis">
      FeatureNeutralizer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="FeatureNeutralizer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.neutralizers.FeatureNeutralizer.neutralize" class="md-nav__link">
    <span class="md-ellipsis">
      neutralize
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.neutralizers.FeatureNeutralizer.normalize" class="md-nav__link">
    <span class="md-ellipsis">
      normalize
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.neutralizers.FeatureNeutralizer.normalize_and_neutralize" class="md-nav__link">
    <span class="md-ellipsis">
      normalize_and_neutralize
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.neutralizers.FeatureNeutralizer.transform" class="md-nav__link">
    <span class="md-ellipsis">
      transform
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.penalizers" class="md-nav__link">
    <span class="md-ellipsis">
      penalizers
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.penalizers.BasePenalizer" class="md-nav__link">
    <span class="md-ellipsis">
      BasePenalizer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BasePenalizer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.penalizers.BasePenalizer.fit_transform" class="md-nav__link">
    <span class="md-ellipsis">
      fit_transform
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.penalizers.BasePenalizer.get_feature_names_out" class="md-nav__link">
    <span class="md-ellipsis">
      get_feature_names_out
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.penalizers.BasePenalizer.predict" class="md-nav__link">
    <span class="md-ellipsis">
      predict
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.penalizers.FeaturePenalizer" class="md-nav__link">
    <span class="md-ellipsis">
      FeaturePenalizer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="FeaturePenalizer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.penalizers.FeaturePenalizer.transform" class="md-nav__link">
    <span class="md-ellipsis">
      transform
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.prediction_loaders" class="md-nav__link">
    <span class="md-ellipsis">
      prediction_loaders
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.prediction_loaders.BasePredictionLoader" class="md-nav__link">
    <span class="md-ellipsis">
      BasePredictionLoader
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BasePredictionLoader">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.prediction_loaders.BasePredictionLoader.get_feature_names_out" class="md-nav__link">
    <span class="md-ellipsis">
      get_feature_names_out
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.prediction_loaders.BasePredictionLoader.transform" class="md-nav__link">
    <span class="md-ellipsis">
      transform
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.prediction_loaders.ExamplePredictions" class="md-nav__link">
    <span class="md-ellipsis">
      ExamplePredictions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ExamplePredictions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.prediction_loaders.ExamplePredictions.transform" class="md-nav__link">
    <span class="md-ellipsis">
      transform
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.evaluation" class="md-nav__link">
    <span class="md-ellipsis">
      evaluation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.evaluation.BaseEvaluator" class="md-nav__link">
    <span class="md-ellipsis">
      BaseEvaluator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BaseEvaluator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.evaluation.BaseEvaluator.apy" class="md-nav__link">
    <span class="md-ellipsis">
      apy
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.evaluation.BaseEvaluator.autocorr1" class="md-nav__link">
    <span class="md-ellipsis">
      autocorr1
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.evaluation.BaseEvaluator.autocorr_penalty" class="md-nav__link">
    <span class="md-ellipsis">
      autocorr_penalty
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.evaluation.BaseEvaluator.contributive_correlation" class="md-nav__link">
    <span class="md-ellipsis">
      contributive_correlation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.evaluation.BaseEvaluator.cross_correlation" class="md-nav__link">
    <span class="md-ellipsis">
      cross_correlation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.evaluation.BaseEvaluator.evaluation_one_col" class="md-nav__link">
    <span class="md-ellipsis">
      evaluation_one_col
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.evaluation.BaseEvaluator.exposure_dissimilarity" class="md-nav__link">
    <span class="md-ellipsis">
      exposure_dissimilarity
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.evaluation.BaseEvaluator.feature_neutral_mean_std_sharpe" class="md-nav__link">
    <span class="md-ellipsis">
      feature_neutral_mean_std_sharpe
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.evaluation.BaseEvaluator.full_evaluation" class="md-nav__link">
    <span class="md-ellipsis">
      full_evaluation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.evaluation.BaseEvaluator.get_feature_exposures_corrv2" class="md-nav__link">
    <span class="md-ellipsis">
      get_feature_exposures_corrv2
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.evaluation.BaseEvaluator.get_feature_exposures_pearson" class="md-nav__link">
    <span class="md-ellipsis">
      get_feature_exposures_pearson
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.evaluation.BaseEvaluator.legacy_contribution" class="md-nav__link">
    <span class="md-ellipsis">
      legacy_contribution
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.evaluation.BaseEvaluator.max_drawdown" class="md-nav__link">
    <span class="md-ellipsis">
      max_drawdown
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.evaluation.BaseEvaluator.max_feature_exposure" class="md-nav__link">
    <span class="md-ellipsis">
      max_feature_exposure
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.evaluation.BaseEvaluator.mean_std_sharpe" class="md-nav__link">
    <span class="md-ellipsis">
      mean_std_sharpe
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.evaluation.BaseEvaluator.numerai_corr" class="md-nav__link">
    <span class="md-ellipsis">
      numerai_corr
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.evaluation.BaseEvaluator.per_era_corrs" class="md-nav__link">
    <span class="md-ellipsis">
      per_era_corrs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.evaluation.BaseEvaluator.per_era_numerai_corrs" class="md-nav__link">
    <span class="md-ellipsis">
      per_era_numerai_corrs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.evaluation.BaseEvaluator.plot_correlations" class="md-nav__link">
    <span class="md-ellipsis">
      plot_correlations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.evaluation.BaseEvaluator.smart_sharpe" class="md-nav__link">
    <span class="md-ellipsis">
      smart_sharpe
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.evaluation.BaseEvaluator.tbx_mean_std_sharpe" class="md-nav__link">
    <span class="md-ellipsis">
      tbx_mean_std_sharpe
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.evaluation.NumeraiClassicEvaluator" class="md-nav__link">
    <span class="md-ellipsis">
      NumeraiClassicEvaluator
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.evaluation.NumeraiSignalsEvaluator" class="md-nav__link">
    <span class="md-ellipsis">
      NumeraiSignalsEvaluator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="NumeraiSignalsEvaluator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.evaluation.NumeraiSignalsEvaluator.__await_diagnostics" class="md-nav__link">
    <span class="md-ellipsis">
      __await_diagnostics
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.evaluation.NumeraiSignalsEvaluator.get_diagnostics" class="md-nav__link">
    <span class="md-ellipsis">
      get_diagnostics
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.submission" class="md-nav__link">
    <span class="md-ellipsis">
      submission
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.submission.BaseSubmitter" class="md-nav__link">
    <span class="md-ellipsis">
      BaseSubmitter
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BaseSubmitter">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.submission.BaseSubmitter.get_model_mapping" class="md-nav__link">
    <span class="md-ellipsis">
      get_model_mapping
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.submission.BaseSubmitter.__call__" class="md-nav__link">
    <span class="md-ellipsis">
      __call__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.submission.BaseSubmitter.combine_csvs" class="md-nav__link">
    <span class="md-ellipsis">
      combine_csvs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.submission.BaseSubmitter.full_submission" class="md-nav__link">
    <span class="md-ellipsis">
      full_submission
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.submission.BaseSubmitter.save_csv" class="md-nav__link">
    <span class="md-ellipsis">
      save_csv
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.submission.BaseSubmitter.upload_predictions" class="md-nav__link">
    <span class="md-ellipsis">
      upload_predictions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.submission.NumerBaySubmitter" class="md-nav__link">
    <span class="md-ellipsis">
      NumerBaySubmitter
    </span>
  </a>
  
    <nav class="md-nav" aria-label="NumerBaySubmitter">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.submission.NumerBaySubmitter.__call__" class="md-nav__link">
    <span class="md-ellipsis">
      __call__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.submission.NumerBaySubmitter.full_submission" class="md-nav__link">
    <span class="md-ellipsis">
      full_submission
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.submission.NumerBaySubmitter.upload_predictions" class="md-nav__link">
    <span class="md-ellipsis">
      upload_predictions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.submission.NumeraiClassicSubmitter" class="md-nav__link">
    <span class="md-ellipsis">
      NumeraiClassicSubmitter
    </span>
  </a>
  
    <nav class="md-nav" aria-label="NumeraiClassicSubmitter">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.submission.NumeraiClassicSubmitter.save_csv" class="md-nav__link">
    <span class="md-ellipsis">
      save_csv
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.submission.NumeraiSignalsSubmitter" class="md-nav__link">
    <span class="md-ellipsis">
      NumeraiSignalsSubmitter
    </span>
  </a>
  
    <nav class="md-nav" aria-label="NumeraiSignalsSubmitter">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.submission.NumeraiSignalsSubmitter.save_csv" class="md-nav__link">
    <span class="md-ellipsis">
      save_csv
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
            
  
  <span class="md-ellipsis">
    More
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            More
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../contributing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    How To Contribute
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../crowdcent/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    About CrowdCent
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../disclaimer/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Disclaimer
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#numerblox.download" class="md-nav__link">
    <span class="md-ellipsis">
      download
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.download.BaseDownloader" class="md-nav__link">
    <span class="md-ellipsis">
      BaseDownloader
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BaseDownloader">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.download.BaseDownloader.__call__" class="md-nav__link">
    <span class="md-ellipsis">
      __call__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.download.BaseDownloader.download_live_data" class="md-nav__link">
    <span class="md-ellipsis">
      download_live_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.download.BaseDownloader.download_training_data" class="md-nav__link">
    <span class="md-ellipsis">
      download_training_data
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.download.BaseIO" class="md-nav__link">
    <span class="md-ellipsis">
      BaseIO
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BaseIO">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.download.BaseIO.get_all_files" class="md-nav__link">
    <span class="md-ellipsis">
      get_all_files
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.download.BaseIO.is_empty" class="md-nav__link">
    <span class="md-ellipsis">
      is_empty
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.download.BaseIO.download_directory_from_gcs" class="md-nav__link">
    <span class="md-ellipsis">
      download_directory_from_gcs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.download.BaseIO.download_file_from_gcs" class="md-nav__link">
    <span class="md-ellipsis">
      download_file_from_gcs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.download.BaseIO.remove_base_directory" class="md-nav__link">
    <span class="md-ellipsis">
      remove_base_directory
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.download.BaseIO.upload_directory_to_gcs" class="md-nav__link">
    <span class="md-ellipsis">
      upload_directory_to_gcs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.download.BaseIO.upload_file_to_gcs" class="md-nav__link">
    <span class="md-ellipsis">
      upload_file_to_gcs
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.download.EODDownloader" class="md-nav__link">
    <span class="md-ellipsis">
      EODDownloader
    </span>
  </a>
  
    <nav class="md-nav" aria-label="EODDownloader">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.download.EODDownloader.download_live_data" class="md-nav__link">
    <span class="md-ellipsis">
      download_live_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.download.EODDownloader.download_training_data" class="md-nav__link">
    <span class="md-ellipsis">
      download_training_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.download.EODDownloader.generate_full_dataf" class="md-nav__link">
    <span class="md-ellipsis">
      generate_full_dataf
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.download.EODDownloader.generate_stock_dataf" class="md-nav__link">
    <span class="md-ellipsis">
      generate_stock_dataf
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.download.EODDownloader.get_numerframe_data" class="md-nav__link">
    <span class="md-ellipsis">
      get_numerframe_data
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.download.KaggleDownloader" class="md-nav__link">
    <span class="md-ellipsis">
      KaggleDownloader
    </span>
  </a>
  
    <nav class="md-nav" aria-label="KaggleDownloader">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.download.KaggleDownloader.download_live_data" class="md-nav__link">
    <span class="md-ellipsis">
      download_live_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.download.KaggleDownloader.download_training_data" class="md-nav__link">
    <span class="md-ellipsis">
      download_training_data
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.download.NumeraiClassicDownloader" class="md-nav__link">
    <span class="md-ellipsis">
      NumeraiClassicDownloader
    </span>
  </a>
  
    <nav class="md-nav" aria-label="NumeraiClassicDownloader">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.download.NumeraiClassicDownloader.download_example_data" class="md-nav__link">
    <span class="md-ellipsis">
      download_example_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.download.NumeraiClassicDownloader.download_live_data" class="md-nav__link">
    <span class="md-ellipsis">
      download_live_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.download.NumeraiClassicDownloader.download_meta_model_preds" class="md-nav__link">
    <span class="md-ellipsis">
      download_meta_model_preds
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.download.NumeraiClassicDownloader.download_single_dataset" class="md-nav__link">
    <span class="md-ellipsis">
      download_single_dataset
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.download.NumeraiClassicDownloader.download_training_data" class="md-nav__link">
    <span class="md-ellipsis">
      download_training_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.download.NumeraiClassicDownloader.get_classic_features" class="md-nav__link">
    <span class="md-ellipsis">
      get_classic_features
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.download.NumeraiSignalsDownloader" class="md-nav__link">
    <span class="md-ellipsis">
      NumeraiSignalsDownloader
    </span>
  </a>
  
    <nav class="md-nav" aria-label="NumeraiSignalsDownloader">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.download.NumeraiSignalsDownloader.download_example_data" class="md-nav__link">
    <span class="md-ellipsis">
      download_example_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.download.NumeraiSignalsDownloader.download_live_data" class="md-nav__link">
    <span class="md-ellipsis">
      download_live_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.download.NumeraiSignalsDownloader.download_single_dataset" class="md-nav__link">
    <span class="md-ellipsis">
      download_single_dataset
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.download.NumeraiSignalsDownloader.download_training_data" class="md-nav__link">
    <span class="md-ellipsis">
      download_training_data
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.numerframe" class="md-nav__link">
    <span class="md-ellipsis">
      numerframe
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.numerframe.NumerFrame" class="md-nav__link">
    <span class="md-ellipsis">
      NumerFrame
    </span>
  </a>
  
    <nav class="md-nav" aria-label="NumerFrame">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.numerframe.NumerFrame.get_aux_data" class="md-nav__link">
    <span class="md-ellipsis">
      get_aux_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.numerframe.NumerFrame.get_dates_from_era_col" class="md-nav__link">
    <span class="md-ellipsis">
      get_dates_from_era_col
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.numerframe.NumerFrame.get_era_data" class="md-nav__link">
    <span class="md-ellipsis">
      get_era_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.numerframe.NumerFrame.get_eras_from_date_col" class="md-nav__link">
    <span class="md-ellipsis">
      get_eras_from_date_col
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.numerframe.NumerFrame.get_feature_data" class="md-nav__link">
    <span class="md-ellipsis">
      get_feature_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.numerframe.NumerFrame.get_fncv3_feature_data" class="md-nav__link">
    <span class="md-ellipsis">
      get_fncv3_feature_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.numerframe.NumerFrame.get_medium_feature_data" class="md-nav__link">
    <span class="md-ellipsis">
      get_medium_feature_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.numerframe.NumerFrame.get_prediction_aux_data" class="md-nav__link">
    <span class="md-ellipsis">
      get_prediction_aux_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.numerframe.NumerFrame.get_prediction_data" class="md-nav__link">
    <span class="md-ellipsis">
      get_prediction_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.numerframe.NumerFrame.get_single_target_data" class="md-nav__link">
    <span class="md-ellipsis">
      get_single_target_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.numerframe.NumerFrame.get_small_feature_data" class="md-nav__link">
    <span class="md-ellipsis">
      get_small_feature_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.numerframe.NumerFrame.get_target_data" class="md-nav__link">
    <span class="md-ellipsis">
      get_target_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.numerframe.NumerFrame.get_unique_eras" class="md-nav__link">
    <span class="md-ellipsis">
      get_unique_eras
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.numerframe.NumerFrame.get_v2_equivalent_feature_data" class="md-nav__link">
    <span class="md-ellipsis">
      get_v2_equivalent_feature_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.numerframe.NumerFrame.get_v3_equivalent_feature_data" class="md-nav__link">
    <span class="md-ellipsis">
      get_v3_equivalent_feature_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.numerframe.NumerFrame.__init_meta_attrs" class="md-nav__link">
    <span class="md-ellipsis">
      __init_meta_attrs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.numerframe.NumerFrame.__set_era_col" class="md-nav__link">
    <span class="md-ellipsis">
      __set_era_col
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.numerframe.NumerFrame.get_column_selection" class="md-nav__link">
    <span class="md-ellipsis">
      get_column_selection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.numerframe.NumerFrame.get_date_from_era" class="md-nav__link">
    <span class="md-ellipsis">
      get_date_from_era
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.numerframe.NumerFrame.get_date_range" class="md-nav__link">
    <span class="md-ellipsis">
      get_date_range
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.numerframe.NumerFrame.get_era_batch" class="md-nav__link">
    <span class="md-ellipsis">
      get_era_batch
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.numerframe.NumerFrame.get_era_from_date" class="md-nav__link">
    <span class="md-ellipsis">
      get_era_from_date
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.numerframe.NumerFrame.get_era_range" class="md-nav__link">
    <span class="md-ellipsis">
      get_era_range
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.numerframe.NumerFrame.get_feature_group" class="md-nav__link">
    <span class="md-ellipsis">
      get_feature_group
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.numerframe.NumerFrame.get_feature_target_pair" class="md-nav__link">
    <span class="md-ellipsis">
      get_feature_target_pair
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.numerframe.NumerFrame.get_last_n_eras" class="md-nav__link">
    <span class="md-ellipsis">
      get_last_n_eras
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.numerframe.NumerFrame.get_pattern_data" class="md-nav__link">
    <span class="md-ellipsis">
      get_pattern_data
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.numerframe.create_numerframe" class="md-nav__link">
    <span class="md-ellipsis">
      create_numerframe
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.preprocessing.base" class="md-nav__link">
    <span class="md-ellipsis">
      base
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.preprocessing.base.BasePreProcessor" class="md-nav__link">
    <span class="md-ellipsis">
      BasePreProcessor
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.preprocessing.classic" class="md-nav__link">
    <span class="md-ellipsis">
      classic
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.preprocessing.classic.GroupStatsPreProcessor" class="md-nav__link">
    <span class="md-ellipsis">
      GroupStatsPreProcessor
    </span>
  </a>
  
    <nav class="md-nav" aria-label="GroupStatsPreProcessor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.preprocessing.classic.GroupStatsPreProcessor.get_feature_names_out" class="md-nav__link">
    <span class="md-ellipsis">
      get_feature_names_out
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.preprocessing.classic.GroupStatsPreProcessor.transform" class="md-nav__link">
    <span class="md-ellipsis">
      transform
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.preprocessing.signals" class="md-nav__link">
    <span class="md-ellipsis">
      signals
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.preprocessing.signals.DifferencePreProcessor" class="md-nav__link">
    <span class="md-ellipsis">
      DifferencePreProcessor
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DifferencePreProcessor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.preprocessing.signals.DifferencePreProcessor.transform" class="md-nav__link">
    <span class="md-ellipsis">
      transform
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.preprocessing.signals.EraQuantileProcessor" class="md-nav__link">
    <span class="md-ellipsis">
      EraQuantileProcessor
    </span>
  </a>
  
    <nav class="md-nav" aria-label="EraQuantileProcessor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.preprocessing.signals.EraQuantileProcessor.get_feature_names_out" class="md-nav__link">
    <span class="md-ellipsis">
      get_feature_names_out
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.preprocessing.signals.EraQuantileProcessor.transform" class="md-nav__link">
    <span class="md-ellipsis">
      transform
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.preprocessing.signals.HLOCVAdjuster" class="md-nav__link">
    <span class="md-ellipsis">
      HLOCVAdjuster
    </span>
  </a>
  
    <nav class="md-nav" aria-label="HLOCVAdjuster">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.preprocessing.signals.HLOCVAdjuster.transform" class="md-nav__link">
    <span class="md-ellipsis">
      transform
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.preprocessing.signals.KatsuFeatureGenerator" class="md-nav__link">
    <span class="md-ellipsis">
      KatsuFeatureGenerator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="KatsuFeatureGenerator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.preprocessing.signals.KatsuFeatureGenerator.__ema1" class="md-nav__link">
    <span class="md-ellipsis">
      __ema1
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.preprocessing.signals.KatsuFeatureGenerator.feature_engineering" class="md-nav__link">
    <span class="md-ellipsis">
      feature_engineering
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.preprocessing.signals.KatsuFeatureGenerator.get_feature_names_out" class="md-nav__link">
    <span class="md-ellipsis">
      get_feature_names_out
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.preprocessing.signals.KatsuFeatureGenerator.transform" class="md-nav__link">
    <span class="md-ellipsis">
      transform
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.preprocessing.signals.LagPreProcessor" class="md-nav__link">
    <span class="md-ellipsis">
      LagPreProcessor
    </span>
  </a>
  
    <nav class="md-nav" aria-label="LagPreProcessor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.preprocessing.signals.LagPreProcessor.get_feature_names_out" class="md-nav__link">
    <span class="md-ellipsis">
      get_feature_names_out
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.preprocessing.signals.MinimumDataFilter" class="md-nav__link">
    <span class="md-ellipsis">
      MinimumDataFilter
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MinimumDataFilter">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.preprocessing.signals.MinimumDataFilter.transform" class="md-nav__link">
    <span class="md-ellipsis">
      transform
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.preprocessing.signals.PandasTaFeatureGenerator" class="md-nav__link">
    <span class="md-ellipsis">
      PandasTaFeatureGenerator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PandasTaFeatureGenerator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.preprocessing.signals.PandasTaFeatureGenerator.add_features" class="md-nav__link">
    <span class="md-ellipsis">
      add_features
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.preprocessing.signals.PandasTaFeatureGenerator.transform" class="md-nav__link">
    <span class="md-ellipsis">
      transform
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.preprocessing.signals.ReduceMemoryProcessor" class="md-nav__link">
    <span class="md-ellipsis">
      ReduceMemoryProcessor
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ReduceMemoryProcessor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.preprocessing.signals.ReduceMemoryProcessor.get_feature_names_out" class="md-nav__link">
    <span class="md-ellipsis">
      get_feature_names_out
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.preprocessing.signals.TickerMapper" class="md-nav__link">
    <span class="md-ellipsis">
      TickerMapper
    </span>
  </a>
  
    <nav class="md-nav" aria-label="TickerMapper">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.preprocessing.signals.TickerMapper.transform" class="md-nav__link">
    <span class="md-ellipsis">
      transform
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.targets" class="md-nav__link">
    <span class="md-ellipsis">
      targets
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.targets.BaseTargetProcessor" class="md-nav__link">
    <span class="md-ellipsis">
      BaseTargetProcessor
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.targets.BayesianGMMTargetProcessor" class="md-nav__link">
    <span class="md-ellipsis">
      BayesianGMMTargetProcessor
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BayesianGMMTargetProcessor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.targets.BayesianGMMTargetProcessor.fit" class="md-nav__link">
    <span class="md-ellipsis">
      fit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.targets.BayesianGMMTargetProcessor.get_feature_names_out" class="md-nav__link">
    <span class="md-ellipsis">
      get_feature_names_out
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.targets.BayesianGMMTargetProcessor.transform" class="md-nav__link">
    <span class="md-ellipsis">
      transform
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.targets.SignalsTargetProcessor" class="md-nav__link">
    <span class="md-ellipsis">
      SignalsTargetProcessor
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SignalsTargetProcessor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.targets.SignalsTargetProcessor.get_feature_names_out" class="md-nav__link">
    <span class="md-ellipsis">
      get_feature_names_out
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.meta" class="md-nav__link">
    <span class="md-ellipsis">
      meta
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.meta.CrossValEstimator" class="md-nav__link">
    <span class="md-ellipsis">
      CrossValEstimator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CrossValEstimator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.meta.CrossValEstimator.__sklearn_is_fitted__" class="md-nav__link">
    <span class="md-ellipsis">
      __sklearn_is_fitted__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.meta.CrossValEstimator.fit" class="md-nav__link">
    <span class="md-ellipsis">
      fit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.meta.CrossValEstimator.transform" class="md-nav__link">
    <span class="md-ellipsis">
      transform
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.meta.MetaEstimator" class="md-nav__link">
    <span class="md-ellipsis">
      MetaEstimator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MetaEstimator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.meta.MetaEstimator.fit" class="md-nav__link">
    <span class="md-ellipsis">
      fit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.meta.MetaEstimator.predict" class="md-nav__link">
    <span class="md-ellipsis">
      predict
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.meta.MetaEstimator.transform" class="md-nav__link">
    <span class="md-ellipsis">
      transform
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.meta.MetaPipeline" class="md-nav__link">
    <span class="md-ellipsis">
      MetaPipeline
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MetaPipeline">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.meta.MetaPipeline.predict" class="md-nav__link">
    <span class="md-ellipsis">
      predict
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.meta.MetaPipeline.wrap_estimators_as_transformers" class="md-nav__link">
    <span class="md-ellipsis">
      wrap_estimators_as_transformers
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.meta.make_meta_pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      make_meta_pipeline
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.neutralizers" class="md-nav__link">
    <span class="md-ellipsis">
      neutralizers
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.neutralizers.BaseNeutralizer" class="md-nav__link">
    <span class="md-ellipsis">
      BaseNeutralizer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BaseNeutralizer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.neutralizers.BaseNeutralizer.fit_transform" class="md-nav__link">
    <span class="md-ellipsis">
      fit_transform
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.neutralizers.BaseNeutralizer.get_feature_names_out" class="md-nav__link">
    <span class="md-ellipsis">
      get_feature_names_out
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.neutralizers.BaseNeutralizer.predict" class="md-nav__link">
    <span class="md-ellipsis">
      predict
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.neutralizers.FeatureNeutralizer" class="md-nav__link">
    <span class="md-ellipsis">
      FeatureNeutralizer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="FeatureNeutralizer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.neutralizers.FeatureNeutralizer.neutralize" class="md-nav__link">
    <span class="md-ellipsis">
      neutralize
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.neutralizers.FeatureNeutralizer.normalize" class="md-nav__link">
    <span class="md-ellipsis">
      normalize
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.neutralizers.FeatureNeutralizer.normalize_and_neutralize" class="md-nav__link">
    <span class="md-ellipsis">
      normalize_and_neutralize
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.neutralizers.FeatureNeutralizer.transform" class="md-nav__link">
    <span class="md-ellipsis">
      transform
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.penalizers" class="md-nav__link">
    <span class="md-ellipsis">
      penalizers
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.penalizers.BasePenalizer" class="md-nav__link">
    <span class="md-ellipsis">
      BasePenalizer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BasePenalizer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.penalizers.BasePenalizer.fit_transform" class="md-nav__link">
    <span class="md-ellipsis">
      fit_transform
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.penalizers.BasePenalizer.get_feature_names_out" class="md-nav__link">
    <span class="md-ellipsis">
      get_feature_names_out
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.penalizers.BasePenalizer.predict" class="md-nav__link">
    <span class="md-ellipsis">
      predict
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.penalizers.FeaturePenalizer" class="md-nav__link">
    <span class="md-ellipsis">
      FeaturePenalizer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="FeaturePenalizer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.penalizers.FeaturePenalizer.transform" class="md-nav__link">
    <span class="md-ellipsis">
      transform
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.prediction_loaders" class="md-nav__link">
    <span class="md-ellipsis">
      prediction_loaders
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.prediction_loaders.BasePredictionLoader" class="md-nav__link">
    <span class="md-ellipsis">
      BasePredictionLoader
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BasePredictionLoader">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.prediction_loaders.BasePredictionLoader.get_feature_names_out" class="md-nav__link">
    <span class="md-ellipsis">
      get_feature_names_out
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.prediction_loaders.BasePredictionLoader.transform" class="md-nav__link">
    <span class="md-ellipsis">
      transform
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.prediction_loaders.ExamplePredictions" class="md-nav__link">
    <span class="md-ellipsis">
      ExamplePredictions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ExamplePredictions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.prediction_loaders.ExamplePredictions.transform" class="md-nav__link">
    <span class="md-ellipsis">
      transform
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.evaluation" class="md-nav__link">
    <span class="md-ellipsis">
      evaluation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.evaluation.BaseEvaluator" class="md-nav__link">
    <span class="md-ellipsis">
      BaseEvaluator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BaseEvaluator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.evaluation.BaseEvaluator.apy" class="md-nav__link">
    <span class="md-ellipsis">
      apy
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.evaluation.BaseEvaluator.autocorr1" class="md-nav__link">
    <span class="md-ellipsis">
      autocorr1
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.evaluation.BaseEvaluator.autocorr_penalty" class="md-nav__link">
    <span class="md-ellipsis">
      autocorr_penalty
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.evaluation.BaseEvaluator.contributive_correlation" class="md-nav__link">
    <span class="md-ellipsis">
      contributive_correlation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.evaluation.BaseEvaluator.cross_correlation" class="md-nav__link">
    <span class="md-ellipsis">
      cross_correlation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.evaluation.BaseEvaluator.evaluation_one_col" class="md-nav__link">
    <span class="md-ellipsis">
      evaluation_one_col
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.evaluation.BaseEvaluator.exposure_dissimilarity" class="md-nav__link">
    <span class="md-ellipsis">
      exposure_dissimilarity
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.evaluation.BaseEvaluator.feature_neutral_mean_std_sharpe" class="md-nav__link">
    <span class="md-ellipsis">
      feature_neutral_mean_std_sharpe
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.evaluation.BaseEvaluator.full_evaluation" class="md-nav__link">
    <span class="md-ellipsis">
      full_evaluation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.evaluation.BaseEvaluator.get_feature_exposures_corrv2" class="md-nav__link">
    <span class="md-ellipsis">
      get_feature_exposures_corrv2
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.evaluation.BaseEvaluator.get_feature_exposures_pearson" class="md-nav__link">
    <span class="md-ellipsis">
      get_feature_exposures_pearson
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.evaluation.BaseEvaluator.legacy_contribution" class="md-nav__link">
    <span class="md-ellipsis">
      legacy_contribution
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.evaluation.BaseEvaluator.max_drawdown" class="md-nav__link">
    <span class="md-ellipsis">
      max_drawdown
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.evaluation.BaseEvaluator.max_feature_exposure" class="md-nav__link">
    <span class="md-ellipsis">
      max_feature_exposure
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.evaluation.BaseEvaluator.mean_std_sharpe" class="md-nav__link">
    <span class="md-ellipsis">
      mean_std_sharpe
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.evaluation.BaseEvaluator.numerai_corr" class="md-nav__link">
    <span class="md-ellipsis">
      numerai_corr
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.evaluation.BaseEvaluator.per_era_corrs" class="md-nav__link">
    <span class="md-ellipsis">
      per_era_corrs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.evaluation.BaseEvaluator.per_era_numerai_corrs" class="md-nav__link">
    <span class="md-ellipsis">
      per_era_numerai_corrs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.evaluation.BaseEvaluator.plot_correlations" class="md-nav__link">
    <span class="md-ellipsis">
      plot_correlations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.evaluation.BaseEvaluator.smart_sharpe" class="md-nav__link">
    <span class="md-ellipsis">
      smart_sharpe
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.evaluation.BaseEvaluator.tbx_mean_std_sharpe" class="md-nav__link">
    <span class="md-ellipsis">
      tbx_mean_std_sharpe
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.evaluation.NumeraiClassicEvaluator" class="md-nav__link">
    <span class="md-ellipsis">
      NumeraiClassicEvaluator
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.evaluation.NumeraiSignalsEvaluator" class="md-nav__link">
    <span class="md-ellipsis">
      NumeraiSignalsEvaluator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="NumeraiSignalsEvaluator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.evaluation.NumeraiSignalsEvaluator.__await_diagnostics" class="md-nav__link">
    <span class="md-ellipsis">
      __await_diagnostics
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.evaluation.NumeraiSignalsEvaluator.get_diagnostics" class="md-nav__link">
    <span class="md-ellipsis">
      get_diagnostics
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.submission" class="md-nav__link">
    <span class="md-ellipsis">
      submission
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.submission.BaseSubmitter" class="md-nav__link">
    <span class="md-ellipsis">
      BaseSubmitter
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BaseSubmitter">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.submission.BaseSubmitter.get_model_mapping" class="md-nav__link">
    <span class="md-ellipsis">
      get_model_mapping
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.submission.BaseSubmitter.__call__" class="md-nav__link">
    <span class="md-ellipsis">
      __call__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.submission.BaseSubmitter.combine_csvs" class="md-nav__link">
    <span class="md-ellipsis">
      combine_csvs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.submission.BaseSubmitter.full_submission" class="md-nav__link">
    <span class="md-ellipsis">
      full_submission
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.submission.BaseSubmitter.save_csv" class="md-nav__link">
    <span class="md-ellipsis">
      save_csv
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.submission.BaseSubmitter.upload_predictions" class="md-nav__link">
    <span class="md-ellipsis">
      upload_predictions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.submission.NumerBaySubmitter" class="md-nav__link">
    <span class="md-ellipsis">
      NumerBaySubmitter
    </span>
  </a>
  
    <nav class="md-nav" aria-label="NumerBaySubmitter">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.submission.NumerBaySubmitter.__call__" class="md-nav__link">
    <span class="md-ellipsis">
      __call__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.submission.NumerBaySubmitter.full_submission" class="md-nav__link">
    <span class="md-ellipsis">
      full_submission
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numerblox.submission.NumerBaySubmitter.upload_predictions" class="md-nav__link">
    <span class="md-ellipsis">
      upload_predictions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.submission.NumeraiClassicSubmitter" class="md-nav__link">
    <span class="md-ellipsis">
      NumeraiClassicSubmitter
    </span>
  </a>
  
    <nav class="md-nav" aria-label="NumeraiClassicSubmitter">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.submission.NumeraiClassicSubmitter.save_csv" class="md-nav__link">
    <span class="md-ellipsis">
      save_csv
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerblox.submission.NumeraiSignalsSubmitter" class="md-nav__link">
    <span class="md-ellipsis">
      NumeraiSignalsSubmitter
    </span>
  </a>
  
    <nav class="md-nav" aria-label="NumeraiSignalsSubmitter">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#numerblox.submission.NumeraiSignalsSubmitter.save_csv" class="md-nav__link">
    <span class="md-ellipsis">
      save_csv
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="full-api-reference">Full API Reference</h1>
<p>This section provides a detailed reference to all objects defined in NumerBlox.</p>


<div class="doc doc-object doc-module">



<a id="numerblox.download"></a>
  <div class="doc doc-contents first">

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="numerblox.download.BaseDownloader" class="doc doc-heading">
          <code>BaseDownloader</code>


</h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="numerblox.download.BaseIO" href="#numerblox.download.BaseIO">BaseIO</a></code></p>

  
      <p>Abstract base class for downloaders.</p>
<p>:param directory_path: Base folder to download files to.</p>

            <details class="quote">
              <summary>Source code in <code>numerblox/download.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">BaseDownloader</span><span class="p">(</span><span class="n">BaseIO</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Abstract base class for downloaders.</span>

<span class="sd">    :param directory_path: Base folder to download files to.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">directory_path</span><span class="o">=</span><span class="n">directory_path</span><span class="p">)</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">download_training_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Download all necessary files needed for training. &quot;&quot;&quot;</span>
        <span class="o">...</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">download_live_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Download minimal amount of files needed for weekly inference. &quot;&quot;&quot;</span>
        <span class="o">...</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_load_json</span><span class="p">(</span><span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Load JSON from file and return as dictionary. &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">file_path</span><span class="p">))</span> <span class="k">as</span> <span class="n">json_file</span><span class="p">:</span>
            <span class="n">json_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">json_file</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">json_data</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">json_data</span>

    <span class="k">def</span> <span class="nf">_default_save_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span> <span class="n">dt</span><span class="p">,</span> <span class="n">end</span><span class="p">:</span> <span class="n">dt</span><span class="p">,</span> <span class="n">backend</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Save to downloader directory indicating backend, start date and end date as parquet file. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">backend</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">start</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">end</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">.parquet&quot;</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The most common use case will be to get weekly inference data. So calling the class itself returns inference data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">download_live_data</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">



<h3 id="numerblox.download.BaseDownloader.__call__" class="doc doc-heading">
          <code class="highlight language-python"><span class="fm">__call__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>The most common use case will be to get weekly inference data. So calling the class itself returns inference data.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/download.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The most common use case will be to get weekly inference data. So calling the class itself returns inference data.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">download_live_data</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="numerblox.download.BaseDownloader.download_live_data" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">download_live_data</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Download minimal amount of files needed for weekly inference.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/download.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="k">def</span> <span class="nf">download_live_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Download minimal amount of files needed for weekly inference. &quot;&quot;&quot;</span>
    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="numerblox.download.BaseDownloader.download_training_data" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">download_training_data</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Download all necessary files needed for training.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/download.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="k">def</span> <span class="nf">download_training_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Download all necessary files needed for training. &quot;&quot;&quot;</span>
    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>


</div>

<div class="doc doc-object doc-class">



<h2 id="numerblox.download.BaseIO" class="doc doc-heading">
          <code>BaseIO</code>


</h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><span title="abc.ABC">ABC</span></code></p>

  
      <p>Basic functionality for IO (downloading and uploading).</p>
<p>:param directory_path: Base folder for IO. Will be created if it does not exist.</p>

            <details class="quote">
              <summary>Source code in <code>numerblox/download.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">BaseIO</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Basic functionality for IO (downloading and uploading).</span>

<span class="sd">    :param directory_path: Base folder for IO. Will be created if it does not exist.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">directory_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_create_directory</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">remove_base_directory</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove directory with all contents.&quot;&quot;&quot;</span>
        <span class="n">abs_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;WARNING: Deleting directory for &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&#39;</span><span class="se">\n</span><span class="s2">Path: &#39;</span><span class="si">{</span><span class="n">abs_path</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
        <span class="p">)</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">abs_path</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">download_file_from_gcs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bucket_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">gcs_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get file from GCS bucket and download to local directory.</span>
<span class="sd">        :param gcs_path: Path to file on GCS bucket.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">blob_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="o">.</span><span class="n">resolve</span><span class="p">())</span>
        <span class="n">blob</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_gcs_blob</span><span class="p">(</span><span class="n">bucket_name</span><span class="o">=</span><span class="n">bucket_name</span><span class="p">,</span> <span class="n">blob_path</span><span class="o">=</span><span class="n">blob_path</span><span class="p">)</span>
        <span class="n">blob</span><span class="o">.</span><span class="n">download_to_filename</span><span class="p">(</span><span class="n">gcs_path</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Downloaded GCS object &#39;</span><span class="si">{</span><span class="n">gcs_path</span><span class="si">}</span><span class="s2">&#39; from bucket &#39;</span><span class="si">{</span><span class="n">blob</span><span class="o">.</span><span class="n">bucket</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&#39; to local directory &#39;</span><span class="si">{</span><span class="n">blob_path</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">upload_file_to_gcs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bucket_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">gcs_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">local_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Upload file to some GCS bucket.</span>
<span class="sd">        :param gcs_path: Path to file on GCS bucket.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">blob</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_gcs_blob</span><span class="p">(</span><span class="n">bucket_name</span><span class="o">=</span><span class="n">bucket_name</span><span class="p">,</span> <span class="n">blob_path</span><span class="o">=</span><span class="n">gcs_path</span><span class="p">)</span>
        <span class="n">blob</span><span class="o">.</span><span class="n">upload_from_filename</span><span class="p">(</span><span class="n">local_path</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Local file &#39;</span><span class="si">{</span><span class="n">local_path</span><span class="si">}</span><span class="s2">&#39; uploaded to &#39;</span><span class="si">{</span><span class="n">gcs_path</span><span class="si">}</span><span class="s2">&#39; in bucket </span><span class="si">{</span><span class="n">blob</span><span class="o">.</span><span class="n">bucket</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">download_directory_from_gcs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bucket_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">gcs_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Copy full directory from GCS bucket to local environment.</span>
<span class="sd">        :param gcs_path: Name of directory on GCS bucket.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">blob_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="o">.</span><span class="n">resolve</span><span class="p">())</span>
        <span class="n">blob</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_gcs_blob</span><span class="p">(</span><span class="n">bucket_name</span><span class="o">=</span><span class="n">bucket_name</span><span class="p">,</span> <span class="n">blob_path</span><span class="o">=</span><span class="n">blob_path</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">gcs_file</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">gcs_path</span> <span class="o">+</span> <span class="s2">&quot;/**&quot;</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">gcs_file</span><span class="p">):</span>
                <span class="n">blob</span><span class="o">.</span><span class="n">download_to_filename</span><span class="p">(</span><span class="n">blob_path</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Directory &#39;</span><span class="si">{</span><span class="n">gcs_path</span><span class="si">}</span><span class="s2">&#39; from bucket &#39;</span><span class="si">{</span><span class="n">blob</span><span class="o">.</span><span class="n">bucket</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&#39; downloaded to &#39;</span><span class="si">{</span><span class="n">blob_path</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">upload_directory_to_gcs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bucket_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">gcs_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Upload full base directory to GCS bucket.</span>
<span class="sd">        :param gcs_path: Name of directory on GCS bucket.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">blob</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_gcs_blob</span><span class="p">(</span><span class="n">bucket_name</span><span class="o">=</span><span class="n">bucket_name</span><span class="p">,</span> <span class="n">blob_path</span><span class="o">=</span><span class="n">gcs_path</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">local_path</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;/**&quot;</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">local_path</span><span class="p">):</span>
                <span class="n">blob</span><span class="o">.</span><span class="n">upload_from_filename</span><span class="p">(</span><span class="n">local_path</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Directory &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="si">}</span><span class="s2">&#39; uploaded to &#39;</span><span class="si">{</span><span class="n">gcs_path</span><span class="si">}</span><span class="s2">&#39; in bucket </span><span class="si">{</span><span class="n">blob</span><span class="o">.</span><span class="n">bucket</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_gcs_blob</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bucket_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">blob_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">storage</span><span class="o">.</span><span class="n">Blob</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Create blob that interacts with Google Cloud Storage (GCS). &quot;&quot;&quot;</span>
        <span class="n">client</span> <span class="o">=</span> <span class="n">storage</span><span class="o">.</span><span class="n">Client</span><span class="p">()</span>
        <span class="c1"># https://console.cloud.google.com/storage/browser/[bucket_name]</span>
        <span class="n">bucket</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get_bucket</span><span class="p">(</span><span class="n">bucket_name</span><span class="p">)</span>
        <span class="n">blob</span> <span class="o">=</span> <span class="n">bucket</span><span class="o">.</span><span class="n">blob</span><span class="p">(</span><span class="n">blob_path</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">blob</span>

    <span class="k">def</span> <span class="nf">_append_folder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">folder</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Path</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return base directory Path object appended with &#39;folder&#39;.</span>
<span class="sd">        Create directory if it does not exist.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dir</span> <span class="o">/</span> <span class="n">folder</span><span class="p">)</span>
        <span class="nb">dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">dir</span>

    <span class="k">def</span> <span class="nf">_get_dest_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subfolder</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Prepare destination path for downloading. &quot;&quot;&quot;</span>
        <span class="nb">dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_append_folder</span><span class="p">(</span><span class="n">subfolder</span><span class="p">)</span>
        <span class="n">dest_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">dir</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
        <span class="k">return</span> <span class="n">dest_path</span>

    <span class="k">def</span> <span class="nf">_create_directory</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Create base directory if it does not exist. &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="o">.</span><span class="n">is_dir</span><span class="p">():</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;No existing directory found at &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="si">}</span><span class="s2">&#39;. Creating directory...&quot;</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">get_all_files</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Return all paths of contents in directory. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="o">.</span><span class="n">iterdir</span><span class="p">())</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_empty</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Check if directory is empty. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_all_files</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="numerblox.download.BaseIO.get_all_files" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_all_files</span><span class="p">:</span> <span class="nb">list</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Return all paths of contents in directory.</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="numerblox.download.BaseIO.is_empty" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">is_empty</span><span class="p">:</span> <span class="nb">bool</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Check if directory is empty.</p>
  </div>

</div>




<div class="doc doc-object doc-function">



<h3 id="numerblox.download.BaseIO.download_directory_from_gcs" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">download_directory_from_gcs</span><span class="p">(</span><span class="n">bucket_name</span><span class="p">,</span> <span class="n">gcs_path</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Copy full directory from GCS bucket to local environment.
:param gcs_path: Name of directory on GCS bucket.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/download.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">download_directory_from_gcs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bucket_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">gcs_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Copy full directory from GCS bucket to local environment.</span>
<span class="sd">    :param gcs_path: Name of directory on GCS bucket.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">blob_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="o">.</span><span class="n">resolve</span><span class="p">())</span>
    <span class="n">blob</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_gcs_blob</span><span class="p">(</span><span class="n">bucket_name</span><span class="o">=</span><span class="n">bucket_name</span><span class="p">,</span> <span class="n">blob_path</span><span class="o">=</span><span class="n">blob_path</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">gcs_file</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">gcs_path</span> <span class="o">+</span> <span class="s2">&quot;/**&quot;</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">gcs_file</span><span class="p">):</span>
            <span class="n">blob</span><span class="o">.</span><span class="n">download_to_filename</span><span class="p">(</span><span class="n">blob_path</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Directory &#39;</span><span class="si">{</span><span class="n">gcs_path</span><span class="si">}</span><span class="s2">&#39; from bucket &#39;</span><span class="si">{</span><span class="n">blob</span><span class="o">.</span><span class="n">bucket</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&#39; downloaded to &#39;</span><span class="si">{</span><span class="n">blob_path</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="numerblox.download.BaseIO.download_file_from_gcs" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">download_file_from_gcs</span><span class="p">(</span><span class="n">bucket_name</span><span class="p">,</span> <span class="n">gcs_path</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Get file from GCS bucket and download to local directory.
:param gcs_path: Path to file on GCS bucket.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/download.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">download_file_from_gcs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bucket_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">gcs_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get file from GCS bucket and download to local directory.</span>
<span class="sd">    :param gcs_path: Path to file on GCS bucket.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">blob_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="o">.</span><span class="n">resolve</span><span class="p">())</span>
    <span class="n">blob</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_gcs_blob</span><span class="p">(</span><span class="n">bucket_name</span><span class="o">=</span><span class="n">bucket_name</span><span class="p">,</span> <span class="n">blob_path</span><span class="o">=</span><span class="n">blob_path</span><span class="p">)</span>
    <span class="n">blob</span><span class="o">.</span><span class="n">download_to_filename</span><span class="p">(</span><span class="n">gcs_path</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Downloaded GCS object &#39;</span><span class="si">{</span><span class="n">gcs_path</span><span class="si">}</span><span class="s2">&#39; from bucket &#39;</span><span class="si">{</span><span class="n">blob</span><span class="o">.</span><span class="n">bucket</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&#39; to local directory &#39;</span><span class="si">{</span><span class="n">blob_path</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="numerblox.download.BaseIO.remove_base_directory" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">remove_base_directory</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Remove directory with all contents.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/download.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">remove_base_directory</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Remove directory with all contents.&quot;&quot;&quot;</span>
    <span class="n">abs_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;WARNING: Deleting directory for &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&#39;</span><span class="se">\n</span><span class="s2">Path: &#39;</span><span class="si">{</span><span class="n">abs_path</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
    <span class="p">)</span>
    <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">abs_path</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="numerblox.download.BaseIO.upload_directory_to_gcs" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">upload_directory_to_gcs</span><span class="p">(</span><span class="n">bucket_name</span><span class="p">,</span> <span class="n">gcs_path</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Upload full base directory to GCS bucket.
:param gcs_path: Name of directory on GCS bucket.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/download.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">upload_directory_to_gcs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bucket_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">gcs_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Upload full base directory to GCS bucket.</span>
<span class="sd">    :param gcs_path: Name of directory on GCS bucket.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">blob</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_gcs_blob</span><span class="p">(</span><span class="n">bucket_name</span><span class="o">=</span><span class="n">bucket_name</span><span class="p">,</span> <span class="n">blob_path</span><span class="o">=</span><span class="n">gcs_path</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">local_path</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;/**&quot;</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">local_path</span><span class="p">):</span>
            <span class="n">blob</span><span class="o">.</span><span class="n">upload_from_filename</span><span class="p">(</span><span class="n">local_path</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Directory &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="si">}</span><span class="s2">&#39; uploaded to &#39;</span><span class="si">{</span><span class="n">gcs_path</span><span class="si">}</span><span class="s2">&#39; in bucket </span><span class="si">{</span><span class="n">blob</span><span class="o">.</span><span class="n">bucket</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="numerblox.download.BaseIO.upload_file_to_gcs" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">upload_file_to_gcs</span><span class="p">(</span><span class="n">bucket_name</span><span class="p">,</span> <span class="n">gcs_path</span><span class="p">,</span> <span class="n">local_path</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Upload file to some GCS bucket.
:param gcs_path: Path to file on GCS bucket.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/download.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">upload_file_to_gcs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bucket_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">gcs_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">local_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Upload file to some GCS bucket.</span>
<span class="sd">    :param gcs_path: Path to file on GCS bucket.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">blob</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_gcs_blob</span><span class="p">(</span><span class="n">bucket_name</span><span class="o">=</span><span class="n">bucket_name</span><span class="p">,</span> <span class="n">blob_path</span><span class="o">=</span><span class="n">gcs_path</span><span class="p">)</span>
    <span class="n">blob</span><span class="o">.</span><span class="n">upload_from_filename</span><span class="p">(</span><span class="n">local_path</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Local file &#39;</span><span class="si">{</span><span class="n">local_path</span><span class="si">}</span><span class="s2">&#39; uploaded to &#39;</span><span class="si">{</span><span class="n">gcs_path</span><span class="si">}</span><span class="s2">&#39; in bucket </span><span class="si">{</span><span class="n">blob</span><span class="o">.</span><span class="n">bucket</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>


</div>

<div class="doc doc-object doc-class">



<h2 id="numerblox.download.EODDownloader" class="doc doc-heading">
          <code>EODDownloader</code>


</h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="numerblox.download.BaseDownloader" href="#numerblox.download.BaseDownloader">BaseDownloader</a></code></p>

  
      <p>Download data from EOD historical data. </p>
<p>More info: https://eodhistoricaldata.com/</p>
<p>Make sure you have the underlying Python package installed.
<code>pip install eod</code>.</p>
<p>:param directory_path: Base folder to download files to. </p>
<p>:param key: Valid EOD client key. </p>
<p>:param tickers: List of valid EOD tickers (Bloomberg ticker format). </p>
<p>:param frequency: Choose from [d, w, m]. </p>
<p>Daily data by default.</p>

            <details class="quote">
              <summary>Source code in <code>numerblox/download.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">EODDownloader</span><span class="p">(</span><span class="n">BaseDownloader</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Download data from EOD historical data. \n</span>
<span class="sd">    More info: https://eodhistoricaldata.com/</span>

<span class="sd">    Make sure you have the underlying Python package installed.</span>
<span class="sd">    `pip install eod`.</span>

<span class="sd">    :param directory_path: Base folder to download files to. \n</span>
<span class="sd">    :param key: Valid EOD client key. \n</span>
<span class="sd">    :param tickers: List of valid EOD tickers (Bloomberg ticker format). \n</span>
<span class="sd">    :param frequency: Choose from [d, w, m]. \n</span>
<span class="sd">    Daily data by default.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">directory_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                 <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                 <span class="n">tickers</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
                 <span class="n">frequency</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;d&quot;</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">directory_path</span><span class="o">=</span><span class="n">directory_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="n">key</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tickers</span> <span class="o">=</span> <span class="n">tickers</span>
        <span class="k">try</span><span class="p">:</span> 
            <span class="kn">from</span> <span class="nn">eod</span> <span class="kn">import</span> <span class="n">EodHistoricalData</span>
        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s2">&quot;Could not import eod package. Please install eod package with &#39;pip install eod&#39;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="n">EodHistoricalData</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span> <span class="o">=</span> <span class="n">frequency</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_time</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end_date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cpu_count</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">()</span>
        <span class="c1"># Time to sleep in between API calls to avoid hitting EOD rate limits.</span>
        <span class="c1"># EOD rate limit is set at 1000 calls per minute.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sleep_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpu_count</span> <span class="o">/</span> <span class="mi">32</span>

    <span class="k">def</span> <span class="nf">download_live_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Download one year of data for defined tickers. &quot;&quot;&quot;</span>
        <span class="n">start</span> <span class="o">=</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_time</span><span class="p">)</span> <span class="o">-</span> <span class="n">relativedelta</span><span class="p">(</span><span class="n">years</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">dataf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_numerframe_data</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">)</span>
        <span class="n">dataf</span><span class="o">.</span><span class="n">to_parquet</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_default_save_path</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="n">start</span><span class="p">),</span>
                                                 <span class="n">end</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end_date</span><span class="p">),</span>
                                                 <span class="n">backend</span><span class="o">=</span><span class="s2">&quot;eod&quot;</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">download_training_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Download full date length available.</span>
<span class="sd">        start: Starting data in %Y-%m-%d format.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">start</span> <span class="k">if</span> <span class="n">start</span> <span class="k">else</span> <span class="s2">&quot;1970-01-01&quot;</span>
        <span class="n">dataf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_full_dataf</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">)</span>
        <span class="n">dataf</span><span class="o">.</span><span class="n">to_parquet</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_default_save_path</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="n">start</span><span class="p">),</span>
                                                 <span class="n">end</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end_date</span><span class="p">),</span>
                                                 <span class="n">backend</span><span class="o">=</span><span class="s2">&quot;eod&quot;</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">get_numerframe_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NumerFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get NumerFrame data from some starting date.</span>
<span class="sd">        start: Starting data in %Y-%m-%d format.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dataf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_full_dataf</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">NumerFrame</span><span class="p">(</span><span class="n">dataf</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">generate_full_dataf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Collect all price data for list of EOD ticker symbols (Bloomberg tickers).</span>
<span class="sd">        start: Starting data in %Y-%m-%d format.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">price_datafs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">with</span> <span class="n">ThreadPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">)</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
            <span class="n">tasks</span> <span class="o">=</span> <span class="p">[</span><span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">generate_stock_dataf</span><span class="p">,</span> <span class="n">ticker</span><span class="p">,</span> <span class="n">start</span><span class="p">)</span> <span class="k">for</span> <span class="n">ticker</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tickers</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">concurrent</span><span class="o">.</span><span class="n">futures</span><span class="o">.</span><span class="n">as_completed</span><span class="p">(</span><span class="n">tasks</span><span class="p">),</span>
                             <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tickers</span><span class="p">),</span>
                             <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;EOD price data extraction&quot;</span><span class="p">):</span>
                <span class="n">price_datafs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">task</span><span class="o">.</span><span class="n">result</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">price_datafs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">generate_stock_dataf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ticker</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate Price DataFrame for a single ticker.</span>
<span class="sd">        ticker: EOD ticker symbol (Bloomberg tickers).</span>
<span class="sd">        For example, Apple stock = AAPL.US.</span>
<span class="sd">        start: Starting data in %Y-%m-%d format.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sleep_time</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get_prices_eod</span><span class="p">(</span><span class="n">ticker</span><span class="p">,</span> <span class="n">period</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="p">,</span>
                                              <span class="n">from_</span><span class="o">=</span><span class="n">start</span><span class="p">,</span> <span class="n">to</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">end_date</span><span class="p">)</span>
            <span class="n">stock_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">resp</span><span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">)</span>
            <span class="n">stock_df</span><span class="p">[</span><span class="s1">&#39;ticker&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ticker</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;WARNING: Date pull failed on ticker: &#39;</span><span class="si">{</span><span class="n">ticker</span><span class="si">}</span><span class="s2">&#39;. Exception: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">stock_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">stock_df</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">



<h3 id="numerblox.download.EODDownloader.download_live_data" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">download_live_data</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Download one year of data for defined tickers.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/download.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">download_live_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Download one year of data for defined tickers. &quot;&quot;&quot;</span>
    <span class="n">start</span> <span class="o">=</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_time</span><span class="p">)</span> <span class="o">-</span> <span class="n">relativedelta</span><span class="p">(</span><span class="n">years</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">dataf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_numerframe_data</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">)</span>
    <span class="n">dataf</span><span class="o">.</span><span class="n">to_parquet</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_default_save_path</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="n">start</span><span class="p">),</span>
                                             <span class="n">end</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end_date</span><span class="p">),</span>
                                             <span class="n">backend</span><span class="o">=</span><span class="s2">&quot;eod&quot;</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="numerblox.download.EODDownloader.download_training_data" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">download_training_data</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Download full date length available.
start: Starting data in %Y-%m-%d format.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/download.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">download_training_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Download full date length available.</span>
<span class="sd">    start: Starting data in %Y-%m-%d format.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">start</span> <span class="k">if</span> <span class="n">start</span> <span class="k">else</span> <span class="s2">&quot;1970-01-01&quot;</span>
    <span class="n">dataf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_full_dataf</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">)</span>
    <span class="n">dataf</span><span class="o">.</span><span class="n">to_parquet</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_default_save_path</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="n">start</span><span class="p">),</span>
                                             <span class="n">end</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end_date</span><span class="p">),</span>
                                             <span class="n">backend</span><span class="o">=</span><span class="s2">&quot;eod&quot;</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="numerblox.download.EODDownloader.generate_full_dataf" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">generate_full_dataf</span><span class="p">(</span><span class="n">start</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Collect all price data for list of EOD ticker symbols (Bloomberg tickers).
start: Starting data in %Y-%m-%d format.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/download.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">generate_full_dataf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Collect all price data for list of EOD ticker symbols (Bloomberg tickers).</span>
<span class="sd">    start: Starting data in %Y-%m-%d format.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">price_datafs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">with</span> <span class="n">ThreadPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">)</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
        <span class="n">tasks</span> <span class="o">=</span> <span class="p">[</span><span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">generate_stock_dataf</span><span class="p">,</span> <span class="n">ticker</span><span class="p">,</span> <span class="n">start</span><span class="p">)</span> <span class="k">for</span> <span class="n">ticker</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tickers</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">concurrent</span><span class="o">.</span><span class="n">futures</span><span class="o">.</span><span class="n">as_completed</span><span class="p">(</span><span class="n">tasks</span><span class="p">),</span>
                         <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tickers</span><span class="p">),</span>
                         <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;EOD price data extraction&quot;</span><span class="p">):</span>
            <span class="n">price_datafs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">task</span><span class="o">.</span><span class="n">result</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">price_datafs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="numerblox.download.EODDownloader.generate_stock_dataf" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">generate_stock_dataf</span><span class="p">(</span><span class="n">ticker</span><span class="p">,</span> <span class="n">start</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Generate Price DataFrame for a single ticker.
ticker: EOD ticker symbol (Bloomberg tickers).
For example, Apple stock = AAPL.US.
start: Starting data in %Y-%m-%d format.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/download.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">generate_stock_dataf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ticker</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate Price DataFrame for a single ticker.</span>
<span class="sd">    ticker: EOD ticker symbol (Bloomberg tickers).</span>
<span class="sd">    For example, Apple stock = AAPL.US.</span>
<span class="sd">    start: Starting data in %Y-%m-%d format.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sleep_time</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get_prices_eod</span><span class="p">(</span><span class="n">ticker</span><span class="p">,</span> <span class="n">period</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="p">,</span>
                                          <span class="n">from_</span><span class="o">=</span><span class="n">start</span><span class="p">,</span> <span class="n">to</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">end_date</span><span class="p">)</span>
        <span class="n">stock_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">resp</span><span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">)</span>
        <span class="n">stock_df</span><span class="p">[</span><span class="s1">&#39;ticker&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ticker</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;WARNING: Date pull failed on ticker: &#39;</span><span class="si">{</span><span class="n">ticker</span><span class="si">}</span><span class="s2">&#39;. Exception: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">stock_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">stock_df</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="numerblox.download.EODDownloader.get_numerframe_data" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_numerframe_data</span><span class="p">(</span><span class="n">start</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Get NumerFrame data from some starting date.
start: Starting data in %Y-%m-%d format.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/download.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_numerframe_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NumerFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get NumerFrame data from some starting date.</span>
<span class="sd">    start: Starting data in %Y-%m-%d format.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dataf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_full_dataf</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">NumerFrame</span><span class="p">(</span><span class="n">dataf</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>


</div>

<div class="doc doc-object doc-class">



<h2 id="numerblox.download.KaggleDownloader" class="doc doc-heading">
          <code>KaggleDownloader</code>


</h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="numerblox.download.BaseDownloader" href="#numerblox.download.BaseDownloader">BaseDownloader</a></code></p>

  
      <p>Download financial data from Kaggle.</p>
<p>For authentication, make sure you have a directory called .kaggle in your home directory
with therein a kaggle.json file. kaggle.json should have the following structure: </p>
<p><code>{"username": USERNAME, "key": KAGGLE_API_KEY}</code> </p>
<p>More info on authentication: github.com/Kaggle/kaggle-api#api-credentials </p>
<p>More info on the Kaggle Python API: kaggle.com/donkeys/kaggle-python-api </p>
<p>:param directory_path: Base folder to download files to.</p>

            <details class="quote">
              <summary>Source code in <code>numerblox/download.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">KaggleDownloader</span><span class="p">(</span><span class="n">BaseDownloader</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Download financial data from Kaggle.</span>

<span class="sd">    For authentication, make sure you have a directory called .kaggle in your home directory</span>
<span class="sd">    with therein a kaggle.json file. kaggle.json should have the following structure: \n</span>
<span class="sd">    `{&quot;username&quot;: USERNAME, &quot;key&quot;: KAGGLE_API_KEY}` \n</span>
<span class="sd">    More info on authentication: github.com/Kaggle/kaggle-api#api-credentials \n</span>

<span class="sd">    More info on the Kaggle Python API: kaggle.com/donkeys/kaggle-python-api \n</span>

<span class="sd">    :param directory_path: Base folder to download files to.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__check_kaggle_import</span><span class="p">()</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">directory_path</span><span class="o">=</span><span class="n">directory_path</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">download_live_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kaggle_dataset_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Download arbitrary Kaggle dataset.</span>
<span class="sd">        :param kaggle_dataset_path: Path on Kaggle (URL slug on kaggle.com/)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">download_training_data</span><span class="p">(</span><span class="n">kaggle_dataset_path</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">download_training_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kaggle_dataset_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Download arbitrary Kaggle dataset.</span>
<span class="sd">        :param kaggle_dataset_path: Path on Kaggle (URL slug on kaggle.com/)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">kaggle</span>
        <span class="n">kaggle</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">dataset_download_files</span><span class="p">(</span><span class="n">kaggle_dataset_path</span><span class="p">,</span>
                                          <span class="n">path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="p">,</span> <span class="n">unzip</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">__check_kaggle_import</span><span class="p">():</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">kaggle</span>
        <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">OSError</span><span class="p">(</span><span class="s2">&quot;Could not find kaggle.json credentials. Make sure it&#39;s located in /home/runner/.kaggle. Or use the environment method. Check github.com/Kaggle/kaggle-api#api-credentials for more information on authentication.&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">



<h3 id="numerblox.download.KaggleDownloader.download_live_data" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">download_live_data</span><span class="p">(</span><span class="n">kaggle_dataset_path</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Download arbitrary Kaggle dataset.
:param kaggle_dataset_path: Path on Kaggle (URL slug on kaggle.com/)</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/download.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">download_live_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kaggle_dataset_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Download arbitrary Kaggle dataset.</span>
<span class="sd">    :param kaggle_dataset_path: Path on Kaggle (URL slug on kaggle.com/)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">download_training_data</span><span class="p">(</span><span class="n">kaggle_dataset_path</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="numerblox.download.KaggleDownloader.download_training_data" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">download_training_data</span><span class="p">(</span><span class="n">kaggle_dataset_path</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Download arbitrary Kaggle dataset.
:param kaggle_dataset_path: Path on Kaggle (URL slug on kaggle.com/)</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/download.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">download_training_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kaggle_dataset_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Download arbitrary Kaggle dataset.</span>
<span class="sd">    :param kaggle_dataset_path: Path on Kaggle (URL slug on kaggle.com/)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">kaggle</span>
    <span class="n">kaggle</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">dataset_download_files</span><span class="p">(</span><span class="n">kaggle_dataset_path</span><span class="p">,</span>
                                      <span class="n">path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="p">,</span> <span class="n">unzip</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>


</div>

<div class="doc doc-object doc-class">



<h2 id="numerblox.download.NumeraiClassicDownloader" class="doc doc-heading">
          <code>NumeraiClassicDownloader</code>


</h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="numerblox.download.BaseDownloader" href="#numerblox.download.BaseDownloader">BaseDownloader</a></code></p>

  
      <p>WARNING: Versions 1-3 (legacy data) are deprecated. Only supporting version 4+.</p>
<p>Downloading from NumerAPI for Numerai Classic data. </p>
<p>:param directory_path: Base folder to download files to. </p>
<p>All kwargs will be passed to NumerAPI initialization.</p>

            <details class="quote">
              <summary>Source code in <code>numerblox/download.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">NumeraiClassicDownloader</span><span class="p">(</span><span class="n">BaseDownloader</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    WARNING: Versions 1-3 (legacy data) are deprecated. Only supporting version 4+.</span>

<span class="sd">    Downloading from NumerAPI for Numerai Classic data. \n</span>
<span class="sd">    :param directory_path: Base folder to download files to. \n</span>
<span class="sd">    All kwargs will be passed to NumerAPI initialization.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">TRAIN_DATASET_NAME</span> <span class="o">=</span> <span class="s2">&quot;train_int8.parquet&quot;</span>
    <span class="n">VALIDATION_DATASET_NAME</span> <span class="o">=</span> <span class="s2">&quot;validation_int8.parquet&quot;</span>
    <span class="n">LIVE_DATASET_NAME</span> <span class="o">=</span> <span class="s2">&quot;live_int8.parquet&quot;</span>
    <span class="n">LIVE_EXAMPLE_PREDS_NAME</span> <span class="o">=</span> <span class="s2">&quot;live_example_preds.parquet&quot;</span>
    <span class="n">VALIDATION_EXAMPLE_PREDS_NAME</span> <span class="o">=</span> <span class="s2">&quot;validation_example_preds.parquet&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">directory_path</span><span class="o">=</span><span class="n">directory_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">napi</span> <span class="o">=</span> <span class="n">NumerAPI</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_round</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">napi</span><span class="o">.</span><span class="n">get_current_round</span><span class="p">()</span>
        <span class="c1"># Get all available versions available for Numerai.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataset_versions</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">napi</span><span class="o">.</span><span class="n">list_datasets</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataset_versions</span><span class="o">.</span><span class="n">discard</span><span class="p">(</span><span class="s2">&quot;signals&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">download_training_data</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">subfolder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">version</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;4.3&quot;</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get Numerai classic training and validation data.</span>
<span class="sd">        :param subfolder: Specify folder to create folder within base directory root.</span>
<span class="sd">        Saves in base directory root by default.</span>
<span class="sd">        :param version: Numerai dataset version.</span>
<span class="sd">        4 = April 2022 dataset</span>
<span class="sd">        4.1 = Sunshine dataset</span>
<span class="sd">        4.2 (default) = Rain Dataset</span>
<span class="sd">        4.3 = Midnight dataset</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_dataset_version</span><span class="p">(</span><span class="n">version</span><span class="p">)</span>
        <span class="n">train_val_files</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;v</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">TRAIN_DATASET_NAME</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                           <span class="sa">f</span><span class="s2">&quot;v</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">VALIDATION_DATASET_NAME</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">train_val_files</span><span class="p">:</span>
            <span class="n">dest_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_dest_path</span><span class="p">(</span><span class="n">subfolder</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">download_single_dataset</span><span class="p">(</span>
                <span class="n">filename</span><span class="o">=</span><span class="n">file</span><span class="p">,</span>
                <span class="n">dest_path</span><span class="o">=</span><span class="n">dest_path</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">download_single_dataset</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">dest_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">round_num</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Download one of the available datasets through NumerAPI.</span>

<span class="sd">        :param filename: Name as listed in NumerAPI (Check NumerAPI().list_datasets() for full overview)</span>
<span class="sd">        :param dest_path: Full path where file will be saved.</span>
<span class="sd">        :param round_num: Numerai tournament round number. Downloads latest round by default.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Downloading &#39;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">napi</span><span class="o">.</span><span class="n">download_dataset</span><span class="p">(</span>
            <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span>
            <span class="n">dest_path</span><span class="o">=</span><span class="n">dest_path</span><span class="p">,</span>
            <span class="n">round_num</span><span class="o">=</span><span class="n">round_num</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">download_live_data</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">subfolder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="n">version</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;4.3&quot;</span><span class="p">,</span>
            <span class="n">round_num</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Download all live data in specified folder for given version (i.e. minimal data needed for inference).</span>

<span class="sd">        :param subfolder: Specify folder to create folder within directory root.</span>
<span class="sd">        Saves in directory root by default.</span>
<span class="sd">        :param version: Numerai dataset version. </span>
<span class="sd">        4 = April 2022 dataset</span>
<span class="sd">        4.1 = Sunshine dataset</span>
<span class="sd">        4.2 (default) = Rain Dataset</span>
<span class="sd">        4.3 = Midnight dataset</span>
<span class="sd">        :param round_num: Numerai tournament round number. Downloads latest round by default.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_dataset_version</span><span class="p">(</span><span class="n">version</span><span class="p">)</span>
        <span class="n">live_files</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;v</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">LIVE_DATASET_NAME</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">live_files</span><span class="p">:</span>
            <span class="n">dest_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_dest_path</span><span class="p">(</span><span class="n">subfolder</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">download_single_dataset</span><span class="p">(</span>
                <span class="n">filename</span><span class="o">=</span><span class="n">file</span><span class="p">,</span>
                <span class="n">dest_path</span><span class="o">=</span><span class="n">dest_path</span><span class="p">,</span>
                <span class="n">round_num</span><span class="o">=</span><span class="n">round_num</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">download_example_data</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">subfolder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">version</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;4.3&quot;</span><span class="p">,</span> <span class="n">round_num</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Download all example prediction data in specified folder for given version.</span>

<span class="sd">        :param subfolder: Specify folder to create folder within base directory root.</span>
<span class="sd">        Saves in base directory root by default.</span>
<span class="sd">        :param version: Numerai dataset version.</span>
<span class="sd">        4 = April 2022 dataset</span>
<span class="sd">        4.1 = Sunshine dataset</span>
<span class="sd">        4.2 (default) = Rain Dataset</span>
<span class="sd">        4.3 = Midnight dataset</span>
<span class="sd">        :param round_num: Numerai tournament round number. Downloads latest round by default.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_dataset_version</span><span class="p">(</span><span class="n">version</span><span class="p">)</span>
        <span class="n">example_files</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;v</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">LIVE_EXAMPLE_PREDS_NAME</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> 
                         <span class="sa">f</span><span class="s2">&quot;v</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">VALIDATION_EXAMPLE_PREDS_NAME</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">example_files</span><span class="p">:</span>
            <span class="n">dest_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_dest_path</span><span class="p">(</span><span class="n">subfolder</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">download_single_dataset</span><span class="p">(</span>
                <span class="n">filename</span><span class="o">=</span><span class="n">file</span><span class="p">,</span>
                <span class="n">dest_path</span><span class="o">=</span><span class="n">dest_path</span><span class="p">,</span>
                <span class="n">round_num</span><span class="o">=</span><span class="n">round_num</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_classic_features</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subfolder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s2">&quot;v4.3/features.json&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Download feature overview (stats and feature sets) through NumerAPI and load as dict.</span>
<span class="sd">        :param subfolder: Specify folder to create folder within base directory root.</span>
<span class="sd">        Saves in base directory root by default.</span>
<span class="sd">        :param filename: name for feature overview.</span>
<span class="sd">        *args, **kwargs will be passed to the JSON loader.</span>
<span class="sd">        :return: Feature overview dict</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">version</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;v&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_dataset_version</span><span class="p">(</span><span class="n">version</span><span class="p">)</span>
        <span class="n">dest_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_dest_path</span><span class="p">(</span><span class="n">subfolder</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">download_single_dataset</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span>
                                     <span class="n">dest_path</span><span class="o">=</span><span class="n">dest_path</span><span class="p">)</span>
        <span class="n">json_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_json</span><span class="p">(</span><span class="n">dest_path</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">json_data</span>

    <span class="k">def</span> <span class="nf">download_meta_model_preds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subfolder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s2">&quot;v4.3/meta_model.parquet&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Download Meta model predictions through NumerAPI.</span>
<span class="sd">        :param subfolder: Specify folder to create folder within base directory root.</span>
<span class="sd">        Saves in base directory root by default.</span>
<span class="sd">        :param filename: name for meta model predictions file.</span>
<span class="sd">        :return: Meta model predictions as DataFrame.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">version</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;v&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_dataset_version</span><span class="p">(</span><span class="n">version</span><span class="p">)</span>
        <span class="n">dest_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_dest_path</span><span class="p">(</span><span class="n">subfolder</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">download_single_dataset</span><span class="p">(</span>
            <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span>
            <span class="n">dest_path</span><span class="o">=</span><span class="n">dest_path</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="n">dest_path</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_check_dataset_version</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">version</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">assert</span> <span class="sa">f</span><span class="s2">&quot;v</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset_versions</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Version &#39;</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">&#39; is not available in NumerAPI.&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">



<h3 id="numerblox.download.NumeraiClassicDownloader.download_example_data" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">download_example_data</span><span class="p">(</span><span class="n">subfolder</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="s1">&#39;4.3&#39;</span><span class="p">,</span> <span class="n">round_num</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Download all example prediction data in specified folder for given version.</p>
<p>:param subfolder: Specify folder to create folder within base directory root.
Saves in base directory root by default.
:param version: Numerai dataset version.
4 = April 2022 dataset
4.1 = Sunshine dataset
4.2 (default) = Rain Dataset
4.3 = Midnight dataset
:param round_num: Numerai tournament round number. Downloads latest round by default.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/download.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">download_example_data</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">subfolder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">version</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;4.3&quot;</span><span class="p">,</span> <span class="n">round_num</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Download all example prediction data in specified folder for given version.</span>

<span class="sd">    :param subfolder: Specify folder to create folder within base directory root.</span>
<span class="sd">    Saves in base directory root by default.</span>
<span class="sd">    :param version: Numerai dataset version.</span>
<span class="sd">    4 = April 2022 dataset</span>
<span class="sd">    4.1 = Sunshine dataset</span>
<span class="sd">    4.2 (default) = Rain Dataset</span>
<span class="sd">    4.3 = Midnight dataset</span>
<span class="sd">    :param round_num: Numerai tournament round number. Downloads latest round by default.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_check_dataset_version</span><span class="p">(</span><span class="n">version</span><span class="p">)</span>
    <span class="n">example_files</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;v</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">LIVE_EXAMPLE_PREDS_NAME</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> 
                     <span class="sa">f</span><span class="s2">&quot;v</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">VALIDATION_EXAMPLE_PREDS_NAME</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">example_files</span><span class="p">:</span>
        <span class="n">dest_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_dest_path</span><span class="p">(</span><span class="n">subfolder</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">download_single_dataset</span><span class="p">(</span>
            <span class="n">filename</span><span class="o">=</span><span class="n">file</span><span class="p">,</span>
            <span class="n">dest_path</span><span class="o">=</span><span class="n">dest_path</span><span class="p">,</span>
            <span class="n">round_num</span><span class="o">=</span><span class="n">round_num</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="numerblox.download.NumeraiClassicDownloader.download_live_data" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">download_live_data</span><span class="p">(</span><span class="n">subfolder</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="s1">&#39;4.3&#39;</span><span class="p">,</span> <span class="n">round_num</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Download all live data in specified folder for given version (i.e. minimal data needed for inference).</p>
<p>:param subfolder: Specify folder to create folder within directory root.
Saves in directory root by default.
:param version: Numerai dataset version. 
4 = April 2022 dataset
4.1 = Sunshine dataset
4.2 (default) = Rain Dataset
4.3 = Midnight dataset
:param round_num: Numerai tournament round number. Downloads latest round by default.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/download.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">download_live_data</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">subfolder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">version</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;4.3&quot;</span><span class="p">,</span>
        <span class="n">round_num</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Download all live data in specified folder for given version (i.e. minimal data needed for inference).</span>

<span class="sd">    :param subfolder: Specify folder to create folder within directory root.</span>
<span class="sd">    Saves in directory root by default.</span>
<span class="sd">    :param version: Numerai dataset version. </span>
<span class="sd">    4 = April 2022 dataset</span>
<span class="sd">    4.1 = Sunshine dataset</span>
<span class="sd">    4.2 (default) = Rain Dataset</span>
<span class="sd">    4.3 = Midnight dataset</span>
<span class="sd">    :param round_num: Numerai tournament round number. Downloads latest round by default.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_check_dataset_version</span><span class="p">(</span><span class="n">version</span><span class="p">)</span>
    <span class="n">live_files</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;v</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">LIVE_DATASET_NAME</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">live_files</span><span class="p">:</span>
        <span class="n">dest_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_dest_path</span><span class="p">(</span><span class="n">subfolder</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">download_single_dataset</span><span class="p">(</span>
            <span class="n">filename</span><span class="o">=</span><span class="n">file</span><span class="p">,</span>
            <span class="n">dest_path</span><span class="o">=</span><span class="n">dest_path</span><span class="p">,</span>
            <span class="n">round_num</span><span class="o">=</span><span class="n">round_num</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="numerblox.download.NumeraiClassicDownloader.download_meta_model_preds" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">download_meta_model_preds</span><span class="p">(</span><span class="n">subfolder</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;v4.3/meta_model.parquet&#39;</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Download Meta model predictions through NumerAPI.
:param subfolder: Specify folder to create folder within base directory root.
Saves in base directory root by default.
:param filename: name for meta model predictions file.
:return: Meta model predictions as DataFrame.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/download.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">download_meta_model_preds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subfolder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s2">&quot;v4.3/meta_model.parquet&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Download Meta model predictions through NumerAPI.</span>
<span class="sd">    :param subfolder: Specify folder to create folder within base directory root.</span>
<span class="sd">    Saves in base directory root by default.</span>
<span class="sd">    :param filename: name for meta model predictions file.</span>
<span class="sd">    :return: Meta model predictions as DataFrame.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">version</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;v&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_check_dataset_version</span><span class="p">(</span><span class="n">version</span><span class="p">)</span>
    <span class="n">dest_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_dest_path</span><span class="p">(</span><span class="n">subfolder</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">download_single_dataset</span><span class="p">(</span>
        <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span>
        <span class="n">dest_path</span><span class="o">=</span><span class="n">dest_path</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="n">dest_path</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="numerblox.download.NumeraiClassicDownloader.download_single_dataset" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">download_single_dataset</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">dest_path</span><span class="p">,</span> <span class="n">round_num</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Download one of the available datasets through NumerAPI.</p>
<p>:param filename: Name as listed in NumerAPI (Check NumerAPI().list_datasets() for full overview)
:param dest_path: Full path where file will be saved.
:param round_num: Numerai tournament round number. Downloads latest round by default.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/download.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">download_single_dataset</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">dest_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">round_num</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Download one of the available datasets through NumerAPI.</span>

<span class="sd">    :param filename: Name as listed in NumerAPI (Check NumerAPI().list_datasets() for full overview)</span>
<span class="sd">    :param dest_path: Full path where file will be saved.</span>
<span class="sd">    :param round_num: Numerai tournament round number. Downloads latest round by default.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Downloading &#39;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">napi</span><span class="o">.</span><span class="n">download_dataset</span><span class="p">(</span>
        <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span>
        <span class="n">dest_path</span><span class="o">=</span><span class="n">dest_path</span><span class="p">,</span>
        <span class="n">round_num</span><span class="o">=</span><span class="n">round_num</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="numerblox.download.NumeraiClassicDownloader.download_training_data" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">download_training_data</span><span class="p">(</span><span class="n">subfolder</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="s1">&#39;4.3&#39;</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Get Numerai classic training and validation data.
:param subfolder: Specify folder to create folder within base directory root.
Saves in base directory root by default.
:param version: Numerai dataset version.
4 = April 2022 dataset
4.1 = Sunshine dataset
4.2 (default) = Rain Dataset
4.3 = Midnight dataset</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/download.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">download_training_data</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">subfolder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">version</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;4.3&quot;</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get Numerai classic training and validation data.</span>
<span class="sd">    :param subfolder: Specify folder to create folder within base directory root.</span>
<span class="sd">    Saves in base directory root by default.</span>
<span class="sd">    :param version: Numerai dataset version.</span>
<span class="sd">    4 = April 2022 dataset</span>
<span class="sd">    4.1 = Sunshine dataset</span>
<span class="sd">    4.2 (default) = Rain Dataset</span>
<span class="sd">    4.3 = Midnight dataset</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_check_dataset_version</span><span class="p">(</span><span class="n">version</span><span class="p">)</span>
    <span class="n">train_val_files</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;v</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">TRAIN_DATASET_NAME</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                       <span class="sa">f</span><span class="s2">&quot;v</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">VALIDATION_DATASET_NAME</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">train_val_files</span><span class="p">:</span>
        <span class="n">dest_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_dest_path</span><span class="p">(</span><span class="n">subfolder</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">download_single_dataset</span><span class="p">(</span>
            <span class="n">filename</span><span class="o">=</span><span class="n">file</span><span class="p">,</span>
            <span class="n">dest_path</span><span class="o">=</span><span class="n">dest_path</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="numerblox.download.NumeraiClassicDownloader.get_classic_features" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_classic_features</span><span class="p">(</span><span class="n">subfolder</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;v4.3/features.json&#39;</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Download feature overview (stats and feature sets) through NumerAPI and load as dict.
:param subfolder: Specify folder to create folder within base directory root.
Saves in base directory root by default.
:param filename: name for feature overview.
<em>args, </em>*kwargs will be passed to the JSON loader.
:return: Feature overview dict</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/download.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_classic_features</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subfolder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s2">&quot;v4.3/features.json&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Download feature overview (stats and feature sets) through NumerAPI and load as dict.</span>
<span class="sd">    :param subfolder: Specify folder to create folder within base directory root.</span>
<span class="sd">    Saves in base directory root by default.</span>
<span class="sd">    :param filename: name for feature overview.</span>
<span class="sd">    *args, **kwargs will be passed to the JSON loader.</span>
<span class="sd">    :return: Feature overview dict</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">version</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;v&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_check_dataset_version</span><span class="p">(</span><span class="n">version</span><span class="p">)</span>
    <span class="n">dest_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_dest_path</span><span class="p">(</span><span class="n">subfolder</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">download_single_dataset</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span>
                                 <span class="n">dest_path</span><span class="o">=</span><span class="n">dest_path</span><span class="p">)</span>
    <span class="n">json_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_json</span><span class="p">(</span><span class="n">dest_path</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">json_data</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>


</div>

<div class="doc doc-object doc-class">



<h2 id="numerblox.download.NumeraiSignalsDownloader" class="doc doc-heading">
          <code>NumeraiSignalsDownloader</code>


</h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="numerblox.download.BaseDownloader" href="#numerblox.download.BaseDownloader">BaseDownloader</a></code></p>

  
      <p>Support for Numerai Signals v1 parquet data.</p>
<p>Downloading from SignalsAPI for Numerai Signals data. </p>
<p>:param directory_path: Base folder to download files to. </p>
<p>All kwargs will be passed to SignalsAPI initialization.</p>

            <details class="quote">
              <summary>Source code in <code>numerblox/download.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">NumeraiSignalsDownloader</span><span class="p">(</span><span class="n">BaseDownloader</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Support for Numerai Signals v1 parquet data.</span>

<span class="sd">    Downloading from SignalsAPI for Numerai Signals data. \n</span>
<span class="sd">    :param directory_path: Base folder to download files to. \n</span>
<span class="sd">    All kwargs will be passed to SignalsAPI initialization.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">TRAIN_DATASET_NAME</span> <span class="o">=</span> <span class="s2">&quot;train.parquet&quot;</span>
    <span class="n">VALIDATION_DATASET_NAME</span> <span class="o">=</span> <span class="s2">&quot;validation.parquet&quot;</span>
    <span class="n">LIVE_DATASET_NAME</span> <span class="o">=</span> <span class="s2">&quot;live.parquet&quot;</span>
    <span class="n">LIVE_EXAMPLE_PREDS_NAME</span> <span class="o">=</span> <span class="s2">&quot;live_example_preds.parquet&quot;</span>
    <span class="n">VALIDATION_EXAMPLE_PREDS_NAME</span> <span class="o">=</span> <span class="s2">&quot;validation_example_preds.parquet&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">directory_path</span><span class="o">=</span><span class="n">directory_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sapi</span> <span class="o">=</span> <span class="n">SignalsAPI</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_round</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sapi</span><span class="o">.</span><span class="n">get_current_round</span><span class="p">()</span>
        <span class="c1"># Get all available versions available for Numerai Signals.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataset_versions</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;signals/&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sapi</span><span class="o">.</span><span class="n">list_datasets</span><span class="p">()</span> <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;signals/v&quot;</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">download_training_data</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">subfolder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">version</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;1.0&quot;</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get Numerai Signals training and validation data.</span>
<span class="sd">        :param subfolder: Specify folder to create folder within base directory root.</span>
<span class="sd">        Saves in base directory root by default.</span>
<span class="sd">        :param version: Numerai Signals dataset version.</span>
<span class="sd">        Currently only v1.0 is supported.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_dataset_version</span><span class="p">(</span><span class="n">version</span><span class="p">)</span>
        <span class="n">train_val_files</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;signals/v</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">TRAIN_DATASET_NAME</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                           <span class="sa">f</span><span class="s2">&quot;signals/v</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">VALIDATION_DATASET_NAME</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">train_val_files</span><span class="p">:</span>
            <span class="n">dest_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_dest_path</span><span class="p">(</span><span class="n">subfolder</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">download_single_dataset</span><span class="p">(</span>
                <span class="n">filename</span><span class="o">=</span><span class="n">file</span><span class="p">,</span>
                <span class="n">dest_path</span><span class="o">=</span><span class="n">dest_path</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">download_single_dataset</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">dest_path</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Download one of the available datasets through SignalsAPI.</span>

<span class="sd">        :param filename: Name as listed in NumerAPI (Check NumerAPI().list_datasets() for full overview)</span>
<span class="sd">        :param dest_path: Full path where file will be saved.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Downloading &#39;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sapi</span><span class="o">.</span><span class="n">download_dataset</span><span class="p">(</span>
            <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span>
            <span class="n">dest_path</span><span class="o">=</span><span class="n">dest_path</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">download_live_data</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">subfolder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="n">version</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;1.0&quot;</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Download all live data in specified folder (i.e. minimal data needed for inference).</span>

<span class="sd">        :param subfolder: Specify folder to create folder within directory root.</span>
<span class="sd">        Saves in directory root by default.</span>
<span class="sd">        :param version: Numerai dataset version. </span>
<span class="sd">        Currently only v1.0 is supported.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_dataset_version</span><span class="p">(</span><span class="n">version</span><span class="p">)</span>
        <span class="n">live_files</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;signals/v</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">LIVE_DATASET_NAME</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">live_files</span><span class="p">:</span>
            <span class="n">dest_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_dest_path</span><span class="p">(</span><span class="n">subfolder</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">download_single_dataset</span><span class="p">(</span>
                <span class="n">filename</span><span class="o">=</span><span class="n">file</span><span class="p">,</span>
                <span class="n">dest_path</span><span class="o">=</span><span class="n">dest_path</span><span class="p">,</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">download_example_data</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">subfolder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">version</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;1.0&quot;</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Download all example prediction data in specified folder for given version.</span>

<span class="sd">        :param subfolder: Specify folder to create folder within base directory root.</span>
<span class="sd">        Saves in base directory root by default.</span>
<span class="sd">        :param version: Numerai dataset version.</span>
<span class="sd">        Currently only v1.0 is supported.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_dataset_version</span><span class="p">(</span><span class="n">version</span><span class="p">)</span>
        <span class="n">example_files</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;signals/v</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">LIVE_EXAMPLE_PREDS_NAME</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> 
                         <span class="sa">f</span><span class="s2">&quot;signals/v</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">VALIDATION_EXAMPLE_PREDS_NAME</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">example_files</span><span class="p">:</span>
            <span class="n">dest_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_dest_path</span><span class="p">(</span><span class="n">subfolder</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">download_single_dataset</span><span class="p">(</span>
                <span class="n">filename</span><span class="o">=</span><span class="n">file</span><span class="p">,</span>
                <span class="n">dest_path</span><span class="o">=</span><span class="n">dest_path</span><span class="p">,</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_check_dataset_version</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">version</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">assert</span> <span class="sa">f</span><span class="s2">&quot;v</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset_versions</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Version &#39;</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">&#39; is not available in SignalsAPI.&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">



<h3 id="numerblox.download.NumeraiSignalsDownloader.download_example_data" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">download_example_data</span><span class="p">(</span><span class="n">subfolder</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="s1">&#39;1.0&#39;</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Download all example prediction data in specified folder for given version.</p>
<p>:param subfolder: Specify folder to create folder within base directory root.
Saves in base directory root by default.
:param version: Numerai dataset version.
Currently only v1.0 is supported.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/download.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">download_example_data</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">subfolder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">version</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;1.0&quot;</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Download all example prediction data in specified folder for given version.</span>

<span class="sd">    :param subfolder: Specify folder to create folder within base directory root.</span>
<span class="sd">    Saves in base directory root by default.</span>
<span class="sd">    :param version: Numerai dataset version.</span>
<span class="sd">    Currently only v1.0 is supported.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_check_dataset_version</span><span class="p">(</span><span class="n">version</span><span class="p">)</span>
    <span class="n">example_files</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;signals/v</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">LIVE_EXAMPLE_PREDS_NAME</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> 
                     <span class="sa">f</span><span class="s2">&quot;signals/v</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">VALIDATION_EXAMPLE_PREDS_NAME</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">example_files</span><span class="p">:</span>
        <span class="n">dest_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_dest_path</span><span class="p">(</span><span class="n">subfolder</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">download_single_dataset</span><span class="p">(</span>
            <span class="n">filename</span><span class="o">=</span><span class="n">file</span><span class="p">,</span>
            <span class="n">dest_path</span><span class="o">=</span><span class="n">dest_path</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="numerblox.download.NumeraiSignalsDownloader.download_live_data" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">download_live_data</span><span class="p">(</span><span class="n">subfolder</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="s1">&#39;1.0&#39;</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Download all live data in specified folder (i.e. minimal data needed for inference).</p>
<p>:param subfolder: Specify folder to create folder within directory root.
Saves in directory root by default.
:param version: Numerai dataset version. 
Currently only v1.0 is supported.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/download.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">download_live_data</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">subfolder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">version</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;1.0&quot;</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Download all live data in specified folder (i.e. minimal data needed for inference).</span>

<span class="sd">    :param subfolder: Specify folder to create folder within directory root.</span>
<span class="sd">    Saves in directory root by default.</span>
<span class="sd">    :param version: Numerai dataset version. </span>
<span class="sd">    Currently only v1.0 is supported.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_check_dataset_version</span><span class="p">(</span><span class="n">version</span><span class="p">)</span>
    <span class="n">live_files</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;signals/v</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">LIVE_DATASET_NAME</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">live_files</span><span class="p">:</span>
        <span class="n">dest_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_dest_path</span><span class="p">(</span><span class="n">subfolder</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">download_single_dataset</span><span class="p">(</span>
            <span class="n">filename</span><span class="o">=</span><span class="n">file</span><span class="p">,</span>
            <span class="n">dest_path</span><span class="o">=</span><span class="n">dest_path</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="numerblox.download.NumeraiSignalsDownloader.download_single_dataset" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">download_single_dataset</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">dest_path</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Download one of the available datasets through SignalsAPI.</p>
<p>:param filename: Name as listed in NumerAPI (Check NumerAPI().list_datasets() for full overview)
:param dest_path: Full path where file will be saved.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/download.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">download_single_dataset</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">dest_path</span><span class="p">:</span> <span class="nb">str</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Download one of the available datasets through SignalsAPI.</span>

<span class="sd">    :param filename: Name as listed in NumerAPI (Check NumerAPI().list_datasets() for full overview)</span>
<span class="sd">    :param dest_path: Full path where file will be saved.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Downloading &#39;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">sapi</span><span class="o">.</span><span class="n">download_dataset</span><span class="p">(</span>
        <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span>
        <span class="n">dest_path</span><span class="o">=</span><span class="n">dest_path</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="numerblox.download.NumeraiSignalsDownloader.download_training_data" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">download_training_data</span><span class="p">(</span><span class="n">subfolder</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="s1">&#39;1.0&#39;</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Get Numerai Signals training and validation data.
:param subfolder: Specify folder to create folder within base directory root.
Saves in base directory root by default.
:param version: Numerai Signals dataset version.
Currently only v1.0 is supported.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/download.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">download_training_data</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">subfolder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">version</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;1.0&quot;</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get Numerai Signals training and validation data.</span>
<span class="sd">    :param subfolder: Specify folder to create folder within base directory root.</span>
<span class="sd">    Saves in base directory root by default.</span>
<span class="sd">    :param version: Numerai Signals dataset version.</span>
<span class="sd">    Currently only v1.0 is supported.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_check_dataset_version</span><span class="p">(</span><span class="n">version</span><span class="p">)</span>
    <span class="n">train_val_files</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;signals/v</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">TRAIN_DATASET_NAME</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                       <span class="sa">f</span><span class="s2">&quot;signals/v</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">VALIDATION_DATASET_NAME</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">train_val_files</span><span class="p">:</span>
        <span class="n">dest_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_dest_path</span><span class="p">(</span><span class="n">subfolder</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">download_single_dataset</span><span class="p">(</span>
            <span class="n">filename</span><span class="o">=</span><span class="n">file</span><span class="p">,</span>
            <span class="n">dest_path</span><span class="o">=</span><span class="n">dest_path</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>


</div>




  </div>

  </div>

</div><hr />


<div class="doc doc-object doc-module">



<a id="numerblox.numerframe"></a>
  <div class="doc doc-contents first">

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="numerblox.numerframe.NumerFrame" class="doc doc-heading">
          <code>NumerFrame</code>


</h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><span title="pandas.DataFrame">DataFrame</span></code></p>

  
      <p>Data structure which extends Pandas DataFrames and
allows for additional Numerai specific functionality.</p>

            <details class="quote">
              <summary>Source code in <code>numerblox/numerframe.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">NumerFrame</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Data structure which extends Pandas DataFrames and</span>
<span class="sd">    allows for additional Numerai specific functionality.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_metadata</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;meta&quot;</span><span class="p">,</span> <span class="s2">&quot;feature_cols&quot;</span><span class="p">,</span> <span class="s2">&quot;target_cols&quot;</span><span class="p">,</span>
                 <span class="s2">&quot;prediction_cols&quot;</span><span class="p">,</span> <span class="s2">&quot;not_aux_cols&quot;</span><span class="p">,</span> <span class="s2">&quot;aux_cols&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meta</span> <span class="o">=</span> <span class="n">AttrDict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__set_era_col</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__init_meta_attrs</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_constructor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">NumerFrame</span>

    <span class="k">def</span> <span class="nf">__init_meta_attrs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Dynamically track column groups. &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feature_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">col</span><span class="p">)</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;feature&quot;</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">col</span><span class="p">)</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;target&quot;</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prediction_cols</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">col</span><span class="p">)</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;prediction&quot;</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">not_aux_cols</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_cols</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_cols</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">prediction_cols</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aux_cols</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">col</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">not_aux_cols</span>
        <span class="p">]</span>

    <span class="k">def</span> <span class="nf">__set_era_col</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Each NumerFrame should have an era column to benefit from all functionality. &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;era&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">era_col</span> <span class="o">=</span> <span class="s2">&quot;era&quot;</span>
        <span class="k">elif</span> <span class="s2">&quot;date&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">era_col</span> <span class="o">=</span> <span class="s2">&quot;date&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">era_col</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">get_column_selection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cols</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s2">&quot;NumerFrame&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Return NumerFrame from selection of columns. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">cols</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cols</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="n">cols</span><span class="p">]]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">get_feature_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;NumerFrame&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; All columns for which name starts with &#39;target&#39;.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_column_selection</span><span class="p">(</span><span class="n">cols</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">feature_cols</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">get_target_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;NumerFrame&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; All columns for which name starts with &#39;target&#39;.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_column_selection</span><span class="p">(</span><span class="n">cols</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">target_cols</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">get_single_target_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;NumerFrame&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Column with name &#39;target&#39; (Main Numerai target column). &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_column_selection</span><span class="p">(</span><span class="n">cols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">])</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">get_prediction_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;NumerFrame&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; All columns for which name starts with &#39;prediction&#39;.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_column_selection</span><span class="p">(</span><span class="n">cols</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prediction_cols</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">get_aux_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;NumerFrame&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; All columns that are not features, targets or predictions. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_column_selection</span><span class="p">(</span><span class="n">cols</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">aux_cols</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">get_era_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;NumerFrame&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Column of all eras. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_column_selection</span><span class="p">(</span><span class="n">cols</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">era_col</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">get_prediction_aux_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;NumerFrame&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; All predictions columns and aux columns (for ensembling, etc.). &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_column_selection</span><span class="p">(</span><span class="n">cols</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prediction_cols</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">aux_cols</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">get_fncv3_feature_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;NumerFrame&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Get FNCv3 features. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_column_selection</span><span class="p">(</span><span class="n">cols</span><span class="o">=</span><span class="n">FNCV3_FEATURES</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">get_small_feature_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;NumerFrame&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Small subset of the Numerai dataset for v4.2 data. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_column_selection</span><span class="p">(</span><span class="n">cols</span><span class="o">=</span><span class="n">SMALL_FEATURES</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">get_medium_feature_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;NumerFrame&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Medium subset of the Numerai dataset for v4.2 data. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_column_selection</span><span class="p">(</span><span class="n">cols</span><span class="o">=</span><span class="n">MEDIUM_FEATURES</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">get_v2_equivalent_feature_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;NumerFrame&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Features equivalent to the deprecated v2 Numerai data. For v4.2 data. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_column_selection</span><span class="p">(</span><span class="n">cols</span><span class="o">=</span><span class="n">V2_EQUIVALENT_FEATURES</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">get_v3_equivalent_feature_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;NumerFrame&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Features equivalent to the deprecated v3 Numerai data. For v4.2 data. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_column_selection</span><span class="p">(</span><span class="n">cols</span><span class="o">=</span><span class="n">V3_EQUIVALENT_FEATURES</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">get_unique_eras</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Get all unique eras in the data. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">era_col</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">get_last_n_eras</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;NumerFrame&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        Get data for the last n eras. </span>
<span class="sd">        Make sure eras are sorted in the way you prefer.</span>
<span class="sd">        :param n: Number of eras to select.</span>
<span class="sd">        :return: NumerFrame with last n eras.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">eras</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">era_col</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()[</span><span class="o">-</span><span class="n">n</span><span class="p">:]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">era_col</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">eras</span><span class="p">)]</span>

    <span class="k">def</span> <span class="nf">get_feature_group</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;NumerFrame&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Get feature group based on name or list of names. &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">V4_2_FEATURE_GROUP_MAPPING</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> \
            <span class="sa">f</span><span class="s2">&quot;Group &#39;</span><span class="si">{</span><span class="n">group</span><span class="si">}</span><span class="s2">&#39; not found in </span><span class="si">{</span><span class="n">V4_2_FEATURE_GROUP_MAPPING</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_column_selection</span><span class="p">(</span><span class="n">cols</span><span class="o">=</span><span class="n">V4_2_FEATURE_GROUP_MAPPING</span><span class="p">[</span><span class="n">group</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">get_pattern_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pattern</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;NumerFrame&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get columns based on pattern (for example &#39;_20&#39; to get all 20-day Numerai targets).</span>
<span class="sd">        :param pattern: A &#39;like&#39; pattern (pattern in column_name == True)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">like</span><span class="o">=</span><span class="n">pattern</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_feature_target_pair</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multi_target</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="s2">&quot;NumerFrame&quot;</span><span class="p">,</span> <span class="s2">&quot;NumerFrame&quot;</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get split of feature and target columns.</span>
<span class="sd">        :param multi_target: Returns only &#39;target&#39; column by default.</span>
<span class="sd">        Returns all target columns when set to True.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_feature_data</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_target_data</span> <span class="k">if</span> <span class="n">multi_target</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_single_target_data</span>
        <span class="k">return</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span>

    <span class="k">def</span> <span class="nf">get_era_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">eras</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span>
                      <span class="n">convert_to_tf</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                      <span class="n">aemlp_batch</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                      <span class="n">features</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                      <span class="n">targets</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                      <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="s2">&quot;NumerFrame&quot;</span><span class="p">,</span> <span class="s2">&quot;NumerFrame&quot;</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get feature target pair batch of 1 or multiple eras. \n</span>
<span class="sd">        :param eras: Selection of era names that should be present in era_col. \n</span>
<span class="sd">        :param convert_to_tf: Convert to tf.Tensor. \n</span>
<span class="sd">        :param aemlp_batch: Specific target batch for autoencoder training. \n</span>
<span class="sd">        `y` output will contain three components: features, targets and targets. \n</span>
<span class="sd">        :param features: List of features to select. All by default \n</span>
<span class="sd">        :param targets: List of targets to select. All by default. \n</span>
<span class="sd">        *args, **kwargs are passed to initialization of Tensor.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">valid_eras</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">era</span> <span class="ow">in</span> <span class="n">eras</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">era</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">era_col</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">(),</span> <span class="sa">f</span><span class="s2">&quot;Era &#39;</span><span class="si">{</span><span class="n">era</span><span class="si">}</span><span class="s2">&#39; not found in era column (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">era_col</span><span class="si">}</span><span class="s2">)&quot;</span>
            <span class="n">valid_eras</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">era</span><span class="p">)</span>
        <span class="n">features</span> <span class="o">=</span> <span class="n">features</span> <span class="k">if</span> <span class="n">features</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_cols</span>
        <span class="n">targets</span> <span class="o">=</span> <span class="n">targets</span> <span class="k">if</span> <span class="n">targets</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_cols</span>
        <span class="n">X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">era_col</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">valid_eras</span><span class="p">)][</span><span class="n">features</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">era_col</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">valid_eras</span><span class="p">)][</span><span class="n">targets</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="k">if</span> <span class="n">aemlp_batch</span><span class="p">:</span>
            <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="n">X</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">y</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">y</span><span class="o">.</span><span class="n">copy</span><span class="p">()]</span>

        <span class="k">if</span> <span class="n">convert_to_tf</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
            <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s2">&quot;TensorFlow is not installed. Please make sure to have Tensorflow installed when setting `convert_to_tf=True`.&quot;</span><span class="p">)</span>
            <span class="n">X</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">aemlp_batch</span><span class="p">:</span>
                <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="n">tf</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">y</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">y</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">get_dates_from_era_col</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Column of all dates from era column. &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="s2">&quot;era&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> \
            <span class="s2">&quot;No &#39;era&#39; column in NumerFrame. Please make sure to have a valid &#39;era&#39; column to use for converting to dates.&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;era&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_date_from_era</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">get_eras_from_date_col</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Column of all eras from date column. &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="s2">&quot;date&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> \
            <span class="s2">&quot;No &#39;date&#39; column in NumerFrame. Please make sure to have a valid &#39;date&#39; column.&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_era_from_date</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_era_range</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_era</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">end_era</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;NumerFrame&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        Get all eras between two era numbers. </span>
<span class="sd">        :param start_era: Era number to start from (inclusive).</span>
<span class="sd">        :param end_era: Era number to end with (inclusive).</span>
<span class="sd">        :return: NumerFrame with all eras between start_era and end_era.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="s2">&quot;era&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="s2">&quot;No &#39;era&#39; column in NumerFrame. Please make sure to have an &#39;era&#39; column.&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">start_era</span><span class="p">,</span> <span class="nb">int</span><span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;start_era should be of type &#39;int&#39; but is &#39;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">start_era</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">end_era</span><span class="p">,</span> <span class="nb">int</span><span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;end_era should be of type &#39;int&#39; but is &#39;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">end_era</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
        <span class="k">assert</span> <span class="mi">1</span> <span class="o">&lt;=</span> <span class="n">start_era</span> <span class="o">&lt;=</span> <span class="n">end_era</span> <span class="o">&lt;=</span> <span class="n">get_current_era</span><span class="p">(),</span> \
            <span class="sa">f</span><span class="s2">&quot;start_era should be between 1 and </span><span class="si">{</span><span class="n">get_current_era</span><span class="p">()</span><span class="si">}</span><span class="s2">. Got &#39;</span><span class="si">{</span><span class="n">start_era</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
        <span class="k">assert</span> <span class="mi">1</span> <span class="o">&lt;=</span> <span class="n">start_era</span> <span class="o">&lt;=</span> <span class="n">end_era</span> <span class="o">&lt;=</span> <span class="n">get_current_era</span><span class="p">(),</span> \
            <span class="sa">f</span><span class="s2">&quot;end_era should be between 1 and </span><span class="si">{</span><span class="n">get_current_era</span><span class="p">()</span><span class="si">}</span><span class="s2">. Got &#39;</span><span class="si">{</span><span class="n">end_era</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
        <span class="k">assert</span> <span class="n">start_era</span> <span class="o">&lt;=</span> <span class="n">end_era</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;start_era should be before end_era. Got &#39;</span><span class="si">{</span><span class="n">start_era</span><span class="si">}</span><span class="s2">&#39; and &#39;</span><span class="si">{</span><span class="n">end_era</span><span class="si">}</span><span class="s2">&#39;&quot;</span>

        <span class="n">temp_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">temp_df</span><span class="p">[</span><span class="s1">&#39;era_int&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp_df</span><span class="p">[</span><span class="s1">&#39;era&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">result_df</span> <span class="o">=</span> <span class="n">temp_df</span><span class="p">[(</span><span class="n">temp_df</span><span class="p">[</span><span class="s1">&#39;era_int&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">start_era</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">temp_df</span><span class="p">[</span><span class="s1">&#39;era_int&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">end_era</span><span class="p">)]</span>
        <span class="k">return</span> <span class="n">result_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;era_int&#39;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">get_date_range</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_date</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">,</span> <span class="n">end_date</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;NumerFrame&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get all eras between two dates.</span>
<span class="sd">        :param start_date: Starting date (inclusive).</span>
<span class="sd">        :param end_date: Ending date (inclusive).</span>
<span class="sd">        :return: NumerFrame with all eras between start_date and end_date.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="s2">&quot;date&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> \
            <span class="s2">&quot;No &#39;date&#39; column in NumerFrame. Please make sure to have a valid &#39;date&#39; column.&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">start_date</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;start_date should be of type &#39;pd.Timestamp&#39; but is &#39;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">start_date</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">end_date</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;end_date should be of type &#39;pd.Timestamp&#39; but is &#39;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">end_date</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
        <span class="k">assert</span> <span class="n">ERA1_TIMESTAMP</span> <span class="o">&lt;=</span> <span class="n">start_date</span> <span class="o">&lt;=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="n">get_current_date</span><span class="p">()),</span> \
            <span class="sa">f</span><span class="s2">&quot;start_date should be between </span><span class="si">{</span><span class="n">ERA_ONE_START</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="n">get_current_date</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">assert</span> <span class="n">ERA1_TIMESTAMP</span> <span class="o">&lt;=</span> <span class="n">end_date</span> <span class="o">&lt;=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="n">get_current_date</span><span class="p">()),</span> \
            <span class="sa">f</span><span class="s2">&quot;end_date should be between </span><span class="si">{</span><span class="n">ERA_ONE_START</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="n">get_current_date</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">assert</span> <span class="n">start_date</span> <span class="o">&lt;=</span> <span class="n">end_date</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;start_date should be before end_date. Got &#39;</span><span class="si">{</span><span class="n">start_date</span><span class="si">}</span><span class="s2">&#39; and &#39;</span><span class="si">{</span><span class="n">end_date</span><span class="si">}</span><span class="s2">&#39;&quot;</span>

        <span class="n">temp_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">result_df</span> <span class="o">=</span> <span class="n">temp_df</span><span class="p">[(</span><span class="n">temp_df</span><span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">start_date</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">temp_df</span><span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">end_date</span><span class="p">)]</span>
        <span class="k">return</span> <span class="n">result_df</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_era_from_date</span><span class="p">(</span><span class="n">date_object</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        Get the era number from a specific date. </span>
<span class="sd">        :param date_object: Pandas Timestamp object for which to get era.</span>
<span class="sd">        :return: Era number.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">date_object</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;date_object should be of type &#39;date&#39; but is &#39;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">date_object</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
        <span class="n">current_date</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="n">get_current_date</span><span class="p">())</span>
        <span class="k">assert</span> <span class="n">ERA1_TIMESTAMP</span> <span class="o">&lt;=</span> <span class="n">date_object</span> <span class="o">&lt;=</span> <span class="n">current_date</span><span class="p">,</span> \
            <span class="sa">f</span><span class="s2">&quot;date_object should be between </span><span class="si">{</span><span class="n">ERA_ONE_START</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">current_date</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="n">get_era_for_date</span><span class="p">(</span><span class="n">date_object</span><span class="o">.</span><span class="n">date</span><span class="p">())</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_date_from_era</span><span class="p">(</span><span class="n">era</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        Get the date from a specific era. </span>
<span class="sd">        :param era: Era number for which to get date.</span>
<span class="sd">        Should be an integer which is at least 1.</span>
<span class="sd">        :return: Datetime object representing the date of the given era.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">era</span><span class="p">,</span> <span class="nb">int</span><span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;era should be of type &#39;int&#39; but is &#39;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">era</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
        <span class="k">assert</span> <span class="mi">1</span> <span class="o">&lt;=</span> <span class="n">era</span> <span class="o">&lt;=</span> <span class="n">get_current_era</span><span class="p">(),</span> \
            <span class="sa">f</span><span class="s2">&quot;era should be between 1 and </span><span class="si">{</span><span class="n">get_current_era</span><span class="p">()</span><span class="si">}</span><span class="s2">. Got &#39;</span><span class="si">{</span><span class="n">era</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="n">get_date_for_era</span><span class="p">(</span><span class="n">era</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="numerblox.numerframe.NumerFrame.get_aux_data" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_aux_data</span><span class="p">:</span> <span class="n">NumerFrame</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>All columns that are not features, targets or predictions.</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="numerblox.numerframe.NumerFrame.get_dates_from_era_col" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_dates_from_era_col</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Column of all dates from era column.</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="numerblox.numerframe.NumerFrame.get_era_data" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_era_data</span><span class="p">:</span> <span class="n">NumerFrame</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Column of all eras.</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="numerblox.numerframe.NumerFrame.get_eras_from_date_col" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_eras_from_date_col</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Column of all eras from date column.</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="numerblox.numerframe.NumerFrame.get_feature_data" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_feature_data</span><span class="p">:</span> <span class="n">NumerFrame</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>All columns for which name starts with 'target'.</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="numerblox.numerframe.NumerFrame.get_fncv3_feature_data" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_fncv3_feature_data</span><span class="p">:</span> <span class="n">NumerFrame</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Get FNCv3 features.</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="numerblox.numerframe.NumerFrame.get_medium_feature_data" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_medium_feature_data</span><span class="p">:</span> <span class="n">NumerFrame</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Medium subset of the Numerai dataset for v4.2 data.</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="numerblox.numerframe.NumerFrame.get_prediction_aux_data" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_prediction_aux_data</span><span class="p">:</span> <span class="n">NumerFrame</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>All predictions columns and aux columns (for ensembling, etc.).</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="numerblox.numerframe.NumerFrame.get_prediction_data" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_prediction_data</span><span class="p">:</span> <span class="n">NumerFrame</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>All columns for which name starts with 'prediction'.</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="numerblox.numerframe.NumerFrame.get_single_target_data" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_single_target_data</span><span class="p">:</span> <span class="n">NumerFrame</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Column with name 'target' (Main Numerai target column).</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="numerblox.numerframe.NumerFrame.get_small_feature_data" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_small_feature_data</span><span class="p">:</span> <span class="n">NumerFrame</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Small subset of the Numerai dataset for v4.2 data.</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="numerblox.numerframe.NumerFrame.get_target_data" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_target_data</span><span class="p">:</span> <span class="n">NumerFrame</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>All columns for which name starts with 'target'.</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="numerblox.numerframe.NumerFrame.get_unique_eras" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_unique_eras</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Get all unique eras in the data.</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="numerblox.numerframe.NumerFrame.get_v2_equivalent_feature_data" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_v2_equivalent_feature_data</span><span class="p">:</span> <span class="n">NumerFrame</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Features equivalent to the deprecated v2 Numerai data. For v4.2 data.</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="numerblox.numerframe.NumerFrame.get_v3_equivalent_feature_data" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_v3_equivalent_feature_data</span><span class="p">:</span> <span class="n">NumerFrame</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Features equivalent to the deprecated v3 Numerai data. For v4.2 data.</p>
  </div>

</div>




<div class="doc doc-object doc-function">



<h3 id="numerblox.numerframe.NumerFrame.__init_meta_attrs" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">__init_meta_attrs</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Dynamically track column groups.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/numerframe.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">__init_meta_attrs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Dynamically track column groups. &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">feature_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">col</span><span class="p">)</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;feature&quot;</span><span class="p">)]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">target_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">col</span><span class="p">)</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;target&quot;</span><span class="p">)]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">prediction_cols</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">col</span><span class="p">)</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;prediction&quot;</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">not_aux_cols</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_cols</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_cols</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">prediction_cols</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">aux_cols</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">col</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">not_aux_cols</span>
    <span class="p">]</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="numerblox.numerframe.NumerFrame.__set_era_col" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">__set_era_col</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Each NumerFrame should have an era column to benefit from all functionality.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/numerframe.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">__set_era_col</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Each NumerFrame should have an era column to benefit from all functionality. &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s2">&quot;era&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">era_col</span> <span class="o">=</span> <span class="s2">&quot;era&quot;</span>
    <span class="k">elif</span> <span class="s2">&quot;date&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">era_col</span> <span class="o">=</span> <span class="s2">&quot;date&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">era_col</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="numerblox.numerframe.NumerFrame.get_column_selection" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_column_selection</span><span class="p">(</span><span class="n">cols</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Return NumerFrame from selection of columns.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/numerframe.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_column_selection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cols</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s2">&quot;NumerFrame&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Return NumerFrame from selection of columns. &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">cols</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cols</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="n">cols</span><span class="p">]]</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="numerblox.numerframe.NumerFrame.get_date_from_era" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_date_from_era</span><span class="p">(</span><span class="n">era</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Get the date from a specific era. 
:param era: Era number for which to get date.
Should be an integer which is at least 1.
:return: Datetime object representing the date of the given era.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/numerframe.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">get_date_from_era</span><span class="p">(</span><span class="n">era</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">    Get the date from a specific era. </span>
<span class="sd">    :param era: Era number for which to get date.</span>
<span class="sd">    Should be an integer which is at least 1.</span>
<span class="sd">    :return: Datetime object representing the date of the given era.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">era</span><span class="p">,</span> <span class="nb">int</span><span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;era should be of type &#39;int&#39; but is &#39;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">era</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
    <span class="k">assert</span> <span class="mi">1</span> <span class="o">&lt;=</span> <span class="n">era</span> <span class="o">&lt;=</span> <span class="n">get_current_era</span><span class="p">(),</span> \
        <span class="sa">f</span><span class="s2">&quot;era should be between 1 and </span><span class="si">{</span><span class="n">get_current_era</span><span class="p">()</span><span class="si">}</span><span class="s2">. Got &#39;</span><span class="si">{</span><span class="n">era</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="n">get_date_for_era</span><span class="p">(</span><span class="n">era</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="numerblox.numerframe.NumerFrame.get_date_range" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_date_range</span><span class="p">(</span><span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Get all eras between two dates.
:param start_date: Starting date (inclusive).
:param end_date: Ending date (inclusive).
:return: NumerFrame with all eras between start_date and end_date.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/numerframe.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_date_range</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_date</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">,</span> <span class="n">end_date</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;NumerFrame&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get all eras between two dates.</span>
<span class="sd">    :param start_date: Starting date (inclusive).</span>
<span class="sd">    :param end_date: Ending date (inclusive).</span>
<span class="sd">    :return: NumerFrame with all eras between start_date and end_date.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="s2">&quot;date&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> \
        <span class="s2">&quot;No &#39;date&#39; column in NumerFrame. Please make sure to have a valid &#39;date&#39; column.&quot;</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">start_date</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;start_date should be of type &#39;pd.Timestamp&#39; but is &#39;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">start_date</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">end_date</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;end_date should be of type &#39;pd.Timestamp&#39; but is &#39;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">end_date</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
    <span class="k">assert</span> <span class="n">ERA1_TIMESTAMP</span> <span class="o">&lt;=</span> <span class="n">start_date</span> <span class="o">&lt;=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="n">get_current_date</span><span class="p">()),</span> \
        <span class="sa">f</span><span class="s2">&quot;start_date should be between </span><span class="si">{</span><span class="n">ERA_ONE_START</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="n">get_current_date</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">assert</span> <span class="n">ERA1_TIMESTAMP</span> <span class="o">&lt;=</span> <span class="n">end_date</span> <span class="o">&lt;=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="n">get_current_date</span><span class="p">()),</span> \
        <span class="sa">f</span><span class="s2">&quot;end_date should be between </span><span class="si">{</span><span class="n">ERA_ONE_START</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="n">get_current_date</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">assert</span> <span class="n">start_date</span> <span class="o">&lt;=</span> <span class="n">end_date</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;start_date should be before end_date. Got &#39;</span><span class="si">{</span><span class="n">start_date</span><span class="si">}</span><span class="s2">&#39; and &#39;</span><span class="si">{</span><span class="n">end_date</span><span class="si">}</span><span class="s2">&#39;&quot;</span>

    <span class="n">temp_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">result_df</span> <span class="o">=</span> <span class="n">temp_df</span><span class="p">[(</span><span class="n">temp_df</span><span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">start_date</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">temp_df</span><span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">end_date</span><span class="p">)]</span>
    <span class="k">return</span> <span class="n">result_df</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="numerblox.numerframe.NumerFrame.get_era_batch" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_era_batch</span><span class="p">(</span><span class="n">eras</span><span class="p">,</span> <span class="n">convert_to_tf</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">aemlp_batch</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">targets</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Get feature target pair batch of 1 or multiple eras. </p>
<p>:param eras: Selection of era names that should be present in era_col. </p>
<p>:param convert_to_tf: Convert to tf.Tensor. </p>
<p>:param aemlp_batch: Specific target batch for autoencoder training. </p>
<p><code>y</code> output will contain three components: features, targets and targets. </p>
<p>:param features: List of features to select. All by default </p>
<p>:param targets: List of targets to select. All by default. </p>
<p><em>args, </em>*kwargs are passed to initialization of Tensor.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/numerframe.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_era_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">eras</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span>
                  <span class="n">convert_to_tf</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                  <span class="n">aemlp_batch</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                  <span class="n">features</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                  <span class="n">targets</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                  <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="s2">&quot;NumerFrame&quot;</span><span class="p">,</span> <span class="s2">&quot;NumerFrame&quot;</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get feature target pair batch of 1 or multiple eras. \n</span>
<span class="sd">    :param eras: Selection of era names that should be present in era_col. \n</span>
<span class="sd">    :param convert_to_tf: Convert to tf.Tensor. \n</span>
<span class="sd">    :param aemlp_batch: Specific target batch for autoencoder training. \n</span>
<span class="sd">    `y` output will contain three components: features, targets and targets. \n</span>
<span class="sd">    :param features: List of features to select. All by default \n</span>
<span class="sd">    :param targets: List of targets to select. All by default. \n</span>
<span class="sd">    *args, **kwargs are passed to initialization of Tensor.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">valid_eras</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">era</span> <span class="ow">in</span> <span class="n">eras</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">era</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">era_col</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">(),</span> <span class="sa">f</span><span class="s2">&quot;Era &#39;</span><span class="si">{</span><span class="n">era</span><span class="si">}</span><span class="s2">&#39; not found in era column (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">era_col</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="n">valid_eras</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">era</span><span class="p">)</span>
    <span class="n">features</span> <span class="o">=</span> <span class="n">features</span> <span class="k">if</span> <span class="n">features</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_cols</span>
    <span class="n">targets</span> <span class="o">=</span> <span class="n">targets</span> <span class="k">if</span> <span class="n">targets</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_cols</span>
    <span class="n">X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">era_col</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">valid_eras</span><span class="p">)][</span><span class="n">features</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">era_col</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">valid_eras</span><span class="p">)][</span><span class="n">targets</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="k">if</span> <span class="n">aemlp_batch</span><span class="p">:</span>
        <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="n">X</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">y</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">y</span><span class="o">.</span><span class="n">copy</span><span class="p">()]</span>

    <span class="k">if</span> <span class="n">convert_to_tf</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s2">&quot;TensorFlow is not installed. Please make sure to have Tensorflow installed when setting `convert_to_tf=True`.&quot;</span><span class="p">)</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">aemlp_batch</span><span class="p">:</span>
            <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="n">tf</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">y</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="numerblox.numerframe.NumerFrame.get_era_from_date" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_era_from_date</span><span class="p">(</span><span class="n">date_object</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Get the era number from a specific date. 
:param date_object: Pandas Timestamp object for which to get era.
:return: Era number.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/numerframe.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">get_era_from_date</span><span class="p">(</span><span class="n">date_object</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">    Get the era number from a specific date. </span>
<span class="sd">    :param date_object: Pandas Timestamp object for which to get era.</span>
<span class="sd">    :return: Era number.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">date_object</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;date_object should be of type &#39;date&#39; but is &#39;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">date_object</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
    <span class="n">current_date</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="n">get_current_date</span><span class="p">())</span>
    <span class="k">assert</span> <span class="n">ERA1_TIMESTAMP</span> <span class="o">&lt;=</span> <span class="n">date_object</span> <span class="o">&lt;=</span> <span class="n">current_date</span><span class="p">,</span> \
        <span class="sa">f</span><span class="s2">&quot;date_object should be between </span><span class="si">{</span><span class="n">ERA_ONE_START</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">current_date</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">return</span> <span class="n">get_era_for_date</span><span class="p">(</span><span class="n">date_object</span><span class="o">.</span><span class="n">date</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="numerblox.numerframe.NumerFrame.get_era_range" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_era_range</span><span class="p">(</span><span class="n">start_era</span><span class="p">,</span> <span class="n">end_era</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Get all eras between two era numbers. 
:param start_era: Era number to start from (inclusive).
:param end_era: Era number to end with (inclusive).
:return: NumerFrame with all eras between start_era and end_era.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/numerframe.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_era_range</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_era</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">end_era</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;NumerFrame&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">    Get all eras between two era numbers. </span>
<span class="sd">    :param start_era: Era number to start from (inclusive).</span>
<span class="sd">    :param end_era: Era number to end with (inclusive).</span>
<span class="sd">    :return: NumerFrame with all eras between start_era and end_era.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="s2">&quot;era&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="s2">&quot;No &#39;era&#39; column in NumerFrame. Please make sure to have an &#39;era&#39; column.&quot;</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">start_era</span><span class="p">,</span> <span class="nb">int</span><span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;start_era should be of type &#39;int&#39; but is &#39;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">start_era</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">end_era</span><span class="p">,</span> <span class="nb">int</span><span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;end_era should be of type &#39;int&#39; but is &#39;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">end_era</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
    <span class="k">assert</span> <span class="mi">1</span> <span class="o">&lt;=</span> <span class="n">start_era</span> <span class="o">&lt;=</span> <span class="n">end_era</span> <span class="o">&lt;=</span> <span class="n">get_current_era</span><span class="p">(),</span> \
        <span class="sa">f</span><span class="s2">&quot;start_era should be between 1 and </span><span class="si">{</span><span class="n">get_current_era</span><span class="p">()</span><span class="si">}</span><span class="s2">. Got &#39;</span><span class="si">{</span><span class="n">start_era</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
    <span class="k">assert</span> <span class="mi">1</span> <span class="o">&lt;=</span> <span class="n">start_era</span> <span class="o">&lt;=</span> <span class="n">end_era</span> <span class="o">&lt;=</span> <span class="n">get_current_era</span><span class="p">(),</span> \
        <span class="sa">f</span><span class="s2">&quot;end_era should be between 1 and </span><span class="si">{</span><span class="n">get_current_era</span><span class="p">()</span><span class="si">}</span><span class="s2">. Got &#39;</span><span class="si">{</span><span class="n">end_era</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
    <span class="k">assert</span> <span class="n">start_era</span> <span class="o">&lt;=</span> <span class="n">end_era</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;start_era should be before end_era. Got &#39;</span><span class="si">{</span><span class="n">start_era</span><span class="si">}</span><span class="s2">&#39; and &#39;</span><span class="si">{</span><span class="n">end_era</span><span class="si">}</span><span class="s2">&#39;&quot;</span>

    <span class="n">temp_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">temp_df</span><span class="p">[</span><span class="s1">&#39;era_int&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp_df</span><span class="p">[</span><span class="s1">&#39;era&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">result_df</span> <span class="o">=</span> <span class="n">temp_df</span><span class="p">[(</span><span class="n">temp_df</span><span class="p">[</span><span class="s1">&#39;era_int&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">start_era</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">temp_df</span><span class="p">[</span><span class="s1">&#39;era_int&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">end_era</span><span class="p">)]</span>
    <span class="k">return</span> <span class="n">result_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;era_int&#39;</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="numerblox.numerframe.NumerFrame.get_feature_group" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_feature_group</span><span class="p">(</span><span class="n">group</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Get feature group based on name or list of names.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/numerframe.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_feature_group</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;NumerFrame&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Get feature group based on name or list of names. &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">V4_2_FEATURE_GROUP_MAPPING</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> \
        <span class="sa">f</span><span class="s2">&quot;Group &#39;</span><span class="si">{</span><span class="n">group</span><span class="si">}</span><span class="s2">&#39; not found in </span><span class="si">{</span><span class="n">V4_2_FEATURE_GROUP_MAPPING</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_column_selection</span><span class="p">(</span><span class="n">cols</span><span class="o">=</span><span class="n">V4_2_FEATURE_GROUP_MAPPING</span><span class="p">[</span><span class="n">group</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="numerblox.numerframe.NumerFrame.get_feature_target_pair" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_feature_target_pair</span><span class="p">(</span><span class="n">multi_target</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Get split of feature and target columns.
:param multi_target: Returns only 'target' column by default.
Returns all target columns when set to True.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/numerframe.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_feature_target_pair</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multi_target</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="s2">&quot;NumerFrame&quot;</span><span class="p">,</span> <span class="s2">&quot;NumerFrame&quot;</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get split of feature and target columns.</span>
<span class="sd">    :param multi_target: Returns only &#39;target&#39; column by default.</span>
<span class="sd">    Returns all target columns when set to True.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_feature_data</span>
    <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_target_data</span> <span class="k">if</span> <span class="n">multi_target</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_single_target_data</span>
    <span class="k">return</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="numerblox.numerframe.NumerFrame.get_last_n_eras" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_last_n_eras</span><span class="p">(</span><span class="n">n</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Get data for the last n eras. 
Make sure eras are sorted in the way you prefer.
:param n: Number of eras to select.
:return: NumerFrame with last n eras.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/numerframe.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_last_n_eras</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;NumerFrame&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">    Get data for the last n eras. </span>
<span class="sd">    Make sure eras are sorted in the way you prefer.</span>
<span class="sd">    :param n: Number of eras to select.</span>
<span class="sd">    :return: NumerFrame with last n eras.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">eras</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">era_col</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()[</span><span class="o">-</span><span class="n">n</span><span class="p">:]</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">era_col</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">eras</span><span class="p">)]</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="numerblox.numerframe.NumerFrame.get_pattern_data" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_pattern_data</span><span class="p">(</span><span class="n">pattern</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Get columns based on pattern (for example '_20' to get all 20-day Numerai targets).
:param pattern: A 'like' pattern (pattern in column_name == True)</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/numerframe.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_pattern_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pattern</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;NumerFrame&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get columns based on pattern (for example &#39;_20&#39; to get all 20-day Numerai targets).</span>
<span class="sd">    :param pattern: A &#39;like&#39; pattern (pattern in column_name == True)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">like</span><span class="o">=</span><span class="n">pattern</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>


</div>



<div class="doc doc-object doc-function">



<h2 id="numerblox.numerframe.create_numerframe" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">create_numerframe</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Convenient function to initialize NumerFrame.
Support most used file formats for Pandas DataFrames </p>
<p>(.csv, .parquet, .xls, .pkl, etc.).
For more details check https://pandas.pydata.org/docs/reference/io.html</p>
<p>:param file_path: Relative or absolute path to data file. </p>
<p>:param columns: Which columns to read (All by default). </p>
<p><em>args, </em>*kwargs will be passed to Pandas loading function.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/numerframe.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">create_numerframe</span><span class="p">(</span><span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">columns</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NumerFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convenient function to initialize NumerFrame.</span>
<span class="sd">    Support most used file formats for Pandas DataFrames \n</span>
<span class="sd">    (.csv, .parquet, .xls, .pkl, etc.).</span>
<span class="sd">    For more details check https://pandas.pydata.org/docs/reference/io.html</span>

<span class="sd">    :param file_path: Relative or absolute path to data file. \n</span>
<span class="sd">    :param columns: Which columns to read (All by default). \n</span>
<span class="sd">    *args, **kwargs will be passed to Pandas loading function.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">Path</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span><span class="o">.</span><span class="n">is_file</span><span class="p">(),</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2"> does not point to file.&quot;</span>
    <span class="n">suffix</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span><span class="o">.</span><span class="n">suffix</span>
    <span class="k">if</span> <span class="n">suffix</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;.csv&quot;</span><span class="p">]:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="n">columns</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">suffix</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;.parquet&quot;</span><span class="p">]:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">suffix</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;.xls&quot;</span><span class="p">,</span> <span class="s2">&quot;.xlsx&quot;</span><span class="p">,</span> <span class="s2">&quot;.xlsm&quot;</span><span class="p">,</span> <span class="s2">&quot;xlsb&quot;</span><span class="p">,</span> <span class="s2">&quot;.odf&quot;</span><span class="p">,</span> <span class="s2">&quot;.ods&quot;</span><span class="p">,</span> <span class="s2">&quot;.odt&quot;</span><span class="p">]:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="n">columns</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">suffix</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;.pkl&#39;</span><span class="p">,</span> <span class="s1">&#39;.pickle&#39;</span><span class="p">]:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_pickle</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">columns</span><span class="p">]</span> <span class="k">if</span> <span class="n">columns</span> <span class="k">else</span> <span class="n">df</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Suffix &#39;</span><span class="si">{</span><span class="n">suffix</span><span class="si">}</span><span class="s2">&#39; is not supported.&quot;</span><span class="p">)</span>
    <span class="n">num_frame</span> <span class="o">=</span> <span class="n">NumerFrame</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">num_frame</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div><hr />


<div class="doc doc-object doc-module">



<a id="numerblox.preprocessing.base"></a>
  <div class="doc doc-contents first">

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="numerblox.preprocessing.base.BasePreProcessor" class="doc doc-heading">
          <code>BasePreProcessor</code>


</h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><span title="sklearn.base.BaseEstimator">BaseEstimator</span></code>, <code><span title="sklearn.base.TransformerMixin">TransformerMixin</span></code></p>

  
      <p>Common functionality for preprocessors and postprocessors.</p>

            <details class="quote">
              <summary>Source code in <code>numerblox/preprocessing/base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">BasePreProcessor</span><span class="p">(</span><span class="n">BaseEstimator</span><span class="p">,</span> <span class="n">TransformerMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Common functionality for preprocessors and postprocessors.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="o">...</span>

    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="o">...</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">get_feature_names_out</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_features</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="o">...</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">











  </div>

  </div>


</div>




  </div>

  </div>

</div>

<div class="doc doc-object doc-module">



<a id="numerblox.preprocessing.classic"></a>
  <div class="doc doc-contents first">

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="numerblox.preprocessing.classic.GroupStatsPreProcessor" class="doc doc-heading">
          <code>GroupStatsPreProcessor</code>


</h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="numerblox.preprocessing.base.BasePreProcessor" href="#numerblox.preprocessing.base.BasePreProcessor">BasePreProcessor</a></code></p>

  
      <p>WARNING: Only supported for v4.2 (Rain) data. The Rain dataset (re)introduced feature groups. </p>
<p>Note that this class only works with <code>pd.DataFrame</code> input.
We using in a Pipeline, make sure that the Pandas output API is set (<code>.set_output(transform="pandas")</code>.</p>
<p>Calculates group statistics for all data groups. </p>
<p>:param groups: Groups to create features for. All groups by default.</p>

            <details class="quote">
              <summary>Source code in <code>numerblox/preprocessing/classic.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">GroupStatsPreProcessor</span><span class="p">(</span><span class="n">BasePreProcessor</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    WARNING: Only supported for v4.2 (Rain) data. The Rain dataset (re)introduced feature groups. \n</span>
<span class="sd">    Note that this class only works with `pd.DataFrame` input.</span>
<span class="sd">    We using in a Pipeline, make sure that the Pandas output API is set (`.set_output(transform=&quot;pandas&quot;)`.</span>

<span class="sd">    Calculates group statistics for all data groups. \n</span>
<span class="sd">    :param groups: Groups to create features for. All groups by default. \n</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">groups</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">all_groups</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s1">&#39;intelligence&#39;</span><span class="p">,</span> 
            <span class="s1">&#39;charisma&#39;</span><span class="p">,</span> 
            <span class="s1">&#39;strength&#39;</span><span class="p">,</span> 
            <span class="s1">&#39;dexterity&#39;</span><span class="p">,</span> 
            <span class="s1">&#39;constitution&#39;</span><span class="p">,</span> 
            <span class="s1">&#39;wisdom&#39;</span><span class="p">,</span> 
            <span class="s1">&#39;agility&#39;</span><span class="p">,</span> 
            <span class="s1">&#39;serenity&#39;</span><span class="p">,</span> 
            <span class="s1">&#39;sunshine&#39;</span><span class="p">,</span> 
            <span class="s1">&#39;rain&#39;</span>
        <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">groups</span> <span class="o">=</span> <span class="n">groups</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">group_names</span> <span class="o">=</span> <span class="n">groups</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">groups</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_groups</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feature_group_mapping</span> <span class="o">=</span> <span class="n">V4_2_FEATURE_GROUP_MAPPING</span>

    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check validity and add group features.&quot;&quot;&quot;</span>
        <span class="n">dataf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_group_features</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">dataf</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_add_group_features</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Mean, standard deviation and skew for each group.&quot;&quot;&quot;</span>
        <span class="n">dataf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_names</span><span class="p">:</span>
            <span class="n">cols</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_group_mapping</span><span class="p">[</span><span class="n">group</span><span class="p">]</span>
            <span class="n">valid_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">cols</span> <span class="k">if</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">valid_cols</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;None of the columns of &#39;</span><span class="si">{</span><span class="n">group</span><span class="si">}</span><span class="s2">&#39; are in the input data. Output will be nans for the group features.&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">cols</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">valid_cols</span><span class="p">):</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Not all columns of &#39;</span><span class="si">{</span><span class="n">group</span><span class="si">}</span><span class="s2">&#39; are in the input data (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">valid_cols</span><span class="p">)</span><span class="si">}</span><span class="s2"> &lt; </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">cols</span><span class="p">)</span><span class="si">}</span><span class="s2">). Use remaining columns for stats features.&quot;</span><span class="p">)</span>
            <span class="n">dataf</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="sa">f</span><span class="s2">&quot;feature_</span><span class="si">{</span><span class="n">group</span><span class="si">}</span><span class="s2">_mean&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">valid_cols</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">dataf</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="sa">f</span><span class="s2">&quot;feature_</span><span class="si">{</span><span class="n">group</span><span class="si">}</span><span class="s2">_std&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">valid_cols</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">dataf</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="sa">f</span><span class="s2">&quot;feature_</span><span class="si">{</span><span class="n">group</span><span class="si">}</span><span class="s2">_skew&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">valid_cols</span><span class="p">]</span><span class="o">.</span><span class="n">skew</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">dataf</span>

    <span class="k">def</span> <span class="nf">get_feature_names_out</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_features</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return feature names.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">input_features</span><span class="p">:</span>
            <span class="n">feature_names</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_names</span><span class="p">:</span>
                <span class="n">feature_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;feature_</span><span class="si">{</span><span class="n">group</span><span class="si">}</span><span class="s2">_mean&quot;</span><span class="p">)</span>
                <span class="n">feature_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;feature_</span><span class="si">{</span><span class="n">group</span><span class="si">}</span><span class="s2">_std&quot;</span><span class="p">)</span>
                <span class="n">feature_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;feature_</span><span class="si">{</span><span class="n">group</span><span class="si">}</span><span class="s2">_skew&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">feature_names</span> <span class="o">=</span> <span class="n">input_features</span>
        <span class="k">return</span> <span class="n">feature_names</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">



<h3 id="numerblox.preprocessing.classic.GroupStatsPreProcessor.get_feature_names_out" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_feature_names_out</span><span class="p">(</span><span class="n">input_features</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Return feature names.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/preprocessing/classic.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_feature_names_out</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_features</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return feature names.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">input_features</span><span class="p">:</span>
        <span class="n">feature_names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_names</span><span class="p">:</span>
            <span class="n">feature_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;feature_</span><span class="si">{</span><span class="n">group</span><span class="si">}</span><span class="s2">_mean&quot;</span><span class="p">)</span>
            <span class="n">feature_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;feature_</span><span class="si">{</span><span class="n">group</span><span class="si">}</span><span class="s2">_std&quot;</span><span class="p">)</span>
            <span class="n">feature_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;feature_</span><span class="si">{</span><span class="n">group</span><span class="si">}</span><span class="s2">_skew&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">feature_names</span> <span class="o">=</span> <span class="n">input_features</span>
    <span class="k">return</span> <span class="n">feature_names</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="numerblox.preprocessing.classic.GroupStatsPreProcessor.transform" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Check validity and add group features.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/preprocessing/classic.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check validity and add group features.&quot;&quot;&quot;</span>
    <span class="n">dataf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_group_features</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">dataf</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>


</div>




  </div>

  </div>

</div>

<div class="doc doc-object doc-module">



<a id="numerblox.preprocessing.signals"></a>
  <div class="doc doc-contents first">

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="numerblox.preprocessing.signals.DifferencePreProcessor" class="doc doc-heading">
          <code>DifferencePreProcessor</code>


</h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="numerblox.preprocessing.base.BasePreProcessor" href="#numerblox.preprocessing.base.BasePreProcessor">BasePreProcessor</a></code></p>

  
      <p>Add difference features based on given windows. Run LagPreProcessor first.
Usage in Pipeline works only with Pandas API. 
Run <code>.set_output("pandas")</code> on your pipeline first.</p>
<p>:param windows: All lag windows to process for all features. </p>
<p>:param feature_names: All features for which you want to create differences. All features that also have lags by default. </p>
<p>:param pct_change: Method to calculate differences. If True, will calculate differences with a percentage change. Otherwise calculates a simple difference. Defaults to False </p>
<p>:param abs_diff: Whether to also calculate the absolute value of all differences. Defaults to True</p>

            <details class="quote">
              <summary>Source code in <code>numerblox/preprocessing/signals.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">DifferencePreProcessor</span><span class="p">(</span><span class="n">BasePreProcessor</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add difference features based on given windows. Run LagPreProcessor first.</span>
<span class="sd">    Usage in Pipeline works only with Pandas API. </span>
<span class="sd">    Run `.set_output(&quot;pandas&quot;)` on your pipeline first.</span>

<span class="sd">    :param windows: All lag windows to process for all features. \n</span>
<span class="sd">    :param feature_names: All features for which you want to create differences. All features that also have lags by default. \n</span>
<span class="sd">    :param pct_change: Method to calculate differences. If True, will calculate differences with a percentage change. Otherwise calculates a simple difference. Defaults to False \n</span>
<span class="sd">    :param abs_diff: Whether to also calculate the absolute value of all differences. Defaults to True \n</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">windows</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">pct_diff</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">abs_diff</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">windows</span> <span class="o">=</span> <span class="n">windows</span> <span class="k">if</span> <span class="n">windows</span> <span class="k">else</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">20</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pct_diff</span> <span class="o">=</span> <span class="n">pct_diff</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">abs_diff</span> <span class="o">=</span> <span class="n">abs_diff</span>

    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create difference feature from lag features.</span>
<span class="sd">        :param X: DataFrame with lag features.</span>
<span class="sd">        NOTE: Make sure only lag features are present in the DataFrame.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">feature_names</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">feature_names</span><span class="p">:</span>
            <span class="k">assert</span> <span class="s2">&quot;_lag&quot;</span> <span class="ow">in</span> <span class="n">col</span><span class="p">,</span> <span class="s2">&quot;DifferencePreProcessor expects only lag features. Got feature: &#39;</span><span class="si">{col}</span><span class="s2">&#39;&quot;</span>
        <span class="n">output_features</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">feature_names</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Difference feature generation&quot;</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">day</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">windows</span><span class="p">:</span>
                <span class="n">differenced_values</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span> <span class="o">/</span> <span class="n">X</span><span class="p">[</span><span class="n">feature</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pct_diff</span>
                        <span class="k">else</span> <span class="n">X</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span> <span class="o">-</span> <span class="n">X</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span>
                    <span class="p">)</span>
                <span class="n">X</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">feature</span><span class="si">}</span><span class="s2">_diff</span><span class="si">{</span><span class="n">day</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">differenced_values</span>
                <span class="n">output_features</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">feature</span><span class="si">}</span><span class="s2">_diff</span><span class="si">{</span><span class="n">day</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">abs_diff</span><span class="p">:</span>
                    <span class="n">X</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">feature</span><span class="si">}</span><span class="s2">_absdiff</span><span class="si">{</span><span class="n">day</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span>
                            <span class="n">X</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">feature</span><span class="si">}</span><span class="s2">_diff</span><span class="si">{</span><span class="n">day</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
                        <span class="p">)</span>
                    <span class="n">output_features</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">feature</span><span class="si">}</span><span class="s2">_absdiff</span><span class="si">{</span><span class="n">day</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_features</span> <span class="o">=</span> <span class="n">output_features</span>
        <span class="k">return</span> <span class="n">X</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">output_features</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">get_feature_names_out</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_features</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_features</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">input_features</span> <span class="k">else</span> <span class="n">input_features</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">



<h3 id="numerblox.preprocessing.signals.DifferencePreProcessor.transform" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Create difference feature from lag features.
:param X: DataFrame with lag features.
NOTE: Make sure only lag features are present in the DataFrame.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/preprocessing/signals.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create difference feature from lag features.</span>
<span class="sd">    :param X: DataFrame with lag features.</span>
<span class="sd">    NOTE: Make sure only lag features are present in the DataFrame.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">feature_names</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">feature_names</span><span class="p">:</span>
        <span class="k">assert</span> <span class="s2">&quot;_lag&quot;</span> <span class="ow">in</span> <span class="n">col</span><span class="p">,</span> <span class="s2">&quot;DifferencePreProcessor expects only lag features. Got feature: &#39;</span><span class="si">{col}</span><span class="s2">&#39;&quot;</span>
    <span class="n">output_features</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">feature_names</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Difference feature generation&quot;</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">day</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">windows</span><span class="p">:</span>
            <span class="n">differenced_values</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span> <span class="o">/</span> <span class="n">X</span><span class="p">[</span><span class="n">feature</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pct_diff</span>
                    <span class="k">else</span> <span class="n">X</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span> <span class="o">-</span> <span class="n">X</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span>
                <span class="p">)</span>
            <span class="n">X</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">feature</span><span class="si">}</span><span class="s2">_diff</span><span class="si">{</span><span class="n">day</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">differenced_values</span>
            <span class="n">output_features</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">feature</span><span class="si">}</span><span class="s2">_diff</span><span class="si">{</span><span class="n">day</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">abs_diff</span><span class="p">:</span>
                <span class="n">X</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">feature</span><span class="si">}</span><span class="s2">_absdiff</span><span class="si">{</span><span class="n">day</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span>
                        <span class="n">X</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">feature</span><span class="si">}</span><span class="s2">_diff</span><span class="si">{</span><span class="n">day</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
                    <span class="p">)</span>
                <span class="n">output_features</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">feature</span><span class="si">}</span><span class="s2">_absdiff</span><span class="si">{</span><span class="n">day</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">output_features</span> <span class="o">=</span> <span class="n">output_features</span>
    <span class="k">return</span> <span class="n">X</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">output_features</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>


</div>

<div class="doc doc-object doc-class">



<h2 id="numerblox.preprocessing.signals.EraQuantileProcessor" class="doc doc-heading">
          <code>EraQuantileProcessor</code>


</h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="numerblox.preprocessing.base.BasePreProcessor" href="#numerblox.preprocessing.base.BasePreProcessor">BasePreProcessor</a></code></p>

  
      <p>Transform features into quantiles by era.
:param num_quantiles: Number of quantiles to use for quantile transformation. 
:param random_state: Random state for QuantileTransformer. 
:param cpu_cores: Number of CPU cores to use for parallel processing.</p>

            <details class="quote">
              <summary>Source code in <code>numerblox/preprocessing/signals.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">EraQuantileProcessor</span><span class="p">(</span><span class="n">BasePreProcessor</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Transform features into quantiles by era.</span>
<span class="sd">    :param num_quantiles: Number of quantiles to use for quantile transformation. </span>
<span class="sd">    :param random_state: Random state for QuantileTransformer. </span>
<span class="sd">    :param cpu_cores: Number of CPU cores to use for parallel processing.  </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">num_quantiles</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
        <span class="n">random_state</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">cpu_cores</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_quantiles</span> <span class="o">=</span> <span class="n">num_quantiles</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">random_state</span> <span class="o">=</span> <span class="n">random_state</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cpu_cores</span> <span class="o">=</span> <span class="n">cpu_cores</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">quantiler</span> <span class="o">=</span> <span class="n">QuantileTransformer</span><span class="p">(</span>
            <span class="n">n_quantiles</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">num_quantiles</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">random_state</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_quantile_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group_data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Process single feature for a single era.</span>
<span class="sd">        :param group_data: Data for a single feature and era.</span>
<span class="sd">        :return: Quantile transformed data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">transformed_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">quantiler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">group_data</span><span class="o">.</span><span class="n">to_frame</span><span class="p">())</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">transformed_data</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">group_data</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">eras</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">],</span>
        <span class="n">eras</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        Quantile all features by era.</span>
<span class="sd">        :param X: Array or DataFrame containing features to be quantiled.</span>
<span class="sd">        :param eras: Series containing era information.</span>
<span class="sd">        :return: Quantiled features.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">eras</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;Input X and eras must have the same number of rows for quantiling.&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">features</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
        <span class="n">X</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;era&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">eras</span>
        <span class="n">date_groups</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;era&#39;</span><span class="p">,</span> <span class="n">group_keys</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">process_feature</span><span class="p">(</span><span class="n">feature</span><span class="p">):</span>
            <span class="n">group_data</span> <span class="o">=</span> <span class="n">date_groups</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_quantile_transform</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">group_data</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">feature</span><span class="si">}</span><span class="s2">_quantile</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">num_quantiles</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">output_series_list</span> <span class="o">=</span> <span class="n">Parallel</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cpu_cores</span><span class="p">)(</span>
            <span class="n">delayed</span><span class="p">(</span><span class="n">process_feature</span><span class="p">)(</span><span class="n">feature</span><span class="p">)</span> <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Quantiling </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">)</span><span class="si">}</span><span class="s2"> features&quot;</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">output_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">output_series_list</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">output_df</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">fit_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">],</span> <span class="n">eras</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">,</span> <span class="n">eras</span><span class="o">=</span><span class="n">eras</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">,</span> <span class="n">eras</span><span class="o">=</span><span class="n">eras</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_feature_names_out</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_features</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return feature names.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">input_features</span><span class="p">:</span>
            <span class="n">feature_names</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">:</span>
                <span class="n">feature_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">feature</span><span class="si">}</span><span class="s2">_quantile</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">num_quantiles</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">feature_names</span> <span class="o">=</span> <span class="n">input_features</span>
        <span class="k">return</span> <span class="n">feature_names</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">



<h3 id="numerblox.preprocessing.signals.EraQuantileProcessor.get_feature_names_out" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_feature_names_out</span><span class="p">(</span><span class="n">input_features</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Return feature names.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/preprocessing/signals.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_feature_names_out</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_features</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return feature names.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">input_features</span><span class="p">:</span>
        <span class="n">feature_names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">:</span>
            <span class="n">feature_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">feature</span><span class="si">}</span><span class="s2">_quantile</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">num_quantiles</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">feature_names</span> <span class="o">=</span> <span class="n">input_features</span>
    <span class="k">return</span> <span class="n">feature_names</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="numerblox.preprocessing.signals.EraQuantileProcessor.transform" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">eras</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Quantile all features by era.
:param X: Array or DataFrame containing features to be quantiled.
:param eras: Series containing era information.
:return: Quantiled features.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/preprocessing/signals.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">transform</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">],</span>
    <span class="n">eras</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">    Quantile all features by era.</span>
<span class="sd">    :param X: Array or DataFrame containing features to be quantiled.</span>
<span class="sd">    :param eras: Series containing era information.</span>
<span class="sd">    :return: Quantiled features.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">eras</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;Input X and eras must have the same number of rows for quantiling.&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">features</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
    <span class="n">X</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;era&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">eras</span>
    <span class="n">date_groups</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;era&#39;</span><span class="p">,</span> <span class="n">group_keys</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">process_feature</span><span class="p">(</span><span class="n">feature</span><span class="p">):</span>
        <span class="n">group_data</span> <span class="o">=</span> <span class="n">date_groups</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_quantile_transform</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">group_data</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">feature</span><span class="si">}</span><span class="s2">_quantile</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">num_quantiles</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">output_series_list</span> <span class="o">=</span> <span class="n">Parallel</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cpu_cores</span><span class="p">)(</span>
        <span class="n">delayed</span><span class="p">(</span><span class="n">process_feature</span><span class="p">)(</span><span class="n">feature</span><span class="p">)</span> <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Quantiling </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">)</span><span class="si">}</span><span class="s2"> features&quot;</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">output_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">output_series_list</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">output_df</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>


</div>

<div class="doc doc-object doc-class">



<h2 id="numerblox.preprocessing.signals.HLOCVAdjuster" class="doc doc-heading">
          <code>HLOCVAdjuster</code>


</h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="numerblox.preprocessing.base.BasePreProcessor" href="#numerblox.preprocessing.base.BasePreProcessor">BasePreProcessor</a></code></p>

  
      <p>Adjust HLOCV data for splits and dividends based on ratio of unadjusted and adjusted close prices.
NOTE: This step only works with DataFrame input. 
Usage in intermediate steps of a scikit-learn Pipeline works with the Pandas set_output API.
i.e. pipeline.set_output(transform="pandas").</p>

            <details class="quote">
              <summary>Source code in <code>numerblox/preprocessing/signals.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">HLOCVAdjuster</span><span class="p">(</span><span class="n">BasePreProcessor</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">    Adjust HLOCV data for splits and dividends based on ratio of unadjusted and adjusted close prices.</span>
<span class="sd">    NOTE: This step only works with DataFrame input. </span>
<span class="sd">    Usage in intermediate steps of a scikit-learn Pipeline works with the Pandas set_output API.</span>
<span class="sd">    i.e. pipeline.set_output(transform=&quot;pandas&quot;).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">open_col</span><span class="o">=</span><span class="s2">&quot;open&quot;</span><span class="p">,</span> <span class="n">high_col</span><span class="o">=</span><span class="s2">&quot;high&quot;</span><span class="p">,</span> <span class="n">low_col</span><span class="o">=</span><span class="s2">&quot;low&quot;</span><span class="p">,</span> 
                 <span class="n">close_col</span><span class="o">=</span><span class="s2">&quot;close&quot;</span><span class="p">,</span> <span class="n">volume_col</span><span class="o">=</span><span class="s2">&quot;volume&quot;</span><span class="p">,</span> <span class="n">adj_close_col</span><span class="o">=</span><span class="s2">&quot;adjusted_close&quot;</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">open_col</span> <span class="o">=</span> <span class="n">open_col</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">high_col</span> <span class="o">=</span> <span class="n">high_col</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">low_col</span> <span class="o">=</span> <span class="n">low_col</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">close_col</span> <span class="o">=</span> <span class="n">close_col</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">volume_col</span> <span class="o">=</span> <span class="n">volume_col</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">adj_close_col</span> <span class="o">=</span> <span class="n">adj_close_col</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">adjusted_col_names</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;adjusted_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">high_col</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;adjusted_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">low_col</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                                   <span class="sa">f</span><span class="s2">&quot;adjusted_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">open_col</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">adj_close_col</span><span class="p">,</span> 
                                   <span class="sa">f</span><span class="s2">&quot;adjusted_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">volume_col</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ratio_</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">close_col</span><span class="p">]</span> <span class="o">/</span> <span class="n">X</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">adj_close_col</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adjust open, high, low, close and volume for splits and dividends.</span>
<span class="sd">        :param X: DataFrame with columns: [high, low, open, close, volume] (HLOCV)</span>
<span class="sd">        :return: Array with adjusted HLOCV columns</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">X_copy</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>  
        <span class="n">X_copy</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;adjusted_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">high_col</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">high_col</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">ratio_</span>
        <span class="n">X_copy</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;adjusted_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">low_col</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">low_col</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">ratio_</span>
        <span class="n">X_copy</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;adjusted_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">open_col</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">open_col</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">ratio_</span>
        <span class="n">X_copy</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;adjusted_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">volume_col</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">volume_col</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">ratio_</span>
        <span class="k">return</span> <span class="n">X_copy</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">adjusted_col_names</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">get_feature_names_out</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_features</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">adjusted_col_names</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">



<h3 id="numerblox.preprocessing.signals.HLOCVAdjuster.transform" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Adjust open, high, low, close and volume for splits and dividends.
:param X: DataFrame with columns: [high, low, open, close, volume] (HLOCV)
:return: Array with adjusted HLOCV columns</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/preprocessing/signals.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Adjust open, high, low, close and volume for splits and dividends.</span>
<span class="sd">    :param X: DataFrame with columns: [high, low, open, close, volume] (HLOCV)</span>
<span class="sd">    :return: Array with adjusted HLOCV columns</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">X_copy</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>  
    <span class="n">X_copy</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;adjusted_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">high_col</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">high_col</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">ratio_</span>
    <span class="n">X_copy</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;adjusted_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">low_col</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">low_col</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">ratio_</span>
    <span class="n">X_copy</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;adjusted_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">open_col</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">open_col</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">ratio_</span>
    <span class="n">X_copy</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;adjusted_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">volume_col</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">volume_col</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">ratio_</span>
    <span class="k">return</span> <span class="n">X_copy</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">adjusted_col_names</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>


</div>

<div class="doc doc-object doc-class">



<h2 id="numerblox.preprocessing.signals.KatsuFeatureGenerator" class="doc doc-heading">
          <code>KatsuFeatureGenerator</code>


</h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="numerblox.preprocessing.base.BasePreProcessor" href="#numerblox.preprocessing.base.BasePreProcessor">BasePreProcessor</a></code></p>

  
      <p>Effective feature engineering setup based on Katsu's starter notebook.
Based on source by Katsu1110: https://www.kaggle.com/code1110/numeraisignals-starter-for-beginners</p>
<p>:param windows: Time interval to apply for window features: </p>
<ol>
<li>
<p>Percentage Rate of change </p>
</li>
<li>
<p>Volatility </p>
</li>
<li>
<p>Moving Average gap </p>
</li>
</ol>
<p>:param ticker_col: Columns with tickers to iterate over. </p>
<p>:param close_col: Column name where you have closing price stored.
:param num_cores: Number of cores to use for multiprocessing. </p>
<p>:param verbose: Print additional information.</p>

            <details class="quote">
              <summary>Source code in <code>numerblox/preprocessing/signals.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">KatsuFeatureGenerator</span><span class="p">(</span><span class="n">BasePreProcessor</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Effective feature engineering setup based on Katsu&#39;s starter notebook.</span>
<span class="sd">    Based on source by Katsu1110: https://www.kaggle.com/code1110/numeraisignals-starter-for-beginners</span>

<span class="sd">    :param windows: Time interval to apply for window features: \n</span>
<span class="sd">    1. Percentage Rate of change \n</span>
<span class="sd">    2. Volatility \n</span>
<span class="sd">    3. Moving Average gap \n</span>
<span class="sd">    :param ticker_col: Columns with tickers to iterate over. \n</span>
<span class="sd">    :param close_col: Column name where you have closing price stored.</span>
<span class="sd">    :param num_cores: Number of cores to use for multiprocessing. \n</span>
<span class="sd">    :param verbose: Print additional information.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">windows</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
        <span class="n">ticker_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;ticker&quot;</span><span class="p">,</span>
        <span class="n">close_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;close&quot;</span><span class="p">,</span>
        <span class="n">num_cores</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">windows</span> <span class="o">=</span> <span class="n">windows</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ticker_col</span> <span class="o">=</span> <span class="n">ticker_col</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">close_col</span> <span class="o">=</span> <span class="n">close_col</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_cores</span> <span class="o">=</span> <span class="n">num_cores</span> <span class="k">if</span> <span class="n">num_cores</span> <span class="k">else</span> <span class="n">os</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>

    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Multiprocessing feature engineering.</span>

<span class="sd">        :param dataf: DataFrame with columns: [ticker, date, open, high, low, close, volume] \n</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tickers</span> <span class="o">=</span> <span class="n">dataf</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ticker_col</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Feature engineering for </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">tickers</span><span class="p">)</span><span class="si">}</span><span class="s2"> tickers using </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">num_cores</span><span class="si">}</span><span class="s2"> CPU cores.&quot;</span>
            <span class="p">)</span>
        <span class="n">dataf_list</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">x</span>
            <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span>
                <span class="n">dataf</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ticker_col</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Generating ticker DataFrames&quot;</span>
            <span class="p">)</span>
        <span class="p">]</span>
        <span class="n">dataf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_features</span><span class="p">(</span><span class="n">dataf_list</span><span class="o">=</span><span class="n">dataf_list</span><span class="p">)</span>
        <span class="n">output_cols</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_feature_names_out</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">dataf</span><span class="p">[</span><span class="n">output_cols</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">feature_engineering</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Feature engineering for single ticker.&quot;&quot;&quot;</span>
        <span class="n">close_series</span> <span class="o">=</span> <span class="n">dataf</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">close_col</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">windows</span><span class="p">:</span>
            <span class="n">dataf</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                <span class="p">:,</span> <span class="sa">f</span><span class="s2">&quot;feature_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">close_col</span><span class="si">}</span><span class="s2">_ROCP_</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">]</span> <span class="o">=</span> <span class="n">close_series</span><span class="o">.</span><span class="n">pct_change</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

            <span class="n">dataf</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="sa">f</span><span class="s2">&quot;feature_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">close_col</span><span class="si">}</span><span class="s2">_VOL_</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="n">close_series</span><span class="p">)</span><span class="o">.</span><span class="n">pct_change</span><span class="p">()</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
            <span class="p">)</span>

            <span class="n">dataf</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="sa">f</span><span class="s2">&quot;feature_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">close_col</span><span class="si">}</span><span class="s2">_MA_gap_</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">close_series</span> <span class="o">/</span> <span class="n">close_series</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
            <span class="p">)</span>

        <span class="n">dataf</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;feature_RSI&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rsi</span><span class="p">(</span><span class="n">close_series</span><span class="p">)</span>
        <span class="n">macd</span><span class="p">,</span> <span class="n">macd_signal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_macd</span><span class="p">(</span><span class="n">close_series</span><span class="p">)</span>
        <span class="n">dataf</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;feature_MACD&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">macd</span>
        <span class="n">dataf</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;feature_MACD_signal&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">macd_signal</span>
        <span class="k">return</span> <span class="n">dataf</span>

    <span class="k">def</span> <span class="nf">_generate_features</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataf_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add features for list of ticker DataFrames and concatenate.&quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">Pool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_cores</span><span class="p">)</span> <span class="k">as</span> <span class="n">p</span><span class="p">:</span>
            <span class="n">feature_datafs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                <span class="n">tqdm</span><span class="p">(</span>
                    <span class="n">p</span><span class="o">.</span><span class="n">imap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">feature_engineering</span><span class="p">,</span> <span class="n">dataf_list</span><span class="p">),</span>
                    <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Generating features&quot;</span><span class="p">,</span>
                    <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">dataf_list</span><span class="p">),</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">feature_datafs</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_rsi</span><span class="p">(</span><span class="n">close</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">period</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">14</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        See source https://github.com/peerchemist/finta</span>
<span class="sd">        and fix https://www.tradingview.com/wiki/Talk:Relative_Strength_Index_(RSI)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">delta</span> <span class="o">=</span> <span class="n">close</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span>
        <span class="n">up</span><span class="p">,</span> <span class="n">down</span> <span class="o">=</span> <span class="n">delta</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">delta</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">up</span><span class="p">[</span><span class="n">up</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">down</span><span class="p">[</span><span class="n">down</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">gain</span> <span class="o">=</span> <span class="n">up</span><span class="o">.</span><span class="n">ewm</span><span class="p">(</span><span class="n">com</span><span class="o">=</span><span class="p">(</span><span class="n">period</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="n">min_periods</span><span class="o">=</span><span class="n">period</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="n">loss</span> <span class="o">=</span> <span class="n">down</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span><span class="o">.</span><span class="n">ewm</span><span class="p">(</span><span class="n">com</span><span class="o">=</span><span class="p">(</span><span class="n">period</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="n">min_periods</span><span class="o">=</span><span class="n">period</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

        <span class="n">rs</span> <span class="o">=</span> <span class="n">gain</span> <span class="o">/</span> <span class="n">loss</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="mi">100</span> <span class="o">-</span> <span class="p">(</span><span class="mi">100</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">rs</span><span class="p">)))</span>

    <span class="k">def</span> <span class="nf">_macd</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">close</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">span1</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">span2</span><span class="o">=</span><span class="mi">26</span><span class="p">,</span> <span class="n">span3</span><span class="o">=</span><span class="mi">9</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Compute MACD and MACD signal.&quot;&quot;&quot;</span>
        <span class="n">exp1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ema1</span><span class="p">(</span><span class="n">close</span><span class="p">,</span> <span class="n">span1</span><span class="p">)</span>
        <span class="n">exp2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ema1</span><span class="p">(</span><span class="n">close</span><span class="p">,</span> <span class="n">span2</span><span class="p">)</span>
        <span class="n">macd</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">*</span> <span class="p">(</span><span class="n">exp1</span> <span class="o">-</span> <span class="n">exp2</span><span class="p">)</span> <span class="o">/</span> <span class="n">exp2</span>
        <span class="n">signal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ema1</span><span class="p">(</span><span class="n">macd</span><span class="p">,</span> <span class="n">span3</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">macd</span><span class="p">,</span> <span class="n">signal</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">__ema1</span><span class="p">(</span><span class="n">series</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">span</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Exponential moving average&quot;&quot;&quot;</span>
        <span class="n">a</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="n">span</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">series</span><span class="o">.</span><span class="n">ewm</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="n">a</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">get_feature_names_out</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_features</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return feature names.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">input_features</span><span class="p">:</span>
            <span class="n">feature_names</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">windows</span><span class="p">:</span>
                <span class="n">feature_names</span> <span class="o">+=</span> <span class="p">[</span>
                    <span class="sa">f</span><span class="s2">&quot;feature_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">close_col</span><span class="si">}</span><span class="s2">_ROCP_</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s2">&quot;feature_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">close_col</span><span class="si">}</span><span class="s2">_VOL_</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s2">&quot;feature_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">close_col</span><span class="si">}</span><span class="s2">_MA_gap_</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="p">]</span>
            <span class="n">feature_names</span> <span class="o">+=</span> <span class="p">[</span>
                <span class="s2">&quot;feature_RSI&quot;</span><span class="p">,</span>
                <span class="s2">&quot;feature_MACD&quot;</span><span class="p">,</span>
                <span class="s2">&quot;feature_MACD_signal&quot;</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">feature_names</span> <span class="o">=</span> <span class="n">input_features</span>
        <span class="k">return</span> <span class="n">feature_names</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">



<h3 id="numerblox.preprocessing.signals.KatsuFeatureGenerator.__ema1" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">__ema1</span><span class="p">(</span><span class="n">series</span><span class="p">,</span> <span class="n">span</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Exponential moving average</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/preprocessing/signals.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">__ema1</span><span class="p">(</span><span class="n">series</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">span</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Exponential moving average&quot;&quot;&quot;</span>
    <span class="n">a</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="n">span</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">series</span><span class="o">.</span><span class="n">ewm</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="n">a</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="numerblox.preprocessing.signals.KatsuFeatureGenerator.feature_engineering" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">feature_engineering</span><span class="p">(</span><span class="n">dataf</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Feature engineering for single ticker.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/preprocessing/signals.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">feature_engineering</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Feature engineering for single ticker.&quot;&quot;&quot;</span>
    <span class="n">close_series</span> <span class="o">=</span> <span class="n">dataf</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">close_col</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">windows</span><span class="p">:</span>
        <span class="n">dataf</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
            <span class="p">:,</span> <span class="sa">f</span><span class="s2">&quot;feature_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">close_col</span><span class="si">}</span><span class="s2">_ROCP_</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">]</span> <span class="o">=</span> <span class="n">close_series</span><span class="o">.</span><span class="n">pct_change</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

        <span class="n">dataf</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="sa">f</span><span class="s2">&quot;feature_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">close_col</span><span class="si">}</span><span class="s2">_VOL_</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="n">close_series</span><span class="p">)</span><span class="o">.</span><span class="n">pct_change</span><span class="p">()</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
        <span class="p">)</span>

        <span class="n">dataf</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="sa">f</span><span class="s2">&quot;feature_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">close_col</span><span class="si">}</span><span class="s2">_MA_gap_</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">close_series</span> <span class="o">/</span> <span class="n">close_series</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="p">)</span>

    <span class="n">dataf</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;feature_RSI&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rsi</span><span class="p">(</span><span class="n">close_series</span><span class="p">)</span>
    <span class="n">macd</span><span class="p">,</span> <span class="n">macd_signal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_macd</span><span class="p">(</span><span class="n">close_series</span><span class="p">)</span>
    <span class="n">dataf</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;feature_MACD&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">macd</span>
    <span class="n">dataf</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;feature_MACD_signal&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">macd_signal</span>
    <span class="k">return</span> <span class="n">dataf</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="numerblox.preprocessing.signals.KatsuFeatureGenerator.get_feature_names_out" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_feature_names_out</span><span class="p">(</span><span class="n">input_features</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Return feature names.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/preprocessing/signals.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_feature_names_out</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_features</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return feature names.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">input_features</span><span class="p">:</span>
        <span class="n">feature_names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">windows</span><span class="p">:</span>
            <span class="n">feature_names</span> <span class="o">+=</span> <span class="p">[</span>
                <span class="sa">f</span><span class="s2">&quot;feature_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">close_col</span><span class="si">}</span><span class="s2">_ROCP_</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">&quot;feature_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">close_col</span><span class="si">}</span><span class="s2">_VOL_</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">&quot;feature_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">close_col</span><span class="si">}</span><span class="s2">_MA_gap_</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="n">feature_names</span> <span class="o">+=</span> <span class="p">[</span>
            <span class="s2">&quot;feature_RSI&quot;</span><span class="p">,</span>
            <span class="s2">&quot;feature_MACD&quot;</span><span class="p">,</span>
            <span class="s2">&quot;feature_MACD_signal&quot;</span><span class="p">,</span>
        <span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">feature_names</span> <span class="o">=</span> <span class="n">input_features</span>
    <span class="k">return</span> <span class="n">feature_names</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="numerblox.preprocessing.signals.KatsuFeatureGenerator.transform" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">transform</span><span class="p">(</span><span class="n">dataf</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Multiprocessing feature engineering.</p>
<p>:param dataf: DataFrame with columns: [ticker, date, open, high, low, close, volume]</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/preprocessing/signals.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Multiprocessing feature engineering.</span>

<span class="sd">    :param dataf: DataFrame with columns: [ticker, date, open, high, low, close, volume] \n</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tickers</span> <span class="o">=</span> <span class="n">dataf</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ticker_col</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Feature engineering for </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">tickers</span><span class="p">)</span><span class="si">}</span><span class="s2"> tickers using </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">num_cores</span><span class="si">}</span><span class="s2"> CPU cores.&quot;</span>
        <span class="p">)</span>
    <span class="n">dataf_list</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">x</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span>
            <span class="n">dataf</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ticker_col</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Generating ticker DataFrames&quot;</span>
        <span class="p">)</span>
    <span class="p">]</span>
    <span class="n">dataf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_features</span><span class="p">(</span><span class="n">dataf_list</span><span class="o">=</span><span class="n">dataf_list</span><span class="p">)</span>
    <span class="n">output_cols</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_feature_names_out</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">dataf</span><span class="p">[</span><span class="n">output_cols</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>


</div>

<div class="doc doc-object doc-class">



<h2 id="numerblox.preprocessing.signals.LagPreProcessor" class="doc doc-heading">
          <code>LagPreProcessor</code>


</h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="numerblox.preprocessing.base.BasePreProcessor" href="#numerblox.preprocessing.base.BasePreProcessor">BasePreProcessor</a></code></p>

  
      <p>Add lag features based on given windows.</p>
<p>:param windows: All lag windows to process for all features. </p>
<p>[5, 10, 15, 20] by default (4 weeks lookback)</p>

            <details class="quote">
              <summary>Source code in <code>numerblox/preprocessing/signals.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">LagPreProcessor</span><span class="p">(</span><span class="n">BasePreProcessor</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add lag features based on given windows.</span>

<span class="sd">    :param windows: All lag windows to process for all features. \n</span>
<span class="sd">    [5, 10, 15, 20] by default (4 weeks lookback) \n</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">windows</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">windows</span> <span class="o">=</span> <span class="n">windows</span> <span class="k">if</span> <span class="n">windows</span> <span class="k">else</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">20</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tickers</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">],</span> <span class="n">tickers</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
        <span class="n">feature_cols</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">X</span><span class="p">[</span><span class="s2">&quot;ticker&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tickers</span>
        <span class="n">ticker_groups</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;ticker&quot;</span><span class="p">)</span>
        <span class="n">output_features</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">feature_cols</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Lag feature generation&quot;</span><span class="p">):</span>
            <span class="n">feature_group</span> <span class="o">=</span> <span class="n">ticker_groups</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">day</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">windows</span><span class="p">:</span>
                <span class="n">shifted</span> <span class="o">=</span> <span class="n">feature_group</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="n">day</span><span class="p">)</span>
                <span class="n">X</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">feature</span><span class="si">}</span><span class="s2">_lag</span><span class="si">{</span><span class="n">day</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">shifted</span>
                <span class="n">output_features</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">feature</span><span class="si">}</span><span class="s2">_lag</span><span class="si">{</span><span class="n">day</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_features</span> <span class="o">=</span> <span class="n">output_features</span>
        <span class="k">return</span> <span class="n">X</span><span class="p">[</span><span class="n">output_features</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">fit_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">],</span> <span class="n">tickers</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">,</span> <span class="n">tickers</span><span class="o">=</span><span class="n">tickers</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">,</span> <span class="n">tickers</span><span class="o">=</span><span class="n">tickers</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_feature_names_out</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_features</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return feature names.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_features</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">input_features</span> <span class="k">else</span> <span class="n">input_features</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">



<h3 id="numerblox.preprocessing.signals.LagPreProcessor.get_feature_names_out" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_feature_names_out</span><span class="p">(</span><span class="n">input_features</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Return feature names.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/preprocessing/signals.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_feature_names_out</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_features</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return feature names.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_features</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">input_features</span> <span class="k">else</span> <span class="n">input_features</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>


</div>

<div class="doc doc-object doc-class">



<h2 id="numerblox.preprocessing.signals.MinimumDataFilter" class="doc doc-heading">
          <code>MinimumDataFilter</code>


</h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="numerblox.preprocessing.base.BasePreProcessor" href="#numerblox.preprocessing.base.BasePreProcessor">BasePreProcessor</a></code></p>

  
      <p>Filter dates and tickers based on minimum data requirements. 
NOTE: This step only works with DataFrame input.</p>
<p>:param min_samples_date: Minimum number of samples per date. Defaults to 200.
:param min_samples_ticker: Minimum number of samples per ticker. Defaults to 1200.
:param blacklist_tickers: List of tickers to exclude from the dataset. Defaults to None.
:param date_col: Column name for date. Defaults to "date".
:param ticker_col: Column name for ticker. Defaults to "bloomberg_ticker".</p>

            <details class="quote">
              <summary>Source code in <code>numerblox/preprocessing/signals.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">MinimumDataFilter</span><span class="p">(</span><span class="n">BasePreProcessor</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">    Filter dates and tickers based on minimum data requirements. </span>
<span class="sd">    NOTE: This step only works with DataFrame input.</span>

<span class="sd">    :param min_samples_date: Minimum number of samples per date. Defaults to 200.</span>
<span class="sd">    :param min_samples_ticker: Minimum number of samples per ticker. Defaults to 1200.</span>
<span class="sd">    :param blacklist_tickers: List of tickers to exclude from the dataset. Defaults to None.</span>
<span class="sd">    :param date_col: Column name for date. Defaults to &quot;date&quot;.</span>
<span class="sd">    :param ticker_col: Column name for ticker. Defaults to &quot;bloomberg_ticker&quot;.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">min_samples_date</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">200</span><span class="p">,</span> <span class="n">min_samples_ticker</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1200</span><span class="p">,</span> <span class="n">blacklist_tickers</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">date_col</span><span class="o">=</span><span class="s2">&quot;date&quot;</span><span class="p">,</span> <span class="n">ticker_col</span><span class="o">=</span><span class="s2">&quot;bloomberg_ticker&quot;</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_samples_date</span> <span class="o">=</span> <span class="n">min_samples_date</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_samples_ticker</span> <span class="o">=</span> <span class="n">min_samples_ticker</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">blacklist_tickers</span> <span class="o">=</span> <span class="n">blacklist_tickers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">date_col</span> <span class="o">=</span> <span class="n">date_col</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ticker_col</span> <span class="o">=</span> <span class="n">ticker_col</span>

    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feature_names_out_</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Filter dates and tickers based on minimum data requirements.</span>
<span class="sd">        :param X: DataFrame with columns: [ticker_col, date_col, open, high, low, close, volume] (HLOCV)</span>
<span class="sd">        :return: Array with filtered DataFrame</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">filtered_data</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">date_col</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_samples_date</span><span class="p">)</span>
        <span class="n">records_per_ticker</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">filtered_data</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ticker_col</span><span class="p">)[</span><span class="bp">self</span><span class="o">.</span><span class="n">date_col</span><span class="p">]</span>
            <span class="o">.</span><span class="n">nunique</span><span class="p">()</span>
            <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
            <span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">date_col</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">tickers_with_records</span> <span class="o">=</span> <span class="n">records_per_ticker</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">date_col</span><span class="si">}</span><span class="s2"> &gt;= </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">min_samples_ticker</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)[</span><span class="bp">self</span><span class="o">.</span><span class="n">ticker_col</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="n">filtered_data</span> <span class="o">=</span> <span class="n">filtered_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">filtered_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ticker_col</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">tickers_with_records</span><span class="p">)]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">blacklist_tickers</span><span class="p">:</span>
            <span class="n">filtered_data</span> <span class="o">=</span> <span class="n">filtered_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">filtered_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ticker_col</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">blacklist_tickers</span><span class="p">)]</span>

        <span class="k">return</span> <span class="n">filtered_data</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">get_feature_names_out</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_features</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_names_out_</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">input_features</span> <span class="k">else</span> <span class="n">input_features</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">



<h3 id="numerblox.preprocessing.signals.MinimumDataFilter.transform" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Filter dates and tickers based on minimum data requirements.
:param X: DataFrame with columns: [ticker_col, date_col, open, high, low, close, volume] (HLOCV)
:return: Array with filtered DataFrame</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/preprocessing/signals.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Filter dates and tickers based on minimum data requirements.</span>
<span class="sd">    :param X: DataFrame with columns: [ticker_col, date_col, open, high, low, close, volume] (HLOCV)</span>
<span class="sd">    :return: Array with filtered DataFrame</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">filtered_data</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">date_col</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_samples_date</span><span class="p">)</span>
    <span class="n">records_per_ticker</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">filtered_data</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ticker_col</span><span class="p">)[</span><span class="bp">self</span><span class="o">.</span><span class="n">date_col</span><span class="p">]</span>
        <span class="o">.</span><span class="n">nunique</span><span class="p">()</span>
        <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        <span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">date_col</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">tickers_with_records</span> <span class="o">=</span> <span class="n">records_per_ticker</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">date_col</span><span class="si">}</span><span class="s2"> &gt;= </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">min_samples_ticker</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)[</span><span class="bp">self</span><span class="o">.</span><span class="n">ticker_col</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="n">filtered_data</span> <span class="o">=</span> <span class="n">filtered_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">filtered_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ticker_col</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">tickers_with_records</span><span class="p">)]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">blacklist_tickers</span><span class="p">:</span>
        <span class="n">filtered_data</span> <span class="o">=</span> <span class="n">filtered_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">filtered_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ticker_col</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">blacklist_tickers</span><span class="p">)]</span>

    <span class="k">return</span> <span class="n">filtered_data</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>


</div>

<div class="doc doc-object doc-class">



<h2 id="numerblox.preprocessing.signals.PandasTaFeatureGenerator" class="doc doc-heading">
          <code>PandasTaFeatureGenerator</code>


</h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="numerblox.preprocessing.base.BasePreProcessor" href="#numerblox.preprocessing.base.BasePreProcessor">BasePreProcessor</a></code></p>

  
      <p>Generate features with pandas-ta.
https://github.com/twopirllc/pandas-ta
Usage in Pipeline works only with Pandas API. 
Run <code>.set_output("pandas")</code> on your pipeline first.</p>
<p>:param strategy: Valid Pandas Ta strategy. </p>
<p>For more information on creating a strategy, see: </p>
<p>https://github.com/twopirllc/pandas-ta#pandas-ta-strategy </p>
<p>By default, a strategy with RSI(14) and RSI(60) is used. </p>
<p>:param ticker_col: Column name for grouping by tickers. </p>
<p>:param num_cores: Number of cores to use for multiprocessing. </p>
<p>By default, all available cores are used.</p>

            <details class="quote">
              <summary>Source code in <code>numerblox/preprocessing/signals.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">PandasTaFeatureGenerator</span><span class="p">(</span><span class="n">BasePreProcessor</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate features with pandas-ta.</span>
<span class="sd">    https://github.com/twopirllc/pandas-ta</span>
<span class="sd">    Usage in Pipeline works only with Pandas API. </span>
<span class="sd">    Run `.set_output(&quot;pandas&quot;)` on your pipeline first.</span>

<span class="sd">    :param strategy: Valid Pandas Ta strategy. \n</span>
<span class="sd">    For more information on creating a strategy, see: \n</span>
<span class="sd">    https://github.com/twopirllc/pandas-ta#pandas-ta-strategy \n</span>
<span class="sd">    By default, a strategy with RSI(14) and RSI(60) is used. \n</span>
<span class="sd">    :param ticker_col: Column name for grouping by tickers. \n</span>
<span class="sd">    :param num_cores: Number of cores to use for multiprocessing. \n</span>
<span class="sd">    By default, all available cores are used. \n</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
                 <span class="n">strategy</span><span class="p">:</span> <span class="n">ta</span><span class="o">.</span><span class="n">Strategy</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">ticker_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;ticker&quot;</span><span class="p">,</span>
                 <span class="n">num_cores</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ticker_col</span> <span class="o">=</span> <span class="n">ticker_col</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_cores</span> <span class="o">=</span> <span class="n">num_cores</span> <span class="k">if</span> <span class="n">num_cores</span> <span class="k">else</span> <span class="n">os</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">()</span>
        <span class="n">standard_strategy</span> <span class="o">=</span> <span class="n">ta</span><span class="o">.</span><span class="n">Strategy</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;standard&quot;</span><span class="p">,</span> 
                                        <span class="n">ta</span><span class="o">=</span><span class="p">[{</span><span class="s2">&quot;kind&quot;</span><span class="p">:</span> <span class="s2">&quot;rsi&quot;</span><span class="p">,</span> <span class="s2">&quot;length&quot;</span><span class="p">:</span> <span class="mi">14</span><span class="p">,</span> <span class="s2">&quot;col_names&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;feature_RSI_14&quot;</span><span class="p">)},</span>
                                            <span class="p">{</span><span class="s2">&quot;kind&quot;</span><span class="p">:</span> <span class="s2">&quot;rsi&quot;</span><span class="p">,</span> <span class="s2">&quot;length&quot;</span><span class="p">:</span> <span class="mi">60</span><span class="p">,</span> <span class="s2">&quot;col_names&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;feature_RSI_60&quot;</span><span class="p">)}])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">strategy</span> <span class="o">=</span> <span class="n">strategy</span> <span class="k">if</span> <span class="n">strategy</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">standard_strategy</span>

    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Main feature generation method. \n </span>
<span class="sd">        :param X: DataFrame with columns: [ticker, date, open, high, low, close, volume] \n</span>
<span class="sd">        :return: PandasTA features</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">initial_features</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">dataf_list</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">x</span>
            <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span>
                <span class="n">X</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ticker_col</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Generating ticker DataFrames&quot;</span>
            <span class="p">)</span>
        <span class="p">]</span>
        <span class="n">X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_features</span><span class="p">(</span><span class="n">dataf_list</span><span class="o">=</span><span class="n">dataf_list</span><span class="p">)</span>
        <span class="n">output_df</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">initial_features</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_cols</span> <span class="o">=</span> <span class="n">output_df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">output_df</span>

    <span class="k">def</span> <span class="nf">_generate_features</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataf_list</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add features for list of ticker DataFrames and concatenate.</span>
<span class="sd">        :param dataf_list: List of DataFrames for each ticker.</span>
<span class="sd">        :return: Concatenated DataFrame for all full list with features added.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">Pool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_cores</span><span class="p">)</span> <span class="k">as</span> <span class="n">p</span><span class="p">:</span>
            <span class="n">feature_datafs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                <span class="n">tqdm</span><span class="p">(</span>
                    <span class="n">p</span><span class="o">.</span><span class="n">imap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">add_features</span><span class="p">,</span> <span class="n">dataf_list</span><span class="p">),</span>
                    <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Generating pandas-ta features&quot;</span><span class="p">,</span>
                    <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">dataf_list</span><span class="p">),</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">feature_datafs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">add_features</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ticker_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        The TA strategy is applied to the DataFrame here.</span>
<span class="sd">        :param ticker_df: DataFrame for a single ticker.</span>
<span class="sd">        :return: DataFrame with features added.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># We use a different multiprocessing engine so shutting off pandas_ta&#39;s multiprocessing</span>
        <span class="n">ticker_df</span><span class="o">.</span><span class="n">ta</span><span class="o">.</span><span class="n">cores</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># Run strategy</span>
        <span class="n">ticker_df</span><span class="o">.</span><span class="n">ta</span><span class="o">.</span><span class="n">strategy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">strategy</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ticker_df</span>

    <span class="k">def</span> <span class="nf">get_feature_names_out</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_features</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_cols</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">input_features</span> <span class="k">else</span> <span class="n">input_features</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">



<h3 id="numerblox.preprocessing.signals.PandasTaFeatureGenerator.add_features" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">add_features</span><span class="p">(</span><span class="n">ticker_df</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>The TA strategy is applied to the DataFrame here.
:param ticker_df: DataFrame for a single ticker.
:return: DataFrame with features added.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/preprocessing/signals.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">add_features</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ticker_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">    The TA strategy is applied to the DataFrame here.</span>
<span class="sd">    :param ticker_df: DataFrame for a single ticker.</span>
<span class="sd">    :return: DataFrame with features added.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># We use a different multiprocessing engine so shutting off pandas_ta&#39;s multiprocessing</span>
    <span class="n">ticker_df</span><span class="o">.</span><span class="n">ta</span><span class="o">.</span><span class="n">cores</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1"># Run strategy</span>
    <span class="n">ticker_df</span><span class="o">.</span><span class="n">ta</span><span class="o">.</span><span class="n">strategy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">strategy</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ticker_df</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="numerblox.preprocessing.signals.PandasTaFeatureGenerator.transform" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Main feature generation method. </p>
<p>:param X: DataFrame with columns: [ticker, date, open, high, low, close, volume] </p>
<p>:return: PandasTA features</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/preprocessing/signals.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Main feature generation method. \n </span>
<span class="sd">    :param X: DataFrame with columns: [ticker, date, open, high, low, close, volume] \n</span>
<span class="sd">    :return: PandasTA features</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">initial_features</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">dataf_list</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">x</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span>
            <span class="n">X</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ticker_col</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Generating ticker DataFrames&quot;</span>
        <span class="p">)</span>
    <span class="p">]</span>
    <span class="n">X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_features</span><span class="p">(</span><span class="n">dataf_list</span><span class="o">=</span><span class="n">dataf_list</span><span class="p">)</span>
    <span class="n">output_df</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">initial_features</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">output_cols</span> <span class="o">=</span> <span class="n">output_df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">output_df</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>


</div>

<div class="doc doc-object doc-class">



<h2 id="numerblox.preprocessing.signals.ReduceMemoryProcessor" class="doc doc-heading">
          <code>ReduceMemoryProcessor</code>


</h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="numerblox.preprocessing.base.BasePreProcessor" href="#numerblox.preprocessing.base.BasePreProcessor">BasePreProcessor</a></code></p>

  
      <p>Reduce memory usage as much as possible.</p>
<p>Credits to kainsama and others for writing about memory usage reduction for Numerai data:
https://forum.numer.ai/t/reducing-memory/313</p>
<p>:param deep_mem_inspect: Introspect the data deeply by interrogating object dtypes.
Yields a more accurate representation of memory usage if you have complex object columns.
:param verbose: Print memory usage before and after optimization.</p>

            <details class="quote">
              <summary>Source code in <code>numerblox/preprocessing/signals.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">ReduceMemoryProcessor</span><span class="p">(</span><span class="n">BasePreProcessor</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reduce memory usage as much as possible.</span>

<span class="sd">    Credits to kainsama and others for writing about memory usage reduction for Numerai data:</span>
<span class="sd">    https://forum.numer.ai/t/reducing-memory/313</span>

<span class="sd">    :param deep_mem_inspect: Introspect the data deeply by interrogating object dtypes.</span>
<span class="sd">    Yields a more accurate representation of memory usage if you have complex object columns.</span>
<span class="sd">    :param verbose: Print memory usage before and after optimization.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">deep_mem_inspect</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deep_mem_inspect</span> <span class="o">=</span> <span class="n">deep_mem_inspect</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>

    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataf</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reduce_mem_usage</span><span class="p">(</span><span class="n">dataf</span><span class="p">)</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_reduce_mem_usage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataf</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Iterate through all columns and modify the numeric column types</span>
<span class="sd">        to reduce memory usage.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dataf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">dataf</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_cols</span> <span class="o">=</span> <span class="n">dataf</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">start_memory_usage</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">dataf</span><span class="o">.</span><span class="n">memory_usage</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">deep_mem_inspect</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">2</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Memory usage of DataFrame is </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">start_memory_usage</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2"> MB&quot;</span>
            <span class="p">)</span>

        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">dataf</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">col_type</span> <span class="o">=</span> <span class="n">dataf</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">name</span>

            <span class="k">if</span> <span class="n">col_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span>
                <span class="s2">&quot;object&quot;</span><span class="p">,</span>
                <span class="s2">&quot;category&quot;</span><span class="p">,</span>
                <span class="s2">&quot;datetime64[ns, UTC]&quot;</span><span class="p">,</span>
                <span class="s2">&quot;datetime64[ns]&quot;</span><span class="p">,</span>
            <span class="p">]:</span>
                <span class="n">c_min</span> <span class="o">=</span> <span class="n">dataf</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
                <span class="n">c_max</span> <span class="o">=</span> <span class="n">dataf</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
                <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">col_type</span><span class="p">)[:</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;int&quot;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">c_min</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">iinfo</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">)</span><span class="o">.</span><span class="n">min</span> <span class="ow">and</span> <span class="n">c_max</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">iinfo</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">:</span>
                        <span class="n">dataf</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">dataf</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int16</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="p">(</span>
                        <span class="n">c_min</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">iinfo</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int16</span><span class="p">)</span><span class="o">.</span><span class="n">min</span>
                        <span class="ow">and</span> <span class="n">c_max</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">iinfo</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int16</span><span class="p">)</span><span class="o">.</span><span class="n">max</span>
                    <span class="p">):</span>
                        <span class="n">dataf</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">dataf</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int16</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="p">(</span>
                        <span class="n">c_min</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">iinfo</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span><span class="o">.</span><span class="n">min</span>
                        <span class="ow">and</span> <span class="n">c_max</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">iinfo</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span><span class="o">.</span><span class="n">max</span>
                    <span class="p">):</span>
                        <span class="n">dataf</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">dataf</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="p">(</span>
                        <span class="n">c_min</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">iinfo</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span><span class="o">.</span><span class="n">min</span>
                        <span class="ow">and</span> <span class="n">c_max</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">iinfo</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span><span class="o">.</span><span class="n">max</span>
                    <span class="p">):</span>
                        <span class="n">dataf</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">dataf</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span>
                        <span class="n">c_min</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float16</span><span class="p">)</span><span class="o">.</span><span class="n">min</span>
                        <span class="ow">and</span> <span class="n">c_max</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float16</span><span class="p">)</span><span class="o">.</span><span class="n">max</span>
                    <span class="p">):</span>
                        <span class="n">dataf</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">dataf</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float16</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="p">(</span>
                        <span class="n">c_min</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span><span class="o">.</span><span class="n">min</span>
                        <span class="ow">and</span> <span class="n">c_max</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span><span class="o">.</span><span class="n">max</span>
                    <span class="p">):</span>
                        <span class="n">dataf</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">dataf</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">dataf</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">dataf</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>

        <span class="n">end_memory_usage</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">dataf</span><span class="o">.</span><span class="n">memory_usage</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">deep_mem_inspect</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">2</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Memory usage after optimization is: </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">end_memory_usage</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2"> MB&quot;</span>
            <span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Usage decreased by </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="mi">100</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">start_memory_usage</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">end_memory_usage</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">start_memory_usage</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2">%&quot;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">dataf</span>

    <span class="k">def</span> <span class="nf">get_feature_names_out</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_features</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return feature names.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_cols</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">input_features</span> <span class="k">else</span> <span class="n">input_features</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">



<h3 id="numerblox.preprocessing.signals.ReduceMemoryProcessor.get_feature_names_out" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_feature_names_out</span><span class="p">(</span><span class="n">input_features</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Return feature names.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/preprocessing/signals.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_feature_names_out</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_features</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return feature names.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_cols</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">input_features</span> <span class="k">else</span> <span class="n">input_features</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>


</div>

<div class="doc doc-object doc-class">



<h2 id="numerblox.preprocessing.signals.TickerMapper" class="doc doc-heading">
          <code>TickerMapper</code>


</h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="numerblox.preprocessing.base.BasePreProcessor" href="#numerblox.preprocessing.base.BasePreProcessor">BasePreProcessor</a></code></p>

  
      <p>Map ticker from one format to another. </p>
<p>:param ticker_col: Column used for mapping. Must already be present in the input data. </p>
<p>:param target_ticker_format: Format to map tickers to. Must be present in the ticker map. </p>
<p>For default mapper supported ticker formats are: ['ticker', 'bloomberg_ticker', 'yahoo'] </p>
<p>:param mapper_path: Path to CSV file containing at least ticker_col and target_ticker_format columns. </p>
<p>Can be either a web link of local path. Numerai Signals mapping by default.</p>

            <details class="quote">
              <summary>Source code in <code>numerblox/preprocessing/signals.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">TickerMapper</span><span class="p">(</span><span class="n">BasePreProcessor</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Map ticker from one format to another. \n</span>
<span class="sd">    :param ticker_col: Column used for mapping. Must already be present in the input data. \n</span>
<span class="sd">    :param target_ticker_format: Format to map tickers to. Must be present in the ticker map. \n</span>
<span class="sd">    For default mapper supported ticker formats are: [&#39;ticker&#39;, &#39;bloomberg_ticker&#39;, &#39;yahoo&#39;] \n</span>
<span class="sd">    :param mapper_path: Path to CSV file containing at least ticker_col and target_ticker_format columns. \n</span>
<span class="sd">    Can be either a web link of local path. Numerai Signals mapping by default.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">ticker_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;ticker&quot;</span><span class="p">,</span> <span class="n">target_ticker_format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;bloomberg_ticker&quot;</span><span class="p">,</span>
        <span class="n">mapper_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;https://numerai-signals-public-data.s3-us-west-2.amazonaws.com/signals_ticker_map_w_bbg.csv&quot;</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ticker_col</span> <span class="o">=</span> <span class="n">ticker_col</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target_ticker_format</span> <span class="o">=</span> <span class="n">target_ticker_format</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">signals_map_path</span> <span class="o">=</span> <span class="n">mapper_path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ticker_map</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">signals_map_path</span><span class="p">)</span>

        <span class="k">assert</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ticker_col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ticker_map</span><span class="o">.</span><span class="n">columns</span>
        <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Ticker column &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ticker_col</span><span class="si">}</span><span class="s2">&#39; is not available in ticker mapping.&quot;</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">target_ticker_format</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ticker_map</span><span class="o">.</span><span class="n">columns</span>
        <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Target ticker column &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">target_ticker_format</span><span class="si">}</span><span class="s2">&#39; is not available in ticker mapping.&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mapping</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ticker_map</span><span class="p">[[</span><span class="bp">self</span><span class="o">.</span><span class="n">ticker_col</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_ticker_format</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Transform ticker column.</span>
<span class="sd">        :param X: Ticker column</span>
<span class="sd">        :return tickers: Mapped tickers</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tickers</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ticker_col</span><span class="p">])[</span><span class="bp">self</span><span class="o">.</span><span class="n">ticker_col</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mapping</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">tickers</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">get_feature_names_out</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_features</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">target_ticker_format</span><span class="p">]</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">input_features</span> <span class="k">else</span> <span class="n">input_features</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">



<h3 id="numerblox.preprocessing.signals.TickerMapper.transform" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Transform ticker column.
:param X: Ticker column
:return tickers: Mapped tickers</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/preprocessing/signals.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Transform ticker column.</span>
<span class="sd">    :param X: Ticker column</span>
<span class="sd">    :return tickers: Mapped tickers</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tickers</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ticker_col</span><span class="p">])[</span><span class="bp">self</span><span class="o">.</span><span class="n">ticker_col</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mapping</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">tickers</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>


</div>




  </div>

  </div>

</div><hr />


<div class="doc doc-object doc-module">



<a id="numerblox.targets"></a>
  <div class="doc doc-contents first">

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="numerblox.targets.BaseTargetProcessor" class="doc doc-heading">
          <code>BaseTargetProcessor</code>


</h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><span title="sklearn.base.BaseEstimator">BaseEstimator</span></code>, <code><span title="sklearn.base.TransformerMixin">TransformerMixin</span></code></p>

  
      <p>Common functionality for preprocessors and postprocessors.</p>

            <details class="quote">
              <summary>Source code in <code>numerblox/targets.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">BaseTargetProcessor</span><span class="p">(</span><span class="n">BaseEstimator</span><span class="p">,</span> <span class="n">TransformerMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Common functionality for preprocessors and postprocessors.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="o">...</span>

    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="o">...</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">get_feature_names_out</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_features</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="o">...</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">











  </div>

  </div>


</div>

<div class="doc doc-object doc-class">



<h2 id="numerblox.targets.BayesianGMMTargetProcessor" class="doc doc-heading">
          <code>BayesianGMMTargetProcessor</code>


</h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="numerblox.targets.BaseTargetProcessor" href="#numerblox.targets.BaseTargetProcessor">BaseTargetProcessor</a></code></p>

  
      <p>Generate synthetic (fake) target using a Bayesian Gaussian Mixture model. </p>
<p>Based on Michael Oliver's GitHub Gist implementation: </p>
<p>https://gist.github.com/the-moliver/dcdd2862dc2c78dda600f1b449071c93</p>
<p>:param n_components: Number of components for fitting Bayesian Gaussian Mixture Model.</p>

            <details class="quote">
              <summary>Source code in <code>numerblox/targets.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">BayesianGMMTargetProcessor</span><span class="p">(</span><span class="n">BaseTargetProcessor</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate synthetic (fake) target using a Bayesian Gaussian Mixture model. \n</span>
<span class="sd">    Based on Michael Oliver&#39;s GitHub Gist implementation: \n</span>
<span class="sd">    https://gist.github.com/the-moliver/dcdd2862dc2c78dda600f1b449071c93</span>

<span class="sd">    :param n_components: Number of components for fitting Bayesian Gaussian Mixture Model.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">n_components</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_components</span> <span class="o">=</span> <span class="n">n_components</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ridge</span> <span class="o">=</span> <span class="n">Ridge</span><span class="p">(</span><span class="n">fit_intercept</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bins</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">eras</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fit Bayesian Gaussian Mixture model on coefficients and normalize.</span>
<span class="sd">        :param X: DataFrame containing features.</span>
<span class="sd">        :param y: Series containing real target.</span>
<span class="sd">        :param eras: Series containing era information.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">bgmm</span> <span class="o">=</span> <span class="n">BayesianGaussianMixture</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n_components</span><span class="p">)</span>
        <span class="n">coefs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_coefs</span><span class="p">(</span><span class="n">dataf</span><span class="o">=</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">eras</span><span class="o">=</span><span class="n">eras</span><span class="p">)</span>
        <span class="n">bgmm</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">coefs</span><span class="p">)</span>
        <span class="c1"># make probability of sampling each component equal to better balance rare regimes</span>
        <span class="n">bgmm</span><span class="o">.</span><span class="n">weights_</span><span class="p">[:]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_components</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bgmm_</span> <span class="o">=</span> <span class="n">bgmm</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">eras</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Main method for generating fake target.</span>
<span class="sd">        :param X: DataFrame containing features.</span>
<span class="sd">        :param eras: Series containing era information.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;bgmm_&quot;</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">eras</span><span class="p">),</span> <span class="s2">&quot;X and eras must be same length.&quot;</span>
        <span class="n">all_eras</span> <span class="o">=</span> <span class="n">eras</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="c1"># Scale data between 0 and 1</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">X</span> <span class="o">/=</span> <span class="n">X</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="n">X</span> <span class="o">-=</span> <span class="mf">0.5</span>
        <span class="n">X</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;era&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">eras</span>

        <span class="n">fake_target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_target</span><span class="p">(</span><span class="n">dataf</span><span class="o">=</span><span class="n">X</span><span class="p">,</span> <span class="n">all_eras</span><span class="o">=</span><span class="n">all_eras</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fake_target</span>

    <span class="k">def</span> <span class="nf">_get_coefs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">eras</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate coefficients for BGMM.</span>
<span class="sd">        :param dataf: DataFrame containing features.</span>
<span class="sd">        :param y: Series containing real target.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">coefs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">dataf</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;era&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">eras</span>
        <span class="n">dataf</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;target&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span>
        <span class="n">all_eras</span> <span class="o">=</span> <span class="n">dataf</span><span class="p">[</span><span class="s1">&#39;era&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">era</span> <span class="ow">in</span> <span class="n">all_eras</span><span class="p">:</span>
            <span class="n">era_df</span> <span class="o">=</span> <span class="n">dataf</span><span class="p">[</span><span class="n">dataf</span><span class="p">[</span><span class="s1">&#39;era&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">era</span><span class="p">]</span>
            <span class="n">era_y</span> <span class="o">=</span> <span class="n">era_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;target&#39;</span><span class="p">]</span>
            <span class="n">era_df</span> <span class="o">=</span> <span class="n">era_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;era&quot;</span><span class="p">,</span> <span class="s2">&quot;target&quot;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ridge</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">era_df</span><span class="p">,</span> <span class="n">era_y</span><span class="p">)</span>
            <span class="n">coefs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ridge</span><span class="o">.</span><span class="n">coef_</span><span class="p">)</span>
        <span class="n">stacked_coefs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span><span class="n">coefs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">stacked_coefs</span>

    <span class="k">def</span> <span class="nf">_generate_target</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">all_eras</span><span class="p">:</span> <span class="nb">list</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate fake target using Bayesian Gaussian Mixture model.&quot;&quot;&quot;</span>
        <span class="n">fake_target</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">era</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">all_eras</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Generating fake target&quot;</span><span class="p">):</span>
            <span class="n">features</span> <span class="o">=</span> <span class="n">dataf</span><span class="p">[</span><span class="n">dataf</span><span class="p">[</span><span class="s1">&#39;era&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">era</span><span class="p">]</span>
            <span class="n">features</span> <span class="o">=</span> <span class="n">features</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;era&quot;</span><span class="p">,</span> <span class="s2">&quot;target&quot;</span><span class="p">])</span>
            <span class="c1"># Sample a set of weights from GMM</span>
            <span class="n">beta</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bgmm_</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="c1"># Create fake continuous target</span>
            <span class="n">fake_targ</span> <span class="o">=</span> <span class="n">features</span> <span class="o">@</span> <span class="n">beta</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="c1"># Bin fake target like real target</span>
            <span class="n">fake_targ</span> <span class="o">=</span> <span class="p">(</span><span class="n">rankdata</span><span class="p">(</span><span class="n">fake_targ</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">fake_targ</span><span class="p">)</span>
            <span class="n">fake_targ</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">digitize</span><span class="p">(</span><span class="n">fake_targ</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bins</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">4</span>
            <span class="n">fake_target</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fake_targ</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">fake_target</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_feature_names_out</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_features</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return feature names.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="s2">&quot;fake_target&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">input_features</span> <span class="k">else</span> <span class="n">input_features</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">



<h3 id="numerblox.targets.BayesianGMMTargetProcessor.fit" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">eras</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Fit Bayesian Gaussian Mixture model on coefficients and normalize.
:param X: DataFrame containing features.
:param y: Series containing real target.
:param eras: Series containing era information.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/targets.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">eras</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Fit Bayesian Gaussian Mixture model on coefficients and normalize.</span>
<span class="sd">    :param X: DataFrame containing features.</span>
<span class="sd">    :param y: Series containing real target.</span>
<span class="sd">    :param eras: Series containing era information.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">bgmm</span> <span class="o">=</span> <span class="n">BayesianGaussianMixture</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n_components</span><span class="p">)</span>
    <span class="n">coefs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_coefs</span><span class="p">(</span><span class="n">dataf</span><span class="o">=</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">eras</span><span class="o">=</span><span class="n">eras</span><span class="p">)</span>
    <span class="n">bgmm</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">coefs</span><span class="p">)</span>
    <span class="c1"># make probability of sampling each component equal to better balance rare regimes</span>
    <span class="n">bgmm</span><span class="o">.</span><span class="n">weights_</span><span class="p">[:]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_components</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">bgmm_</span> <span class="o">=</span> <span class="n">bgmm</span>
    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="numerblox.targets.BayesianGMMTargetProcessor.get_feature_names_out" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_feature_names_out</span><span class="p">(</span><span class="n">input_features</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Return feature names.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/targets.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_feature_names_out</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_features</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return feature names.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">[</span><span class="s2">&quot;fake_target&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">input_features</span> <span class="k">else</span> <span class="n">input_features</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="numerblox.targets.BayesianGMMTargetProcessor.transform" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">eras</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Main method for generating fake target.
:param X: DataFrame containing features.
:param eras: Series containing era information.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/targets.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">eras</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Main method for generating fake target.</span>
<span class="sd">    :param X: DataFrame containing features.</span>
<span class="sd">    :param eras: Series containing era information.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;bgmm_&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">eras</span><span class="p">),</span> <span class="s2">&quot;X and eras must be same length.&quot;</span>
    <span class="n">all_eras</span> <span class="o">=</span> <span class="n">eras</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="c1"># Scale data between 0 and 1</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">X</span> <span class="o">/=</span> <span class="n">X</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="n">X</span> <span class="o">-=</span> <span class="mf">0.5</span>
    <span class="n">X</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;era&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">eras</span>

    <span class="n">fake_target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_target</span><span class="p">(</span><span class="n">dataf</span><span class="o">=</span><span class="n">X</span><span class="p">,</span> <span class="n">all_eras</span><span class="o">=</span><span class="n">all_eras</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fake_target</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>


</div>

<div class="doc doc-object doc-class">



<h2 id="numerblox.targets.SignalsTargetProcessor" class="doc doc-heading">
          <code>SignalsTargetProcessor</code>


</h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="numerblox.targets.BaseTargetProcessor" href="#numerblox.targets.BaseTargetProcessor">BaseTargetProcessor</a></code></p>

  
      <p>Engineer targets for Numerai Signals. </p>
<p>More information on implements Numerai Signals targets: </p>
<p>https://forum.numer.ai/t/decoding-the-signals-target/2501</p>
<p>:param price_col: Column from which target will be derived. </p>
<p>:param windows: Timeframes to use for engineering targets. 10 and 20-day by default. </p>
<p>:param bins: Binning used to create group targets. Nomi binning by default. </p>
<p>:param labels: Scaling for binned target. Must be same length as resulting bins (bins-1). Numerai labels by default.</p>

            <details class="quote">
              <summary>Source code in <code>numerblox/targets.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">SignalsTargetProcessor</span><span class="p">(</span><span class="n">BaseTargetProcessor</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Engineer targets for Numerai Signals. \n</span>
<span class="sd">    More information on implements Numerai Signals targets: \n</span>
<span class="sd">    https://forum.numer.ai/t/decoding-the-signals-target/2501</span>

<span class="sd">    :param price_col: Column from which target will be derived. \n</span>
<span class="sd">    :param windows: Timeframes to use for engineering targets. 10 and 20-day by default. \n</span>
<span class="sd">    :param bins: Binning used to create group targets. Nomi binning by default. \n</span>
<span class="sd">    :param labels: Scaling for binned target. Must be same length as resulting bins (bins-1). Numerai labels by default.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">price_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;close&quot;</span><span class="p">,</span>
        <span class="n">windows</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">bins</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">labels</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">price_col</span> <span class="o">=</span> <span class="n">price_col</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">windows</span> <span class="o">=</span> <span class="n">windows</span> <span class="k">if</span> <span class="n">windows</span> <span class="k">else</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bins</span> <span class="o">=</span> <span class="n">bins</span> <span class="k">if</span> <span class="n">bins</span> <span class="k">else</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labels</span> <span class="o">=</span> <span class="n">labels</span> <span class="k">if</span> <span class="n">labels</span> <span class="k">else</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.50</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">eras</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">window</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">windows</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Signals target engineering windows&quot;</span><span class="p">):</span>
            <span class="n">dataf</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="sa">f</span><span class="s2">&quot;target_</span><span class="si">{</span><span class="n">window</span><span class="si">}</span><span class="s2">d_raw&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">dataf</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">price_col</span><span class="p">]</span><span class="o">.</span><span class="n">pct_change</span><span class="p">(</span><span class="n">periods</span><span class="o">=</span><span class="n">window</span><span class="p">)</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="o">-</span><span class="n">window</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">era_groups</span> <span class="o">=</span> <span class="n">dataf</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">eras</span><span class="p">)</span>

            <span class="n">dataf</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="sa">f</span><span class="s2">&quot;target_</span><span class="si">{</span><span class="n">window</span><span class="si">}</span><span class="s2">d_rank&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">era_groups</span><span class="p">[</span>
                <span class="sa">f</span><span class="s2">&quot;target_</span><span class="si">{</span><span class="n">window</span><span class="si">}</span><span class="s2">d_raw&quot;</span>
            <span class="p">]</span><span class="o">.</span><span class="n">rank</span><span class="p">(</span><span class="n">pct</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;first&quot;</span><span class="p">)</span>
            <span class="n">dataf</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="sa">f</span><span class="s2">&quot;target_</span><span class="si">{</span><span class="n">window</span><span class="si">}</span><span class="s2">d_group&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">era_groups</span><span class="p">[</span>
                <span class="sa">f</span><span class="s2">&quot;target_</span><span class="si">{</span><span class="n">window</span><span class="si">}</span><span class="s2">d_rank&quot;</span>
            <span class="p">]</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span>
                <span class="k">lambda</span> <span class="n">group</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span>
                    <span class="n">group</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bins</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">,</span> <span class="n">include_lowest</span><span class="o">=</span><span class="kc">True</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="n">output_cols</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_feature_names_out</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">dataf</span><span class="p">[</span><span class="n">output_cols</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">get_feature_names_out</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_features</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return feature names of Signals targets. &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">input_features</span><span class="p">:</span>
            <span class="n">feature_names</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">window</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">windows</span><span class="p">:</span>
                <span class="n">feature_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;target_</span><span class="si">{</span><span class="n">window</span><span class="si">}</span><span class="s2">d_raw&quot;</span><span class="p">)</span>
                <span class="n">feature_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;target_</span><span class="si">{</span><span class="n">window</span><span class="si">}</span><span class="s2">d_rank&quot;</span><span class="p">)</span>
                <span class="n">feature_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;target_</span><span class="si">{</span><span class="n">window</span><span class="si">}</span><span class="s2">d_group&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">feature_names</span> <span class="o">=</span> <span class="n">input_features</span>
        <span class="k">return</span> <span class="n">feature_names</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">



<h3 id="numerblox.targets.SignalsTargetProcessor.get_feature_names_out" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_feature_names_out</span><span class="p">(</span><span class="n">input_features</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Return feature names of Signals targets.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/targets.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_feature_names_out</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_features</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return feature names of Signals targets. &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">input_features</span><span class="p">:</span>
        <span class="n">feature_names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">window</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">windows</span><span class="p">:</span>
            <span class="n">feature_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;target_</span><span class="si">{</span><span class="n">window</span><span class="si">}</span><span class="s2">d_raw&quot;</span><span class="p">)</span>
            <span class="n">feature_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;target_</span><span class="si">{</span><span class="n">window</span><span class="si">}</span><span class="s2">d_rank&quot;</span><span class="p">)</span>
            <span class="n">feature_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;target_</span><span class="si">{</span><span class="n">window</span><span class="si">}</span><span class="s2">d_group&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">feature_names</span> <span class="o">=</span> <span class="n">input_features</span>
    <span class="k">return</span> <span class="n">feature_names</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>


</div>




  </div>

  </div>

</div><hr />


<div class="doc doc-object doc-module">



<a id="numerblox.meta"></a>
  <div class="doc doc-contents first">

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="numerblox.meta.CrossValEstimator" class="doc doc-heading">
          <code>CrossValEstimator</code>


</h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><span title="sklearn.base.BaseEstimator">BaseEstimator</span></code>, <code><span title="sklearn.base.TransformerMixin">TransformerMixin</span></code></p>

  
      <p>Split your data into multiple folds and fit an estimator on each fold.
For transforms predictions are concatenated into a 2D array.
:param cv: Cross validation object that follows scikit-learn conventions.
:param estimator: Estimator to fit on each fold.
:param evaluation_func: Custom evaluation logic that is executed on validation data for each fold. Must accepts as input y_true and y_pred.
For example, evaluation_func can handle logging metrics for each fold.
Anything that evaluation_func returns is stored in <code>self.eval_results_</code>.
:param predict_func: Name of the function that will be used for prediction.
Must be one of 'predict', 'predict_proba', 'predict_log_proba'.
For example, XGBRegressor has 'predict' and 'predict_proba' functions.
:param verbose: Whether to print progress.</p>

            <details class="quote">
              <summary>Source code in <code>numerblox/meta.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">CrossValEstimator</span><span class="p">(</span><span class="n">BaseEstimator</span><span class="p">,</span> <span class="n">TransformerMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Split your data into multiple folds and fit an estimator on each fold.</span>
<span class="sd">    For transforms predictions are concatenated into a 2D array.</span>
<span class="sd">    :param cv: Cross validation object that follows scikit-learn conventions.</span>
<span class="sd">    :param estimator: Estimator to fit on each fold.</span>
<span class="sd">    :param evaluation_func: Custom evaluation logic that is executed on validation data for each fold. Must accepts as input y_true and y_pred.</span>
<span class="sd">    For example, evaluation_func can handle logging metrics for each fold.</span>
<span class="sd">    Anything that evaluation_func returns is stored in `self.eval_results_`.</span>
<span class="sd">    :param predict_func: Name of the function that will be used for prediction.</span>
<span class="sd">    Must be one of &#39;predict&#39;, &#39;predict_proba&#39;, &#39;predict_log_proba&#39;.</span>
<span class="sd">    For example, XGBRegressor has &#39;predict&#39; and &#39;predict_proba&#39; functions.</span>
<span class="sd">    :param verbose: Whether to print progress.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">estimator</span><span class="p">:</span> <span class="n">BaseEstimator</span><span class="p">,</span> <span class="n">cv</span><span class="p">:</span> <span class="n">BaseCrossValidator</span><span class="p">,</span> <span class="n">evaluation_func</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">predict_func</span><span class="o">=</span><span class="s2">&quot;predict&quot;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cv</span> <span class="o">=</span> <span class="n">cv</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cv</span><span class="p">,</span> <span class="s2">&quot;split&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cv</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;cv must be a valid sklearn cv object withat least a &#39;split&#39; function.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">estimator</span> <span class="o">=</span> <span class="n">estimator</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">estimator_name</span> <span class="o">=</span> <span class="n">estimator</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">evaluation_func</span> <span class="o">=</span> <span class="n">evaluation_func</span>

        <span class="k">if</span> <span class="n">predict_func</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;predict&quot;</span><span class="p">,</span> <span class="s2">&quot;predict_proba&quot;</span><span class="p">,</span> <span class="s2">&quot;predict_log_proba&quot;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;predict_func must be &#39;predict&#39;, &#39;predict_proba&#39;, or &#39;predict_log_proba&#39;.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">predict_func</span> <span class="o">=</span> <span class="n">predict_func</span>
        <span class="k">assert</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict_func</span><span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Estimator </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">estimator_name</span><span class="si">}</span><span class="s2"> does not have </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">predict_func</span><span class="si">}</span><span class="s2"> function.&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>

    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">],</span> <span class="n">y</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Use cross validation object to fit estimators. &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">estimators_</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eval_results_</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)):</span>
            <span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)):</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">train_idx</span><span class="p">,</span> <span class="n">val_idx</span><span class="p">)</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cv</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)),</span> 
                                            <span class="n">desc</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;CrossValEstimator Fitting. Estimator=&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">estimator_name</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">,</span> 
                                            <span class="n">total</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cv</span><span class="o">.</span><span class="n">get_n_splits</span><span class="p">(),</span> 
                                            <span class="n">disable</span><span class="o">=</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">):</span>
            <span class="n">estimator</span> <span class="o">=</span> <span class="n">clone</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fitting </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">estimator_name</span><span class="si">}</span><span class="s2"> on fold </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">estimators_</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>


            <span class="n">estimator</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">train_idx</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">train_idx</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

            <span class="c1"># Execute custom evaluation logic</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluation_func</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Running evaluation on fold </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">estimators_</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="n">y_pred</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">estimator</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict_func</span><span class="p">)(</span><span class="n">X</span><span class="p">[</span><span class="n">val_idx</span><span class="p">])</span>
                <span class="n">y_pred</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_postprocess_pred</span><span class="p">(</span><span class="n">y_pred</span><span class="p">)</span>
                <span class="n">eval_fold</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluation_func</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">val_idx</span><span class="p">],</span> <span class="n">y_pred</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;CrossValEstimator (estimator=&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">estimator_name</span><span class="si">}</span><span class="s2">&#39;): Fold &#39;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&#39; evaluation results: &#39;</span><span class="si">{</span><span class="n">eval_fold</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">eval_results_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">eval_fold</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">estimators_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">estimator</span><span class="p">)</span>

            <span class="c1"># Store output shape by doing inference on 1st sample of training set</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">sample_prediction</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">estimator</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict_func</span><span class="p">)(</span><span class="n">X</span><span class="p">[</span><span class="n">train_idx</span><span class="p">][:</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">sample_prediction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_postprocess_pred</span><span class="p">(</span><span class="n">sample_prediction</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">output_shape_</span> <span class="o">=</span> <span class="n">sample_prediction</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">multi_output_</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">n_outputs_per_model_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_shape_</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">model_idxs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        Use cross validation object to transform estimators. </span>
<span class="sd">        :param X: Input data for inference.</span>
<span class="sd">        :param y: Target data for inference.</span>
<span class="sd">        :param model_idxs: List of indices of models to use for inference. </span>
<span class="sd">        By default, all fitted models are used.</span>
<span class="sd">        :param kwargs: Additional arguments to pass to the estimator&#39;s predict function.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>        
        <span class="n">inference_estimators</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">estimators_</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">model_idxs</span><span class="p">]</span> <span class="k">if</span> <span class="n">model_idxs</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">estimators_</span>

        <span class="c1"># Create an empty array to store predictions</span>
        <span class="n">final_predictions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">len</span><span class="p">(</span><span class="n">inference_estimators</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_outputs_per_model_</span><span class="p">))</span>
        <span class="c1"># Iterate through models to get predictions</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">estimator</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">inference_estimators</span><span class="p">):</span>
            <span class="n">pred</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">estimator</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict_func</span><span class="p">)(</span><span class="n">X</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">pred</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_postprocess_pred</span><span class="p">(</span><span class="n">pred</span><span class="p">)</span>

            <span class="c1"># Calculate where to place these predictions in the final array</span>
            <span class="n">start_idx</span> <span class="o">=</span> <span class="n">idx</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_outputs_per_model_</span>
            <span class="n">end_idx</span> <span class="o">=</span> <span class="p">(</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_outputs_per_model_</span>

            <span class="n">final_predictions</span><span class="p">[:,</span> <span class="n">start_idx</span><span class="p">:</span><span class="n">end_idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">pred</span>

        <span class="k">return</span> <span class="n">final_predictions</span>

    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">model_idxs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">model_idxs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_feature_names_out</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_features</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">base_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;CrossValEstimator_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">estimator_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">predict_func</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="c1"># Single-output case</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_outputs_per_model_</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">feature_names</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_str</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">estimators_</span><span class="p">))]</span>
        <span class="c1"># Multi-output case</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">feature_names</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">estimators_</span><span class="p">)):</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_outputs_per_model_</span><span class="p">):</span>
                    <span class="n">feature_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_str</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">_output_</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">feature_names</span>

    <span class="k">def</span> <span class="nf">_postprocess_pred</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pred</span><span class="p">):</span>
        <span class="c1"># Make sure predictions are 2D</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pred</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">pred</span> <span class="o">=</span> <span class="n">pred</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pred</span>

    <span class="k">def</span> <span class="nf">__sklearn_is_fitted__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Check fitted status. &quot;&quot;&quot;</span>
        <span class="c1"># Must have a fitted estimator for each split.</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">estimators_</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv</span><span class="o">.</span><span class="n">get_n_splits</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">



<h3 id="numerblox.meta.CrossValEstimator.__sklearn_is_fitted__" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">__sklearn_is_fitted__</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Check fitted status.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/meta.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">__sklearn_is_fitted__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Check fitted status. &quot;&quot;&quot;</span>
    <span class="c1"># Must have a fitted estimator for each split.</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">estimators_</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv</span><span class="o">.</span><span class="n">get_n_splits</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="numerblox.meta.CrossValEstimator.fit" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Use cross validation object to fit estimators.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/meta.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">],</span> <span class="n">y</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Use cross validation object to fit estimators. &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">estimators_</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">eval_results_</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)):</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)):</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">train_idx</span><span class="p">,</span> <span class="n">val_idx</span><span class="p">)</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cv</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)),</span> 
                                        <span class="n">desc</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;CrossValEstimator Fitting. Estimator=&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">estimator_name</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">,</span> 
                                        <span class="n">total</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cv</span><span class="o">.</span><span class="n">get_n_splits</span><span class="p">(),</span> 
                                        <span class="n">disable</span><span class="o">=</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">):</span>
        <span class="n">estimator</span> <span class="o">=</span> <span class="n">clone</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fitting </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">estimator_name</span><span class="si">}</span><span class="s2"> on fold </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">estimators_</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>


        <span class="n">estimator</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">train_idx</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">train_idx</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c1"># Execute custom evaluation logic</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluation_func</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Running evaluation on fold </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">estimators_</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="n">y_pred</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">estimator</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict_func</span><span class="p">)(</span><span class="n">X</span><span class="p">[</span><span class="n">val_idx</span><span class="p">])</span>
            <span class="n">y_pred</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_postprocess_pred</span><span class="p">(</span><span class="n">y_pred</span><span class="p">)</span>
            <span class="n">eval_fold</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluation_func</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">val_idx</span><span class="p">],</span> <span class="n">y_pred</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;CrossValEstimator (estimator=&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">estimator_name</span><span class="si">}</span><span class="s2">&#39;): Fold &#39;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&#39; evaluation results: &#39;</span><span class="si">{</span><span class="n">eval_fold</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">eval_results_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">eval_fold</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">estimators_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">estimator</span><span class="p">)</span>

        <span class="c1"># Store output shape by doing inference on 1st sample of training set</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">sample_prediction</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">estimator</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict_func</span><span class="p">)(</span><span class="n">X</span><span class="p">[</span><span class="n">train_idx</span><span class="p">][:</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">sample_prediction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_postprocess_pred</span><span class="p">(</span><span class="n">sample_prediction</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">output_shape_</span> <span class="o">=</span> <span class="n">sample_prediction</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">multi_output_</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">n_outputs_per_model_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_shape_</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="numerblox.meta.CrossValEstimator.transform" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">model_idxs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Use cross validation object to transform estimators. 
:param X: Input data for inference.
:param y: Target data for inference.
:param model_idxs: List of indices of models to use for inference. 
By default, all fitted models are used.
:param kwargs: Additional arguments to pass to the estimator's predict function.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/meta.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">model_idxs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">    Use cross validation object to transform estimators. </span>
<span class="sd">    :param X: Input data for inference.</span>
<span class="sd">    :param y: Target data for inference.</span>
<span class="sd">    :param model_idxs: List of indices of models to use for inference. </span>
<span class="sd">    By default, all fitted models are used.</span>
<span class="sd">    :param kwargs: Additional arguments to pass to the estimator&#39;s predict function.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>        
    <span class="n">inference_estimators</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">estimators_</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">model_idxs</span><span class="p">]</span> <span class="k">if</span> <span class="n">model_idxs</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">estimators_</span>

    <span class="c1"># Create an empty array to store predictions</span>
    <span class="n">final_predictions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">len</span><span class="p">(</span><span class="n">inference_estimators</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_outputs_per_model_</span><span class="p">))</span>
    <span class="c1"># Iterate through models to get predictions</span>
    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">estimator</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">inference_estimators</span><span class="p">):</span>
        <span class="n">pred</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">estimator</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict_func</span><span class="p">)(</span><span class="n">X</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">pred</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_postprocess_pred</span><span class="p">(</span><span class="n">pred</span><span class="p">)</span>

        <span class="c1"># Calculate where to place these predictions in the final array</span>
        <span class="n">start_idx</span> <span class="o">=</span> <span class="n">idx</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_outputs_per_model_</span>
        <span class="n">end_idx</span> <span class="o">=</span> <span class="p">(</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_outputs_per_model_</span>

        <span class="n">final_predictions</span><span class="p">[:,</span> <span class="n">start_idx</span><span class="p">:</span><span class="n">end_idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">pred</span>

    <span class="k">return</span> <span class="n">final_predictions</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>


</div>

<div class="doc doc-object doc-class">



<h2 id="numerblox.meta.MetaEstimator" class="doc doc-heading">
          <code>MetaEstimator</code>


</h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><span title="sklearn.base.BaseEstimator">BaseEstimator</span></code>, <code><span title="sklearn.base.TransformerMixin">TransformerMixin</span></code>, <code><span title="sklearn.base.MetaEstimatorMixin">MetaEstimatorMixin</span></code></p>

  
      <p>Helper for NumeraiPipeline and NumeraiFeatureUnion to use a model as a transformer.</p>
<p>:param estimator: Underlying estimator like XGBoost, Catboost, scikit-learn, etc.
:param predict_func: Name of the function that will be used for prediction.
Must be one of 'predict', 'predict_proba', 'predict_log_proba'.
For example, XGBRegressor has 'predict' and 'predict_proba' functions.
:param model_type: "regressor" or "classifier". Used to determine if the estimator is multi output.</p>

            <details class="quote">
              <summary>Source code in <code>numerblox/meta.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">MetaEstimator</span><span class="p">(</span><span class="n">BaseEstimator</span><span class="p">,</span> <span class="n">TransformerMixin</span><span class="p">,</span> <span class="n">MetaEstimatorMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Helper for NumeraiPipeline and NumeraiFeatureUnion to use a model as a transformer.</span>

<span class="sd">    :param estimator: Underlying estimator like XGBoost, Catboost, scikit-learn, etc.</span>
<span class="sd">    :param predict_func: Name of the function that will be used for prediction.</span>
<span class="sd">    Must be one of &#39;predict&#39;, &#39;predict_proba&#39;, &#39;predict_log_proba&#39;.</span>
<span class="sd">    For example, XGBRegressor has &#39;predict&#39; and &#39;predict_proba&#39; functions.</span>
<span class="sd">    :param model_type: &quot;regressor&quot; or &quot;classifier&quot;. Used to determine if the estimator is multi output.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">estimator</span><span class="p">,</span> <span class="n">predict_func</span><span class="o">=</span><span class="s2">&quot;predict&quot;</span><span class="p">,</span> <span class="n">model_type</span><span class="o">=</span><span class="s2">&quot;regressor&quot;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">estimator</span> <span class="o">=</span> <span class="n">estimator</span>
        <span class="k">if</span> <span class="n">predict_func</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;predict&quot;</span><span class="p">,</span> <span class="s2">&quot;predict_proba&quot;</span><span class="p">,</span> <span class="s2">&quot;predict_log_proba&quot;</span><span class="p">,</span> <span class="s2">&quot;transform&quot;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;predict_func must be &#39;predict&#39;, &#39;predict_proba&#39;, &#39;predict_log_proba&#39; or &#39;transform&#39;.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">predict_func</span> <span class="o">=</span> <span class="n">predict_func</span>
        <span class="k">assert</span> <span class="n">model_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;regressor&quot;</span><span class="p">,</span> <span class="s2">&quot;classifier&quot;</span><span class="p">],</span> <span class="s2">&quot;model_type must be &#39;regressor&#39; or &#39;classifier&#39;.&quot;</span>
        <span class="k">assert</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict_func</span><span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Estimator </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> does not have </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">predict_func</span><span class="si">}</span><span class="s2"> function.&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_type</span> <span class="o">=</span> <span class="n">model_type</span>
        <span class="c1"># predict_proba for classifiers -&gt; multi output</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">proba_class_</span> <span class="o">=</span> <span class="n">predict_func</span> <span class="o">==</span> <span class="s2">&quot;predict_proba&quot;</span> <span class="ow">and</span> <span class="n">model_type</span> <span class="o">==</span> <span class="s2">&quot;classifier&quot;</span>

    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">],</span> <span class="n">y</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fit underlying estimator and set attributes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">check_X_y</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">estimator</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">FLOAT_DTYPES</span><span class="p">,</span> <span class="n">multi_output</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># Either multi target or outputs are probabilities</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">multi_output_</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">proba_class_</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">estimator_</span> <span class="o">=</span> <span class="n">clone</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">estimator_</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Apply the `predict_func` on the fitted estimator.</span>

<span class="sd">        Shape `(X.shape[0], )` if estimator is not multi output and else `(X.shape[0], y.shape[1])`.</span>
<span class="sd">        All additional kwargs are passed to the underlying estimator&#39;s predict function.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;estimator_&quot;</span><span class="p">)</span>
        <span class="n">output</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">estimator_</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict_func</span><span class="p">)(</span><span class="n">X</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">output</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">multi_output_</span> <span class="k">else</span> <span class="n">output</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        For if a MetaEstimator happens to be the last step in the pipeline. Has same behavior as transform.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_feature_names_out</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_features</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">feature_names</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">predict_func</span><span class="si">}</span><span class="s2">_output&quot;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">feature_names</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">input_features</span> <span class="k">else</span> <span class="n">input_features</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">



<h3 id="numerblox.meta.MetaEstimator.fit" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Fit underlying estimator and set attributes.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/meta.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">],</span> <span class="n">y</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Fit underlying estimator and set attributes.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">check_X_y</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">estimator</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">FLOAT_DTYPES</span><span class="p">,</span> <span class="n">multi_output</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># Either multi target or outputs are probabilities</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">multi_output_</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">proba_class_</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">estimator_</span> <span class="o">=</span> <span class="n">clone</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">estimator_</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="numerblox.meta.MetaEstimator.predict" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>For if a MetaEstimator happens to be the last step in the pipeline. Has same behavior as transform.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/meta.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">    For if a MetaEstimator happens to be the last step in the pipeline. Has same behavior as transform.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="numerblox.meta.MetaEstimator.transform" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Apply the <code>predict_func</code> on the fitted estimator.</p>
<p>Shape <code>(X.shape[0], )</code> if estimator is not multi output and else <code>(X.shape[0], y.shape[1])</code>.
All additional kwargs are passed to the underlying estimator's predict function.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/meta.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Apply the `predict_func` on the fitted estimator.</span>

<span class="sd">    Shape `(X.shape[0], )` if estimator is not multi output and else `(X.shape[0], y.shape[1])`.</span>
<span class="sd">    All additional kwargs are passed to the underlying estimator&#39;s predict function.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;estimator_&quot;</span><span class="p">)</span>
    <span class="n">output</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">estimator_</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict_func</span><span class="p">)(</span><span class="n">X</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">output</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">multi_output_</span> <span class="k">else</span> <span class="n">output</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>


</div>

<div class="doc doc-object doc-class">



<h2 id="numerblox.meta.MetaPipeline" class="doc doc-heading">
          <code>MetaPipeline</code>


</h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><span title="sklearn.pipeline.Pipeline">Pipeline</span></code></p>

  
      <p>Pipeline which turns all estimators into transformers by wrapping them in MetaEstimator.
This allows to have pipeline steps after models.
For example, a FeatureNeutralizer after an XGBRegressor.</p>
<p>:param steps: List of (name, transform) tuples (implementing fit/transform) that are chained, in the order in which they are chained, with the last object an instance of BaseNeutralizer.
:param memory: Used to cache the fitted transformers of the pipeline.
:param verbose: If True, the time elapsed while fitting each step will be printed as it is completed.
:param predict_func: Name of the function that will be used for prediction.</p>

            <details class="quote">
              <summary>Source code in <code>numerblox/meta.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">MetaPipeline</span><span class="p">(</span><span class="n">Pipeline</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Pipeline which turns all estimators into transformers by wrapping them in MetaEstimator.</span>
<span class="sd">    This allows to have pipeline steps after models.</span>
<span class="sd">    For example, a FeatureNeutralizer after an XGBRegressor.</span>

<span class="sd">    :param steps: List of (name, transform) tuples (implementing fit/transform) that are chained, in the order in which they are chained, with the last object an instance of BaseNeutralizer.</span>
<span class="sd">    :param memory: Used to cache the fitted transformers of the pipeline.</span>
<span class="sd">    :param verbose: If True, the time elapsed while fitting each step will be printed as it is completed.</span>
<span class="sd">    :param predict_func: Name of the function that will be used for prediction.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">steps</span><span class="p">,</span> <span class="n">memory</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">predict_func</span><span class="o">=</span><span class="s2">&quot;predict&quot;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">predict_func</span> <span class="o">=</span> <span class="n">predict_func</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modified_steps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wrap_estimators_as_transformers</span><span class="p">(</span><span class="n">steps</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">steps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">modified_steps</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">memory</span> <span class="o">=</span> <span class="n">memory</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>

    <span class="k">def</span> <span class="nf">wrap_estimators_as_transformers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">steps</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts all estimator steps (except the last step) into transformers by wrapping them in MetaEstimator.</span>
<span class="sd">        :param steps: List of (name, transform) tuples specifying the pipeline steps.</span>
<span class="sd">        :return: Modified steps with all estimators wrapped as transformers.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">transformed_steps</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">step_tuple</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">steps</span><span class="p">):</span>
            <span class="n">is_last_step</span> <span class="o">=</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">steps</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">step_tuple</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">name</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="n">step_tuple</span>
                <span class="n">transformed_steps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_wrap_step</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">columns</span><span class="p">,</span> <span class="n">is_last_step</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">name</span><span class="p">,</span> <span class="n">step</span> <span class="o">=</span> <span class="n">step_tuple</span>
                <span class="n">transformed_steps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_wrap_step</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">is_last_step</span><span class="o">=</span><span class="n">is_last_step</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">transformed_steps</span>

    <span class="k">def</span> <span class="nf">_wrap_step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">is_last_step</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot; Recursive function to wrap steps &quot;&quot;&quot;</span>
            <span class="c1"># Recursive call</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">step</span><span class="p">,</span> <span class="p">(</span><span class="n">Pipeline</span><span class="p">,</span> <span class="n">FeatureUnion</span><span class="p">,</span> <span class="n">ColumnTransformer</span><span class="p">)):</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">step</span><span class="p">,</span> <span class="n">Pipeline</span><span class="p">):</span>
                    <span class="n">transformed</span> <span class="o">=</span> <span class="n">step</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wrap_estimators_as_transformers</span><span class="p">(</span><span class="n">step</span><span class="o">.</span><span class="n">steps</span><span class="p">))</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">step</span><span class="p">,</span> <span class="n">FeatureUnion</span><span class="p">):</span>
                    <span class="n">transformed</span> <span class="o">=</span> <span class="n">FeatureUnion</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wrap_estimators_as_transformers</span><span class="p">(</span><span class="n">step</span><span class="o">.</span><span class="n">transformer_list</span><span class="p">))</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">step</span><span class="p">,</span> <span class="n">ColumnTransformer</span><span class="p">):</span>
                    <span class="n">transformed_transformers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wrap_estimators_as_transformers</span><span class="p">(</span><span class="n">step</span><span class="o">.</span><span class="n">transformers</span><span class="p">)</span>
                    <span class="n">transformed</span> <span class="o">=</span> <span class="n">ColumnTransformer</span><span class="p">(</span><span class="n">transformed_transformers</span><span class="p">)</span>
                <span class="k">return</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">transformed</span><span class="p">,</span> <span class="n">columns</span><span class="p">)</span> <span class="k">if</span> <span class="n">columns</span> <span class="k">else</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">transformed</span><span class="p">)</span>

            <span class="c1"># If it&#39;s the last step and it doesn&#39;t have a transform method, don&#39;t wrap it</span>
            <span class="k">if</span> <span class="n">is_last_step</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">step</span><span class="p">,</span> <span class="s1">&#39;transform&#39;</span><span class="p">):</span>
                <span class="k">return</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">columns</span><span class="p">)</span> <span class="k">if</span> <span class="n">columns</span> <span class="k">else</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>

            <span class="c1"># Wrap estimator that has the predict function but not the transform function</span>
            <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">step</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict_func</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">step</span><span class="p">,</span> <span class="s1">&#39;transform&#39;</span><span class="p">):</span>
                <span class="k">return</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">MetaEstimator</span><span class="p">(</span><span class="n">step</span><span class="p">,</span> <span class="n">predict_func</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">predict_func</span><span class="p">))</span>

            <span class="k">return</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">columns</span><span class="p">)</span> <span class="k">if</span> <span class="n">columns</span> <span class="k">else</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">fit_params_steps</span><span class="p">):</span>
        <span class="c1"># shallow copy of steps - this should really be steps_</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">steps</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">steps</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_steps</span><span class="p">()</span>
        <span class="c1"># Setup the memory</span>
        <span class="n">memory</span> <span class="o">=</span> <span class="n">check_memory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">memory</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">step_idx</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">transformer</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iter</span><span class="p">(</span>
            <span class="n">with_final</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">filter_passthrough</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">):</span>
            <span class="k">if</span> <span class="n">transformer</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">transformer</span> <span class="o">==</span> <span class="s2">&quot;passthrough&quot;</span><span class="p">:</span>
                <span class="k">with</span> <span class="n">_print_elapsed_time</span><span class="p">(</span><span class="s2">&quot;Pipeline&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log_message</span><span class="p">(</span><span class="n">step_idx</span><span class="p">)):</span>
                    <span class="k">continue</span>

            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">memory</span><span class="p">,</span> <span class="s2">&quot;location&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">memory</span><span class="o">.</span><span class="n">location</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># we do not clone when caching is disabled to</span>
                <span class="c1"># preserve backward compatibility</span>
                <span class="n">cloned_transformer</span> <span class="o">=</span> <span class="n">transformer</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cloned_transformer</span> <span class="o">=</span> <span class="n">clone</span><span class="p">(</span><span class="n">transformer</span><span class="p">)</span>
            <span class="c1"># Fit or load from cache the current transformer</span>
            <span class="n">X</span><span class="p">,</span> <span class="n">fitted_transformer</span> <span class="o">=</span> <span class="n">_fit_transform_one</span><span class="p">(</span>
                <span class="n">cloned_transformer</span><span class="p">,</span>
                <span class="n">X</span><span class="p">,</span>
                <span class="n">y</span><span class="p">,</span>
                <span class="kc">None</span><span class="p">,</span>
                <span class="n">message_clsname</span><span class="o">=</span><span class="s2">&quot;Pipeline&quot;</span><span class="p">,</span>
                <span class="n">message</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_log_message</span><span class="p">(</span><span class="n">step_idx</span><span class="p">),</span>
                <span class="o">**</span><span class="n">fit_params_steps</span><span class="p">[</span><span class="n">name</span><span class="p">],</span>
            <span class="p">)</span>
            <span class="c1"># Replace the transformer of the step with the fitted</span>
            <span class="c1"># transformer. This is necessary when loading the transformer</span>
            <span class="c1"># from the cache.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">steps</span><span class="p">[</span><span class="n">step_idx</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">fitted_transformer</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">X</span>

    <span class="nd">@available_if</span><span class="p">(</span><span class="n">_final_estimator_has</span><span class="p">(</span><span class="s2">&quot;predict&quot;</span><span class="p">))</span>
    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="o">**</span><span class="n">predict_params</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Overrides predict method in Pipeline so it also parses arguments to transforms.&quot;&quot;&quot;</span>
        <span class="n">Xt</span> <span class="o">=</span> <span class="n">X</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">transform</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iter</span><span class="p">(</span><span class="n">with_final</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
            <span class="c1"># Check if predict params is needed in transform. If so parse along</span>
            <span class="n">sig</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">signature</span><span class="p">(</span><span class="n">transform</span><span class="o">.</span><span class="n">transform</span><span class="p">)</span>
            <span class="n">params_needed</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">predict_params</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">sig</span><span class="o">.</span><span class="n">parameters</span><span class="p">}</span>
            <span class="c1"># Use the needed parameters when calling transform</span>
            <span class="n">Xt</span> <span class="o">=</span> <span class="n">transform</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">Xt</span><span class="p">,</span> <span class="o">**</span><span class="n">params_needed</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">steps</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">Xt</span><span class="p">,</span> <span class="o">**</span><span class="n">predict_params</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">



<h3 id="numerblox.meta.MetaPipeline.predict" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="o">**</span><span class="n">predict_params</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Overrides predict method in Pipeline so it also parses arguments to transforms.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/meta.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@available_if</span><span class="p">(</span><span class="n">_final_estimator_has</span><span class="p">(</span><span class="s2">&quot;predict&quot;</span><span class="p">))</span>
<span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="o">**</span><span class="n">predict_params</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Overrides predict method in Pipeline so it also parses arguments to transforms.&quot;&quot;&quot;</span>
    <span class="n">Xt</span> <span class="o">=</span> <span class="n">X</span>
    <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">transform</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iter</span><span class="p">(</span><span class="n">with_final</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="c1"># Check if predict params is needed in transform. If so parse along</span>
        <span class="n">sig</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">signature</span><span class="p">(</span><span class="n">transform</span><span class="o">.</span><span class="n">transform</span><span class="p">)</span>
        <span class="n">params_needed</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">predict_params</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">sig</span><span class="o">.</span><span class="n">parameters</span><span class="p">}</span>
        <span class="c1"># Use the needed parameters when calling transform</span>
        <span class="n">Xt</span> <span class="o">=</span> <span class="n">transform</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">Xt</span><span class="p">,</span> <span class="o">**</span><span class="n">params_needed</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">steps</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">Xt</span><span class="p">,</span> <span class="o">**</span><span class="n">predict_params</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="numerblox.meta.MetaPipeline.wrap_estimators_as_transformers" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">wrap_estimators_as_transformers</span><span class="p">(</span><span class="n">steps</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Converts all estimator steps (except the last step) into transformers by wrapping them in MetaEstimator.
:param steps: List of (name, transform) tuples specifying the pipeline steps.
:return: Modified steps with all estimators wrapped as transformers.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/meta.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">wrap_estimators_as_transformers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">steps</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts all estimator steps (except the last step) into transformers by wrapping them in MetaEstimator.</span>
<span class="sd">    :param steps: List of (name, transform) tuples specifying the pipeline steps.</span>
<span class="sd">    :return: Modified steps with all estimators wrapped as transformers.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">transformed_steps</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">step_tuple</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">steps</span><span class="p">):</span>
        <span class="n">is_last_step</span> <span class="o">=</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">steps</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">step_tuple</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">name</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="n">step_tuple</span>
            <span class="n">transformed_steps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_wrap_step</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">columns</span><span class="p">,</span> <span class="n">is_last_step</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">name</span><span class="p">,</span> <span class="n">step</span> <span class="o">=</span> <span class="n">step_tuple</span>
            <span class="n">transformed_steps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_wrap_step</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">is_last_step</span><span class="o">=</span><span class="n">is_last_step</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">transformed_steps</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>


</div>



<div class="doc doc-object doc-function">



<h2 id="numerblox.meta.make_meta_pipeline" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">make_meta_pipeline</span><span class="p">(</span><span class="o">*</span><span class="n">steps</span><span class="p">,</span> <span class="n">memory</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Convenience function for creating a MetaPipeline. 
:param steps: List of (name, transform) tuples (implementing fit/transform) that are chained, in the order in which they are chained, with the last object an instance of BaseNeutralizer.
:param memory: Used to cache the fitted transformers of the pipeline.
:param verbose: If True, the time elapsed while fitting each step will be printed as it is completed.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/meta.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">make_meta_pipeline</span><span class="p">(</span><span class="o">*</span><span class="n">steps</span><span class="p">,</span> <span class="n">memory</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MetaPipeline</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">    Convenience function for creating a MetaPipeline. </span>
<span class="sd">    :param steps: List of (name, transform) tuples (implementing fit/transform) that are chained, in the order in which they are chained, with the last object an instance of BaseNeutralizer.</span>
<span class="sd">    :param memory: Used to cache the fitted transformers of the pipeline.</span>
<span class="sd">    :param verbose: If True, the time elapsed while fitting each step will be printed as it is completed.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">MetaPipeline</span><span class="p">(</span><span class="n">_name_estimators</span><span class="p">(</span><span class="n">steps</span><span class="p">),</span> <span class="n">memory</span><span class="o">=</span><span class="n">memory</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div><hr />


<div class="doc doc-object doc-module">



<a id="numerblox.neutralizers"></a>
  <div class="doc doc-contents first">

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="numerblox.neutralizers.BaseNeutralizer" class="doc doc-heading">
          <code>BaseNeutralizer</code>


</h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><span title="sklearn.base.BaseEstimator">BaseEstimator</span></code>, <code><span title="sklearn.base.TransformerMixin">TransformerMixin</span></code></p>

  
      <p>Base class for neutralization so it is compatible with scikit-learn.
:param new_col_name: Name of new neutralized column.</p>

            <details class="quote">
              <summary>Source code in <code>numerblox/neutralizers.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">BaseNeutralizer</span><span class="p">(</span><span class="n">BaseEstimator</span><span class="p">,</span> <span class="n">TransformerMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Base class for neutralization so it is compatible with scikit-learn.</span>
<span class="sd">    :param new_col_name: Name of new neutralized column.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_col_names</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">new_col_names</span> <span class="o">=</span> <span class="n">new_col_names</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">],</span> 
        <span class="n">features</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">eras</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
        <span class="o">...</span>

    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">features</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">eras</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Convenience function for scikit-learn compatibility. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="n">features</span><span class="p">,</span> <span class="n">eras</span><span class="o">=</span><span class="n">eras</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">fit_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">features</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">eras</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        Convenience function for scikit-learn compatibility.</span>
<span class="sd">        Needed because fit and transform except different arguments here.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="n">features</span><span class="p">,</span> <span class="n">eras</span><span class="o">=</span><span class="n">eras</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">],</span>
        <span class="n">features</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">eras</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="n">features</span><span class="p">,</span> <span class="n">eras</span><span class="o">=</span><span class="n">eras</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_feature_names_out</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_features</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        Get feature names for neutralized output.</span>

<span class="sd">        :param input_features: Optional list of input feature names.</span>
<span class="sd">        :return: List of feature names for neutralized output.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">input_features</span> <span class="k">if</span> <span class="n">input_features</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_col_names</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">



<h3 id="numerblox.neutralizers.BaseNeutralizer.fit_transform" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">features</span><span class="p">,</span> <span class="n">eras</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Convenience function for scikit-learn compatibility.
Needed because fit and transform except different arguments here.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/neutralizers.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">fit_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">features</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">eras</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">    Convenience function for scikit-learn compatibility.</span>
<span class="sd">    Needed because fit and transform except different arguments here.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="n">features</span><span class="p">,</span> <span class="n">eras</span><span class="o">=</span><span class="n">eras</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="numerblox.neutralizers.BaseNeutralizer.get_feature_names_out" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_feature_names_out</span><span class="p">(</span><span class="n">input_features</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Get feature names for neutralized output.</p>
<p>:param input_features: Optional list of input feature names.
:return: List of feature names for neutralized output.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/neutralizers.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_feature_names_out</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_features</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">    Get feature names for neutralized output.</span>

<span class="sd">    :param input_features: Optional list of input feature names.</span>
<span class="sd">    :return: List of feature names for neutralized output.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">input_features</span> <span class="k">if</span> <span class="n">input_features</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_col_names</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="numerblox.neutralizers.BaseNeutralizer.predict" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">features</span><span class="p">,</span> <span class="n">eras</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Convenience function for scikit-learn compatibility.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/neutralizers.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">features</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">eras</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Convenience function for scikit-learn compatibility. &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="n">features</span><span class="p">,</span> <span class="n">eras</span><span class="o">=</span><span class="n">eras</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>


</div>

<div class="doc doc-object doc-class">



<h2 id="numerblox.neutralizers.FeatureNeutralizer" class="doc doc-heading">
          <code>FeatureNeutralizer</code>


</h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="numerblox.neutralizers.BaseNeutralizer" href="#numerblox.neutralizers.BaseNeutralizer">BaseNeutralizer</a></code></p>

  
      <p>Classic feature neutralization by subtracting a linear model.</p>
<p>:param pred_name: Name of prediction column. For creating the new column name. 
:param proportion: Number in range [0...1] indicating how much to neutralize.
:param suffix: Optional suffix that is added to new column name.
:param num_cores: Number of cores to use for parallel processing.
By default, all CPU cores are used.</p>

            <details class="quote">
              <summary>Source code in <code>numerblox/neutralizers.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">FeatureNeutralizer</span><span class="p">(</span><span class="n">BaseNeutralizer</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Classic feature neutralization by subtracting a linear model.</span>

<span class="sd">    :param pred_name: Name of prediction column. For creating the new column name. </span>
<span class="sd">    :param proportion: Number in range [0...1] indicating how much to neutralize.</span>
<span class="sd">    :param suffix: Optional suffix that is added to new column name.</span>
<span class="sd">    :param num_cores: Number of cores to use for parallel processing.</span>
<span class="sd">    By default, all CPU cores are used.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">pred_name</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;prediction&quot;</span><span class="p">,</span>
        <span class="n">proportion</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
        <span class="n">suffix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">num_cores</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pred_name</span> <span class="o">=</span> <span class="p">[</span><span class="n">pred_name</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pred_name</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">pred_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">proportion</span> <span class="o">=</span> <span class="p">[</span><span class="n">proportion</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">proportion</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="k">else</span> <span class="n">proportion</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pred_name</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pred_name</span><span class="p">)),</span> <span class="s2">&quot;Duplicate &#39;pred_names&#39; found. Make sure all names are unique.&quot;</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">proportion</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">proportion</span><span class="p">)),</span> <span class="s2">&quot;Duplicate &#39;proportions&#39; found. Make sure all proportions are unique.&quot;</span>
        <span class="k">for</span> <span class="n">prop</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">proportion</span><span class="p">:</span>
            <span class="k">assert</span> <span class="p">(</span>
                <span class="mf">0.0</span> <span class="o">&lt;=</span> <span class="n">prop</span> <span class="o">&lt;=</span> <span class="mf">1.0</span>
            <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;&#39;proportion&#39; should be a float in range [0...1]. Got &#39;</span><span class="si">{</span><span class="n">prop</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>

        <span class="n">new_col_names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">pred_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pred_name</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">prop</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">proportion</span><span class="p">:</span>
                <span class="n">new_col_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">pred_name</span><span class="si">}</span><span class="s2">_neutralized_</span><span class="si">{</span><span class="n">prop</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">suffix</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">suffix</span> <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">pred_name</span><span class="si">}</span><span class="s2">_neutralized_</span><span class="si">{</span><span class="n">prop</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">new_col_names</span><span class="o">=</span><span class="n">new_col_names</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">suffix</span> <span class="o">=</span> <span class="n">suffix</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_cores</span> <span class="o">=</span> <span class="n">num_cores</span>

    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">],</span> 
                  <span class="n">features</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">eras</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Main transform function.</span>
<span class="sd">        :param X: Input predictions to neutralize. \n</span>
<span class="sd">        :param features: DataFrame with features for neutralization. \n</span>
<span class="sd">        :param eras: Series with era labels for each row in features. \n</span>
<span class="sd">        Features, eras and the prediction column must all have the same length.</span>
<span class="sd">        :return: Neutralized predictions NumPy array.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">features</span><span class="p">),</span> <span class="s2">&quot;Input predictions must have same length as features.&quot;</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">eras</span><span class="p">),</span> <span class="s2">&quot;Input predictions must have same length as eras.&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">features</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
        <span class="c1"># Ensure X is a 2D array and has the same number of columns as pred_name</span>
        <span class="k">if</span> <span class="n">X</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pred_name</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Only one prediction column found. Please input a 2D array or define one column for &#39;pred_name&#39;.&quot;</span>
            <span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pred_name</span><span class="p">)</span> <span class="o">==</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;Number of prediction columns given in X does not match &#39;pred_name&#39;.&quot;</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">pred_name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pred_name</span><span class="p">):</span>
            <span class="n">df</span><span class="p">[</span><span class="n">pred_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span>
        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;era&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">eras</span>

        <span class="n">feature_cols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">features</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
        <span class="n">tasks</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">delayed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_process_pred_name</span><span class="p">)(</span><span class="n">df</span><span class="p">,</span> <span class="n">pred_name</span><span class="p">,</span> <span class="n">proportion</span><span class="p">,</span> <span class="n">feature_cols</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">pred_name</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pred_name</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Processing feature neutralizations&quot;</span><span class="p">)</span> 
            <span class="k">for</span> <span class="n">proportion</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">proportion</span>
        <span class="p">]</span>
        <span class="n">neutralized_results</span> <span class="o">=</span> <span class="n">Parallel</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">num_cores</span><span class="p">)(</span><span class="n">tasks</span><span class="p">)</span>
        <span class="n">neutralized_preds</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">neutralized_results</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">neutralized_preds</span>

    <span class="k">def</span> <span class="nf">_process_pred_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">pred_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">proportion</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">feature_cols</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        Process one combination of prediction and proportion.</span>
<span class="sd">        :param df: DataFrame with features and predictions.</span>
<span class="sd">        :param pred_name: Name of prediction column.</span>
<span class="sd">        :param proportion: Proportion to neutralize.</span>
<span class="sd">        :param feature_cols: List of feature column names.</span>
<span class="sd">        :return: Neutralized predictions.</span>
<span class="sd">        Neutralized predictions are scaled to [0...1].</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">neutralized_pred</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;era&quot;</span><span class="p">,</span> <span class="n">group_keys</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalize_and_neutralize</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">[</span><span class="n">pred_name</span><span class="p">],</span> <span class="n">feature_cols</span><span class="p">,</span> <span class="n">proportion</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">MinMaxScaler</span><span class="p">()</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">neutralized_pred</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">neutralize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">columns</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">by</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">proportion</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        Neutralize on CPU. </span>
<span class="sd">        :param dataf: DataFrame with features and predictions.</span>
<span class="sd">        :param columns: List of prediction column names.</span>
<span class="sd">        :param by: List of feature column names.</span>
<span class="sd">        :param proportion: Proportion to neutralize.</span>
<span class="sd">        :return: Neutralized predictions.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">scores</span> <span class="o">=</span> <span class="n">dataf</span><span class="p">[</span><span class="n">columns</span><span class="p">]</span>
        <span class="n">exposures</span> <span class="o">=</span> <span class="n">dataf</span><span class="p">[</span><span class="n">by</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="n">scores</span> <span class="o">=</span> <span class="n">scores</span> <span class="o">-</span> <span class="n">proportion</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_raw_exposures</span><span class="p">(</span><span class="n">exposures</span><span class="p">,</span> <span class="n">scores</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">scores</span> <span class="o">/</span> <span class="n">scores</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">normalize</span><span class="p">(</span><span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Normalize predictions.</span>
<span class="sd">        1. Rank predictions.</span>
<span class="sd">        2. Normalize ranks.</span>
<span class="sd">        3. Gaussianize ranks.</span>
<span class="sd">        :param dataf: DataFrame with predictions.</span>
<span class="sd">        :return: Gaussianized rank predictions.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">normalized_ranks</span> <span class="o">=</span> <span class="p">(</span><span class="n">dataf</span><span class="o">.</span><span class="n">rank</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;first&quot;</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">dataf</span><span class="p">)</span>
        <span class="c1"># Gaussianized ranks</span>
        <span class="k">return</span> <span class="n">sp</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">normalized_ranks</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">normalize_and_neutralize</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">columns</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">by</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">proportion</span><span class="p">:</span> <span class="nb">float</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        Gaussianize predictions and neutralize with one combination of prediction and proportion. </span>
<span class="sd">        :param dataf: DataFrame with features and predictions.</span>
<span class="sd">        :param columns: List of prediction column names.</span>
<span class="sd">        :param by: List of feature column names.</span>
<span class="sd">        :param proportion: Proportion to neutralize.</span>
<span class="sd">        :return: Neutralized predictions DataFrame.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dataf</span><span class="p">[</span><span class="n">columns</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="n">dataf</span><span class="p">[</span><span class="n">columns</span><span class="p">])</span>
        <span class="n">dataf</span><span class="p">[</span><span class="n">columns</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">neutralize</span><span class="p">(</span><span class="n">dataf</span><span class="p">,</span> <span class="n">columns</span><span class="p">,</span> <span class="n">by</span><span class="p">,</span> <span class="n">proportion</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">dataf</span><span class="p">[</span><span class="n">columns</span><span class="p">]</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_get_raw_exposures</span><span class="p">(</span><span class="n">exposures</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">scores</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        Get raw feature exposures.</span>
<span class="sd">        Make sure predictions are normalized!</span>
<span class="sd">        :param exposures: Exposures for each era. </span>
<span class="sd">        :param scores: DataFrame with predictions.</span>
<span class="sd">        :return: Raw exposures for each era.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">exposures</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">pinv</span><span class="p">(</span><span class="n">exposures</span><span class="p">)</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">scores</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">



<h3 id="numerblox.neutralizers.FeatureNeutralizer.neutralize" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">neutralize</span><span class="p">(</span><span class="n">dataf</span><span class="p">,</span> <span class="n">columns</span><span class="p">,</span> <span class="n">by</span><span class="p">,</span> <span class="n">proportion</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Neutralize on CPU. 
:param dataf: DataFrame with features and predictions.
:param columns: List of prediction column names.
:param by: List of feature column names.
:param proportion: Proportion to neutralize.
:return: Neutralized predictions.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/neutralizers.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">neutralize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">columns</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">by</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">proportion</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">    Neutralize on CPU. </span>
<span class="sd">    :param dataf: DataFrame with features and predictions.</span>
<span class="sd">    :param columns: List of prediction column names.</span>
<span class="sd">    :param by: List of feature column names.</span>
<span class="sd">    :param proportion: Proportion to neutralize.</span>
<span class="sd">    :return: Neutralized predictions.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">scores</span> <span class="o">=</span> <span class="n">dataf</span><span class="p">[</span><span class="n">columns</span><span class="p">]</span>
    <span class="n">exposures</span> <span class="o">=</span> <span class="n">dataf</span><span class="p">[</span><span class="n">by</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="n">scores</span> <span class="o">=</span> <span class="n">scores</span> <span class="o">-</span> <span class="n">proportion</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_raw_exposures</span><span class="p">(</span><span class="n">exposures</span><span class="p">,</span> <span class="n">scores</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">scores</span> <span class="o">/</span> <span class="n">scores</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="numerblox.neutralizers.FeatureNeutralizer.normalize" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">normalize</span><span class="p">(</span><span class="n">dataf</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Normalize predictions.
1. Rank predictions.
2. Normalize ranks.
3. Gaussianize ranks.
:param dataf: DataFrame with predictions.
:return: Gaussianized rank predictions.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/neutralizers.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">normalize</span><span class="p">(</span><span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Normalize predictions.</span>
<span class="sd">    1. Rank predictions.</span>
<span class="sd">    2. Normalize ranks.</span>
<span class="sd">    3. Gaussianize ranks.</span>
<span class="sd">    :param dataf: DataFrame with predictions.</span>
<span class="sd">    :return: Gaussianized rank predictions.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">normalized_ranks</span> <span class="o">=</span> <span class="p">(</span><span class="n">dataf</span><span class="o">.</span><span class="n">rank</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;first&quot;</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">dataf</span><span class="p">)</span>
    <span class="c1"># Gaussianized ranks</span>
    <span class="k">return</span> <span class="n">sp</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">normalized_ranks</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="numerblox.neutralizers.FeatureNeutralizer.normalize_and_neutralize" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">normalize_and_neutralize</span><span class="p">(</span><span class="n">dataf</span><span class="p">,</span> <span class="n">columns</span><span class="p">,</span> <span class="n">by</span><span class="p">,</span> <span class="n">proportion</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Gaussianize predictions and neutralize with one combination of prediction and proportion. 
:param dataf: DataFrame with features and predictions.
:param columns: List of prediction column names.
:param by: List of feature column names.
:param proportion: Proportion to neutralize.
:return: Neutralized predictions DataFrame.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/neutralizers.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">normalize_and_neutralize</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">columns</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">by</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">proportion</span><span class="p">:</span> <span class="nb">float</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">    Gaussianize predictions and neutralize with one combination of prediction and proportion. </span>
<span class="sd">    :param dataf: DataFrame with features and predictions.</span>
<span class="sd">    :param columns: List of prediction column names.</span>
<span class="sd">    :param by: List of feature column names.</span>
<span class="sd">    :param proportion: Proportion to neutralize.</span>
<span class="sd">    :return: Neutralized predictions DataFrame.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dataf</span><span class="p">[</span><span class="n">columns</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="n">dataf</span><span class="p">[</span><span class="n">columns</span><span class="p">])</span>
    <span class="n">dataf</span><span class="p">[</span><span class="n">columns</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">neutralize</span><span class="p">(</span><span class="n">dataf</span><span class="p">,</span> <span class="n">columns</span><span class="p">,</span> <span class="n">by</span><span class="p">,</span> <span class="n">proportion</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">dataf</span><span class="p">[</span><span class="n">columns</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="numerblox.neutralizers.FeatureNeutralizer.transform" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">features</span><span class="p">,</span> <span class="n">eras</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Main transform function.
:param X: Input predictions to neutralize. </p>
<p>:param features: DataFrame with features for neutralization. </p>
<p>:param eras: Series with era labels for each row in features. </p>
<p>Features, eras and the prediction column must all have the same length.
:return: Neutralized predictions NumPy array.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/neutralizers.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">],</span> 
              <span class="n">features</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">eras</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Main transform function.</span>
<span class="sd">    :param X: Input predictions to neutralize. \n</span>
<span class="sd">    :param features: DataFrame with features for neutralization. \n</span>
<span class="sd">    :param eras: Series with era labels for each row in features. \n</span>
<span class="sd">    Features, eras and the prediction column must all have the same length.</span>
<span class="sd">    :return: Neutralized predictions NumPy array.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">features</span><span class="p">),</span> <span class="s2">&quot;Input predictions must have same length as features.&quot;</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">eras</span><span class="p">),</span> <span class="s2">&quot;Input predictions must have same length as eras.&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">features</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="c1"># Ensure X is a 2D array and has the same number of columns as pred_name</span>
    <span class="k">if</span> <span class="n">X</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pred_name</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Only one prediction column found. Please input a 2D array or define one column for &#39;pred_name&#39;.&quot;</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pred_name</span><span class="p">)</span> <span class="o">==</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;Number of prediction columns given in X does not match &#39;pred_name&#39;.&quot;</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">pred_name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pred_name</span><span class="p">):</span>
        <span class="n">df</span><span class="p">[</span><span class="n">pred_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;era&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">eras</span>

    <span class="n">feature_cols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">features</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
    <span class="n">tasks</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">delayed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_process_pred_name</span><span class="p">)(</span><span class="n">df</span><span class="p">,</span> <span class="n">pred_name</span><span class="p">,</span> <span class="n">proportion</span><span class="p">,</span> <span class="n">feature_cols</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">pred_name</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pred_name</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Processing feature neutralizations&quot;</span><span class="p">)</span> 
        <span class="k">for</span> <span class="n">proportion</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">proportion</span>
    <span class="p">]</span>
    <span class="n">neutralized_results</span> <span class="o">=</span> <span class="n">Parallel</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">num_cores</span><span class="p">)(</span><span class="n">tasks</span><span class="p">)</span>
    <span class="n">neutralized_preds</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">neutralized_results</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">neutralized_preds</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>


</div>




  </div>

  </div>

</div><hr />


<div class="doc doc-object doc-module">



<a id="numerblox.penalizers"></a>
  <div class="doc doc-contents first">

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="numerblox.penalizers.BasePenalizer" class="doc doc-heading">
          <code>BasePenalizer</code>


</h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><span title="sklearn.base.BaseEstimator">BaseEstimator</span></code>, <code><span title="sklearn.base.TransformerMixin">TransformerMixin</span></code></p>

  
      <p>Base class for penalization so it is compatible with scikit-learn.
:param new_col_name: Name of new neutralized column.</p>

            <details class="quote">
              <summary>Source code in <code>numerblox/penalizers.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">BasePenalizer</span><span class="p">(</span><span class="n">BaseEstimator</span><span class="p">,</span> <span class="n">TransformerMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Base class for penalization so it is compatible with scikit-learn.</span>
<span class="sd">    :param new_col_name: Name of new neutralized column.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_col_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">new_col_name</span> <span class="o">=</span> <span class="n">new_col_name</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">],</span> 
        <span class="n">features</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">eras</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
        <span class="o">...</span>

    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">features</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">eras</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Convenience function for scikit-learn compatibility. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="n">features</span><span class="p">,</span> <span class="n">eras</span><span class="o">=</span><span class="n">eras</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">fit_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">features</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">eras</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        Convenience function for scikit-learn compatibility.</span>
<span class="sd">        Needed because fit and transform except different arguments here.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="n">features</span><span class="p">,</span> <span class="n">eras</span><span class="o">=</span><span class="n">eras</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">],</span>
        <span class="n">features</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">eras</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="n">features</span><span class="p">,</span> <span class="n">eras</span><span class="o">=</span><span class="n">eras</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_feature_names_out</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_features</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        Get feature names for neutralized output.</span>

<span class="sd">        :param input_features: Optional list of input feature names.</span>
<span class="sd">        :return: List of feature names for neutralized output.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">input_features</span> <span class="k">if</span> <span class="n">input_features</span> <span class="k">else</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">new_col_name</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">



<h3 id="numerblox.penalizers.BasePenalizer.fit_transform" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">features</span><span class="p">,</span> <span class="n">eras</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Convenience function for scikit-learn compatibility.
Needed because fit and transform except different arguments here.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/penalizers.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">fit_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">features</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">eras</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">    Convenience function for scikit-learn compatibility.</span>
<span class="sd">    Needed because fit and transform except different arguments here.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="n">features</span><span class="p">,</span> <span class="n">eras</span><span class="o">=</span><span class="n">eras</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="numerblox.penalizers.BasePenalizer.get_feature_names_out" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_feature_names_out</span><span class="p">(</span><span class="n">input_features</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Get feature names for neutralized output.</p>
<p>:param input_features: Optional list of input feature names.
:return: List of feature names for neutralized output.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/penalizers.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_feature_names_out</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_features</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">    Get feature names for neutralized output.</span>

<span class="sd">    :param input_features: Optional list of input feature names.</span>
<span class="sd">    :return: List of feature names for neutralized output.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">input_features</span> <span class="k">if</span> <span class="n">input_features</span> <span class="k">else</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">new_col_name</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="numerblox.penalizers.BasePenalizer.predict" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">features</span><span class="p">,</span> <span class="n">eras</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Convenience function for scikit-learn compatibility.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/penalizers.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">features</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">eras</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Convenience function for scikit-learn compatibility. &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="n">features</span><span class="p">,</span> <span class="n">eras</span><span class="o">=</span><span class="n">eras</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>


</div>

<div class="doc doc-object doc-class">



<h2 id="numerblox.penalizers.FeaturePenalizer" class="doc doc-heading">
          <code>FeaturePenalizer</code>


</h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="numerblox.penalizers.BasePenalizer" href="#numerblox.penalizers.BasePenalizer">BasePenalizer</a></code></p>

  
      <p>Feature penalization with TensorFlow.</p>
<p>Source (by jrb): https://github.com/jonrtaylor/twitch/blob/master/FE_Clipping_Script.ipynb</p>
<p>Source of first PyTorch implementation (by Michael Oliver / mdo): https://forum.numer.ai/t/model-diagnostics-feature-exposure/899/12</p>
<p>:param max_exposure: Number in range [0...1] indicating how much to reduce max feature exposure to.
:param pred_name: Prediction column name. Used for new column name. </p>
<p>:param suffix: Optional suffix that is added to new column name.</p>

            <details class="quote">
              <summary>Source code in <code>numerblox/penalizers.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">FeaturePenalizer</span><span class="p">(</span><span class="n">BasePenalizer</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Feature penalization with TensorFlow.</span>

<span class="sd">    Source (by jrb): https://github.com/jonrtaylor/twitch/blob/master/FE_Clipping_Script.ipynb</span>

<span class="sd">    Source of first PyTorch implementation (by Michael Oliver / mdo): https://forum.numer.ai/t/model-diagnostics-feature-exposure/899/12</span>

<span class="sd">    :param max_exposure: Number in range [0...1] indicating how much to reduce max feature exposure to.</span>
<span class="sd">    :param pred_name: Prediction column name. Used for new column name. \n</span>
<span class="sd">    :param suffix: Optional suffix that is added to new column name.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">max_exposure</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">pred_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;prediction&quot;</span><span class="p">,</span>
        <span class="n">suffix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_exposure</span> <span class="o">=</span> <span class="n">max_exposure</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pred_name</span> <span class="o">=</span> <span class="n">pred_name</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="mf">0.0</span> <span class="o">&lt;=</span> <span class="n">max_exposure</span> <span class="o">&lt;=</span> <span class="mf">1.0</span>
        <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;&#39;max_exposure&#39; should be a float in range [0...1]. Got &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">max_exposure</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
        <span class="n">new_col_name</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">pred_name</span><span class="si">}</span><span class="s2">_penalized_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">max_exposure</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">suffix</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">if</span> <span class="n">suffix</span>
            <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">pred_name</span><span class="si">}</span><span class="s2">_penalized_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">max_exposure</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">new_col_name</span><span class="o">=</span><span class="n">new_col_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">suffix</span> <span class="o">=</span> <span class="n">suffix</span>

    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">features</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">eras</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Main transform method.</span>
<span class="sd">        :param X: Input predictions to neutralize. </span>
<span class="sd">        :param features: DataFrame with features for neutralization. </span>
<span class="sd">        :param eras: Series with era labels for each row in features. </span>
<span class="sd">        Features, eras and the prediction column must all have the same length.</span>
<span class="sd">        :return: Penalized predictions.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">features</span><span class="p">),</span> <span class="s2">&quot;Input predictions must have same length as features.&quot;</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">eras</span><span class="p">),</span> <span class="s2">&quot;Input predictions must have same length as eras.&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">features</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;prediction&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span>
        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;era&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">eras</span>
        <span class="n">penalized_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reduce_all_exposures</span><span class="p">(</span>
            <span class="n">dataf</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pred_name</span><span class="p">,</span> <span class="n">neutralizers</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">features</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">penalized_data</span>

    <span class="k">def</span> <span class="nf">_reduce_all_exposures</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">column</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;prediction&quot;</span><span class="p">,</span>
        <span class="n">neutralizers</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">gaussianize</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="n">neutralized</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">era</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">dataf</span><span class="p">[</span><span class="s2">&quot;era&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()):</span>
            <span class="n">dataf_era</span> <span class="o">=</span> <span class="n">dataf</span><span class="p">[</span><span class="n">dataf</span><span class="p">[</span><span class="s2">&quot;era&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">era</span><span class="p">]</span>
            <span class="n">scores</span> <span class="o">=</span> <span class="n">dataf_era</span><span class="p">[[</span><span class="n">column</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span>
            <span class="n">exposure_values</span> <span class="o">=</span> <span class="n">dataf_era</span><span class="p">[</span><span class="n">neutralizers</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

            <span class="k">if</span> <span class="n">normalize</span><span class="p">:</span>
                <span class="n">scores2</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">scores</span><span class="o">.</span><span class="n">T</span><span class="p">:</span>
                    <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">rankdata</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;ordinal&quot;</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">gaussianize</span><span class="p">:</span>
                        <span class="n">x</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
                    <span class="n">scores2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
                <span class="n">scores</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">scores2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

            <span class="n">scores</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reduce_exposure</span><span class="p">(</span>
                <span class="n">scores</span><span class="p">,</span> <span class="n">exposure_values</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">neutralizers</span><span class="p">),</span> <span class="kc">None</span>
            <span class="p">)</span>

            <span class="n">scores</span> <span class="o">/=</span> <span class="n">tf</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">reduce_std</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span>
            <span class="n">scores</span> <span class="o">-=</span> <span class="n">tf</span><span class="o">.</span><span class="n">reduce_min</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span>
            <span class="n">scores</span> <span class="o">/=</span> <span class="n">tf</span><span class="o">.</span><span class="n">reduce_max</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span>
            <span class="n">neutralized</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scores</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span>

        <span class="n">predictions</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">neutralized</span><span class="p">),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="n">column</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="n">dataf</span><span class="o">.</span><span class="n">index</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">predictions</span>

    <span class="k">def</span> <span class="nf">_reduce_exposure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prediction</span><span class="p">,</span> <span class="n">features</span><span class="p">,</span> <span class="n">input_size</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Input</span><span class="p">(</span><span class="n">input_size</span><span class="p">),</span>
                <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">experimental</span><span class="o">.</span><span class="n">LinearModel</span><span class="p">(</span><span class="n">use_bias</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
            <span class="p">]</span>
        <span class="p">)</span>
        <span class="n">feats</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">features</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="n">pred</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">prediction</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">weights</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">optimizer</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">optimizers</span><span class="o">.</span><span class="n">Adamax</span><span class="p">()</span>
            <span class="n">start_exp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__exposures</span><span class="p">(</span><span class="n">feats</span><span class="p">,</span> <span class="n">pred</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">])</span>
            <span class="n">target_exps</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">clip_by_value</span><span class="p">(</span>
                <span class="n">start_exp</span><span class="p">,</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">max_exposure</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_exposure</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_train_loop</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">optimizer</span><span class="p">,</span> <span class="n">feats</span><span class="p">,</span> <span class="n">pred</span><span class="p">,</span> <span class="n">target_exps</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">model</span><span class="o">.</span><span class="n">set_weights</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pred</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">-</span> <span class="n">model</span><span class="p">(</span><span class="n">feats</span><span class="p">),</span> <span class="n">model</span><span class="o">.</span><span class="n">get_weights</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_train_loop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">optimizer</span><span class="p">,</span> <span class="n">feats</span><span class="p">,</span> <span class="n">pred</span><span class="p">,</span> <span class="n">target_exps</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000000</span><span class="p">):</span>
            <span class="n">loss</span><span class="p">,</span> <span class="n">grads</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__train_loop_body</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">feats</span><span class="p">,</span> <span class="n">pred</span><span class="p">,</span> <span class="n">target_exps</span><span class="p">)</span>
            <span class="n">optimizer</span><span class="o">.</span><span class="n">apply_gradients</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">grads</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">trainable_variables</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">loss</span> <span class="o">&lt;</span> <span class="mf">1e-7</span><span class="p">:</span>
                <span class="k">break</span>

    <span class="nd">@tf</span><span class="o">.</span><span class="n">function</span><span class="p">(</span><span class="n">experimental_relax_shapes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">__train_loop_body</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">feats</span><span class="p">,</span> <span class="n">pred</span><span class="p">,</span> <span class="n">target_exps</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">tf</span><span class="o">.</span><span class="n">GradientTape</span><span class="p">()</span> <span class="k">as</span> <span class="n">tape</span><span class="p">:</span>
            <span class="n">exps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__exposures</span><span class="p">(</span><span class="n">feats</span><span class="p">,</span> <span class="n">pred</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">-</span> <span class="n">model</span><span class="p">(</span><span class="n">feats</span><span class="p">,</span> <span class="n">training</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
            <span class="n">loss</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">reduce_sum</span><span class="p">(</span>
                <span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span><span class="n">exps</span><span class="p">)</span> <span class="o">-</span> <span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span><span class="n">target_exps</span><span class="p">))</span>
                <span class="o">+</span> <span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span><span class="o">-</span><span class="n">exps</span><span class="p">)</span> <span class="o">-</span> <span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span><span class="o">-</span><span class="n">target_exps</span><span class="p">))</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">loss</span><span class="p">,</span> <span class="n">tape</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="n">loss</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">trainable_variables</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="nd">@tf</span><span class="o">.</span><span class="n">function</span><span class="p">(</span><span class="n">experimental_relax_shapes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">experimental_compile</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">__exposures</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="n">tf</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">reduce_mean</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">/</span> <span class="n">tf</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">y</span> <span class="o">-</span> <span class="n">tf</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">reduce_mean</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">y</span> <span class="o">/</span> <span class="n">tf</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">tf</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">transpose_a</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">



<h3 id="numerblox.penalizers.FeaturePenalizer.transform" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">features</span><span class="p">,</span> <span class="n">eras</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Main transform method.
:param X: Input predictions to neutralize. 
:param features: DataFrame with features for neutralization. 
:param eras: Series with era labels for each row in features. 
Features, eras and the prediction column must all have the same length.
:return: Penalized predictions.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/penalizers.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">features</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">eras</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Main transform method.</span>
<span class="sd">    :param X: Input predictions to neutralize. </span>
<span class="sd">    :param features: DataFrame with features for neutralization. </span>
<span class="sd">    :param eras: Series with era labels for each row in features. </span>
<span class="sd">    Features, eras and the prediction column must all have the same length.</span>
<span class="sd">    :return: Penalized predictions.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">features</span><span class="p">),</span> <span class="s2">&quot;Input predictions must have same length as features.&quot;</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">eras</span><span class="p">),</span> <span class="s2">&quot;Input predictions must have same length as eras.&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">features</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;prediction&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;era&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">eras</span>
    <span class="n">penalized_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reduce_all_exposures</span><span class="p">(</span>
        <span class="n">dataf</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pred_name</span><span class="p">,</span> <span class="n">neutralizers</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">features</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">penalized_data</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>


</div>




  </div>

  </div>

</div><hr />


<div class="doc doc-object doc-module">



<a id="numerblox.prediction_loaders"></a>
  <div class="doc doc-contents first">

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="numerblox.prediction_loaders.BasePredictionLoader" class="doc doc-heading">
          <code>BasePredictionLoader</code>


</h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><span title="sklearn.base.BaseEstimator">BaseEstimator</span></code>, <code><span title="sklearn.base.TransformerMixin">TransformerMixin</span></code></p>

  
      <p>Shared functionality for all Prediction Loaders.</p>

            <details class="quote">
              <summary>Source code in <code>numerblox/prediction_loaders.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">BasePredictionLoader</span><span class="p">(</span><span class="n">BaseEstimator</span><span class="p">,</span> <span class="n">TransformerMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Shared functionality for all Prediction Loaders. &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="o">...</span>

    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Return Predictions generated by model. &quot;&quot;&quot;</span>
        <span class="o">...</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">get_feature_names_out</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_features</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Return feature names. &quot;&quot;&quot;</span>
        <span class="o">...</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">



<h3 id="numerblox.prediction_loaders.BasePredictionLoader.get_feature_names_out" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_feature_names_out</span><span class="p">(</span><span class="n">input_features</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Return feature names.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/prediction_loaders.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="k">def</span> <span class="nf">get_feature_names_out</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_features</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Return feature names. &quot;&quot;&quot;</span>
    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="numerblox.prediction_loaders.BasePredictionLoader.transform" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Return Predictions generated by model.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/prediction_loaders.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Return Predictions generated by model. &quot;&quot;&quot;</span>
    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>


</div>

<div class="doc doc-object doc-class">



<h2 id="numerblox.prediction_loaders.ExamplePredictions" class="doc doc-heading">
          <code>ExamplePredictions</code>


</h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="numerblox.prediction_loaders.BasePredictionLoader" href="#numerblox.prediction_loaders.BasePredictionLoader">BasePredictionLoader</a></code></p>

  
      <p>Load example predictions.
:param file_name: File to download from NumerAPI.
By default this is example predictions for v4.2 data.
'v4.2/live_example_preds.parquet' by default. 
Example predictions in previous versions:
- v4.2. validation examples -&gt; "v4.2/validation_example_preds.parquet"
- v4.2. live benchmark models -&gt; "v4.2/live_benchmark_models.parquet"
- v4.2. validation benchmark models -&gt; "v4.2/validation_benchmark_models.parquet"
:param round_num: Optional round number. Downloads most recent round by default.
:param keep_files: Whether to keep downloaded files.
By default, files are deleted after the predictions are loaded.</p>

            <details class="quote">
              <summary>Source code in <code>numerblox/prediction_loaders.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">ExamplePredictions</span><span class="p">(</span><span class="n">BasePredictionLoader</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Load example predictions.</span>
<span class="sd">    :param file_name: File to download from NumerAPI.</span>
<span class="sd">    By default this is example predictions for v4.2 data.</span>
<span class="sd">    &#39;v4.2/live_example_preds.parquet&#39; by default. </span>
<span class="sd">    Example predictions in previous versions:</span>
<span class="sd">    - v4.2. validation examples -&gt; &quot;v4.2/validation_example_preds.parquet&quot;</span>
<span class="sd">    - v4.2. live benchmark models -&gt; &quot;v4.2/live_benchmark_models.parquet&quot;</span>
<span class="sd">    - v4.2. validation benchmark models -&gt; &quot;v4.2/validation_benchmark_models.parquet&quot;</span>
<span class="sd">    :param round_num: Optional round number. Downloads most recent round by default.</span>
<span class="sd">    :param keep_files: Whether to keep downloaded files.</span>
<span class="sd">    By default, files are deleted after the predictions are loaded.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;v4.2/live_example_preds.parquet&quot;</span><span class="p">,</span>
                 <span class="n">round_num</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">keep_files</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_name</span> <span class="o">=</span> <span class="n">file_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">round_num</span> <span class="o">=</span> <span class="n">round_num</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keep_files</span> <span class="o">=</span> <span class="n">keep_files</span>

    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Return example predictions. &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_download_example_preds</span><span class="p">()</span>
        <span class="n">example_preds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_example_preds</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">keep_files</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">downloader</span><span class="o">.</span><span class="n">remove_base_directory</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">example_preds</span>

    <span class="k">def</span> <span class="nf">_download_example_preds</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">data_directory</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;example_predictions_loader_</span><span class="si">{</span><span class="n">uuid4</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">downloader</span> <span class="o">=</span> <span class="n">NumeraiClassicDownloader</span><span class="p">(</span><span class="n">directory_path</span><span class="o">=</span><span class="n">data_directory</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dest_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">downloader</span><span class="o">.</span><span class="n">dir</span><span class="p">)</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">file_name</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">downloader</span><span class="o">.</span><span class="n">download_single_dataset</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">file_name</span><span class="p">,</span>
                                                <span class="n">dest_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dest_path</span><span class="p">,</span>
                                                <span class="n">round_num</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">round_num</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_load_example_preds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dest_path</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_feature_names_out</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_features</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_name</span><span class="p">)</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">as_posix</span><span class="p">()]</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">input_features</span> <span class="k">else</span> <span class="n">input_features</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">



<h3 id="numerblox.prediction_loaders.ExamplePredictions.transform" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Return example predictions.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/prediction_loaders.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Return example predictions. &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_download_example_preds</span><span class="p">()</span>
    <span class="n">example_preds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_example_preds</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">keep_files</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">downloader</span><span class="o">.</span><span class="n">remove_base_directory</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">example_preds</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>


</div>




  </div>

  </div>

</div><hr />


<div class="doc doc-object doc-module">



<a id="numerblox.evaluation"></a>
  <div class="doc doc-contents first">

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="numerblox.evaluation.BaseEvaluator" class="doc doc-heading">
          <code>BaseEvaluator</code>


</h2>


  <div class="doc doc-contents ">

  
      <p>Evaluation functionality that is relevant for both
Numerai Classic and Numerai Signals.</p>
<p>Metrics include:
- Mean, Standard Deviation and Sharpe (Corrv2) for era returns.
- Max drawdown.
- Annual Percentage Yield (APY).
- Correlation with benchmark predictions.
- Max feature exposure: https://forum.numer.ai/t/model-diagnostics-feature-exposure/899.
- Feature Neutral Mean, Standard deviation and Sharpe: https://docs.numer.ai/tournament/feature-neutral-correlation.
- Smart Sharpe
- Exposure Dissimilarity: https://forum.numer.ai/t/true-contribution-details/5128/4.
- Autocorrelation (1st order).
- Calmar Ratio.
- Performance vs. Benchmark predictions.
- Mean, Standard Deviation and Sharpe for TB200 (Buy top 200 stocks and sell bottom 200 stocks).
- Mean, Standard Deviation and Sharpe for TB500 (Buy top 500 stocks and sell bottom 500 stocks).</p>
<p>:param metrics_list: List of metrics to calculate. Default: FAST_METRICS.
:param era_col: Column name pointing to eras. Most commonly "era" for Numerai Classic and "date" for Numerai Signals.
:param custom_functions: Additional functions called in evaluation.
Check out the NumerBlox docs on evaluation for more info on using custom functions.
:param show_detailed_progress_bar: Show detailed progress bar for evaluation of each prediction column.</p>
<p>Note that we calculate the sample standard deviation with ddof=0.
It may differ slightly from the standard Pandas calculation, but
is consistent with how NumPy computes standard deviation.
More info:
https://stackoverflow.com/questions/24984178/different-std-in-pandas-vs-numpy</p>

            <details class="quote">
              <summary>Source code in <code>numerblox/evaluation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span>
<span class="normal">907</span>
<span class="normal">908</span>
<span class="normal">909</span>
<span class="normal">910</span>
<span class="normal">911</span>
<span class="normal">912</span>
<span class="normal">913</span>
<span class="normal">914</span>
<span class="normal">915</span>
<span class="normal">916</span>
<span class="normal">917</span>
<span class="normal">918</span>
<span class="normal">919</span>
<span class="normal">920</span>
<span class="normal">921</span>
<span class="normal">922</span>
<span class="normal">923</span>
<span class="normal">924</span>
<span class="normal">925</span>
<span class="normal">926</span>
<span class="normal">927</span>
<span class="normal">928</span>
<span class="normal">929</span>
<span class="normal">930</span>
<span class="normal">931</span>
<span class="normal">932</span>
<span class="normal">933</span>
<span class="normal">934</span>
<span class="normal">935</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">BaseEvaluator</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Evaluation functionality that is relevant for both</span>
<span class="sd">    Numerai Classic and Numerai Signals.</span>

<span class="sd">    Metrics include:</span>
<span class="sd">    - Mean, Standard Deviation and Sharpe (Corrv2) for era returns.</span>
<span class="sd">    - Max drawdown.</span>
<span class="sd">    - Annual Percentage Yield (APY).</span>
<span class="sd">    - Correlation with benchmark predictions.</span>
<span class="sd">    - Max feature exposure: https://forum.numer.ai/t/model-diagnostics-feature-exposure/899.</span>
<span class="sd">    - Feature Neutral Mean, Standard deviation and Sharpe: https://docs.numer.ai/tournament/feature-neutral-correlation.</span>
<span class="sd">    - Smart Sharpe</span>
<span class="sd">    - Exposure Dissimilarity: https://forum.numer.ai/t/true-contribution-details/5128/4.</span>
<span class="sd">    - Autocorrelation (1st order).</span>
<span class="sd">    - Calmar Ratio.</span>
<span class="sd">    - Performance vs. Benchmark predictions.</span>
<span class="sd">    - Mean, Standard Deviation and Sharpe for TB200 (Buy top 200 stocks and sell bottom 200 stocks).</span>
<span class="sd">    - Mean, Standard Deviation and Sharpe for TB500 (Buy top 500 stocks and sell bottom 500 stocks).</span>

<span class="sd">    :param metrics_list: List of metrics to calculate. Default: FAST_METRICS.</span>
<span class="sd">    :param era_col: Column name pointing to eras. Most commonly &quot;era&quot; for Numerai Classic and &quot;date&quot; for Numerai Signals.</span>
<span class="sd">    :param custom_functions: Additional functions called in evaluation.</span>
<span class="sd">    Check out the NumerBlox docs on evaluation for more info on using custom functions.</span>
<span class="sd">    :param show_detailed_progress_bar: Show detailed progress bar for evaluation of each prediction column.</span>

<span class="sd">    Note that we calculate the sample standard deviation with ddof=0.</span>
<span class="sd">    It may differ slightly from the standard Pandas calculation, but</span>
<span class="sd">    is consistent with how NumPy computes standard deviation.</span>
<span class="sd">    More info:</span>
<span class="sd">    https://stackoverflow.com/questions/24984178/different-std-in-pandas-vs-numpy</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">metrics_list</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">era_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">custom_functions</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span>
        <span class="n">show_detailed_progress_bar</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">era_col</span> <span class="o">=</span> <span class="n">era_col</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metrics_list</span> <span class="o">=</span> <span class="n">metrics_list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">custom_functions</span> <span class="o">=</span> <span class="n">custom_functions</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">custom_functions</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_custom_functions</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show_detailed_progress_bar</span> <span class="o">=</span> <span class="n">show_detailed_progress_bar</span>

    <span class="k">def</span> <span class="nf">full_evaluation</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">pred_cols</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;target&quot;</span><span class="p">,</span>
        <span class="n">benchmark_cols</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Perform evaluation for each prediction column in pred_cols.</span>
<span class="sd">        By default only the &quot;prediction&quot; column is evaluated.</span>
<span class="sd">        Evaluation is done against given target and benchmark prediction column.</span>
<span class="sd">        :param dataf: DataFrame containing era_col, pred_cols, target_col and optional benchmark_cols.</span>
<span class="sd">        :param pred_cols: List of prediction columns to calculate evaluation metrics for.</span>
<span class="sd">        :param target_col: Target column to evaluate against.</span>
<span class="sd">        :param benchmark_cols: Optional list of benchmark columns to calculate evaluation metrics for.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">val_stats</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
        <span class="n">feature_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">dataf</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">col</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;feature&quot;</span><span class="p">)]</span>
        <span class="n">cat_cols</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">dataf</span><span class="p">[</span><span class="n">feature_cols</span><span class="p">]</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;category&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">cat_cols</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;WARNING: Categorical features detected that cannot be used for neutralization. Removing columns: &#39;</span><span class="si">{</span><span class="n">cat_cols</span><span class="si">}</span><span class="s2">&#39; for evaluation.&quot;</span>
            <span class="p">)</span>
            <span class="n">dataf</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">feature_cols</span><span class="p">]</span> <span class="o">=</span> <span class="n">dataf</span><span class="p">[</span><span class="n">feature_cols</span><span class="p">]</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span>
                <span class="n">exclude</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;category&quot;</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="n">dataf</span> <span class="o">=</span> <span class="n">dataf</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">pred_cols</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Evaluation: &quot;</span><span class="p">):</span>
            <span class="n">col_stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluation_one_col</span><span class="p">(</span>
                <span class="n">dataf</span><span class="o">=</span><span class="n">dataf</span><span class="p">,</span>
                <span class="n">pred_col</span><span class="o">=</span><span class="n">col</span><span class="p">,</span>
                <span class="n">feature_cols</span><span class="o">=</span><span class="n">feature_cols</span><span class="p">,</span>
                <span class="n">target_col</span><span class="o">=</span><span class="n">target_col</span><span class="p">,</span>
                <span class="n">benchmark_cols</span><span class="o">=</span><span class="n">benchmark_cols</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">val_stats</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">val_stats</span><span class="p">,</span> <span class="n">col_stats</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">val_stats</span>

    <span class="k">def</span> <span class="nf">evaluation_one_col</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">feature_cols</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
        <span class="n">pred_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">benchmark_cols</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Perform evaluation for one prediction column</span>
<span class="sd">        against given target and benchmark column(s).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">era_col</span> <span class="ow">in</span> <span class="n">dataf</span><span class="o">.</span><span class="n">columns</span>
        <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Era column &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">era_col</span><span class="si">}</span><span class="s2">&#39; not found in DataFrame. Make sure to set the correct era_col.&quot;</span>
        <span class="k">assert</span> <span class="p">(</span>
                <span class="n">pred_col</span> <span class="ow">in</span> <span class="n">dataf</span><span class="o">.</span><span class="n">columns</span>
            <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Prediction column &#39;</span><span class="si">{</span><span class="n">pred_col</span><span class="si">}</span><span class="s2">&#39; not found in DataFrame. Make sure to set the correct pred_col.&quot;</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="n">target_col</span> <span class="ow">in</span> <span class="n">dataf</span><span class="o">.</span><span class="n">columns</span>
        <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Target column &#39;</span><span class="si">{</span><span class="n">target_col</span><span class="si">}</span><span class="s2">&#39; not found in DataFrame. Make sure to set the correct target_col.&quot;</span>
        <span class="k">if</span> <span class="n">benchmark_cols</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">benchmark_cols</span><span class="p">:</span>
                <span class="k">assert</span> <span class="p">(</span>
                    <span class="n">col</span> <span class="ow">in</span> <span class="n">dataf</span><span class="o">.</span><span class="n">columns</span>
                <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Benchmark column &#39;</span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s2">&#39; not found in DataFrame. Make sure to set the correct benchmark_cols.&quot;</span>

        <span class="c1"># Check that all values are between 0 and 1</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="n">dataf</span><span class="p">[</span><span class="n">pred_col</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">dataf</span><span class="p">[</span><span class="n">pred_col</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="mi">1</span>
        <span class="p">),</span> <span class="s2">&quot;All predictions should be between 0 and 1 (inclusive).&quot;</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="n">dataf</span><span class="p">[</span><span class="n">target_col</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">dataf</span><span class="p">[</span><span class="n">target_col</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="mi">1</span>
        <span class="p">),</span> <span class="s2">&quot;All targets should be between 0 and 1 (inclusive).&quot;</span>
        <span class="k">if</span> <span class="n">benchmark_cols</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">benchmark_cols</span><span class="p">:</span>
                <span class="k">assert</span> <span class="p">(</span>
                    <span class="n">dataf</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">dataf</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="mi">1</span>
                <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;All predictions for &#39;</span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s2">&#39; should be between 0 and 1 (inclusive).&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_detailed_progress_bar</span><span class="p">:</span>
            <span class="n">len_metrics_list</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metrics_list</span><span class="p">)</span>
            <span class="n">len_benchmark_cols</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">benchmark_cols</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="nb">len</span><span class="p">(</span><span class="n">benchmark_cols</span><span class="p">)</span>
            <span class="n">len_custom_functions</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">custom_functions</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">custom_functions</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
            <span class="n">len_pbar</span> <span class="o">=</span> <span class="n">len_metrics_list</span> <span class="o">+</span> <span class="n">len_benchmark_cols</span> <span class="o">+</span> <span class="n">len_custom_functions</span>
            <span class="n">pbar</span> <span class="o">=</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">total</span><span class="o">=</span><span class="n">len_pbar</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Evaluation&quot;</span><span class="p">)</span>

        <span class="n">col_stats</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">col_stats</span><span class="p">[</span><span class="s2">&quot;target&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">target_col</span>

        <span class="c1"># Compute stats per era (only if needed)</span>
        <span class="n">per_era_numerai_corrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">per_era_numerai_corrs</span><span class="p">(</span>
            <span class="n">dataf</span><span class="o">=</span><span class="n">dataf</span><span class="p">,</span> <span class="n">pred_col</span><span class="o">=</span><span class="n">pred_col</span><span class="p">,</span> <span class="n">target_col</span><span class="o">=</span><span class="n">target_col</span>
        <span class="p">)</span>

        <span class="c1"># check if mean, std, or sharpe are in metrics_list</span>
        <span class="k">if</span> <span class="s2">&quot;mean_std_sharpe&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metrics_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_detailed_progress_bar</span><span class="p">:</span>
                <span class="n">pbar</span><span class="o">.</span><span class="n">set_description_str</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;mean_std_sharpe for evaluation&quot;</span><span class="p">)</span>
                <span class="n">pbar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">mean</span><span class="p">,</span> <span class="n">std</span><span class="p">,</span> <span class="n">sharpe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean_std_sharpe</span><span class="p">(</span><span class="n">era_corrs</span><span class="o">=</span><span class="n">per_era_numerai_corrs</span><span class="p">)</span>
            <span class="n">col_stats</span><span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean</span>
            <span class="n">col_stats</span><span class="p">[</span><span class="s2">&quot;std&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">std</span>
            <span class="n">col_stats</span><span class="p">[</span><span class="s2">&quot;sharpe&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sharpe</span>

        <span class="k">if</span> <span class="s2">&quot;legacy_mean_std_sharpe&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metrics_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_detailed_progress_bar</span><span class="p">:</span>
                <span class="n">pbar</span><span class="o">.</span><span class="n">set_description_str</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;legacy_mean_std_sharpe for evaluation&quot;</span><span class="p">)</span>
                <span class="n">pbar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">per_era_corrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">per_era_corrs</span><span class="p">(</span>
                <span class="n">dataf</span><span class="o">=</span><span class="n">dataf</span><span class="p">,</span> <span class="n">pred_col</span><span class="o">=</span><span class="n">pred_col</span><span class="p">,</span> <span class="n">target_col</span><span class="o">=</span><span class="n">target_col</span>
            <span class="p">)</span>
            <span class="n">legacy_mean</span><span class="p">,</span> <span class="n">legacy_std</span><span class="p">,</span> <span class="n">legacy_sharpe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean_std_sharpe</span><span class="p">(</span>
                <span class="n">era_corrs</span><span class="o">=</span><span class="n">per_era_corrs</span>
            <span class="p">)</span>
            <span class="n">col_stats</span><span class="p">[</span><span class="s2">&quot;legacy_mean&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">legacy_mean</span>
            <span class="n">col_stats</span><span class="p">[</span><span class="s2">&quot;legacy_std&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">legacy_std</span>
            <span class="n">col_stats</span><span class="p">[</span><span class="s2">&quot;legacy_sharpe&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">legacy_sharpe</span>

        <span class="k">if</span> <span class="s2">&quot;max_drawdown&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metrics_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_detailed_progress_bar</span><span class="p">:</span>
                <span class="n">pbar</span><span class="o">.</span><span class="n">set_description_str</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;max_drawdown for evaluation&quot;</span><span class="p">)</span>
                <span class="n">pbar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">col_stats</span><span class="p">[</span><span class="s2">&quot;max_drawdown&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_drawdown</span><span class="p">(</span>
                <span class="n">era_corrs</span><span class="o">=</span><span class="n">per_era_numerai_corrs</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="s2">&quot;apy&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_detailed_progress_bar</span><span class="p">:</span>
                <span class="n">pbar</span><span class="o">.</span><span class="n">set_description_str</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;apy for evaluation&quot;</span><span class="p">)</span>
                <span class="n">pbar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">col_stats</span><span class="p">[</span><span class="s2">&quot;apy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apy</span><span class="p">(</span><span class="n">era_corrs</span><span class="o">=</span><span class="n">per_era_numerai_corrs</span><span class="p">)</span>

        <span class="k">if</span> <span class="s2">&quot;calmar_ratio&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metrics_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_detailed_progress_bar</span><span class="p">:</span>
                <span class="n">pbar</span><span class="o">.</span><span class="n">set_description_str</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;calmar_ratio for evaluation&quot;</span><span class="p">)</span>
                <span class="n">pbar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="s2">&quot;max_drawdown&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metrics_list</span><span class="p">:</span>
                <span class="n">col_stats</span><span class="p">[</span><span class="s2">&quot;max_drawdown&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_drawdown</span><span class="p">(</span>
                    <span class="n">era_corrs</span><span class="o">=</span><span class="n">per_era_numerai_corrs</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="s2">&quot;apy&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metrics_list</span><span class="p">:</span>
                <span class="n">col_stats</span><span class="p">[</span><span class="s2">&quot;apy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apy</span><span class="p">(</span><span class="n">era_corrs</span><span class="o">=</span><span class="n">per_era_numerai_corrs</span><span class="p">)</span>
            <span class="n">col_stats</span><span class="p">[</span><span class="s2">&quot;calmar_ratio&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                <span class="k">if</span> <span class="n">col_stats</span><span class="p">[</span><span class="s2">&quot;max_drawdown&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span>
                <span class="k">else</span> <span class="n">col_stats</span><span class="p">[</span><span class="s2">&quot;apy&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="o">-</span><span class="n">col_stats</span><span class="p">[</span><span class="s2">&quot;max_drawdown&quot;</span><span class="p">]</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="s2">&quot;autocorrelation&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metrics_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_detailed_progress_bar</span><span class="p">:</span>
                <span class="n">pbar</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;autocorrelation for evaluation&quot;</span><span class="p">)</span>
                <span class="n">pbar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">col_stats</span><span class="p">[</span><span class="s2">&quot;autocorrelation&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">autocorr1</span><span class="p">(</span><span class="n">per_era_numerai_corrs</span><span class="p">)</span>

        <span class="k">if</span> <span class="s2">&quot;max_feature_exposure&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metrics_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_detailed_progress_bar</span><span class="p">:</span>
                <span class="n">pbar</span><span class="o">.</span><span class="n">set_description_str</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;max_feature_exposure for evaluation&quot;</span><span class="p">)</span>
                <span class="n">pbar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">col_stats</span><span class="p">[</span><span class="s2">&quot;max_feature_exposure&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_feature_exposure</span><span class="p">(</span>
                <span class="n">dataf</span><span class="o">=</span><span class="n">dataf</span><span class="p">,</span> <span class="n">feature_cols</span><span class="o">=</span><span class="n">feature_cols</span><span class="p">,</span> <span class="n">pred_col</span><span class="o">=</span><span class="n">pred_col</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="s2">&quot;smart_sharpe&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metrics_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_detailed_progress_bar</span><span class="p">:</span>
                <span class="n">pbar</span><span class="o">.</span><span class="n">set_description_str</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;smart_sharpe for evaluation&quot;</span><span class="p">)</span>
                <span class="n">pbar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">col_stats</span><span class="p">[</span><span class="s2">&quot;smart_sharpe&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">smart_sharpe</span><span class="p">(</span>
                <span class="n">era_corrs</span><span class="o">=</span><span class="n">per_era_numerai_corrs</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">benchmark_cols</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">bench_col</span> <span class="ow">in</span> <span class="n">benchmark_cols</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_detailed_progress_bar</span><span class="p">:</span>
                    <span class="n">pbar</span><span class="o">.</span><span class="n">set_description_str</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Evaluation for benchmark column: &#39;</span><span class="si">{</span><span class="n">bench_col</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
                    <span class="n">pbar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

                <span class="n">per_era_bench_corrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">per_era_numerai_corrs</span><span class="p">(</span>
                    <span class="n">dataf</span><span class="o">=</span><span class="n">dataf</span><span class="p">,</span> <span class="n">pred_col</span><span class="o">=</span><span class="n">bench_col</span><span class="p">,</span> <span class="n">target_col</span><span class="o">=</span><span class="n">target_col</span>
                <span class="p">)</span>

                <span class="k">if</span> <span class="s2">&quot;mean_std_sharpe&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metrics_list</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_detailed_progress_bar</span><span class="p">:</span>
                        <span class="n">pbar</span><span class="o">.</span><span class="n">set_description_str</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;mean_std_sharpe for benchmark column: &#39;</span><span class="si">{</span><span class="n">bench_col</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
                    <span class="n">bench_mean</span><span class="p">,</span> <span class="n">bench_std</span><span class="p">,</span> <span class="n">bench_sharpe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean_std_sharpe</span><span class="p">(</span>
                        <span class="n">era_corrs</span><span class="o">=</span><span class="n">per_era_bench_corrs</span>
                    <span class="p">)</span>
                    <span class="n">col_stats</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;mean_vs_</span><span class="si">{</span><span class="n">bench_col</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean</span> <span class="o">-</span> <span class="n">bench_mean</span>
                    <span class="n">col_stats</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;std_vs_</span><span class="si">{</span><span class="n">bench_col</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">std</span> <span class="o">-</span> <span class="n">bench_std</span>
                    <span class="n">col_stats</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;sharpe_vs_</span><span class="si">{</span><span class="n">bench_col</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sharpe</span> <span class="o">-</span> <span class="n">bench_sharpe</span>

                <span class="k">if</span> <span class="s2">&quot;mc_mean_std_sharpe&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metrics_list</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_detailed_progress_bar</span><span class="p">:</span>
                        <span class="n">pbar</span><span class="o">.</span><span class="n">set_description_str</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;mc_mean_std_sharpe for benchmark column: &#39;</span><span class="si">{</span><span class="n">bench_col</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
                    <span class="n">mc_scores</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">contributive_correlation</span><span class="p">(</span>
                        <span class="n">dataf</span><span class="o">=</span><span class="n">dataf</span><span class="p">,</span>
                        <span class="n">pred_col</span><span class="o">=</span><span class="n">pred_col</span><span class="p">,</span>
                        <span class="n">target_col</span><span class="o">=</span><span class="n">target_col</span><span class="p">,</span>
                        <span class="n">other_col</span><span class="o">=</span><span class="n">bench_col</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="n">col_stats</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;mc_mean_</span><span class="si">{</span><span class="n">bench_col</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">mc_scores</span><span class="p">)</span>
                    <span class="n">col_stats</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;mc_std_</span><span class="si">{</span><span class="n">bench_col</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanstd</span><span class="p">(</span><span class="n">mc_scores</span><span class="p">)</span>
                    <span class="n">col_stats</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;mc_sharpe_</span><span class="si">{</span><span class="n">bench_col</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                        <span class="k">if</span> <span class="n">col_stats</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;mc_std_</span><span class="si">{</span><span class="n">bench_col</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span>
                        <span class="k">else</span> <span class="n">col_stats</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;mc_mean_</span><span class="si">{</span><span class="n">bench_col</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
                        <span class="o">/</span> <span class="n">col_stats</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;mc_std_</span><span class="si">{</span><span class="n">bench_col</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
                    <span class="p">)</span>

                <span class="k">if</span> <span class="s2">&quot;corr_with&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metrics_list</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_detailed_progress_bar</span><span class="p">:</span>
                        <span class="n">pbar</span><span class="o">.</span><span class="n">set_description_str</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;corr_with for benchmark column: &#39;</span><span class="si">{</span><span class="n">bench_col</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
                    <span class="n">col_stats</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;corr_with_</span><span class="si">{</span><span class="n">bench_col</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cross_correlation</span><span class="p">(</span>
                        <span class="n">dataf</span><span class="o">=</span><span class="n">dataf</span><span class="p">,</span> <span class="n">pred_col</span><span class="o">=</span><span class="n">bench_col</span><span class="p">,</span> <span class="n">other_col</span><span class="o">=</span><span class="n">bench_col</span>
                    <span class="p">)</span>

                <span class="k">if</span> <span class="s2">&quot;legacy_mc_mean_std_sharpe&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metrics_list</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_detailed_progress_bar</span><span class="p">:</span>
                        <span class="n">pbar</span><span class="o">.</span><span class="n">set_description_str</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;legacy_mc_mean_std_sharpe for benchmark column: &#39;</span><span class="si">{</span><span class="n">bench_col</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
                    <span class="n">legacy_mc_scores</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">legacy_contribution</span><span class="p">(</span>
                        <span class="n">dataf</span><span class="o">=</span><span class="n">dataf</span><span class="p">,</span>
                        <span class="n">pred_col</span><span class="o">=</span><span class="n">pred_col</span><span class="p">,</span>
                        <span class="n">target_col</span><span class="o">=</span><span class="n">target_col</span><span class="p">,</span>
                        <span class="n">other_col</span><span class="o">=</span><span class="n">bench_col</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="n">col_stats</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;legacy_mc_mean_</span><span class="si">{</span><span class="n">bench_col</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span>
                        <span class="n">legacy_mc_scores</span>
                    <span class="p">)</span>
                    <span class="n">col_stats</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;legacy_mc_std_</span><span class="si">{</span><span class="n">bench_col</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanstd</span><span class="p">(</span>
                        <span class="n">legacy_mc_scores</span>
                    <span class="p">)</span>
                    <span class="n">col_stats</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;legacy_mc_sharpe_</span><span class="si">{</span><span class="n">bench_col</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                        <span class="k">if</span> <span class="n">col_stats</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;legacy_mc_std_</span><span class="si">{</span><span class="n">bench_col</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span>
                        <span class="k">else</span> <span class="n">col_stats</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;legacy_mc_mean_</span><span class="si">{</span><span class="n">bench_col</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
                        <span class="o">/</span> <span class="n">col_stats</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;legacy_mc_std_</span><span class="si">{</span><span class="n">bench_col</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
                    <span class="p">)</span>

                <span class="k">if</span> <span class="s2">&quot;ex_diss&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metrics_list</span> <span class="ow">or</span> <span class="s2">&quot;ex_diss_pearson&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metrics_list</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_detailed_progress_bar</span><span class="p">:</span>
                        <span class="n">pbar</span><span class="o">.</span><span class="n">set_description_str</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ex_diss_pearson for benchmark column: &#39;</span><span class="si">{</span><span class="n">bench_col</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
                    <span class="n">col_stats</span><span class="p">[</span>
                        <span class="sa">f</span><span class="s2">&quot;exposure_dissimilarity_pearson_</span><span class="si">{</span><span class="n">bench_col</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exposure_dissimilarity</span><span class="p">(</span>
                        <span class="n">dataf</span><span class="o">=</span><span class="n">dataf</span><span class="p">,</span> <span class="n">pred_col</span><span class="o">=</span><span class="n">pred_col</span><span class="p">,</span> <span class="n">other_col</span><span class="o">=</span><span class="n">bench_col</span><span class="p">,</span>
                        <span class="n">corr_method</span><span class="o">=</span><span class="s2">&quot;pearson&quot;</span>
                    <span class="p">)</span>
                <span class="k">if</span> <span class="s2">&quot;ex_diss_spearman&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metrics_list</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_detailed_progress_bar</span><span class="p">:</span>
                        <span class="n">pbar</span><span class="o">.</span><span class="n">set_description_str</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ex_diss_spearman for benchmark column: &#39;</span><span class="si">{</span><span class="n">bench_col</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
                    <span class="n">col_stats</span><span class="p">[</span>
                        <span class="sa">f</span><span class="s2">&quot;exposure_dissimilarity_spearman_</span><span class="si">{</span><span class="n">bench_col</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exposure_dissimilarity</span><span class="p">(</span>
                        <span class="n">dataf</span><span class="o">=</span><span class="n">dataf</span><span class="p">,</span> <span class="n">pred_col</span><span class="o">=</span><span class="n">pred_col</span><span class="p">,</span> <span class="n">other_col</span><span class="o">=</span><span class="n">bench_col</span><span class="p">,</span>
                        <span class="n">corr_method</span><span class="o">=</span><span class="s2">&quot;spearman&quot;</span>
                    <span class="p">)</span>

        <span class="c1"># Compute intensive stats</span>
        <span class="k">if</span> <span class="s2">&quot;fn_mean_std_sharpe&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metrics_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_detailed_progress_bar</span><span class="p">:</span>
                <span class="n">pbar</span><span class="o">.</span><span class="n">set_description_str</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;fn_mean_std_sharpe for evaluation&quot;</span><span class="p">)</span>
                <span class="n">pbar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">fn_mean</span><span class="p">,</span> <span class="n">fn_std</span><span class="p">,</span> <span class="n">fn_sharpe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_neutral_mean_std_sharpe</span><span class="p">(</span>
                <span class="n">dataf</span><span class="o">=</span><span class="n">dataf</span><span class="p">,</span>
                <span class="n">pred_col</span><span class="o">=</span><span class="n">pred_col</span><span class="p">,</span>
                <span class="n">target_col</span><span class="o">=</span><span class="n">target_col</span><span class="p">,</span>
                <span class="n">feature_names</span><span class="o">=</span><span class="n">feature_cols</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">col_stats</span><span class="p">[</span><span class="s2">&quot;feature_neutral_mean&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fn_mean</span>
            <span class="n">col_stats</span><span class="p">[</span><span class="s2">&quot;feature_neutral_std&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fn_std</span>
            <span class="n">col_stats</span><span class="p">[</span><span class="s2">&quot;feature_neutral_sharpe&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fn_sharpe</span>

        <span class="k">if</span> <span class="s2">&quot;tb200_mean_std_sharpe&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metrics_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_detailed_progress_bar</span><span class="p">:</span>
                <span class="n">pbar</span><span class="o">.</span><span class="n">set_description_str</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;tb200_mean_std_sharpe for evaluation&quot;</span><span class="p">)</span>
                <span class="n">pbar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">tb200_mean</span><span class="p">,</span> <span class="n">tb200_std</span><span class="p">,</span> <span class="n">tb200_sharpe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tbx_mean_std_sharpe</span><span class="p">(</span>
                <span class="n">dataf</span><span class="o">=</span><span class="n">dataf</span><span class="p">,</span> <span class="n">pred_col</span><span class="o">=</span><span class="n">pred_col</span><span class="p">,</span> <span class="n">target_col</span><span class="o">=</span><span class="n">target_col</span><span class="p">,</span> <span class="n">tb</span><span class="o">=</span><span class="mi">200</span>
            <span class="p">)</span>
            <span class="n">col_stats</span><span class="p">[</span><span class="s2">&quot;tb200_mean&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tb200_mean</span>
            <span class="n">col_stats</span><span class="p">[</span><span class="s2">&quot;tb200_std&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tb200_std</span>
            <span class="n">col_stats</span><span class="p">[</span><span class="s2">&quot;tb200_sharpe&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tb200_sharpe</span>

        <span class="k">if</span> <span class="s2">&quot;tb500_mean_std_sharpe&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metrics_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_detailed_progress_bar</span><span class="p">:</span>
                <span class="n">pbar</span><span class="o">.</span><span class="n">set_description_str</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;tb500_mean_std_sharpe for evaluation&quot;</span><span class="p">)</span>
                <span class="n">pbar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">tb500_mean</span><span class="p">,</span> <span class="n">tb500_std</span><span class="p">,</span> <span class="n">tb500_sharpe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tbx_mean_std_sharpe</span><span class="p">(</span>
                <span class="n">dataf</span><span class="o">=</span><span class="n">dataf</span><span class="p">,</span> <span class="n">pred_col</span><span class="o">=</span><span class="n">pred_col</span><span class="p">,</span> <span class="n">target_col</span><span class="o">=</span><span class="n">target_col</span><span class="p">,</span> <span class="n">tb</span><span class="o">=</span><span class="mi">500</span>
            <span class="p">)</span>
            <span class="n">col_stats</span><span class="p">[</span><span class="s2">&quot;tb500_mean&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tb500_mean</span>
            <span class="n">col_stats</span><span class="p">[</span><span class="s2">&quot;tb500_std&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tb500_std</span>
            <span class="n">col_stats</span><span class="p">[</span><span class="s2">&quot;tb500_sharpe&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tb500_sharpe</span>

        <span class="c1"># Custom functions</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">custom_functions</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">local_vars</span> <span class="o">=</span> <span class="nb">locals</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">func_name</span><span class="p">,</span> <span class="n">func_info</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">custom_functions</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_detailed_progress_bar</span><span class="p">:</span>
                    <span class="n">pbar</span><span class="o">.</span><span class="n">set_description_str</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;custom function: &#39;</span><span class="si">{</span><span class="n">func_name</span><span class="si">}</span><span class="s2">&#39; for evaluation&quot;</span><span class="p">)</span>
                    <span class="n">pbar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">func_info</span><span class="p">[</span><span class="s1">&#39;func&#39;</span><span class="p">]</span>
                <span class="n">args</span> <span class="o">=</span> <span class="n">func_info</span><span class="p">[</span><span class="s1">&#39;args&#39;</span><span class="p">]</span>
                <span class="n">local_args</span> <span class="o">=</span> <span class="n">func_info</span><span class="p">[</span><span class="s1">&#39;local_args&#39;</span><span class="p">]</span>
                <span class="n">resolved_args</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">args</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="c1"># Resolve variables defined as local args</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">local_args</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">v</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">local_vars</span><span class="p">:</span>
                            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Variable &#39;</span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2">&#39; was defined in &#39;local_args&#39;, but was not found in local variables. Make sure to set the correct local_args.&quot;</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">resolved_args</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">local_vars</span><span class="p">[</span><span class="n">v</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">resolved_args</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
                <span class="n">col_stats</span><span class="p">[</span><span class="n">func_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">**</span><span class="n">resolved_args</span><span class="p">)</span>

        <span class="n">col_stats_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">col_stats</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="n">pred_col</span><span class="p">])</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_detailed_progress_bar</span><span class="p">:</span>
            <span class="n">pbar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">pbar</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">col_stats_df</span>

    <span class="k">def</span> <span class="nf">per_era_corrs</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">pred_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Correlation between prediction and target for each era.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">dataf</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">era_col</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normalize_uniform</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">pred_col</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.5</span><span class="p">))</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span>
                <span class="n">d</span><span class="p">[</span><span class="n">target_col</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">per_era_numerai_corrs</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">pred_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Numerai Corr between prediction and target for each era.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">dataf</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">era_col</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">numerai_corr</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.5</span><span class="p">),</span> <span class="n">pred_col</span><span class="p">,</span> <span class="n">target_col</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">mean_std_sharpe</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">era_corrs</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Average, standard deviation and Sharpe ratio for</span>
<span class="sd">        correlations per era.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mean</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">era_corrs</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
        <span class="n">std</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">era_corrs</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">ddof</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
        <span class="n">sharpe</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="k">if</span> <span class="n">std</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">mean</span> <span class="o">/</span> <span class="n">std</span>
        <span class="k">return</span> <span class="n">mean</span><span class="p">,</span> <span class="n">std</span><span class="p">,</span> <span class="n">sharpe</span>

    <span class="k">def</span> <span class="nf">numerai_corr</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">pred_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Computes &#39;Numerai Corr&#39; aka &#39;Corrv2&#39;.</span>
<span class="sd">        More info: https://forum.numer.ai/t/target-cyrus-new-primary-target/6303</span>

<span class="sd">        Assumes original target col as input (i.e. in [0, 1] range).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Rank and gaussianize predictions</span>
        <span class="n">ranked_preds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normalize_uniform</span><span class="p">(</span>
            <span class="n">dataf</span><span class="p">[</span><span class="n">pred_col</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.5</span><span class="p">),</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;average&quot;</span>
        <span class="p">)</span>
        <span class="n">gauss_ranked_preds</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">ranked_preds</span><span class="p">)</span>
        <span class="c1"># Center target from [0...1] to [-0.5...0.5] range</span>
        <span class="n">targets</span> <span class="o">=</span> <span class="n">dataf</span><span class="p">[</span><span class="n">target_col</span><span class="p">]</span>
        <span class="n">centered_target</span> <span class="o">=</span> <span class="n">targets</span> <span class="o">-</span> <span class="n">targets</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="c1"># Accentuate tails of predictions and targets</span>
        <span class="n">preds_p15</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">gauss_ranked_preds</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">gauss_ranked_preds</span><span class="p">)</span> <span class="o">**</span> <span class="mf">1.5</span>
        <span class="n">target_p15</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">centered_target</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">centered_target</span><span class="p">)</span> <span class="o">**</span> <span class="mf">1.5</span>
        <span class="c1"># Pearson correlation</span>
        <span class="n">corr</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">pearsonr</span><span class="p">(</span><span class="n">preds_p15</span><span class="p">,</span> <span class="n">target_p15</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">corr</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">max_drawdown</span><span class="p">(</span><span class="n">era_corrs</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Maximum drawdown per era.&quot;&quot;&quot;</span>
        <span class="c1"># Arbitrarily large window</span>
        <span class="n">rolling_max</span> <span class="o">=</span> <span class="p">(</span>
            <span class="p">(</span><span class="n">era_corrs</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">cumprod</span><span class="p">()</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="mi">9000</span><span class="p">,</span> <span class="n">min_periods</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="n">daily_value</span> <span class="o">=</span> <span class="p">(</span><span class="n">era_corrs</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">cumprod</span><span class="p">()</span>
        <span class="n">max_drawdown</span> <span class="o">=</span> <span class="o">-</span><span class="p">((</span><span class="n">rolling_max</span> <span class="o">-</span> <span class="n">daily_value</span><span class="p">)</span> <span class="o">/</span> <span class="n">rolling_max</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">max_drawdown</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">apy</span><span class="p">(</span><span class="n">era_corrs</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">stake_compounding_lag</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">4</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Annual percentage yield.</span>
<span class="sd">        :param era_corrs: Correlation scores by era</span>
<span class="sd">        :param stake_compounding_lag: Compounding lag for Numerai rounds (4 for Numerai Classic)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">payout_scores</span> <span class="o">=</span> <span class="n">era_corrs</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="o">-</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">)</span>
        <span class="n">payout_product</span> <span class="o">=</span> <span class="p">(</span><span class="n">payout_scores</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">prod</span><span class="p">()</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="n">payout_product</span>
            <span class="o">**</span> <span class="p">(</span>
                <span class="c1"># 52 weeks of compounding minus n for stake compounding lag</span>
                <span class="p">(</span><span class="mi">52</span> <span class="o">-</span> <span class="n">stake_compounding_lag</span><span class="p">)</span>
                <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">payout_scores</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="o">-</span> <span class="mi">1</span>
        <span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>

    <span class="k">def</span> <span class="nf">cross_correlation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">pred_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">other_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Corrv2 correlation with other predictions (like another model, example predictions or meta model prediction).</span>
<span class="sd">        :param dataf: DataFrame containing both pred_col and other_col.</span>
<span class="sd">        :param pred_col: Main Prediction.</span>
<span class="sd">        :param other_col: Other prediction column to calculate correlation with pred_col.</span>

<span class="sd">        :return: Correlation between Corrv2&#39;s of pred_col and other_col.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">per_era_numerai_corrs</span><span class="p">(</span>
            <span class="n">dataf</span><span class="o">=</span><span class="n">dataf</span><span class="p">,</span>
            <span class="n">pred_col</span><span class="o">=</span><span class="n">pred_col</span><span class="p">,</span>
            <span class="n">target_col</span><span class="o">=</span><span class="n">other_col</span><span class="p">,</span>
        <span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">max_feature_exposure</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">feature_cols</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">pred_col</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Maximum exposure over all features.&quot;&quot;&quot;</span>
        <span class="n">max_per_era</span> <span class="o">=</span> <span class="n">dataf</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">era_col</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="n">d</span><span class="p">[</span><span class="n">feature_cols</span><span class="p">]</span><span class="o">.</span><span class="n">corrwith</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">pred_col</span><span class="p">])</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="n">max_feature_exposure</span> <span class="o">=</span> <span class="n">max_per_era</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">max_feature_exposure</span>

    <span class="k">def</span> <span class="nf">feature_neutral_mean_std_sharpe</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">pred_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">feature_names</span><span class="p">:</span> <span class="nb">list</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Feature neutralized mean performance.</span>
<span class="sd">        More info: https://docs.numer.ai/tournament/feature-neutral-correlation</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fn</span> <span class="o">=</span> <span class="n">FeatureNeutralizer</span><span class="p">(</span><span class="n">pred_name</span><span class="o">=</span><span class="n">pred_col</span><span class="p">,</span> <span class="n">proportion</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
        <span class="n">neutralized_preds</span> <span class="o">=</span> <span class="n">fn</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span>
            <span class="n">dataf</span><span class="p">[</span><span class="n">pred_col</span><span class="p">],</span> <span class="n">features</span><span class="o">=</span><span class="n">dataf</span><span class="p">[</span><span class="n">feature_names</span><span class="p">],</span> <span class="n">eras</span><span class="o">=</span><span class="n">dataf</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">era_col</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="c1"># Construct new DataFrame with era col, target col and preds</span>
        <span class="n">neutralized_dataf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">era_col</span><span class="p">,</span> <span class="n">target_col</span><span class="p">,</span> <span class="n">pred_col</span><span class="p">])</span>
        <span class="n">neutralized_dataf</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">era_col</span><span class="p">]</span> <span class="o">=</span> <span class="n">dataf</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">era_col</span><span class="p">]</span>
        <span class="n">neutralized_dataf</span><span class="p">[</span><span class="n">target_col</span><span class="p">]</span> <span class="o">=</span> <span class="n">dataf</span><span class="p">[</span><span class="n">target_col</span><span class="p">]</span>
        <span class="n">neutralized_dataf</span><span class="p">[</span><span class="n">pred_col</span><span class="p">]</span> <span class="o">=</span> <span class="n">neutralized_preds</span>

        <span class="n">neutral_corrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">per_era_numerai_corrs</span><span class="p">(</span>
            <span class="n">dataf</span><span class="o">=</span><span class="n">neutralized_dataf</span><span class="p">,</span>
            <span class="n">pred_col</span><span class="o">=</span><span class="n">pred_col</span><span class="p">,</span>
            <span class="n">target_col</span><span class="o">=</span><span class="n">target_col</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">mean</span><span class="p">,</span> <span class="n">std</span><span class="p">,</span> <span class="n">sharpe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean_std_sharpe</span><span class="p">(</span><span class="n">era_corrs</span><span class="o">=</span><span class="n">neutral_corrs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">mean</span><span class="p">,</span> <span class="n">std</span><span class="p">,</span> <span class="n">sharpe</span>

    <span class="k">def</span> <span class="nf">tbx_mean_std_sharpe</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">pred_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">tb</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">200</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate Mean, Standard deviation and Sharpe ratio</span>
<span class="sd">        when we focus on the x top and x bottom predictions.</span>
<span class="sd">        :param tb: How many of top and bottom predictions to focus on.</span>
<span class="sd">        TB200 and TB500 are the most common situations.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tb_val_corrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_score_by_date</span><span class="p">(</span>
            <span class="n">dataf</span><span class="o">=</span><span class="n">dataf</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="n">pred_col</span><span class="p">],</span> <span class="n">target</span><span class="o">=</span><span class="n">target_col</span><span class="p">,</span> <span class="n">tb</span><span class="o">=</span><span class="n">tb</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean_std_sharpe</span><span class="p">(</span><span class="n">era_corrs</span><span class="o">=</span><span class="n">tb_val_corrs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">exposure_dissimilarity</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">pred_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">other_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">corr_method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;pearson&quot;</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Model pattern of feature exposure to the another column.</span>
<span class="sd">        See TC details forum post: https://forum.numer.ai/t/true-contribution-details/5128/4</span>
<span class="sd">        :param dataf: DataFrame containing both pred_col and other_col.</span>
<span class="sd">        :param pred_col: Main Prediction.</span>
<span class="sd">        :param other_col: Other prediction column to calculate exposure dissimilarity against.</span>
<span class="sd">        :param corr_method: Correlation method to use for calculating feature exposures.</span>
<span class="sd">        corr_method should be one of [&#39;pearson&#39;, &#39;kendall&#39;, &#39;spearman&#39;]. Default: &#39;pearson&#39;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="n">corr_method</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;pearson&quot;</span><span class="p">,</span> <span class="s2">&quot;kendall&quot;</span><span class="p">,</span> <span class="s2">&quot;spearman&quot;</span><span class="p">],</span> <span class="sa">f</span><span class="s2">&quot;corr_method should be one of [&#39;pearson&#39;, &#39;kendall&#39;, &#39;spearman&#39;]. Got: &#39;</span><span class="si">{</span><span class="n">corr_method</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
        <span class="n">feature_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">dataf</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">col</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;feature&quot;</span><span class="p">)]</span>
        <span class="n">U</span> <span class="o">=</span> <span class="n">dataf</span><span class="p">[</span><span class="n">feature_cols</span><span class="p">]</span><span class="o">.</span><span class="n">corrwith</span><span class="p">(</span><span class="n">dataf</span><span class="p">[</span><span class="n">pred_col</span><span class="p">],</span> <span class="n">method</span><span class="o">=</span><span class="n">corr_method</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>
        <span class="n">E</span> <span class="o">=</span> <span class="n">dataf</span><span class="p">[</span><span class="n">feature_cols</span><span class="p">]</span><span class="o">.</span><span class="n">corrwith</span><span class="p">(</span><span class="n">dataf</span><span class="p">[</span><span class="n">other_col</span><span class="p">],</span> <span class="n">method</span><span class="o">=</span><span class="n">corr_method</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>

        <span class="n">denominator</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">E</span><span class="p">,</span> <span class="n">E</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">denominator</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">exp_dis</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">exp_dis</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">U</span><span class="p">,</span> <span class="n">E</span><span class="p">)</span> <span class="o">/</span> <span class="n">denominator</span>
        <span class="k">return</span> <span class="n">exp_dis</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_neutralize_series</span><span class="p">(</span>
        <span class="n">series</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">by</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">proportion</span><span class="o">=</span><span class="mf">1.0</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">:</span>
        <span class="n">scores</span> <span class="o">=</span> <span class="n">series</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">exposures</span> <span class="o">=</span> <span class="n">by</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c1"># This line makes series neutral to a constant column so that it&#39;s centered and for sure gets corr 0 with exposures</span>
        <span class="n">exposures</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span>
            <span class="p">(</span><span class="n">exposures</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">series</span><span class="p">)]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">exposures</span><span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="p">)</span>

        <span class="n">correction</span> <span class="o">=</span> <span class="n">proportion</span> <span class="o">*</span> <span class="p">(</span>
            <span class="n">exposures</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">lstsq</span><span class="p">(</span><span class="n">exposures</span><span class="p">,</span> <span class="n">scores</span><span class="p">,</span> <span class="n">rcond</span><span class="o">=</span><span class="kc">None</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        <span class="p">)</span>
        <span class="n">corrected_scores</span> <span class="o">=</span> <span class="n">scores</span> <span class="o">-</span> <span class="n">correction</span>
        <span class="n">neutralized</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">corrected_scores</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">index</span><span class="o">=</span><span class="n">series</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">neutralized</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_orthogonalize</span><span class="p">(</span><span class="n">v</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">u</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Orthogonalizes v with respect to u by projecting v onto u,</span>
<span class="sd">        then subtracting that projection from v.</span>

<span class="sd">        This will reach the same result as the neutralize function when v and u</span>
<span class="sd">        are single column vectors, but this is much faster.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            v: np.ndarray - the vector to orthogonalize</span>
<span class="sd">            u: np.ndarray - the vector to orthogonalize v against</span>

<span class="sd">        Returns:</span>
<span class="sd">            np.ndarray - the orthogonalized vector v</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Calculate the dot product of u and v</span>
        <span class="n">dot_product</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">v</span>

        <span class="c1"># Calculate the projection of v onto u</span>
        <span class="n">projection</span> <span class="o">=</span> <span class="p">(</span><span class="n">dot_product</span> <span class="o">/</span> <span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">u</span><span class="p">))</span> <span class="o">*</span> <span class="n">u</span>

        <span class="c1"># Subtract the projection from v</span>
        <span class="k">return</span> <span class="n">v</span> <span class="o">-</span> <span class="n">projection</span>

    <span class="k">def</span> <span class="nf">_score_by_date</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">columns</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">tb</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get era correlation based on given TB (x top and bottom predictions).</span>
<span class="sd">        :param tb: How many of top and bottom predictions to focus on.</span>
<span class="sd">        TB200 is the most common situation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">unique_eras</span> <span class="o">=</span> <span class="n">dataf</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">era_col</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
        <span class="n">computed</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">unique_eras</span><span class="p">:</span>
            <span class="n">df_era</span> <span class="o">=</span> <span class="n">dataf</span><span class="p">[</span><span class="n">dataf</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">era_col</span><span class="p">]</span> <span class="o">==</span> <span class="n">u</span><span class="p">]</span>
            <span class="n">era_pred</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">df_era</span><span class="p">[</span><span class="n">columns</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
            <span class="n">era_target</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">df_era</span><span class="p">[</span><span class="n">target</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">tb</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">ccs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">corrcoef</span><span class="p">(</span><span class="n">era_target</span><span class="p">,</span> <span class="n">era_pred</span><span class="p">)[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">:]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">tbidx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">era_pred</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">tbidx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">tbidx</span><span class="p">[:,</span> <span class="p">:</span><span class="n">tb</span><span class="p">],</span> <span class="n">tbidx</span><span class="p">[:,</span> <span class="o">-</span><span class="n">tb</span><span class="p">:]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">ccs</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">corrcoef</span><span class="p">(</span><span class="n">era_target</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">pred</span><span class="p">[</span><span class="n">idx</span><span class="p">])[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">pred</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">tbidx</span><span class="p">,</span> <span class="n">era_pred</span><span class="p">)</span>
                <span class="p">]</span>
                <span class="n">ccs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ccs</span><span class="p">)</span>
            <span class="n">computed</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ccs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">computed</span><span class="p">),</span> <span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">dataf</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">era_col</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
        <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_normalize_uniform</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;first&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Normalize predictions uniformly using ranks.</span>
<span class="sd">        NOTE: Make sure the range of predictions is [0, 1] (inclusive).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">rank</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span>
            <span class="n">df</span>
        <span class="p">)</span>  <span class="c1"># TODO: Evaluate if subtracting df.mean() is better</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_feature_exposures_pearson</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">pred_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">feature_list</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">cpu_cores</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate feature exposures for each era using Pearson correlation.</span>

<span class="sd">        :param dataf: DataFrame containing predictions, features, and eras.</span>
<span class="sd">        :param pred_col: Prediction column to calculate feature exposures for.</span>
<span class="sd">        :param feature_list: List of feature columns in X.</span>
<span class="sd">        :param cpu_cores: Number of CPU cores to use for parallelization.</span>
<span class="sd">        :return: DataFrame with Pearson feature exposures by era for each feature.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">calculate_era_pearson_exposure</span><span class="p">(</span>
            <span class="n">era</span><span class="p">,</span> <span class="n">group</span><span class="p">,</span> <span class="n">feature_list</span><span class="p">,</span> <span class="n">pred_col_normalized</span>
        <span class="p">):</span>
            <span class="n">data_matrix</span> <span class="o">=</span> <span class="n">group</span><span class="p">[</span><span class="n">feature_list</span> <span class="o">+</span> <span class="p">[</span><span class="n">pred_col_normalized</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span>
            <span class="n">correlations</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">corrcoef</span><span class="p">(</span><span class="n">data_matrix</span><span class="p">,</span> <span class="n">rowvar</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

            <span class="c1"># Get the correlations of all features with the predictions (which is the last column)</span>
            <span class="n">feature_correlations</span> <span class="o">=</span> <span class="n">correlations</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">era</span><span class="p">,</span> <span class="n">feature_correlations</span>

        <span class="n">normalized_ranks</span> <span class="o">=</span> <span class="p">(</span><span class="n">dataf</span><span class="p">[[</span><span class="n">pred_col</span><span class="p">]]</span><span class="o">.</span><span class="n">rank</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;first&quot;</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">dataf</span><span class="p">)</span>
        <span class="n">dataf</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">pred_col</span><span class="si">}</span><span class="s2">_normalized&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">normalized_ranks</span><span class="p">)</span>
        <span class="n">feature_exposure_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="n">index</span><span class="o">=</span><span class="n">dataf</span><span class="p">[</span><span class="s2">&quot;era&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">(),</span> <span class="n">columns</span><span class="o">=</span><span class="n">feature_list</span>
        <span class="p">)</span>

        <span class="n">grouped_data</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">dataf</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;era&quot;</span><span class="p">))</span>

        <span class="n">results</span> <span class="o">=</span> <span class="n">Parallel</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=</span><span class="n">cpu_cores</span><span class="p">)(</span>
            <span class="n">delayed</span><span class="p">(</span><span class="n">calculate_era_pearson_exposure</span><span class="p">)(</span>
                <span class="n">era</span><span class="p">,</span> <span class="n">group</span><span class="p">,</span> <span class="n">feature_list</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">pred_col</span><span class="si">}</span><span class="s2">_normalized&quot;</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">era</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">grouped_data</span>
        <span class="p">)</span>

        <span class="k">for</span> <span class="n">era</span><span class="p">,</span> <span class="n">feature_correlations</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
            <span class="n">feature_exposure_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">era</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">feature_correlations</span>
        <span class="k">return</span> <span class="n">feature_exposure_data</span>

    <span class="k">def</span> <span class="nf">get_feature_exposures_corrv2</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">pred_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">feature_list</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">cpu_cores</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate feature exposures for each era using &#39;Numerai Corr&#39;.</span>
<span class="sd">        Results will be similar to get_feature_exposures() but more accurate.</span>
<span class="sd">        This method will take longer to compute.</span>

<span class="sd">        :param dataf: DataFrame containing predictions, features, and eras.</span>
<span class="sd">        :param pred_col: Prediction column to calculate feature exposures for.</span>
<span class="sd">        :param feature_list: List of feature columns in X.</span>
<span class="sd">        :param cpu_cores: Number of CPU cores to use for parallelization.</span>
<span class="sd">        Default: -1 (all cores).</span>
<span class="sd">        :return: DataFrame with Corrv2 feature exposures by era for each feature.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">calculate_era_feature_exposure</span><span class="p">(</span><span class="n">era</span><span class="p">,</span> <span class="n">group</span><span class="p">,</span> <span class="n">pred_col</span><span class="p">,</span> <span class="n">feature_list</span><span class="p">):</span>
            <span class="n">exposures</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">feature_list</span><span class="p">:</span>
                <span class="n">corr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">numerai_corr</span><span class="p">(</span>
                    <span class="n">group</span><span class="p">,</span> <span class="n">pred_col</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">pred_col</span><span class="si">}</span><span class="s2">_normalized&quot;</span><span class="p">,</span> <span class="n">target_col</span><span class="o">=</span><span class="n">feature</span>
                <span class="p">)</span>
                <span class="n">exposures</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span> <span class="o">=</span> <span class="n">corr</span>
            <span class="k">return</span> <span class="n">era</span><span class="p">,</span> <span class="n">exposures</span>

        <span class="n">normalized_ranks</span> <span class="o">=</span> <span class="p">(</span><span class="n">dataf</span><span class="p">[[</span><span class="n">pred_col</span><span class="p">]]</span><span class="o">.</span><span class="n">rank</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;first&quot;</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">dataf</span><span class="p">)</span>
        <span class="n">dataf</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">pred_col</span><span class="si">}</span><span class="s2">_normalized&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">normalized_ranks</span><span class="p">)</span>
        <span class="n">feature_exposure_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="n">index</span><span class="o">=</span><span class="n">dataf</span><span class="p">[</span><span class="s2">&quot;era&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">(),</span> <span class="n">columns</span><span class="o">=</span><span class="n">feature_list</span>
        <span class="p">)</span>

        <span class="n">grouped_data</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">dataf</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;era&quot;</span><span class="p">))</span>

        <span class="n">results</span> <span class="o">=</span> <span class="n">Parallel</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=</span><span class="n">cpu_cores</span><span class="p">)(</span>
            <span class="n">delayed</span><span class="p">(</span><span class="n">calculate_era_feature_exposure</span><span class="p">)(</span><span class="n">era</span><span class="p">,</span> <span class="n">group</span><span class="p">,</span> <span class="n">pred_col</span><span class="p">,</span> <span class="n">feature_list</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">era</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">grouped_data</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">era</span><span class="p">,</span> <span class="n">exposures</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
            <span class="n">feature_exposure_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">era</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">exposures</span>
        <span class="k">return</span> <span class="n">feature_exposure_data</span>

    <span class="k">def</span> <span class="nf">smart_sharpe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">era_corrs</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sharpe adjusted for autocorrelation.</span>
<span class="sd">        :param era_corrs: Correlation scores by era</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">era_corrs</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">nanstd</span><span class="p">(</span><span class="n">era_corrs</span><span class="p">,</span> <span class="n">ddof</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">autocorr_penalty</span><span class="p">(</span><span class="n">era_corrs</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">autocorr_penalty</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">era_corrs</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adjusting factor for autocorrelation. Used in Smart Sharpe.</span>
<span class="sd">        :param era_corrs: Correlation scores by era.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">era_corrs</span><span class="p">)</span>
        <span class="c1"># 1st order autocorrelation</span>
        <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">autocorr1</span><span class="p">(</span><span class="n">era_corrs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([((</span><span class="n">n</span> <span class="o">-</span> <span class="n">i</span><span class="p">)</span> <span class="o">/</span> <span class="n">n</span><span class="p">)</span> <span class="o">*</span> <span class="n">p</span><span class="o">**</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">)]))</span>

    <span class="k">def</span> <span class="nf">autocorr1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">era_corrs</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        1st order autocorrelation.</span>
<span class="sd">        :param era_corrs: Correlation scores by era.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">corrcoef</span><span class="p">(</span><span class="n">era_corrs</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">era_corrs</span><span class="p">[</span><span class="mi">1</span><span class="p">:])[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">legacy_contribution</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">pred_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">other_col</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Legacy contibution mean, standard deviation and sharpe ratio.</span>
<span class="sd">        More info: https://forum.numer.ai/t/mmc2-announcement/93</span>

<span class="sd">        :param dataf: DataFrame containing era_col, pred_col, target_col and other_col.</span>
<span class="sd">        :param pred_col: Prediction column to calculate MMC for.</span>
<span class="sd">        :param target_col: Target column to calculate MMC against.</span>
<span class="sd">        :param other_col: Meta model column containing predictions to neutralize against.</span>

<span class="sd">        :return: List of legacy contribution scores by era.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">legacy_mc_scores</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># Standard deviation of a uniform distribution</span>
        <span class="n">COVARIANCE_FACTOR</span> <span class="o">=</span> <span class="mf">0.29</span><span class="o">**</span><span class="mi">2</span>
        <span class="c1"># Calculate MMC for each era</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">dataf</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">era_col</span><span class="p">):</span>
            <span class="n">series</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_neutralize_series</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_normalize_uniform</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">pred_col</span><span class="p">]),</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">other_col</span><span class="p">])</span>
            <span class="p">)</span>
            <span class="n">legacy_mc_scores</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">cov</span><span class="p">(</span><span class="n">series</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="n">target_col</span><span class="p">])[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">COVARIANCE_FACTOR</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">legacy_mc_scores</span>

    <span class="k">def</span> <span class="nf">contributive_correlation</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">pred_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">other_col</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate the contributive correlation of the given predictions</span>
<span class="sd">        wrt the given meta model.</span>
<span class="sd">        see: https://docs.numer.ai/numerai-tournament/scoring/meta-model-contribution-mmc-and-bmc</span>

<span class="sd">        Uses Numerai&#39;s official scoring function for contribution under the hood.</span>
<span class="sd">        See: https://github.com/numerai/numerai-tools/blob/master/numerai_tools/scoring.py</span>

<span class="sd">        Calculate contributive correlation by:</span>
<span class="sd">        1. tie-kept ranking each prediction and the meta model</span>
<span class="sd">        2. gaussianizing each prediction and the meta model</span>
<span class="sd">        3. orthogonalizing each prediction wrt the meta model</span>
<span class="sd">        3.5. scaling the targets to buckets [-2, -1, 0, 1, 2]</span>
<span class="sd">        4. dot product the orthogonalized predictions and the targets</span>
<span class="sd">       then normalize by the length of the target (equivalent to covariance)</span>

<span class="sd">        :param dataf: DataFrame containing era_col, pred_col, target_col and other_col.</span>
<span class="sd">        :param pred_col: Prediction column to calculate MMC for.</span>
<span class="sd">        :param target_col: Target column to calculate MMC against.</span>
<span class="sd">        Make sure the range of targets is [0, 1] (inclusive). </span>
<span class="sd">        If the function is called from full_evalation, this is guaranteed because of the checks.</span>
<span class="sd">        :param other_col: Meta model column containing predictions to neutralize against.</span>

<span class="sd">        :return: A 1D NumPy array of contributive correlations by era.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mc_scores</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">dataf</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">era_col</span><span class="p">):</span>
            <span class="n">mc</span> <span class="o">=</span> <span class="n">correlation_contribution</span><span class="p">(</span><span class="n">x</span><span class="p">[[</span><span class="n">pred_col</span><span class="p">]],</span> 
                                          <span class="n">x</span><span class="p">[</span><span class="n">other_col</span><span class="p">],</span> 
                                          <span class="n">x</span><span class="p">[</span><span class="n">target_col</span><span class="p">])</span>
            <span class="n">mc_scores</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mc</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mc_scores</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">check_custom_functions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">custom_functions</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;custom_functions must be a dictionary&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">func_name</span><span class="p">,</span> <span class="n">func_info</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">custom_functions</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">func_info</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">or</span> <span class="s1">&#39;func&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">func_info</span> <span class="ow">or</span> <span class="s1">&#39;args&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">func_info</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Function </span><span class="si">{</span><span class="n">func_name</span><span class="si">}</span><span class="s2"> must have a &#39;func&#39; and &#39;args&#39; key&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="nb">callable</span><span class="p">(</span><span class="n">func_info</span><span class="p">[</span><span class="s1">&#39;func&#39;</span><span class="p">]):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The &#39;func&#39; value for &#39;</span><span class="si">{</span><span class="n">func_name</span><span class="si">}</span><span class="s2">&#39; in custom_functions must be a callable function.&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">func_info</span><span class="p">[</span><span class="s1">&#39;args&#39;</span><span class="p">],</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&#39;args&#39; for &#39;</span><span class="si">{</span><span class="n">func_name</span><span class="si">}</span><span class="s2">&#39; in custom_functions must be a dictionary&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="s2">&quot;local_args&quot;</span> <span class="ow">in</span> <span class="n">func_info</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">func_info</span><span class="p">[</span><span class="s1">&#39;local_args&#39;</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The &#39;local_args&#39; key for </span><span class="si">{</span><span class="n">func_name</span><span class="si">}</span><span class="s2"> in custom_functionsmust be a list&quot;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">local_arg</span> <span class="ow">in</span> <span class="n">func_info</span><span class="p">[</span><span class="s1">&#39;local_args&#39;</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">local_arg</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Local arg &#39;</span><span class="si">{</span><span class="n">local_arg</span><span class="si">}</span><span class="s2">&#39; for &#39;</span><span class="si">{</span><span class="n">func_name</span><span class="si">}</span><span class="s2">&#39; in custom_functions must be string.&quot;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">local_arg</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">func_info</span><span class="p">[</span><span class="s1">&#39;args&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Local arg &#39;</span><span class="si">{</span><span class="n">local_arg</span><span class="si">}</span><span class="s2">&#39; for &#39;</span><span class="si">{</span><span class="n">func_name</span><span class="si">}</span><span class="s2">&#39; in custom_functions was not found in &#39;args&#39;&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">plot_correlations</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">pred_cols</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">corr_cols</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;target&quot;</span><span class="p">,</span>
        <span class="n">roll_mean</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot per era correlations over time.</span>
<span class="sd">        :param dataf: DataFrame that contains at least all pred_cols, target_col and corr_cols.</span>
<span class="sd">        :param pred_cols: List of prediction columns to calculate per era correlations for and plot.</span>
<span class="sd">        :param corr_cols: Per era correlations already prepared to include in the plot.</span>
<span class="sd">        This is optional for if you already have per era correlations prepared in your input dataf.</span>
<span class="sd">        :param target_col: Target column name to compute per era correlations against.</span>
<span class="sd">        :param roll_mean: How many eras should be averaged to compute a rolling score.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">validation_by_eras</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
        <span class="c1"># Compute per era correlation for each prediction column.</span>
        <span class="k">for</span> <span class="n">pred_col</span> <span class="ow">in</span> <span class="n">pred_cols</span><span class="p">:</span>
            <span class="n">per_era_corrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">per_era_numerai_corrs</span><span class="p">(</span>
                <span class="n">dataf</span><span class="p">,</span> <span class="n">pred_col</span><span class="o">=</span><span class="n">pred_col</span><span class="p">,</span> <span class="n">target_col</span><span class="o">=</span><span class="n">target_col</span>
            <span class="p">)</span>
            <span class="n">validation_by_eras</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">pred_col</span><span class="p">]</span> <span class="o">=</span> <span class="n">per_era_corrs</span>

        <span class="c1"># Add prepared per era correlation if any.</span>
        <span class="k">if</span> <span class="n">corr_cols</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">corr_col</span> <span class="ow">in</span> <span class="n">corr_cols</span><span class="p">:</span>
                <span class="n">validation_by_eras</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">corr_col</span><span class="p">]</span> <span class="o">=</span> <span class="n">dataf</span><span class="p">[</span><span class="n">corr_col</span><span class="p">]</span>

        <span class="n">validation_by_eras</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">roll_mean</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;line&quot;</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span>
            <span class="n">ms</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
            <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Rolling Per Era Correlation Mean (rolling window size: </span><span class="si">{</span><span class="n">roll_mean</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>
            <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span>
            <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper center&quot;</span><span class="p">,</span>
            <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.05</span><span class="p">),</span>
            <span class="n">fancybox</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">shadow</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">ncol</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="n">validation_by_eras</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Cumulative Sum of Era Correlations&quot;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span>
            <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper center&quot;</span><span class="p">,</span>
            <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.05</span><span class="p">),</span>
            <span class="n">fancybox</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">shadow</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">ncol</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">return</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">plot_correlation_heatmap</span><span class="p">(</span><span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">pred_cols</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>
        <span class="n">corr_matrix</span> <span class="o">=</span> <span class="n">dataf</span><span class="p">[</span><span class="n">pred_cols</span><span class="p">]</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">))</span>

        <span class="c1"># Create heatmap</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">corr_matrix</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;coolwarm&quot;</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>

        <span class="c1"># Add ticks and labels</span>
        <span class="n">ticks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">pred_cols</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">ticks</span><span class="p">,</span> <span class="n">pred_cols</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">ticks</span><span class="p">,</span> <span class="n">pred_cols</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">return</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">



<h3 id="numerblox.evaluation.BaseEvaluator.apy" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">apy</span><span class="p">(</span><span class="n">era_corrs</span><span class="p">,</span> <span class="n">stake_compounding_lag</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Annual percentage yield.
:param era_corrs: Correlation scores by era
:param stake_compounding_lag: Compounding lag for Numerai rounds (4 for Numerai Classic)</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/evaluation.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">apy</span><span class="p">(</span><span class="n">era_corrs</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">stake_compounding_lag</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">4</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Annual percentage yield.</span>
<span class="sd">    :param era_corrs: Correlation scores by era</span>
<span class="sd">    :param stake_compounding_lag: Compounding lag for Numerai rounds (4 for Numerai Classic)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">payout_scores</span> <span class="o">=</span> <span class="n">era_corrs</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="o">-</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">)</span>
    <span class="n">payout_product</span> <span class="o">=</span> <span class="p">(</span><span class="n">payout_scores</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">prod</span><span class="p">()</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="n">payout_product</span>
        <span class="o">**</span> <span class="p">(</span>
            <span class="c1"># 52 weeks of compounding minus n for stake compounding lag</span>
            <span class="p">(</span><span class="mi">52</span> <span class="o">-</span> <span class="n">stake_compounding_lag</span><span class="p">)</span>
            <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">payout_scores</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="o">-</span> <span class="mi">1</span>
    <span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="numerblox.evaluation.BaseEvaluator.autocorr1" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">autocorr1</span><span class="p">(</span><span class="n">era_corrs</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>1st order autocorrelation.
:param era_corrs: Correlation scores by era.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/evaluation.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">autocorr1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">era_corrs</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    1st order autocorrelation.</span>
<span class="sd">    :param era_corrs: Correlation scores by era.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">corrcoef</span><span class="p">(</span><span class="n">era_corrs</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">era_corrs</span><span class="p">[</span><span class="mi">1</span><span class="p">:])[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="numerblox.evaluation.BaseEvaluator.autocorr_penalty" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">autocorr_penalty</span><span class="p">(</span><span class="n">era_corrs</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Adjusting factor for autocorrelation. Used in Smart Sharpe.
:param era_corrs: Correlation scores by era.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/evaluation.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">autocorr_penalty</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">era_corrs</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Adjusting factor for autocorrelation. Used in Smart Sharpe.</span>
<span class="sd">    :param era_corrs: Correlation scores by era.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">era_corrs</span><span class="p">)</span>
    <span class="c1"># 1st order autocorrelation</span>
    <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">autocorr1</span><span class="p">(</span><span class="n">era_corrs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([((</span><span class="n">n</span> <span class="o">-</span> <span class="n">i</span><span class="p">)</span> <span class="o">/</span> <span class="n">n</span><span class="p">)</span> <span class="o">*</span> <span class="n">p</span><span class="o">**</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">)]))</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="numerblox.evaluation.BaseEvaluator.contributive_correlation" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">contributive_correlation</span><span class="p">(</span><span class="n">dataf</span><span class="p">,</span> <span class="n">pred_col</span><span class="p">,</span> <span class="n">target_col</span><span class="p">,</span> <span class="n">other_col</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Calculate the contributive correlation of the given predictions
 wrt the given meta model.
 see: https://docs.numer.ai/numerai-tournament/scoring/meta-model-contribution-mmc-and-bmc</p>
<p>Uses Numerai's official scoring function for contribution under the hood.
 See: https://github.com/numerai/numerai-tools/blob/master/numerai_tools/scoring.py</p>
<p>Calculate contributive correlation by:
 1. tie-kept ranking each prediction and the meta model
 2. gaussianizing each prediction and the meta model
 3. orthogonalizing each prediction wrt the meta model
 3.5. scaling the targets to buckets [-2, -1, 0, 1, 2]
 4. dot product the orthogonalized predictions and the targets
then normalize by the length of the target (equivalent to covariance)</p>
<p>:param dataf: DataFrame containing era_col, pred_col, target_col and other_col.
 :param pred_col: Prediction column to calculate MMC for.
 :param target_col: Target column to calculate MMC against.
 Make sure the range of targets is [0, 1] (inclusive). 
 If the function is called from full_evalation, this is guaranteed because of the checks.
 :param other_col: Meta model column containing predictions to neutralize against.</p>
<p>:return: A 1D NumPy array of contributive correlations by era.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/evaluation.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">contributive_correlation</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">pred_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">other_col</span><span class="p">:</span> <span class="nb">str</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the contributive correlation of the given predictions</span>
<span class="sd">    wrt the given meta model.</span>
<span class="sd">    see: https://docs.numer.ai/numerai-tournament/scoring/meta-model-contribution-mmc-and-bmc</span>

<span class="sd">    Uses Numerai&#39;s official scoring function for contribution under the hood.</span>
<span class="sd">    See: https://github.com/numerai/numerai-tools/blob/master/numerai_tools/scoring.py</span>

<span class="sd">    Calculate contributive correlation by:</span>
<span class="sd">    1. tie-kept ranking each prediction and the meta model</span>
<span class="sd">    2. gaussianizing each prediction and the meta model</span>
<span class="sd">    3. orthogonalizing each prediction wrt the meta model</span>
<span class="sd">    3.5. scaling the targets to buckets [-2, -1, 0, 1, 2]</span>
<span class="sd">    4. dot product the orthogonalized predictions and the targets</span>
<span class="sd">   then normalize by the length of the target (equivalent to covariance)</span>

<span class="sd">    :param dataf: DataFrame containing era_col, pred_col, target_col and other_col.</span>
<span class="sd">    :param pred_col: Prediction column to calculate MMC for.</span>
<span class="sd">    :param target_col: Target column to calculate MMC against.</span>
<span class="sd">    Make sure the range of targets is [0, 1] (inclusive). </span>
<span class="sd">    If the function is called from full_evalation, this is guaranteed because of the checks.</span>
<span class="sd">    :param other_col: Meta model column containing predictions to neutralize against.</span>

<span class="sd">    :return: A 1D NumPy array of contributive correlations by era.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">mc_scores</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">dataf</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">era_col</span><span class="p">):</span>
        <span class="n">mc</span> <span class="o">=</span> <span class="n">correlation_contribution</span><span class="p">(</span><span class="n">x</span><span class="p">[[</span><span class="n">pred_col</span><span class="p">]],</span> 
                                      <span class="n">x</span><span class="p">[</span><span class="n">other_col</span><span class="p">],</span> 
                                      <span class="n">x</span><span class="p">[</span><span class="n">target_col</span><span class="p">])</span>
        <span class="n">mc_scores</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mc</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mc_scores</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="numerblox.evaluation.BaseEvaluator.cross_correlation" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">cross_correlation</span><span class="p">(</span><span class="n">dataf</span><span class="p">,</span> <span class="n">pred_col</span><span class="p">,</span> <span class="n">other_col</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Corrv2 correlation with other predictions (like another model, example predictions or meta model prediction).
:param dataf: DataFrame containing both pred_col and other_col.
:param pred_col: Main Prediction.
:param other_col: Other prediction column to calculate correlation with pred_col.</p>
<p>:return: Correlation between Corrv2's of pred_col and other_col.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/evaluation.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">cross_correlation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">pred_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">other_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Corrv2 correlation with other predictions (like another model, example predictions or meta model prediction).</span>
<span class="sd">    :param dataf: DataFrame containing both pred_col and other_col.</span>
<span class="sd">    :param pred_col: Main Prediction.</span>
<span class="sd">    :param other_col: Other prediction column to calculate correlation with pred_col.</span>

<span class="sd">    :return: Correlation between Corrv2&#39;s of pred_col and other_col.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">per_era_numerai_corrs</span><span class="p">(</span>
        <span class="n">dataf</span><span class="o">=</span><span class="n">dataf</span><span class="p">,</span>
        <span class="n">pred_col</span><span class="o">=</span><span class="n">pred_col</span><span class="p">,</span>
        <span class="n">target_col</span><span class="o">=</span><span class="n">other_col</span><span class="p">,</span>
    <span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="numerblox.evaluation.BaseEvaluator.evaluation_one_col" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">evaluation_one_col</span><span class="p">(</span><span class="n">dataf</span><span class="p">,</span> <span class="n">feature_cols</span><span class="p">,</span> <span class="n">pred_col</span><span class="p">,</span> <span class="n">target_col</span><span class="p">,</span> <span class="n">benchmark_cols</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Perform evaluation for one prediction column
against given target and benchmark column(s).</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/evaluation.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">evaluation_one_col</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">feature_cols</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
    <span class="n">pred_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">benchmark_cols</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Perform evaluation for one prediction column</span>
<span class="sd">    against given target and benchmark column(s).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">era_col</span> <span class="ow">in</span> <span class="n">dataf</span><span class="o">.</span><span class="n">columns</span>
    <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Era column &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">era_col</span><span class="si">}</span><span class="s2">&#39; not found in DataFrame. Make sure to set the correct era_col.&quot;</span>
    <span class="k">assert</span> <span class="p">(</span>
            <span class="n">pred_col</span> <span class="ow">in</span> <span class="n">dataf</span><span class="o">.</span><span class="n">columns</span>
        <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Prediction column &#39;</span><span class="si">{</span><span class="n">pred_col</span><span class="si">}</span><span class="s2">&#39; not found in DataFrame. Make sure to set the correct pred_col.&quot;</span>
    <span class="k">assert</span> <span class="p">(</span>
        <span class="n">target_col</span> <span class="ow">in</span> <span class="n">dataf</span><span class="o">.</span><span class="n">columns</span>
    <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Target column &#39;</span><span class="si">{</span><span class="n">target_col</span><span class="si">}</span><span class="s2">&#39; not found in DataFrame. Make sure to set the correct target_col.&quot;</span>
    <span class="k">if</span> <span class="n">benchmark_cols</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">benchmark_cols</span><span class="p">:</span>
            <span class="k">assert</span> <span class="p">(</span>
                <span class="n">col</span> <span class="ow">in</span> <span class="n">dataf</span><span class="o">.</span><span class="n">columns</span>
            <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Benchmark column &#39;</span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s2">&#39; not found in DataFrame. Make sure to set the correct benchmark_cols.&quot;</span>

    <span class="c1"># Check that all values are between 0 and 1</span>
    <span class="k">assert</span> <span class="p">(</span>
        <span class="n">dataf</span><span class="p">[</span><span class="n">pred_col</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">dataf</span><span class="p">[</span><span class="n">pred_col</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="mi">1</span>
    <span class="p">),</span> <span class="s2">&quot;All predictions should be between 0 and 1 (inclusive).&quot;</span>
    <span class="k">assert</span> <span class="p">(</span>
        <span class="n">dataf</span><span class="p">[</span><span class="n">target_col</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">dataf</span><span class="p">[</span><span class="n">target_col</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="mi">1</span>
    <span class="p">),</span> <span class="s2">&quot;All targets should be between 0 and 1 (inclusive).&quot;</span>
    <span class="k">if</span> <span class="n">benchmark_cols</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">benchmark_cols</span><span class="p">:</span>
            <span class="k">assert</span> <span class="p">(</span>
                <span class="n">dataf</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">dataf</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="mi">1</span>
            <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;All predictions for &#39;</span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s2">&#39; should be between 0 and 1 (inclusive).&quot;</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_detailed_progress_bar</span><span class="p">:</span>
        <span class="n">len_metrics_list</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metrics_list</span><span class="p">)</span>
        <span class="n">len_benchmark_cols</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">benchmark_cols</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="nb">len</span><span class="p">(</span><span class="n">benchmark_cols</span><span class="p">)</span>
        <span class="n">len_custom_functions</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">custom_functions</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">custom_functions</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
        <span class="n">len_pbar</span> <span class="o">=</span> <span class="n">len_metrics_list</span> <span class="o">+</span> <span class="n">len_benchmark_cols</span> <span class="o">+</span> <span class="n">len_custom_functions</span>
        <span class="n">pbar</span> <span class="o">=</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">total</span><span class="o">=</span><span class="n">len_pbar</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Evaluation&quot;</span><span class="p">)</span>

    <span class="n">col_stats</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">col_stats</span><span class="p">[</span><span class="s2">&quot;target&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">target_col</span>

    <span class="c1"># Compute stats per era (only if needed)</span>
    <span class="n">per_era_numerai_corrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">per_era_numerai_corrs</span><span class="p">(</span>
        <span class="n">dataf</span><span class="o">=</span><span class="n">dataf</span><span class="p">,</span> <span class="n">pred_col</span><span class="o">=</span><span class="n">pred_col</span><span class="p">,</span> <span class="n">target_col</span><span class="o">=</span><span class="n">target_col</span>
    <span class="p">)</span>

    <span class="c1"># check if mean, std, or sharpe are in metrics_list</span>
    <span class="k">if</span> <span class="s2">&quot;mean_std_sharpe&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metrics_list</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_detailed_progress_bar</span><span class="p">:</span>
            <span class="n">pbar</span><span class="o">.</span><span class="n">set_description_str</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;mean_std_sharpe for evaluation&quot;</span><span class="p">)</span>
            <span class="n">pbar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">mean</span><span class="p">,</span> <span class="n">std</span><span class="p">,</span> <span class="n">sharpe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean_std_sharpe</span><span class="p">(</span><span class="n">era_corrs</span><span class="o">=</span><span class="n">per_era_numerai_corrs</span><span class="p">)</span>
        <span class="n">col_stats</span><span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean</span>
        <span class="n">col_stats</span><span class="p">[</span><span class="s2">&quot;std&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">std</span>
        <span class="n">col_stats</span><span class="p">[</span><span class="s2">&quot;sharpe&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sharpe</span>

    <span class="k">if</span> <span class="s2">&quot;legacy_mean_std_sharpe&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metrics_list</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_detailed_progress_bar</span><span class="p">:</span>
            <span class="n">pbar</span><span class="o">.</span><span class="n">set_description_str</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;legacy_mean_std_sharpe for evaluation&quot;</span><span class="p">)</span>
            <span class="n">pbar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">per_era_corrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">per_era_corrs</span><span class="p">(</span>
            <span class="n">dataf</span><span class="o">=</span><span class="n">dataf</span><span class="p">,</span> <span class="n">pred_col</span><span class="o">=</span><span class="n">pred_col</span><span class="p">,</span> <span class="n">target_col</span><span class="o">=</span><span class="n">target_col</span>
        <span class="p">)</span>
        <span class="n">legacy_mean</span><span class="p">,</span> <span class="n">legacy_std</span><span class="p">,</span> <span class="n">legacy_sharpe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean_std_sharpe</span><span class="p">(</span>
            <span class="n">era_corrs</span><span class="o">=</span><span class="n">per_era_corrs</span>
        <span class="p">)</span>
        <span class="n">col_stats</span><span class="p">[</span><span class="s2">&quot;legacy_mean&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">legacy_mean</span>
        <span class="n">col_stats</span><span class="p">[</span><span class="s2">&quot;legacy_std&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">legacy_std</span>
        <span class="n">col_stats</span><span class="p">[</span><span class="s2">&quot;legacy_sharpe&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">legacy_sharpe</span>

    <span class="k">if</span> <span class="s2">&quot;max_drawdown&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metrics_list</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_detailed_progress_bar</span><span class="p">:</span>
            <span class="n">pbar</span><span class="o">.</span><span class="n">set_description_str</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;max_drawdown for evaluation&quot;</span><span class="p">)</span>
            <span class="n">pbar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">col_stats</span><span class="p">[</span><span class="s2">&quot;max_drawdown&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_drawdown</span><span class="p">(</span>
            <span class="n">era_corrs</span><span class="o">=</span><span class="n">per_era_numerai_corrs</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="s2">&quot;apy&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_detailed_progress_bar</span><span class="p">:</span>
            <span class="n">pbar</span><span class="o">.</span><span class="n">set_description_str</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;apy for evaluation&quot;</span><span class="p">)</span>
            <span class="n">pbar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">col_stats</span><span class="p">[</span><span class="s2">&quot;apy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apy</span><span class="p">(</span><span class="n">era_corrs</span><span class="o">=</span><span class="n">per_era_numerai_corrs</span><span class="p">)</span>

    <span class="k">if</span> <span class="s2">&quot;calmar_ratio&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metrics_list</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_detailed_progress_bar</span><span class="p">:</span>
            <span class="n">pbar</span><span class="o">.</span><span class="n">set_description_str</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;calmar_ratio for evaluation&quot;</span><span class="p">)</span>
            <span class="n">pbar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="s2">&quot;max_drawdown&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metrics_list</span><span class="p">:</span>
            <span class="n">col_stats</span><span class="p">[</span><span class="s2">&quot;max_drawdown&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_drawdown</span><span class="p">(</span>
                <span class="n">era_corrs</span><span class="o">=</span><span class="n">per_era_numerai_corrs</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="s2">&quot;apy&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metrics_list</span><span class="p">:</span>
            <span class="n">col_stats</span><span class="p">[</span><span class="s2">&quot;apy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apy</span><span class="p">(</span><span class="n">era_corrs</span><span class="o">=</span><span class="n">per_era_numerai_corrs</span><span class="p">)</span>
        <span class="n">col_stats</span><span class="p">[</span><span class="s2">&quot;calmar_ratio&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
            <span class="k">if</span> <span class="n">col_stats</span><span class="p">[</span><span class="s2">&quot;max_drawdown&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span>
            <span class="k">else</span> <span class="n">col_stats</span><span class="p">[</span><span class="s2">&quot;apy&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="o">-</span><span class="n">col_stats</span><span class="p">[</span><span class="s2">&quot;max_drawdown&quot;</span><span class="p">]</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="s2">&quot;autocorrelation&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metrics_list</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_detailed_progress_bar</span><span class="p">:</span>
            <span class="n">pbar</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;autocorrelation for evaluation&quot;</span><span class="p">)</span>
            <span class="n">pbar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">col_stats</span><span class="p">[</span><span class="s2">&quot;autocorrelation&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">autocorr1</span><span class="p">(</span><span class="n">per_era_numerai_corrs</span><span class="p">)</span>

    <span class="k">if</span> <span class="s2">&quot;max_feature_exposure&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metrics_list</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_detailed_progress_bar</span><span class="p">:</span>
            <span class="n">pbar</span><span class="o">.</span><span class="n">set_description_str</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;max_feature_exposure for evaluation&quot;</span><span class="p">)</span>
            <span class="n">pbar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">col_stats</span><span class="p">[</span><span class="s2">&quot;max_feature_exposure&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_feature_exposure</span><span class="p">(</span>
            <span class="n">dataf</span><span class="o">=</span><span class="n">dataf</span><span class="p">,</span> <span class="n">feature_cols</span><span class="o">=</span><span class="n">feature_cols</span><span class="p">,</span> <span class="n">pred_col</span><span class="o">=</span><span class="n">pred_col</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="s2">&quot;smart_sharpe&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metrics_list</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_detailed_progress_bar</span><span class="p">:</span>
            <span class="n">pbar</span><span class="o">.</span><span class="n">set_description_str</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;smart_sharpe for evaluation&quot;</span><span class="p">)</span>
            <span class="n">pbar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">col_stats</span><span class="p">[</span><span class="s2">&quot;smart_sharpe&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">smart_sharpe</span><span class="p">(</span>
            <span class="n">era_corrs</span><span class="o">=</span><span class="n">per_era_numerai_corrs</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">benchmark_cols</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">bench_col</span> <span class="ow">in</span> <span class="n">benchmark_cols</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_detailed_progress_bar</span><span class="p">:</span>
                <span class="n">pbar</span><span class="o">.</span><span class="n">set_description_str</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Evaluation for benchmark column: &#39;</span><span class="si">{</span><span class="n">bench_col</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
                <span class="n">pbar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

            <span class="n">per_era_bench_corrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">per_era_numerai_corrs</span><span class="p">(</span>
                <span class="n">dataf</span><span class="o">=</span><span class="n">dataf</span><span class="p">,</span> <span class="n">pred_col</span><span class="o">=</span><span class="n">bench_col</span><span class="p">,</span> <span class="n">target_col</span><span class="o">=</span><span class="n">target_col</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="s2">&quot;mean_std_sharpe&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metrics_list</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_detailed_progress_bar</span><span class="p">:</span>
                    <span class="n">pbar</span><span class="o">.</span><span class="n">set_description_str</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;mean_std_sharpe for benchmark column: &#39;</span><span class="si">{</span><span class="n">bench_col</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
                <span class="n">bench_mean</span><span class="p">,</span> <span class="n">bench_std</span><span class="p">,</span> <span class="n">bench_sharpe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean_std_sharpe</span><span class="p">(</span>
                    <span class="n">era_corrs</span><span class="o">=</span><span class="n">per_era_bench_corrs</span>
                <span class="p">)</span>
                <span class="n">col_stats</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;mean_vs_</span><span class="si">{</span><span class="n">bench_col</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean</span> <span class="o">-</span> <span class="n">bench_mean</span>
                <span class="n">col_stats</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;std_vs_</span><span class="si">{</span><span class="n">bench_col</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">std</span> <span class="o">-</span> <span class="n">bench_std</span>
                <span class="n">col_stats</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;sharpe_vs_</span><span class="si">{</span><span class="n">bench_col</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sharpe</span> <span class="o">-</span> <span class="n">bench_sharpe</span>

            <span class="k">if</span> <span class="s2">&quot;mc_mean_std_sharpe&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metrics_list</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_detailed_progress_bar</span><span class="p">:</span>
                    <span class="n">pbar</span><span class="o">.</span><span class="n">set_description_str</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;mc_mean_std_sharpe for benchmark column: &#39;</span><span class="si">{</span><span class="n">bench_col</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
                <span class="n">mc_scores</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">contributive_correlation</span><span class="p">(</span>
                    <span class="n">dataf</span><span class="o">=</span><span class="n">dataf</span><span class="p">,</span>
                    <span class="n">pred_col</span><span class="o">=</span><span class="n">pred_col</span><span class="p">,</span>
                    <span class="n">target_col</span><span class="o">=</span><span class="n">target_col</span><span class="p">,</span>
                    <span class="n">other_col</span><span class="o">=</span><span class="n">bench_col</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">col_stats</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;mc_mean_</span><span class="si">{</span><span class="n">bench_col</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">mc_scores</span><span class="p">)</span>
                <span class="n">col_stats</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;mc_std_</span><span class="si">{</span><span class="n">bench_col</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanstd</span><span class="p">(</span><span class="n">mc_scores</span><span class="p">)</span>
                <span class="n">col_stats</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;mc_sharpe_</span><span class="si">{</span><span class="n">bench_col</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                    <span class="k">if</span> <span class="n">col_stats</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;mc_std_</span><span class="si">{</span><span class="n">bench_col</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span>
                    <span class="k">else</span> <span class="n">col_stats</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;mc_mean_</span><span class="si">{</span><span class="n">bench_col</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
                    <span class="o">/</span> <span class="n">col_stats</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;mc_std_</span><span class="si">{</span><span class="n">bench_col</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
                <span class="p">)</span>

            <span class="k">if</span> <span class="s2">&quot;corr_with&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metrics_list</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_detailed_progress_bar</span><span class="p">:</span>
                    <span class="n">pbar</span><span class="o">.</span><span class="n">set_description_str</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;corr_with for benchmark column: &#39;</span><span class="si">{</span><span class="n">bench_col</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
                <span class="n">col_stats</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;corr_with_</span><span class="si">{</span><span class="n">bench_col</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cross_correlation</span><span class="p">(</span>
                    <span class="n">dataf</span><span class="o">=</span><span class="n">dataf</span><span class="p">,</span> <span class="n">pred_col</span><span class="o">=</span><span class="n">bench_col</span><span class="p">,</span> <span class="n">other_col</span><span class="o">=</span><span class="n">bench_col</span>
                <span class="p">)</span>

            <span class="k">if</span> <span class="s2">&quot;legacy_mc_mean_std_sharpe&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metrics_list</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_detailed_progress_bar</span><span class="p">:</span>
                    <span class="n">pbar</span><span class="o">.</span><span class="n">set_description_str</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;legacy_mc_mean_std_sharpe for benchmark column: &#39;</span><span class="si">{</span><span class="n">bench_col</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
                <span class="n">legacy_mc_scores</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">legacy_contribution</span><span class="p">(</span>
                    <span class="n">dataf</span><span class="o">=</span><span class="n">dataf</span><span class="p">,</span>
                    <span class="n">pred_col</span><span class="o">=</span><span class="n">pred_col</span><span class="p">,</span>
                    <span class="n">target_col</span><span class="o">=</span><span class="n">target_col</span><span class="p">,</span>
                    <span class="n">other_col</span><span class="o">=</span><span class="n">bench_col</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">col_stats</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;legacy_mc_mean_</span><span class="si">{</span><span class="n">bench_col</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span>
                    <span class="n">legacy_mc_scores</span>
                <span class="p">)</span>
                <span class="n">col_stats</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;legacy_mc_std_</span><span class="si">{</span><span class="n">bench_col</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanstd</span><span class="p">(</span>
                    <span class="n">legacy_mc_scores</span>
                <span class="p">)</span>
                <span class="n">col_stats</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;legacy_mc_sharpe_</span><span class="si">{</span><span class="n">bench_col</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                    <span class="k">if</span> <span class="n">col_stats</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;legacy_mc_std_</span><span class="si">{</span><span class="n">bench_col</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span>
                    <span class="k">else</span> <span class="n">col_stats</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;legacy_mc_mean_</span><span class="si">{</span><span class="n">bench_col</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
                    <span class="o">/</span> <span class="n">col_stats</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;legacy_mc_std_</span><span class="si">{</span><span class="n">bench_col</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
                <span class="p">)</span>

            <span class="k">if</span> <span class="s2">&quot;ex_diss&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metrics_list</span> <span class="ow">or</span> <span class="s2">&quot;ex_diss_pearson&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metrics_list</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_detailed_progress_bar</span><span class="p">:</span>
                    <span class="n">pbar</span><span class="o">.</span><span class="n">set_description_str</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ex_diss_pearson for benchmark column: &#39;</span><span class="si">{</span><span class="n">bench_col</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
                <span class="n">col_stats</span><span class="p">[</span>
                    <span class="sa">f</span><span class="s2">&quot;exposure_dissimilarity_pearson_</span><span class="si">{</span><span class="n">bench_col</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exposure_dissimilarity</span><span class="p">(</span>
                    <span class="n">dataf</span><span class="o">=</span><span class="n">dataf</span><span class="p">,</span> <span class="n">pred_col</span><span class="o">=</span><span class="n">pred_col</span><span class="p">,</span> <span class="n">other_col</span><span class="o">=</span><span class="n">bench_col</span><span class="p">,</span>
                    <span class="n">corr_method</span><span class="o">=</span><span class="s2">&quot;pearson&quot;</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="s2">&quot;ex_diss_spearman&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metrics_list</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_detailed_progress_bar</span><span class="p">:</span>
                    <span class="n">pbar</span><span class="o">.</span><span class="n">set_description_str</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ex_diss_spearman for benchmark column: &#39;</span><span class="si">{</span><span class="n">bench_col</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
                <span class="n">col_stats</span><span class="p">[</span>
                    <span class="sa">f</span><span class="s2">&quot;exposure_dissimilarity_spearman_</span><span class="si">{</span><span class="n">bench_col</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exposure_dissimilarity</span><span class="p">(</span>
                    <span class="n">dataf</span><span class="o">=</span><span class="n">dataf</span><span class="p">,</span> <span class="n">pred_col</span><span class="o">=</span><span class="n">pred_col</span><span class="p">,</span> <span class="n">other_col</span><span class="o">=</span><span class="n">bench_col</span><span class="p">,</span>
                    <span class="n">corr_method</span><span class="o">=</span><span class="s2">&quot;spearman&quot;</span>
                <span class="p">)</span>

    <span class="c1"># Compute intensive stats</span>
    <span class="k">if</span> <span class="s2">&quot;fn_mean_std_sharpe&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metrics_list</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_detailed_progress_bar</span><span class="p">:</span>
            <span class="n">pbar</span><span class="o">.</span><span class="n">set_description_str</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;fn_mean_std_sharpe for evaluation&quot;</span><span class="p">)</span>
            <span class="n">pbar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">fn_mean</span><span class="p">,</span> <span class="n">fn_std</span><span class="p">,</span> <span class="n">fn_sharpe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_neutral_mean_std_sharpe</span><span class="p">(</span>
            <span class="n">dataf</span><span class="o">=</span><span class="n">dataf</span><span class="p">,</span>
            <span class="n">pred_col</span><span class="o">=</span><span class="n">pred_col</span><span class="p">,</span>
            <span class="n">target_col</span><span class="o">=</span><span class="n">target_col</span><span class="p">,</span>
            <span class="n">feature_names</span><span class="o">=</span><span class="n">feature_cols</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">col_stats</span><span class="p">[</span><span class="s2">&quot;feature_neutral_mean&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fn_mean</span>
        <span class="n">col_stats</span><span class="p">[</span><span class="s2">&quot;feature_neutral_std&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fn_std</span>
        <span class="n">col_stats</span><span class="p">[</span><span class="s2">&quot;feature_neutral_sharpe&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fn_sharpe</span>

    <span class="k">if</span> <span class="s2">&quot;tb200_mean_std_sharpe&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metrics_list</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_detailed_progress_bar</span><span class="p">:</span>
            <span class="n">pbar</span><span class="o">.</span><span class="n">set_description_str</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;tb200_mean_std_sharpe for evaluation&quot;</span><span class="p">)</span>
            <span class="n">pbar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">tb200_mean</span><span class="p">,</span> <span class="n">tb200_std</span><span class="p">,</span> <span class="n">tb200_sharpe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tbx_mean_std_sharpe</span><span class="p">(</span>
            <span class="n">dataf</span><span class="o">=</span><span class="n">dataf</span><span class="p">,</span> <span class="n">pred_col</span><span class="o">=</span><span class="n">pred_col</span><span class="p">,</span> <span class="n">target_col</span><span class="o">=</span><span class="n">target_col</span><span class="p">,</span> <span class="n">tb</span><span class="o">=</span><span class="mi">200</span>
        <span class="p">)</span>
        <span class="n">col_stats</span><span class="p">[</span><span class="s2">&quot;tb200_mean&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tb200_mean</span>
        <span class="n">col_stats</span><span class="p">[</span><span class="s2">&quot;tb200_std&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tb200_std</span>
        <span class="n">col_stats</span><span class="p">[</span><span class="s2">&quot;tb200_sharpe&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tb200_sharpe</span>

    <span class="k">if</span> <span class="s2">&quot;tb500_mean_std_sharpe&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metrics_list</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_detailed_progress_bar</span><span class="p">:</span>
            <span class="n">pbar</span><span class="o">.</span><span class="n">set_description_str</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;tb500_mean_std_sharpe for evaluation&quot;</span><span class="p">)</span>
            <span class="n">pbar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">tb500_mean</span><span class="p">,</span> <span class="n">tb500_std</span><span class="p">,</span> <span class="n">tb500_sharpe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tbx_mean_std_sharpe</span><span class="p">(</span>
            <span class="n">dataf</span><span class="o">=</span><span class="n">dataf</span><span class="p">,</span> <span class="n">pred_col</span><span class="o">=</span><span class="n">pred_col</span><span class="p">,</span> <span class="n">target_col</span><span class="o">=</span><span class="n">target_col</span><span class="p">,</span> <span class="n">tb</span><span class="o">=</span><span class="mi">500</span>
        <span class="p">)</span>
        <span class="n">col_stats</span><span class="p">[</span><span class="s2">&quot;tb500_mean&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tb500_mean</span>
        <span class="n">col_stats</span><span class="p">[</span><span class="s2">&quot;tb500_std&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tb500_std</span>
        <span class="n">col_stats</span><span class="p">[</span><span class="s2">&quot;tb500_sharpe&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tb500_sharpe</span>

    <span class="c1"># Custom functions</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">custom_functions</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">local_vars</span> <span class="o">=</span> <span class="nb">locals</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">func_name</span><span class="p">,</span> <span class="n">func_info</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">custom_functions</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_detailed_progress_bar</span><span class="p">:</span>
                <span class="n">pbar</span><span class="o">.</span><span class="n">set_description_str</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;custom function: &#39;</span><span class="si">{</span><span class="n">func_name</span><span class="si">}</span><span class="s2">&#39; for evaluation&quot;</span><span class="p">)</span>
                <span class="n">pbar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">func</span> <span class="o">=</span> <span class="n">func_info</span><span class="p">[</span><span class="s1">&#39;func&#39;</span><span class="p">]</span>
            <span class="n">args</span> <span class="o">=</span> <span class="n">func_info</span><span class="p">[</span><span class="s1">&#39;args&#39;</span><span class="p">]</span>
            <span class="n">local_args</span> <span class="o">=</span> <span class="n">func_info</span><span class="p">[</span><span class="s1">&#39;local_args&#39;</span><span class="p">]</span>
            <span class="n">resolved_args</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">args</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="c1"># Resolve variables defined as local args</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">local_args</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">v</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">local_vars</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Variable &#39;</span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2">&#39; was defined in &#39;local_args&#39;, but was not found in local variables. Make sure to set the correct local_args.&quot;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">resolved_args</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">local_vars</span><span class="p">[</span><span class="n">v</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">resolved_args</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
            <span class="n">col_stats</span><span class="p">[</span><span class="n">func_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">**</span><span class="n">resolved_args</span><span class="p">)</span>

    <span class="n">col_stats_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">col_stats</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="n">pred_col</span><span class="p">])</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_detailed_progress_bar</span><span class="p">:</span>
        <span class="n">pbar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">pbar</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">col_stats_df</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="numerblox.evaluation.BaseEvaluator.exposure_dissimilarity" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">exposure_dissimilarity</span><span class="p">(</span><span class="n">dataf</span><span class="p">,</span> <span class="n">pred_col</span><span class="p">,</span> <span class="n">other_col</span><span class="p">,</span> <span class="n">corr_method</span><span class="o">=</span><span class="s1">&#39;pearson&#39;</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Model pattern of feature exposure to the another column.
See TC details forum post: https://forum.numer.ai/t/true-contribution-details/5128/4
:param dataf: DataFrame containing both pred_col and other_col.
:param pred_col: Main Prediction.
:param other_col: Other prediction column to calculate exposure dissimilarity against.
:param corr_method: Correlation method to use for calculating feature exposures.
corr_method should be one of ['pearson', 'kendall', 'spearman']. Default: 'pearson'.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/evaluation.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">exposure_dissimilarity</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">pred_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">other_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">corr_method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;pearson&quot;</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Model pattern of feature exposure to the another column.</span>
<span class="sd">    See TC details forum post: https://forum.numer.ai/t/true-contribution-details/5128/4</span>
<span class="sd">    :param dataf: DataFrame containing both pred_col and other_col.</span>
<span class="sd">    :param pred_col: Main Prediction.</span>
<span class="sd">    :param other_col: Other prediction column to calculate exposure dissimilarity against.</span>
<span class="sd">    :param corr_method: Correlation method to use for calculating feature exposures.</span>
<span class="sd">    corr_method should be one of [&#39;pearson&#39;, &#39;kendall&#39;, &#39;spearman&#39;]. Default: &#39;pearson&#39;.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">corr_method</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;pearson&quot;</span><span class="p">,</span> <span class="s2">&quot;kendall&quot;</span><span class="p">,</span> <span class="s2">&quot;spearman&quot;</span><span class="p">],</span> <span class="sa">f</span><span class="s2">&quot;corr_method should be one of [&#39;pearson&#39;, &#39;kendall&#39;, &#39;spearman&#39;]. Got: &#39;</span><span class="si">{</span><span class="n">corr_method</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
    <span class="n">feature_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">dataf</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">col</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;feature&quot;</span><span class="p">)]</span>
    <span class="n">U</span> <span class="o">=</span> <span class="n">dataf</span><span class="p">[</span><span class="n">feature_cols</span><span class="p">]</span><span class="o">.</span><span class="n">corrwith</span><span class="p">(</span><span class="n">dataf</span><span class="p">[</span><span class="n">pred_col</span><span class="p">],</span> <span class="n">method</span><span class="o">=</span><span class="n">corr_method</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>
    <span class="n">E</span> <span class="o">=</span> <span class="n">dataf</span><span class="p">[</span><span class="n">feature_cols</span><span class="p">]</span><span class="o">.</span><span class="n">corrwith</span><span class="p">(</span><span class="n">dataf</span><span class="p">[</span><span class="n">other_col</span><span class="p">],</span> <span class="n">method</span><span class="o">=</span><span class="n">corr_method</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>

    <span class="n">denominator</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">E</span><span class="p">,</span> <span class="n">E</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">denominator</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">exp_dis</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">exp_dis</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">U</span><span class="p">,</span> <span class="n">E</span><span class="p">)</span> <span class="o">/</span> <span class="n">denominator</span>
    <span class="k">return</span> <span class="n">exp_dis</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="numerblox.evaluation.BaseEvaluator.feature_neutral_mean_std_sharpe" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">feature_neutral_mean_std_sharpe</span><span class="p">(</span><span class="n">dataf</span><span class="p">,</span> <span class="n">pred_col</span><span class="p">,</span> <span class="n">target_col</span><span class="p">,</span> <span class="n">feature_names</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Feature neutralized mean performance.
More info: https://docs.numer.ai/tournament/feature-neutral-correlation</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/evaluation.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">feature_neutral_mean_std_sharpe</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">pred_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">feature_names</span><span class="p">:</span> <span class="nb">list</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Feature neutralized mean performance.</span>
<span class="sd">    More info: https://docs.numer.ai/tournament/feature-neutral-correlation</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fn</span> <span class="o">=</span> <span class="n">FeatureNeutralizer</span><span class="p">(</span><span class="n">pred_name</span><span class="o">=</span><span class="n">pred_col</span><span class="p">,</span> <span class="n">proportion</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
    <span class="n">neutralized_preds</span> <span class="o">=</span> <span class="n">fn</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span>
        <span class="n">dataf</span><span class="p">[</span><span class="n">pred_col</span><span class="p">],</span> <span class="n">features</span><span class="o">=</span><span class="n">dataf</span><span class="p">[</span><span class="n">feature_names</span><span class="p">],</span> <span class="n">eras</span><span class="o">=</span><span class="n">dataf</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">era_col</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="c1"># Construct new DataFrame with era col, target col and preds</span>
    <span class="n">neutralized_dataf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">era_col</span><span class="p">,</span> <span class="n">target_col</span><span class="p">,</span> <span class="n">pred_col</span><span class="p">])</span>
    <span class="n">neutralized_dataf</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">era_col</span><span class="p">]</span> <span class="o">=</span> <span class="n">dataf</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">era_col</span><span class="p">]</span>
    <span class="n">neutralized_dataf</span><span class="p">[</span><span class="n">target_col</span><span class="p">]</span> <span class="o">=</span> <span class="n">dataf</span><span class="p">[</span><span class="n">target_col</span><span class="p">]</span>
    <span class="n">neutralized_dataf</span><span class="p">[</span><span class="n">pred_col</span><span class="p">]</span> <span class="o">=</span> <span class="n">neutralized_preds</span>

    <span class="n">neutral_corrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">per_era_numerai_corrs</span><span class="p">(</span>
        <span class="n">dataf</span><span class="o">=</span><span class="n">neutralized_dataf</span><span class="p">,</span>
        <span class="n">pred_col</span><span class="o">=</span><span class="n">pred_col</span><span class="p">,</span>
        <span class="n">target_col</span><span class="o">=</span><span class="n">target_col</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">mean</span><span class="p">,</span> <span class="n">std</span><span class="p">,</span> <span class="n">sharpe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean_std_sharpe</span><span class="p">(</span><span class="n">era_corrs</span><span class="o">=</span><span class="n">neutral_corrs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">mean</span><span class="p">,</span> <span class="n">std</span><span class="p">,</span> <span class="n">sharpe</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="numerblox.evaluation.BaseEvaluator.full_evaluation" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">full_evaluation</span><span class="p">(</span><span class="n">dataf</span><span class="p">,</span> <span class="n">pred_cols</span><span class="p">,</span> <span class="n">target_col</span><span class="o">=</span><span class="s1">&#39;target&#39;</span><span class="p">,</span> <span class="n">benchmark_cols</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Perform evaluation for each prediction column in pred_cols.
By default only the "prediction" column is evaluated.
Evaluation is done against given target and benchmark prediction column.
:param dataf: DataFrame containing era_col, pred_cols, target_col and optional benchmark_cols.
:param pred_cols: List of prediction columns to calculate evaluation metrics for.
:param target_col: Target column to evaluate against.
:param benchmark_cols: Optional list of benchmark columns to calculate evaluation metrics for.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/evaluation.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">full_evaluation</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">pred_cols</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;target&quot;</span><span class="p">,</span>
    <span class="n">benchmark_cols</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Perform evaluation for each prediction column in pred_cols.</span>
<span class="sd">    By default only the &quot;prediction&quot; column is evaluated.</span>
<span class="sd">    Evaluation is done against given target and benchmark prediction column.</span>
<span class="sd">    :param dataf: DataFrame containing era_col, pred_cols, target_col and optional benchmark_cols.</span>
<span class="sd">    :param pred_cols: List of prediction columns to calculate evaluation metrics for.</span>
<span class="sd">    :param target_col: Target column to evaluate against.</span>
<span class="sd">    :param benchmark_cols: Optional list of benchmark columns to calculate evaluation metrics for.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">val_stats</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
    <span class="n">feature_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">dataf</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">col</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;feature&quot;</span><span class="p">)]</span>
    <span class="n">cat_cols</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">dataf</span><span class="p">[</span><span class="n">feature_cols</span><span class="p">]</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;category&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">cat_cols</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;WARNING: Categorical features detected that cannot be used for neutralization. Removing columns: &#39;</span><span class="si">{</span><span class="n">cat_cols</span><span class="si">}</span><span class="s2">&#39; for evaluation.&quot;</span>
        <span class="p">)</span>
        <span class="n">dataf</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">feature_cols</span><span class="p">]</span> <span class="o">=</span> <span class="n">dataf</span><span class="p">[</span><span class="n">feature_cols</span><span class="p">]</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span>
            <span class="n">exclude</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;category&quot;</span><span class="p">]</span>
        <span class="p">)</span>
    <span class="n">dataf</span> <span class="o">=</span> <span class="n">dataf</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">pred_cols</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Evaluation: &quot;</span><span class="p">):</span>
        <span class="n">col_stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluation_one_col</span><span class="p">(</span>
            <span class="n">dataf</span><span class="o">=</span><span class="n">dataf</span><span class="p">,</span>
            <span class="n">pred_col</span><span class="o">=</span><span class="n">col</span><span class="p">,</span>
            <span class="n">feature_cols</span><span class="o">=</span><span class="n">feature_cols</span><span class="p">,</span>
            <span class="n">target_col</span><span class="o">=</span><span class="n">target_col</span><span class="p">,</span>
            <span class="n">benchmark_cols</span><span class="o">=</span><span class="n">benchmark_cols</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">val_stats</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">val_stats</span><span class="p">,</span> <span class="n">col_stats</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">val_stats</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="numerblox.evaluation.BaseEvaluator.get_feature_exposures_corrv2" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_feature_exposures_corrv2</span><span class="p">(</span><span class="n">dataf</span><span class="p">,</span> <span class="n">pred_col</span><span class="p">,</span> <span class="n">feature_list</span><span class="p">,</span> <span class="n">cpu_cores</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Calculate feature exposures for each era using 'Numerai Corr'.
Results will be similar to get_feature_exposures() but more accurate.
This method will take longer to compute.</p>
<p>:param dataf: DataFrame containing predictions, features, and eras.
:param pred_col: Prediction column to calculate feature exposures for.
:param feature_list: List of feature columns in X.
:param cpu_cores: Number of CPU cores to use for parallelization.
Default: -1 (all cores).
:return: DataFrame with Corrv2 feature exposures by era for each feature.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/evaluation.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_feature_exposures_corrv2</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">pred_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">feature_list</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">cpu_cores</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate feature exposures for each era using &#39;Numerai Corr&#39;.</span>
<span class="sd">    Results will be similar to get_feature_exposures() but more accurate.</span>
<span class="sd">    This method will take longer to compute.</span>

<span class="sd">    :param dataf: DataFrame containing predictions, features, and eras.</span>
<span class="sd">    :param pred_col: Prediction column to calculate feature exposures for.</span>
<span class="sd">    :param feature_list: List of feature columns in X.</span>
<span class="sd">    :param cpu_cores: Number of CPU cores to use for parallelization.</span>
<span class="sd">    Default: -1 (all cores).</span>
<span class="sd">    :return: DataFrame with Corrv2 feature exposures by era for each feature.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">calculate_era_feature_exposure</span><span class="p">(</span><span class="n">era</span><span class="p">,</span> <span class="n">group</span><span class="p">,</span> <span class="n">pred_col</span><span class="p">,</span> <span class="n">feature_list</span><span class="p">):</span>
        <span class="n">exposures</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">feature_list</span><span class="p">:</span>
            <span class="n">corr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">numerai_corr</span><span class="p">(</span>
                <span class="n">group</span><span class="p">,</span> <span class="n">pred_col</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">pred_col</span><span class="si">}</span><span class="s2">_normalized&quot;</span><span class="p">,</span> <span class="n">target_col</span><span class="o">=</span><span class="n">feature</span>
            <span class="p">)</span>
            <span class="n">exposures</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span> <span class="o">=</span> <span class="n">corr</span>
        <span class="k">return</span> <span class="n">era</span><span class="p">,</span> <span class="n">exposures</span>

    <span class="n">normalized_ranks</span> <span class="o">=</span> <span class="p">(</span><span class="n">dataf</span><span class="p">[[</span><span class="n">pred_col</span><span class="p">]]</span><span class="o">.</span><span class="n">rank</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;first&quot;</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">dataf</span><span class="p">)</span>
    <span class="n">dataf</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">pred_col</span><span class="si">}</span><span class="s2">_normalized&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">normalized_ranks</span><span class="p">)</span>
    <span class="n">feature_exposure_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
        <span class="n">index</span><span class="o">=</span><span class="n">dataf</span><span class="p">[</span><span class="s2">&quot;era&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">(),</span> <span class="n">columns</span><span class="o">=</span><span class="n">feature_list</span>
    <span class="p">)</span>

    <span class="n">grouped_data</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">dataf</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;era&quot;</span><span class="p">))</span>

    <span class="n">results</span> <span class="o">=</span> <span class="n">Parallel</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=</span><span class="n">cpu_cores</span><span class="p">)(</span>
        <span class="n">delayed</span><span class="p">(</span><span class="n">calculate_era_feature_exposure</span><span class="p">)(</span><span class="n">era</span><span class="p">,</span> <span class="n">group</span><span class="p">,</span> <span class="n">pred_col</span><span class="p">,</span> <span class="n">feature_list</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">era</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">grouped_data</span>
    <span class="p">)</span>
    <span class="k">for</span> <span class="n">era</span><span class="p">,</span> <span class="n">exposures</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
        <span class="n">feature_exposure_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">era</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">exposures</span>
    <span class="k">return</span> <span class="n">feature_exposure_data</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="numerblox.evaluation.BaseEvaluator.get_feature_exposures_pearson" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_feature_exposures_pearson</span><span class="p">(</span><span class="n">dataf</span><span class="p">,</span> <span class="n">pred_col</span><span class="p">,</span> <span class="n">feature_list</span><span class="p">,</span> <span class="n">cpu_cores</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Calculate feature exposures for each era using Pearson correlation.</p>
<p>:param dataf: DataFrame containing predictions, features, and eras.
:param pred_col: Prediction column to calculate feature exposures for.
:param feature_list: List of feature columns in X.
:param cpu_cores: Number of CPU cores to use for parallelization.
:return: DataFrame with Pearson feature exposures by era for each feature.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/evaluation.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_feature_exposures_pearson</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">pred_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">feature_list</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">cpu_cores</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate feature exposures for each era using Pearson correlation.</span>

<span class="sd">    :param dataf: DataFrame containing predictions, features, and eras.</span>
<span class="sd">    :param pred_col: Prediction column to calculate feature exposures for.</span>
<span class="sd">    :param feature_list: List of feature columns in X.</span>
<span class="sd">    :param cpu_cores: Number of CPU cores to use for parallelization.</span>
<span class="sd">    :return: DataFrame with Pearson feature exposures by era for each feature.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">calculate_era_pearson_exposure</span><span class="p">(</span>
        <span class="n">era</span><span class="p">,</span> <span class="n">group</span><span class="p">,</span> <span class="n">feature_list</span><span class="p">,</span> <span class="n">pred_col_normalized</span>
    <span class="p">):</span>
        <span class="n">data_matrix</span> <span class="o">=</span> <span class="n">group</span><span class="p">[</span><span class="n">feature_list</span> <span class="o">+</span> <span class="p">[</span><span class="n">pred_col_normalized</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span>
        <span class="n">correlations</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">corrcoef</span><span class="p">(</span><span class="n">data_matrix</span><span class="p">,</span> <span class="n">rowvar</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Get the correlations of all features with the predictions (which is the last column)</span>
        <span class="n">feature_correlations</span> <span class="o">=</span> <span class="n">correlations</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">era</span><span class="p">,</span> <span class="n">feature_correlations</span>

    <span class="n">normalized_ranks</span> <span class="o">=</span> <span class="p">(</span><span class="n">dataf</span><span class="p">[[</span><span class="n">pred_col</span><span class="p">]]</span><span class="o">.</span><span class="n">rank</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;first&quot;</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">dataf</span><span class="p">)</span>
    <span class="n">dataf</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">pred_col</span><span class="si">}</span><span class="s2">_normalized&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">normalized_ranks</span><span class="p">)</span>
    <span class="n">feature_exposure_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
        <span class="n">index</span><span class="o">=</span><span class="n">dataf</span><span class="p">[</span><span class="s2">&quot;era&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">(),</span> <span class="n">columns</span><span class="o">=</span><span class="n">feature_list</span>
    <span class="p">)</span>

    <span class="n">grouped_data</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">dataf</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;era&quot;</span><span class="p">))</span>

    <span class="n">results</span> <span class="o">=</span> <span class="n">Parallel</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=</span><span class="n">cpu_cores</span><span class="p">)(</span>
        <span class="n">delayed</span><span class="p">(</span><span class="n">calculate_era_pearson_exposure</span><span class="p">)(</span>
            <span class="n">era</span><span class="p">,</span> <span class="n">group</span><span class="p">,</span> <span class="n">feature_list</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">pred_col</span><span class="si">}</span><span class="s2">_normalized&quot;</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">era</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">grouped_data</span>
    <span class="p">)</span>

    <span class="k">for</span> <span class="n">era</span><span class="p">,</span> <span class="n">feature_correlations</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
        <span class="n">feature_exposure_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">era</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">feature_correlations</span>
    <span class="k">return</span> <span class="n">feature_exposure_data</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="numerblox.evaluation.BaseEvaluator.legacy_contribution" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">legacy_contribution</span><span class="p">(</span><span class="n">dataf</span><span class="p">,</span> <span class="n">pred_col</span><span class="p">,</span> <span class="n">target_col</span><span class="p">,</span> <span class="n">other_col</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Legacy contibution mean, standard deviation and sharpe ratio.
More info: https://forum.numer.ai/t/mmc2-announcement/93</p>
<p>:param dataf: DataFrame containing era_col, pred_col, target_col and other_col.
:param pred_col: Prediction column to calculate MMC for.
:param target_col: Target column to calculate MMC against.
:param other_col: Meta model column containing predictions to neutralize against.</p>
<p>:return: List of legacy contribution scores by era.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/evaluation.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">legacy_contribution</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">pred_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">other_col</span><span class="p">:</span> <span class="nb">str</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Legacy contibution mean, standard deviation and sharpe ratio.</span>
<span class="sd">    More info: https://forum.numer.ai/t/mmc2-announcement/93</span>

<span class="sd">    :param dataf: DataFrame containing era_col, pred_col, target_col and other_col.</span>
<span class="sd">    :param pred_col: Prediction column to calculate MMC for.</span>
<span class="sd">    :param target_col: Target column to calculate MMC against.</span>
<span class="sd">    :param other_col: Meta model column containing predictions to neutralize against.</span>

<span class="sd">    :return: List of legacy contribution scores by era.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">legacy_mc_scores</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># Standard deviation of a uniform distribution</span>
    <span class="n">COVARIANCE_FACTOR</span> <span class="o">=</span> <span class="mf">0.29</span><span class="o">**</span><span class="mi">2</span>
    <span class="c1"># Calculate MMC for each era</span>
    <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">dataf</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">era_col</span><span class="p">):</span>
        <span class="n">series</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_neutralize_series</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_normalize_uniform</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">pred_col</span><span class="p">]),</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">other_col</span><span class="p">])</span>
        <span class="p">)</span>
        <span class="n">legacy_mc_scores</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">cov</span><span class="p">(</span><span class="n">series</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="n">target_col</span><span class="p">])[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">COVARIANCE_FACTOR</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">legacy_mc_scores</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="numerblox.evaluation.BaseEvaluator.max_drawdown" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">max_drawdown</span><span class="p">(</span><span class="n">era_corrs</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Maximum drawdown per era.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/evaluation.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">max_drawdown</span><span class="p">(</span><span class="n">era_corrs</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Maximum drawdown per era.&quot;&quot;&quot;</span>
    <span class="c1"># Arbitrarily large window</span>
    <span class="n">rolling_max</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">era_corrs</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">cumprod</span><span class="p">()</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="mi">9000</span><span class="p">,</span> <span class="n">min_periods</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="p">)</span>
    <span class="n">daily_value</span> <span class="o">=</span> <span class="p">(</span><span class="n">era_corrs</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">cumprod</span><span class="p">()</span>
    <span class="n">max_drawdown</span> <span class="o">=</span> <span class="o">-</span><span class="p">((</span><span class="n">rolling_max</span> <span class="o">-</span> <span class="n">daily_value</span><span class="p">)</span> <span class="o">/</span> <span class="n">rolling_max</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">max_drawdown</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="numerblox.evaluation.BaseEvaluator.max_feature_exposure" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">max_feature_exposure</span><span class="p">(</span><span class="n">dataf</span><span class="p">,</span> <span class="n">feature_cols</span><span class="p">,</span> <span class="n">pred_col</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Maximum exposure over all features.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/evaluation.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">max_feature_exposure</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">feature_cols</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">pred_col</span><span class="p">:</span> <span class="nb">str</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Maximum exposure over all features.&quot;&quot;&quot;</span>
    <span class="n">max_per_era</span> <span class="o">=</span> <span class="n">dataf</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">era_col</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
        <span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="n">d</span><span class="p">[</span><span class="n">feature_cols</span><span class="p">]</span><span class="o">.</span><span class="n">corrwith</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">pred_col</span><span class="p">])</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="p">)</span>
    <span class="n">max_feature_exposure</span> <span class="o">=</span> <span class="n">max_per_era</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">max_feature_exposure</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="numerblox.evaluation.BaseEvaluator.mean_std_sharpe" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">mean_std_sharpe</span><span class="p">(</span><span class="n">era_corrs</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Average, standard deviation and Sharpe ratio for
correlations per era.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/evaluation.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">mean_std_sharpe</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">era_corrs</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Average, standard deviation and Sharpe ratio for</span>
<span class="sd">    correlations per era.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">mean</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">era_corrs</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
    <span class="n">std</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">era_corrs</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">ddof</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
    <span class="n">sharpe</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="k">if</span> <span class="n">std</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">mean</span> <span class="o">/</span> <span class="n">std</span>
    <span class="k">return</span> <span class="n">mean</span><span class="p">,</span> <span class="n">std</span><span class="p">,</span> <span class="n">sharpe</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="numerblox.evaluation.BaseEvaluator.numerai_corr" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">numerai_corr</span><span class="p">(</span><span class="n">dataf</span><span class="p">,</span> <span class="n">pred_col</span><span class="p">,</span> <span class="n">target_col</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Computes 'Numerai Corr' aka 'Corrv2'.
More info: https://forum.numer.ai/t/target-cyrus-new-primary-target/6303</p>
<p>Assumes original target col as input (i.e. in [0, 1] range).</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/evaluation.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">numerai_corr</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">pred_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Computes &#39;Numerai Corr&#39; aka &#39;Corrv2&#39;.</span>
<span class="sd">    More info: https://forum.numer.ai/t/target-cyrus-new-primary-target/6303</span>

<span class="sd">    Assumes original target col as input (i.e. in [0, 1] range).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Rank and gaussianize predictions</span>
    <span class="n">ranked_preds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normalize_uniform</span><span class="p">(</span>
        <span class="n">dataf</span><span class="p">[</span><span class="n">pred_col</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.5</span><span class="p">),</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;average&quot;</span>
    <span class="p">)</span>
    <span class="n">gauss_ranked_preds</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">ranked_preds</span><span class="p">)</span>
    <span class="c1"># Center target from [0...1] to [-0.5...0.5] range</span>
    <span class="n">targets</span> <span class="o">=</span> <span class="n">dataf</span><span class="p">[</span><span class="n">target_col</span><span class="p">]</span>
    <span class="n">centered_target</span> <span class="o">=</span> <span class="n">targets</span> <span class="o">-</span> <span class="n">targets</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="c1"># Accentuate tails of predictions and targets</span>
    <span class="n">preds_p15</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">gauss_ranked_preds</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">gauss_ranked_preds</span><span class="p">)</span> <span class="o">**</span> <span class="mf">1.5</span>
    <span class="n">target_p15</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">centered_target</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">centered_target</span><span class="p">)</span> <span class="o">**</span> <span class="mf">1.5</span>
    <span class="c1"># Pearson correlation</span>
    <span class="n">corr</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">pearsonr</span><span class="p">(</span><span class="n">preds_p15</span><span class="p">,</span> <span class="n">target_p15</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">corr</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="numerblox.evaluation.BaseEvaluator.per_era_corrs" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">per_era_corrs</span><span class="p">(</span><span class="n">dataf</span><span class="p">,</span> <span class="n">pred_col</span><span class="p">,</span> <span class="n">target_col</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Correlation between prediction and target for each era.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/evaluation.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">per_era_corrs</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">pred_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Correlation between prediction and target for each era.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">dataf</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">era_col</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
        <span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normalize_uniform</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">pred_col</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.5</span><span class="p">))</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span>
            <span class="n">d</span><span class="p">[</span><span class="n">target_col</span><span class="p">]</span>
        <span class="p">)</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="numerblox.evaluation.BaseEvaluator.per_era_numerai_corrs" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">per_era_numerai_corrs</span><span class="p">(</span><span class="n">dataf</span><span class="p">,</span> <span class="n">pred_col</span><span class="p">,</span> <span class="n">target_col</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Numerai Corr between prediction and target for each era.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/evaluation.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">per_era_numerai_corrs</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">pred_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Numerai Corr between prediction and target for each era.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">dataf</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">era_col</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
        <span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">numerai_corr</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.5</span><span class="p">),</span> <span class="n">pred_col</span><span class="p">,</span> <span class="n">target_col</span><span class="p">)</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="numerblox.evaluation.BaseEvaluator.plot_correlations" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">plot_correlations</span><span class="p">(</span><span class="n">dataf</span><span class="p">,</span> <span class="n">pred_cols</span><span class="p">,</span> <span class="n">corr_cols</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">target_col</span><span class="o">=</span><span class="s1">&#39;target&#39;</span><span class="p">,</span> <span class="n">roll_mean</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Plot per era correlations over time.
:param dataf: DataFrame that contains at least all pred_cols, target_col and corr_cols.
:param pred_cols: List of prediction columns to calculate per era correlations for and plot.
:param corr_cols: Per era correlations already prepared to include in the plot.
This is optional for if you already have per era correlations prepared in your input dataf.
:param target_col: Target column name to compute per era correlations against.
:param roll_mean: How many eras should be averaged to compute a rolling score.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/evaluation.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span>
<span class="normal">907</span>
<span class="normal">908</span>
<span class="normal">909</span>
<span class="normal">910</span>
<span class="normal">911</span>
<span class="normal">912</span>
<span class="normal">913</span>
<span class="normal">914</span>
<span class="normal">915</span>
<span class="normal">916</span>
<span class="normal">917</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">plot_correlations</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">pred_cols</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">corr_cols</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;target&quot;</span><span class="p">,</span>
    <span class="n">roll_mean</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot per era correlations over time.</span>
<span class="sd">    :param dataf: DataFrame that contains at least all pred_cols, target_col and corr_cols.</span>
<span class="sd">    :param pred_cols: List of prediction columns to calculate per era correlations for and plot.</span>
<span class="sd">    :param corr_cols: Per era correlations already prepared to include in the plot.</span>
<span class="sd">    This is optional for if you already have per era correlations prepared in your input dataf.</span>
<span class="sd">    :param target_col: Target column name to compute per era correlations against.</span>
<span class="sd">    :param roll_mean: How many eras should be averaged to compute a rolling score.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">validation_by_eras</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
    <span class="c1"># Compute per era correlation for each prediction column.</span>
    <span class="k">for</span> <span class="n">pred_col</span> <span class="ow">in</span> <span class="n">pred_cols</span><span class="p">:</span>
        <span class="n">per_era_corrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">per_era_numerai_corrs</span><span class="p">(</span>
            <span class="n">dataf</span><span class="p">,</span> <span class="n">pred_col</span><span class="o">=</span><span class="n">pred_col</span><span class="p">,</span> <span class="n">target_col</span><span class="o">=</span><span class="n">target_col</span>
        <span class="p">)</span>
        <span class="n">validation_by_eras</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">pred_col</span><span class="p">]</span> <span class="o">=</span> <span class="n">per_era_corrs</span>

    <span class="c1"># Add prepared per era correlation if any.</span>
    <span class="k">if</span> <span class="n">corr_cols</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">corr_col</span> <span class="ow">in</span> <span class="n">corr_cols</span><span class="p">:</span>
            <span class="n">validation_by_eras</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">corr_col</span><span class="p">]</span> <span class="o">=</span> <span class="n">dataf</span><span class="p">[</span><span class="n">corr_col</span><span class="p">]</span>

    <span class="n">validation_by_eras</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">roll_mean</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
        <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;line&quot;</span><span class="p">,</span>
        <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span>
        <span class="n">ms</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
        <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Rolling Per Era Correlation Mean (rolling window size: </span><span class="si">{</span><span class="n">roll_mean</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>
        <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span>
        <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper center&quot;</span><span class="p">,</span>
        <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.05</span><span class="p">),</span>
        <span class="n">fancybox</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">shadow</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">ncol</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="n">validation_by_eras</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Cumulative Sum of Era Correlations&quot;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span>
        <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper center&quot;</span><span class="p">,</span>
        <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.05</span><span class="p">),</span>
        <span class="n">fancybox</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">shadow</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">ncol</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">return</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="numerblox.evaluation.BaseEvaluator.smart_sharpe" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">smart_sharpe</span><span class="p">(</span><span class="n">era_corrs</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Sharpe adjusted for autocorrelation.
:param era_corrs: Correlation scores by era</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/evaluation.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">smart_sharpe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">era_corrs</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Sharpe adjusted for autocorrelation.</span>
<span class="sd">    :param era_corrs: Correlation scores by era</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">era_corrs</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">nanstd</span><span class="p">(</span><span class="n">era_corrs</span><span class="p">,</span> <span class="n">ddof</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">autocorr_penalty</span><span class="p">(</span><span class="n">era_corrs</span><span class="p">)</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="numerblox.evaluation.BaseEvaluator.tbx_mean_std_sharpe" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">tbx_mean_std_sharpe</span><span class="p">(</span><span class="n">dataf</span><span class="p">,</span> <span class="n">pred_col</span><span class="p">,</span> <span class="n">target_col</span><span class="p">,</span> <span class="n">tb</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Calculate Mean, Standard deviation and Sharpe ratio
when we focus on the x top and x bottom predictions.
:param tb: How many of top and bottom predictions to focus on.
TB200 and TB500 are the most common situations.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/evaluation.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">tbx_mean_std_sharpe</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">pred_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">tb</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">200</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate Mean, Standard deviation and Sharpe ratio</span>
<span class="sd">    when we focus on the x top and x bottom predictions.</span>
<span class="sd">    :param tb: How many of top and bottom predictions to focus on.</span>
<span class="sd">    TB200 and TB500 are the most common situations.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tb_val_corrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_score_by_date</span><span class="p">(</span>
        <span class="n">dataf</span><span class="o">=</span><span class="n">dataf</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="n">pred_col</span><span class="p">],</span> <span class="n">target</span><span class="o">=</span><span class="n">target_col</span><span class="p">,</span> <span class="n">tb</span><span class="o">=</span><span class="n">tb</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean_std_sharpe</span><span class="p">(</span><span class="n">era_corrs</span><span class="o">=</span><span class="n">tb_val_corrs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>


</div>

<div class="doc doc-object doc-class">



<h2 id="numerblox.evaluation.NumeraiClassicEvaluator" class="doc doc-heading">
          <code>NumeraiClassicEvaluator</code>


</h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="numerblox.evaluation.BaseEvaluator" href="#numerblox.evaluation.BaseEvaluator">BaseEvaluator</a></code></p>

  
      <p>Evaluator for all metrics that are relevant in Numerai Classic.</p>

            <details class="quote">
              <summary>Source code in <code>numerblox/evaluation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 938</span>
<span class="normal"> 939</span>
<span class="normal"> 940</span>
<span class="normal"> 941</span>
<span class="normal"> 942</span>
<span class="normal"> 943</span>
<span class="normal"> 944</span>
<span class="normal"> 945</span>
<span class="normal"> 946</span>
<span class="normal"> 947</span>
<span class="normal"> 948</span>
<span class="normal"> 949</span>
<span class="normal"> 950</span>
<span class="normal"> 951</span>
<span class="normal"> 952</span>
<span class="normal"> 953</span>
<span class="normal"> 954</span>
<span class="normal"> 955</span>
<span class="normal"> 956</span>
<span class="normal"> 957</span>
<span class="normal"> 958</span>
<span class="normal"> 959</span>
<span class="normal"> 960</span>
<span class="normal"> 961</span>
<span class="normal"> 962</span>
<span class="normal"> 963</span>
<span class="normal"> 964</span>
<span class="normal"> 965</span>
<span class="normal"> 966</span>
<span class="normal"> 967</span>
<span class="normal"> 968</span>
<span class="normal"> 969</span>
<span class="normal"> 970</span>
<span class="normal"> 971</span>
<span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">NumeraiClassicEvaluator</span><span class="p">(</span><span class="n">BaseEvaluator</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Evaluator for all metrics that are relevant in Numerai Classic.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">era_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;era&quot;</span><span class="p">,</span>
        <span class="n">metrics_list</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">FAST_METRICS</span><span class="p">,</span>
        <span class="n">custom_functions</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">show_detailed_progress_bar</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="k">for</span> <span class="n">metric</span> <span class="ow">in</span> <span class="n">metrics_list</span><span class="p">:</span>
            <span class="k">assert</span> <span class="p">(</span>
                <span class="n">metric</span> <span class="ow">in</span> <span class="n">ALL_CLASSIC_METRICS</span>
            <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Metric &#39;</span><span class="si">{</span><span class="n">metric</span><span class="si">}</span><span class="s2">&#39; not found. Valid metrics: </span><span class="si">{</span><span class="n">ALL_CLASSIC_METRICS</span><span class="si">}</span><span class="s2">.&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">era_col</span><span class="o">=</span><span class="n">era_col</span><span class="p">,</span> <span class="n">metrics_list</span><span class="o">=</span><span class="n">metrics_list</span><span class="p">,</span> <span class="n">custom_functions</span><span class="o">=</span><span class="n">custom_functions</span><span class="p">,</span>
            <span class="n">show_detailed_progress_bar</span><span class="o">=</span><span class="n">show_detailed_progress_bar</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fncv3_features</span> <span class="o">=</span> <span class="n">FNCV3_FEATURES</span>

    <span class="k">def</span> <span class="nf">full_evaluation</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">pred_cols</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;target&quot;</span><span class="p">,</span>
        <span class="n">benchmark_cols</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="n">val_stats</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
        <span class="n">dataf</span> <span class="o">=</span> <span class="n">dataf</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">feature_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">dataf</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">col</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;feature&quot;</span><span class="p">)]</span>

        <span class="c1"># Check if sufficient columns are present in dataf to compute FNC</span>
        <span class="n">feature_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">dataf</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fncv3_features</span><span class="p">)</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="n">feature_set</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot;Using &#39;v4.2/features.json/fncv3_features&#39; feature set to calculate FNC metrics.&quot;</span>
            <span class="p">)</span>
            <span class="n">valid_features</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fncv3_features</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot;WARNING: No suitable feature set defined for FNC. Skipping calculation of FNC.&quot;</span>
            <span class="p">)</span>
            <span class="n">valid_features</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">with</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">pred_cols</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Evaluation&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">pbar</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">pbar</span><span class="p">:</span>
                <span class="c1"># Metrics that can be calculated for both Numerai Classic and Signals</span>
                <span class="n">col_stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluation_one_col</span><span class="p">(</span>
                    <span class="n">dataf</span><span class="o">=</span><span class="n">dataf</span><span class="p">,</span>
                    <span class="n">feature_cols</span><span class="o">=</span><span class="n">feature_cols</span><span class="p">,</span>
                    <span class="n">pred_col</span><span class="o">=</span><span class="n">col</span><span class="p">,</span>
                    <span class="n">target_col</span><span class="o">=</span><span class="n">target_col</span><span class="p">,</span>
                    <span class="n">benchmark_cols</span><span class="o">=</span><span class="n">benchmark_cols</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="c1"># Numerai Classic specific metrics</span>
                <span class="k">if</span> <span class="n">valid_features</span> <span class="ow">and</span> <span class="s2">&quot;fncv3_mean_std_sharpe&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metrics_list</span><span class="p">:</span>
                    <span class="n">pbar</span><span class="o">.</span><span class="n">set_description_str</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;fncv3_mean_std_sharpe for evaluation of &#39;</span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
                    <span class="c1"># Using only valid features defined in FNCV3_FEATURES</span>
                    <span class="n">fnc_v3</span><span class="p">,</span> <span class="n">fn_std_v3</span><span class="p">,</span> <span class="n">fn_sharpe_v3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_neutral_mean_std_sharpe</span><span class="p">(</span>
                        <span class="n">dataf</span><span class="o">=</span><span class="n">dataf</span><span class="p">,</span>
                        <span class="n">pred_col</span><span class="o">=</span><span class="n">col</span><span class="p">,</span>
                        <span class="n">target_col</span><span class="o">=</span><span class="n">target_col</span><span class="p">,</span>
                        <span class="n">feature_names</span><span class="o">=</span><span class="n">valid_features</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="n">col_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">col</span><span class="p">,</span> <span class="s2">&quot;feature_neutral_mean_v3&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fnc_v3</span>
                    <span class="n">col_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">col</span><span class="p">,</span> <span class="s2">&quot;feature_neutral_std_v3&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fn_std_v3</span>
                    <span class="n">col_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">col</span><span class="p">,</span> <span class="s2">&quot;feature_neutral_sharpe_v3&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fn_sharpe_v3</span>

                <span class="n">val_stats</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">val_stats</span><span class="p">,</span> <span class="n">col_stats</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">val_stats</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">











  </div>

  </div>


</div>

<div class="doc doc-object doc-class">



<h2 id="numerblox.evaluation.NumeraiSignalsEvaluator" class="doc doc-heading">
          <code>NumeraiSignalsEvaluator</code>


</h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="numerblox.evaluation.BaseEvaluator" href="#numerblox.evaluation.BaseEvaluator">BaseEvaluator</a></code></p>

  
      <p>Evaluator for all metrics that are relevant in Numerai Signals.</p>

            <details class="quote">
              <summary>Source code in <code>numerblox/evaluation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">NumeraiSignalsEvaluator</span><span class="p">(</span><span class="n">BaseEvaluator</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Evaluator for all metrics that are relevant in Numerai Signals.&quot;&quot;&quot;</span>
    <span class="c1"># Columns retrievable from Numerai Signals diagnostics.</span>
    <span class="c1"># More info: https://forum.numer.ai/t/signals-diagnostics-guide/5950</span>
    <span class="n">VALID_DIAGNOSTICS_COLS</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;validationCorrV4&quot;</span><span class="p">,</span> <span class="s2">&quot;validationFncV4&quot;</span><span class="p">,</span> <span class="s2">&quot;validationIcV2&quot;</span><span class="p">,</span> <span class="s2">&quot;validationRic&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">era_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;date&quot;</span><span class="p">,</span>
        <span class="n">metrics_list</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">FAST_METRICS</span><span class="p">,</span>
        <span class="n">custom_functions</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">show_detailed_progress_bar</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="k">for</span> <span class="n">metric</span> <span class="ow">in</span> <span class="n">metrics_list</span><span class="p">:</span>
            <span class="k">assert</span> <span class="p">(</span>
                <span class="n">metric</span> <span class="ow">in</span> <span class="n">ALL_SIGNALS_METRICS</span>
            <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Metric &#39;</span><span class="si">{</span><span class="n">metric</span><span class="si">}</span><span class="s2">&#39; not found. Valid metrics: </span><span class="si">{</span><span class="n">ALL_SIGNALS_METRICS</span><span class="si">}</span><span class="s2">.&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">era_col</span><span class="o">=</span><span class="n">era_col</span><span class="p">,</span> <span class="n">metrics_list</span><span class="o">=</span><span class="n">metrics_list</span><span class="p">,</span> <span class="n">custom_functions</span><span class="o">=</span><span class="n">custom_functions</span><span class="p">,</span>
            <span class="n">show_detailed_progress_bar</span><span class="o">=</span><span class="n">show_detailed_progress_bar</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_diagnostics</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">val_dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="n">Key</span><span class="p">,</span> <span class="n">timeout_min</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
        <span class="n">col</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;validationFncV4&quot;</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieved neutralized validation correlation by era. \n</span>
<span class="sd">        Calculated on Numerai servers. \n</span>
<span class="sd">        :param val_dataf: A DataFrame containing prediction, date, ticker and data_type columns. \n</span>
<span class="sd">        data_type column should contain &#39;validation&#39; instances. \n</span>
<span class="sd">        :param model_name: Any model name for which you have authentication credentials. \n</span>
<span class="sd">        :param key: Key object to authenticate upload of diagnostics. \n</span>
<span class="sd">        :param timeout_min: How many minutes to wait on diagnostics Computing on Numerai servers before timing out. \n</span>
<span class="sd">        :param col: Which column to return. Should be one of [&#39;validationCorrV4&#39;, &#39;validationFncV4&#39;, &#39;validationIcV2&#39;, &#39;validationRic&#39;]. If None, all columns will be returned. \n</span>
<span class="sd">        2 minutes by default. \n</span>
<span class="sd">        :return: Pandas Series with era as index and neutralized validation correlations (validationCorr).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">VALID_DIAGNOSTICS_COLS</span> <span class="ow">or</span> <span class="n">col</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;corr_col should be one of </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">VALID_DIAGNOSTICS_COLS</span><span class="si">}</span><span class="s2"> or None. Got: &#39;</span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
        <span class="n">api</span> <span class="o">=</span> <span class="n">SignalsAPI</span><span class="p">(</span><span class="n">public_id</span><span class="o">=</span><span class="n">key</span><span class="o">.</span><span class="n">pub_id</span><span class="p">,</span> <span class="n">secret_key</span><span class="o">=</span><span class="n">key</span><span class="o">.</span><span class="n">secret_key</span><span class="p">)</span>
        <span class="n">model_id</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">get_models</span><span class="p">()[</span><span class="n">model_name</span><span class="p">]</span>
        <span class="n">diagnostics_id</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">upload_diagnostics</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">val_dataf</span><span class="p">,</span> <span class="n">model_id</span><span class="o">=</span><span class="n">model_id</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__await_diagnostics</span><span class="p">(</span>
            <span class="n">api</span><span class="o">=</span><span class="n">api</span><span class="p">,</span>
            <span class="n">model_id</span><span class="o">=</span><span class="n">model_id</span><span class="p">,</span>
            <span class="n">diagnostics_id</span><span class="o">=</span><span class="n">diagnostics_id</span><span class="p">,</span>
            <span class="n">timeout_min</span><span class="o">=</span><span class="n">timeout_min</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">diagnostics_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;perEraDiagnostics&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;era&quot;</span><span class="p">)</span>
        <span class="n">diagnostics_df</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">diagnostics_df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        <span class="n">return_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="k">if</span> <span class="n">col</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">VALID_DIAGNOSTICS_COLS</span>
        <span class="k">return</span> <span class="n">diagnostics_df</span><span class="p">[</span><span class="n">return_cols</span><span class="p">]</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">__await_diagnostics</span><span class="p">(</span>
        <span class="n">api</span><span class="p">:</span> <span class="n">SignalsAPI</span><span class="p">,</span>
        <span class="n">model_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">diagnostics_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">timeout_min</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">interval_sec</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">15</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Wait for diagnostics to be uploaded.</span>
<span class="sd">        Try every &#39;interval_sec&#39; seconds until &#39;timeout_min&#39; minutes have passed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">timeout</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">+</span> <span class="mi">60</span> <span class="o">*</span> <span class="n">timeout_min</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;not_done&quot;</span><span class="p">}</span>
        <span class="k">while</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">timeout</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">diagnostics</span><span class="p">(</span><span class="n">model_id</span><span class="o">=</span><span class="n">model_id</span><span class="p">,</span> <span class="n">diagnostics_id</span><span class="o">=</span><span class="n">diagnostics_id</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;done&quot;</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Diagnostics not processed yet. Sleeping for another </span><span class="si">{</span><span class="n">interval_sec</span><span class="si">}</span><span class="s2"> seconds.&quot;</span>
                <span class="p">)</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">interval_sec</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">break</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;done&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Diagnostics couldn&#39;t be retrieved within </span><span class="si">{</span><span class="n">timeout_min</span><span class="si">}</span><span class="s2"> minutes after uploading. Check if Numerai API is offline.&quot;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">data</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">



<h3 id="numerblox.evaluation.NumeraiSignalsEvaluator.__await_diagnostics" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">__await_diagnostics</span><span class="p">(</span><span class="n">api</span><span class="p">,</span> <span class="n">model_id</span><span class="p">,</span> <span class="n">diagnostics_id</span><span class="p">,</span> <span class="n">timeout_min</span><span class="p">,</span> <span class="n">interval_sec</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Wait for diagnostics to be uploaded.
Try every 'interval_sec' seconds until 'timeout_min' minutes have passed.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/evaluation.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">__await_diagnostics</span><span class="p">(</span>
    <span class="n">api</span><span class="p">:</span> <span class="n">SignalsAPI</span><span class="p">,</span>
    <span class="n">model_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">diagnostics_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">timeout_min</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">interval_sec</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">15</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Wait for diagnostics to be uploaded.</span>
<span class="sd">    Try every &#39;interval_sec&#39; seconds until &#39;timeout_min&#39; minutes have passed.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">timeout</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">+</span> <span class="mi">60</span> <span class="o">*</span> <span class="n">timeout_min</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;not_done&quot;</span><span class="p">}</span>
    <span class="k">while</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">timeout</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">diagnostics</span><span class="p">(</span><span class="n">model_id</span><span class="o">=</span><span class="n">model_id</span><span class="p">,</span> <span class="n">diagnostics_id</span><span class="o">=</span><span class="n">diagnostics_id</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;done&quot;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Diagnostics not processed yet. Sleeping for another </span><span class="si">{</span><span class="n">interval_sec</span><span class="si">}</span><span class="s2"> seconds.&quot;</span>
            <span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">interval_sec</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">break</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;done&quot;</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Diagnostics couldn&#39;t be retrieved within </span><span class="si">{</span><span class="n">timeout_min</span><span class="si">}</span><span class="s2"> minutes after uploading. Check if Numerai API is offline.&quot;</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">data</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="numerblox.evaluation.NumeraiSignalsEvaluator.get_diagnostics" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_diagnostics</span><span class="p">(</span><span class="n">val_dataf</span><span class="p">,</span> <span class="n">model_name</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">timeout_min</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="s1">&#39;validationFncV4&#39;</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Retrieved neutralized validation correlation by era. </p>
<p>Calculated on Numerai servers. </p>
<p>:param val_dataf: A DataFrame containing prediction, date, ticker and data_type columns. </p>
<p>data_type column should contain 'validation' instances. </p>
<p>:param model_name: Any model name for which you have authentication credentials. </p>
<p>:param key: Key object to authenticate upload of diagnostics. </p>
<p>:param timeout_min: How many minutes to wait on diagnostics Computing on Numerai servers before timing out. </p>
<p>:param col: Which column to return. Should be one of ['validationCorrV4', 'validationFncV4', 'validationIcV2', 'validationRic']. If None, all columns will be returned. </p>
<p>2 minutes by default. </p>
<p>:return: Pandas Series with era as index and neutralized validation correlations (validationCorr).</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/evaluation.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_diagnostics</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">val_dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="n">Key</span><span class="p">,</span> <span class="n">timeout_min</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
    <span class="n">col</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;validationFncV4&quot;</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieved neutralized validation correlation by era. \n</span>
<span class="sd">    Calculated on Numerai servers. \n</span>
<span class="sd">    :param val_dataf: A DataFrame containing prediction, date, ticker and data_type columns. \n</span>
<span class="sd">    data_type column should contain &#39;validation&#39; instances. \n</span>
<span class="sd">    :param model_name: Any model name for which you have authentication credentials. \n</span>
<span class="sd">    :param key: Key object to authenticate upload of diagnostics. \n</span>
<span class="sd">    :param timeout_min: How many minutes to wait on diagnostics Computing on Numerai servers before timing out. \n</span>
<span class="sd">    :param col: Which column to return. Should be one of [&#39;validationCorrV4&#39;, &#39;validationFncV4&#39;, &#39;validationIcV2&#39;, &#39;validationRic&#39;]. If None, all columns will be returned. \n</span>
<span class="sd">    2 minutes by default. \n</span>
<span class="sd">    :return: Pandas Series with era as index and neutralized validation correlations (validationCorr).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">VALID_DIAGNOSTICS_COLS</span> <span class="ow">or</span> <span class="n">col</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;corr_col should be one of </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">VALID_DIAGNOSTICS_COLS</span><span class="si">}</span><span class="s2"> or None. Got: &#39;</span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
    <span class="n">api</span> <span class="o">=</span> <span class="n">SignalsAPI</span><span class="p">(</span><span class="n">public_id</span><span class="o">=</span><span class="n">key</span><span class="o">.</span><span class="n">pub_id</span><span class="p">,</span> <span class="n">secret_key</span><span class="o">=</span><span class="n">key</span><span class="o">.</span><span class="n">secret_key</span><span class="p">)</span>
    <span class="n">model_id</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">get_models</span><span class="p">()[</span><span class="n">model_name</span><span class="p">]</span>
    <span class="n">diagnostics_id</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">upload_diagnostics</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">val_dataf</span><span class="p">,</span> <span class="n">model_id</span><span class="o">=</span><span class="n">model_id</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__await_diagnostics</span><span class="p">(</span>
        <span class="n">api</span><span class="o">=</span><span class="n">api</span><span class="p">,</span>
        <span class="n">model_id</span><span class="o">=</span><span class="n">model_id</span><span class="p">,</span>
        <span class="n">diagnostics_id</span><span class="o">=</span><span class="n">diagnostics_id</span><span class="p">,</span>
        <span class="n">timeout_min</span><span class="o">=</span><span class="n">timeout_min</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">diagnostics_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;perEraDiagnostics&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;era&quot;</span><span class="p">)</span>
    <span class="n">diagnostics_df</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">diagnostics_df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
    <span class="n">return_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="k">if</span> <span class="n">col</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">VALID_DIAGNOSTICS_COLS</span>
    <span class="k">return</span> <span class="n">diagnostics_df</span><span class="p">[</span><span class="n">return_cols</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>


</div>




  </div>

  </div>

</div><hr />


<div class="doc doc-object doc-module">



<a id="numerblox.submission"></a>
  <div class="doc doc-contents first">

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="numerblox.submission.BaseSubmitter" class="doc doc-heading">
          <code>BaseSubmitter</code>


</h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="numerblox.download.BaseIO" href="#numerblox.download.BaseIO">BaseIO</a></code></p>

  
      <p>Basic functionality for submitting to Numerai. 
Uses numerapi under the hood.
More info: https://numerapi.readthedocs.io/ </p>
<p>:param directory_path: Directory to store and read submissions from. 
:param api: NumerAPI or SignalsAPI
:param max_retries: Maximum number of retries for uploading predictions to Numerai. 
:param sleep_time: Time to sleep between uploading retries.
:param fail_silently: Whether to skip uploading to Numerai without raising an error. 
Useful for if you are uploading many models in a loop and want to skip models that fail to upload.</p>

            <details class="quote">
              <summary>Source code in <code>numerblox/submission.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">BaseSubmitter</span><span class="p">(</span><span class="n">BaseIO</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Basic functionality for submitting to Numerai. </span>
<span class="sd">    Uses numerapi under the hood.</span>
<span class="sd">    More info: https://numerapi.readthedocs.io/ </span>

<span class="sd">    :param directory_path: Directory to store and read submissions from. </span>
<span class="sd">    :param api: NumerAPI or SignalsAPI</span>
<span class="sd">    :param max_retries: Maximum number of retries for uploading predictions to Numerai. </span>
<span class="sd">    :param sleep_time: Time to sleep between uploading retries.</span>
<span class="sd">    :param fail_silently: Whether to skip uploading to Numerai without raising an error. </span>
<span class="sd">    Useful for if you are uploading many models in a loop and want to skip models that fail to upload.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">api</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">NumerAPI</span><span class="p">,</span> <span class="n">SignalsAPI</span><span class="p">],</span> <span class="n">max_retries</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> 
                 <span class="n">sleep_time</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">fail_silently</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">directory_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">api</span> <span class="o">=</span> <span class="n">api</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_retries</span> <span class="o">=</span> <span class="n">max_retries</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sleep_time</span> <span class="o">=</span> <span class="n">sleep_time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fail_silently</span> <span class="o">=</span> <span class="n">fail_silently</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">save_csv</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">cols</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">],</span>
        <span class="o">*</span><span class="n">args</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        For Numerai Classic: Save index column + &#39;cols&#39; (targets) to CSV.</span>
<span class="sd">        For Numerai Signals: Save ticker, date, data_type and signal columns to CSV.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="o">...</span>

    <span class="k">def</span> <span class="nf">upload_predictions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Upload CSV file to Numerai for given model name.</span>
<span class="sd">        :param file_name: File name/path relative to directory_path.</span>
<span class="sd">        :param model_name: Lowercase raw model name (For example, &#39;integration_test&#39;).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">full_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dir</span> <span class="o">/</span> <span class="n">file_name</span><span class="p">)</span>
        <span class="n">model_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_model_id</span><span class="p">(</span><span class="n">model_name</span><span class="o">=</span><span class="n">model_name</span><span class="p">)</span>
        <span class="n">api_type</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">api_type</span><span class="si">}</span><span class="s2">: Uploading predictions from &#39;</span><span class="si">{</span><span class="n">full_path</span><span class="si">}</span><span class="s2">&#39; for model &#39;</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">&#39; (model_id=&#39;</span><span class="si">{</span><span class="n">model_id</span><span class="si">}</span><span class="s2">&#39;)&quot;</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">attempt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_retries</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">upload_predictions</span><span class="p">(</span>
                    <span class="n">file_path</span><span class="o">=</span><span class="n">full_path</span><span class="p">,</span> <span class="n">model_id</span><span class="o">=</span><span class="n">model_id</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
                <span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">api_type</span><span class="si">}</span><span class="s2"> submission of &#39;</span><span class="si">{</span><span class="n">full_path</span><span class="si">}</span><span class="s2">&#39; for &#39;</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">&#39; is successful!&quot;</span>
                <span class="p">)</span>
                <span class="k">return</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">attempt</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_retries</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># i.e. not the last attempt</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to upload &#39;</span><span class="si">{</span><span class="n">full_path</span><span class="si">}</span><span class="s2">&#39; for &#39;</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">&#39; to Numerai. Retrying in </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">sleep_time</span><span class="si">}</span><span class="s2"> seconds...&quot;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sleep_time</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fail_silently</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to upload&#39;</span><span class="si">{</span><span class="n">full_path</span><span class="si">}</span><span class="s2">&#39; for &#39;</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">&#39; to Numerai. Skipping...&quot;</span><span class="p">)</span>
                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to upload &#39;</span><span class="si">{</span><span class="n">full_path</span><span class="si">}</span><span class="s2">&#39; for &#39;</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">&#39; to Numerai after </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">max_retries</span><span class="si">}</span><span class="s2"> attempts.&quot;</span><span class="p">)</span>
                        <span class="k">raise</span> <span class="n">e</span>

    <span class="k">def</span> <span class="nf">full_submission</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">cols</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">],</span>
        <span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;submission.csv&#39;</span><span class="p">,</span>
        <span class="o">*</span><span class="n">args</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save DataFrame to csv and upload predictions through API.</span>

<span class="sd">        :param dataf: Main DataFrame containing `cols`.</span>
<span class="sd">        :param model_name: Lowercase Numerai model name.</span>
<span class="sd">        :param file_name: path to save model to relative to base directory.</span>
<span class="sd">        :param cols: Columns to be saved in submission file.</span>
<span class="sd">        1 prediction column for Numerai Classic.</span>
<span class="sd">        At least 1 prediction column and 1 ticker column for Numerai Signals.</span>
<span class="sd">        *args, **kwargs are passed to numerapi API.</span>
<span class="sd">        For example `version` argument in Numerai Classic submissions.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_csv</span><span class="p">(</span><span class="n">dataf</span><span class="o">=</span><span class="n">dataf</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="n">file_name</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="n">cols</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">upload_predictions</span><span class="p">(</span>
            <span class="n">file_name</span><span class="o">=</span><span class="n">file_name</span><span class="p">,</span> <span class="n">model_name</span><span class="o">=</span><span class="n">model_name</span><span class="p">,</span>
            <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">combine_csvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">csv_paths</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
                     <span class="n">aux_cols</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
                     <span class="n">era_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                     <span class="n">pred_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;prediction&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read in csv files and combine all predictions with a rank mean. \n</span>
<span class="sd">        Multi-target predictions will be averaged out. \n</span>
<span class="sd">        :param csv_paths: List of full paths to .csv prediction files. \n</span>
<span class="sd">        :param aux_cols: [&#39;id&#39;] for Numerai Classic. \n</span>
<span class="sd">        [&#39;ticker&#39;, &#39;last_friday&#39;, &#39;data_type&#39;], for example, with Numerai Signals. \n</span>
<span class="sd">        :param era_col: Column indicating era (&#39;era&#39; or &#39;last_friday&#39;). \n</span>
<span class="sd">        Will be used for Grouping the rank mean if given. Skip groupby if no era_col provided. \n</span>
<span class="sd">        :param pred_col: &#39;prediction&#39; for Numerai Classic and &#39;signal&#39; for Numerai Signals.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">all_datafs</span> <span class="o">=</span> <span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="n">aux_cols</span><span class="p">)</span> <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">csv_paths</span><span class="p">)]</span>
        <span class="n">final_dataf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">all_datafs</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s2">&quot;columns&quot;</span><span class="p">)</span>
        <span class="c1"># Remove issue of duplicate columns</span>
        <span class="n">numeric_cols</span> <span class="o">=</span> <span class="n">final_dataf</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">number</span><span class="p">)</span><span class="o">.</span><span class="n">columns</span>
        <span class="n">final_dataf</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="n">k</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">numeric_cols</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">numeric_cols</span><span class="p">)))},</span>
                           <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                           <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># Combine all numeric columns with rank mean</span>
        <span class="n">num_dataf</span> <span class="o">=</span> <span class="n">final_dataf</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">number</span><span class="p">)</span>
        <span class="n">num_dataf</span> <span class="o">=</span> <span class="n">num_dataf</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">era_col</span><span class="p">)</span> <span class="k">if</span> <span class="n">era_col</span> <span class="k">else</span> <span class="n">num_dataf</span>
        <span class="n">final_dataf</span><span class="p">[</span><span class="n">pred_col</span><span class="p">]</span> <span class="o">=</span> <span class="n">num_dataf</span><span class="o">.</span><span class="n">rank</span><span class="p">(</span><span class="n">pct</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;first&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">final_dataf</span><span class="p">[[</span><span class="n">pred_col</span><span class="p">]]</span>

    <span class="k">def</span> <span class="nf">_get_model_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get ID needed for prediction uploading.</span>
<span class="sd">        :param model_name: Raw lowercase model name</span>
<span class="sd">        of Numerai model that you have access to.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_model_mapping</span><span class="p">[</span><span class="n">model_name</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">get_model_mapping</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Mapping between raw model names and model IDs.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">get_models</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_check_value_range</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">cols</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Check if all predictions are in range (0...1). &quot;&quot;&quot;</span>
        <span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">cols</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cols</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">cols</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">dataf</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">between</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                <span class="n">min_val</span><span class="p">,</span> <span class="n">max_val</span> <span class="o">=</span> <span class="n">dataf</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">dataf</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Values must be between 0 and 1. </span><span class="se">\</span>
<span class="s2">Found min value of &#39;</span><span class="si">{</span><span class="n">min_val</span><span class="si">}</span><span class="s2">&#39; and max value of &#39;</span><span class="si">{</span><span class="n">max_val</span><span class="si">}</span><span class="s2">&#39; for column &#39;</span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
                <span class="p">)</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
            <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
            <span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;submission.csv&quot;</span><span class="p">,</span>
            <span class="n">cols</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;prediction&quot;</span><span class="p">,</span>
            <span class="o">*</span><span class="n">args</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The most common use case will be to create a CSV and submit it immediately after that.</span>
<span class="sd">        full_submission handles this.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">full_submission</span><span class="p">(</span>
            <span class="n">dataf</span><span class="o">=</span><span class="n">dataf</span><span class="p">,</span>
            <span class="n">file_name</span><span class="o">=</span><span class="n">file_name</span><span class="p">,</span>
            <span class="n">model_name</span><span class="o">=</span><span class="n">model_name</span><span class="p">,</span>
            <span class="n">cols</span><span class="o">=</span><span class="n">cols</span><span class="p">,</span>
            <span class="o">*</span><span class="n">args</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="numerblox.submission.BaseSubmitter.get_model_mapping" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_model_mapping</span><span class="p">:</span> <span class="nb">dict</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Mapping between raw model names and model IDs.</p>
  </div>

</div>




<div class="doc doc-object doc-function">



<h3 id="numerblox.submission.BaseSubmitter.__call__" class="doc doc-heading">
          <code class="highlight language-python"><span class="fm">__call__</span><span class="p">(</span><span class="n">dataf</span><span class="p">,</span> <span class="n">model_name</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="s1">&#39;submission.csv&#39;</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="s1">&#39;prediction&#39;</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>The most common use case will be to create a CSV and submit it immediately after that.
full_submission handles this.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/submission.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;submission.csv&quot;</span><span class="p">,</span>
        <span class="n">cols</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;prediction&quot;</span><span class="p">,</span>
        <span class="o">*</span><span class="n">args</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The most common use case will be to create a CSV and submit it immediately after that.</span>
<span class="sd">    full_submission handles this.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">full_submission</span><span class="p">(</span>
        <span class="n">dataf</span><span class="o">=</span><span class="n">dataf</span><span class="p">,</span>
        <span class="n">file_name</span><span class="o">=</span><span class="n">file_name</span><span class="p">,</span>
        <span class="n">model_name</span><span class="o">=</span><span class="n">model_name</span><span class="p">,</span>
        <span class="n">cols</span><span class="o">=</span><span class="n">cols</span><span class="p">,</span>
        <span class="o">*</span><span class="n">args</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="numerblox.submission.BaseSubmitter.combine_csvs" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">combine_csvs</span><span class="p">(</span><span class="n">csv_paths</span><span class="p">,</span> <span class="n">aux_cols</span><span class="p">,</span> <span class="n">era_col</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pred_col</span><span class="o">=</span><span class="s1">&#39;prediction&#39;</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Read in csv files and combine all predictions with a rank mean. </p>
<p>Multi-target predictions will be averaged out. </p>
<p>:param csv_paths: List of full paths to .csv prediction files. </p>
<p>:param aux_cols: ['id'] for Numerai Classic. </p>
<p>['ticker', 'last_friday', 'data_type'], for example, with Numerai Signals. </p>
<p>:param era_col: Column indicating era ('era' or 'last_friday'). </p>
<p>Will be used for Grouping the rank mean if given. Skip groupby if no era_col provided. </p>
<p>:param pred_col: 'prediction' for Numerai Classic and 'signal' for Numerai Signals.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/submission.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">combine_csvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">csv_paths</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
                 <span class="n">aux_cols</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
                 <span class="n">era_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">pred_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;prediction&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read in csv files and combine all predictions with a rank mean. \n</span>
<span class="sd">    Multi-target predictions will be averaged out. \n</span>
<span class="sd">    :param csv_paths: List of full paths to .csv prediction files. \n</span>
<span class="sd">    :param aux_cols: [&#39;id&#39;] for Numerai Classic. \n</span>
<span class="sd">    [&#39;ticker&#39;, &#39;last_friday&#39;, &#39;data_type&#39;], for example, with Numerai Signals. \n</span>
<span class="sd">    :param era_col: Column indicating era (&#39;era&#39; or &#39;last_friday&#39;). \n</span>
<span class="sd">    Will be used for Grouping the rank mean if given. Skip groupby if no era_col provided. \n</span>
<span class="sd">    :param pred_col: &#39;prediction&#39; for Numerai Classic and &#39;signal&#39; for Numerai Signals.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">all_datafs</span> <span class="o">=</span> <span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="n">aux_cols</span><span class="p">)</span> <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">csv_paths</span><span class="p">)]</span>
    <span class="n">final_dataf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">all_datafs</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s2">&quot;columns&quot;</span><span class="p">)</span>
    <span class="c1"># Remove issue of duplicate columns</span>
    <span class="n">numeric_cols</span> <span class="o">=</span> <span class="n">final_dataf</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">number</span><span class="p">)</span><span class="o">.</span><span class="n">columns</span>
    <span class="n">final_dataf</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="n">k</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">numeric_cols</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">numeric_cols</span><span class="p">)))},</span>
                       <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                       <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># Combine all numeric columns with rank mean</span>
    <span class="n">num_dataf</span> <span class="o">=</span> <span class="n">final_dataf</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">number</span><span class="p">)</span>
    <span class="n">num_dataf</span> <span class="o">=</span> <span class="n">num_dataf</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">era_col</span><span class="p">)</span> <span class="k">if</span> <span class="n">era_col</span> <span class="k">else</span> <span class="n">num_dataf</span>
    <span class="n">final_dataf</span><span class="p">[</span><span class="n">pred_col</span><span class="p">]</span> <span class="o">=</span> <span class="n">num_dataf</span><span class="o">.</span><span class="n">rank</span><span class="p">(</span><span class="n">pct</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;first&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">final_dataf</span><span class="p">[[</span><span class="n">pred_col</span><span class="p">]]</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="numerblox.submission.BaseSubmitter.full_submission" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">full_submission</span><span class="p">(</span><span class="n">dataf</span><span class="p">,</span> <span class="n">model_name</span><span class="p">,</span> <span class="n">cols</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="s1">&#39;submission.csv&#39;</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Save DataFrame to csv and upload predictions through API.</p>
<p>:param dataf: Main DataFrame containing <code>cols</code>.
:param model_name: Lowercase Numerai model name.
:param file_name: path to save model to relative to base directory.
:param cols: Columns to be saved in submission file.
1 prediction column for Numerai Classic.
At least 1 prediction column and 1 ticker column for Numerai Signals.
<em>args, </em>*kwargs are passed to numerapi API.
For example <code>version</code> argument in Numerai Classic submissions.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/submission.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">full_submission</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">cols</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">],</span>
    <span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;submission.csv&#39;</span><span class="p">,</span>
    <span class="o">*</span><span class="n">args</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Save DataFrame to csv and upload predictions through API.</span>

<span class="sd">    :param dataf: Main DataFrame containing `cols`.</span>
<span class="sd">    :param model_name: Lowercase Numerai model name.</span>
<span class="sd">    :param file_name: path to save model to relative to base directory.</span>
<span class="sd">    :param cols: Columns to be saved in submission file.</span>
<span class="sd">    1 prediction column for Numerai Classic.</span>
<span class="sd">    At least 1 prediction column and 1 ticker column for Numerai Signals.</span>
<span class="sd">    *args, **kwargs are passed to numerapi API.</span>
<span class="sd">    For example `version` argument in Numerai Classic submissions.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">save_csv</span><span class="p">(</span><span class="n">dataf</span><span class="o">=</span><span class="n">dataf</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="n">file_name</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="n">cols</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">upload_predictions</span><span class="p">(</span>
        <span class="n">file_name</span><span class="o">=</span><span class="n">file_name</span><span class="p">,</span> <span class="n">model_name</span><span class="o">=</span><span class="n">model_name</span><span class="p">,</span>
        <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="numerblox.submission.BaseSubmitter.save_csv" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">save_csv</span><span class="p">(</span><span class="n">dataf</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">cols</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>For Numerai Classic: Save index column + 'cols' (targets) to CSV.
For Numerai Signals: Save ticker, date, data_type and signal columns to CSV.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/submission.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="k">def</span> <span class="nf">save_csv</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">cols</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">],</span>
    <span class="o">*</span><span class="n">args</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    For Numerai Classic: Save index column + &#39;cols&#39; (targets) to CSV.</span>
<span class="sd">    For Numerai Signals: Save ticker, date, data_type and signal columns to CSV.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="numerblox.submission.BaseSubmitter.upload_predictions" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">upload_predictions</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">model_name</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Upload CSV file to Numerai for given model name.
:param file_name: File name/path relative to directory_path.
:param model_name: Lowercase raw model name (For example, 'integration_test').</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/submission.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">upload_predictions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Upload CSV file to Numerai for given model name.</span>
<span class="sd">    :param file_name: File name/path relative to directory_path.</span>
<span class="sd">    :param model_name: Lowercase raw model name (For example, &#39;integration_test&#39;).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">full_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dir</span> <span class="o">/</span> <span class="n">file_name</span><span class="p">)</span>
    <span class="n">model_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_model_id</span><span class="p">(</span><span class="n">model_name</span><span class="o">=</span><span class="n">model_name</span><span class="p">)</span>
    <span class="n">api_type</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">api_type</span><span class="si">}</span><span class="s2">: Uploading predictions from &#39;</span><span class="si">{</span><span class="n">full_path</span><span class="si">}</span><span class="s2">&#39; for model &#39;</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">&#39; (model_id=&#39;</span><span class="si">{</span><span class="n">model_id</span><span class="si">}</span><span class="s2">&#39;)&quot;</span>
    <span class="p">)</span>
    <span class="k">for</span> <span class="n">attempt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_retries</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">upload_predictions</span><span class="p">(</span>
                <span class="n">file_path</span><span class="o">=</span><span class="n">full_path</span><span class="p">,</span> <span class="n">model_id</span><span class="o">=</span><span class="n">model_id</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
            <span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">api_type</span><span class="si">}</span><span class="s2"> submission of &#39;</span><span class="si">{</span><span class="n">full_path</span><span class="si">}</span><span class="s2">&#39; for &#39;</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">&#39; is successful!&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">attempt</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_retries</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># i.e. not the last attempt</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to upload &#39;</span><span class="si">{</span><span class="n">full_path</span><span class="si">}</span><span class="s2">&#39; for &#39;</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">&#39; to Numerai. Retrying in </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">sleep_time</span><span class="si">}</span><span class="s2"> seconds...&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sleep_time</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fail_silently</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to upload&#39;</span><span class="si">{</span><span class="n">full_path</span><span class="si">}</span><span class="s2">&#39; for &#39;</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">&#39; to Numerai. Skipping...&quot;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to upload &#39;</span><span class="si">{</span><span class="n">full_path</span><span class="si">}</span><span class="s2">&#39; for &#39;</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">&#39; to Numerai after </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">max_retries</span><span class="si">}</span><span class="s2"> attempts.&quot;</span><span class="p">)</span>
                    <span class="k">raise</span> <span class="n">e</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>


</div>

<div class="doc doc-object doc-class">



<h2 id="numerblox.submission.NumerBaySubmitter" class="doc doc-heading">
          <code>NumerBaySubmitter</code>


</h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="numerblox.submission.BaseSubmitter" href="#numerblox.submission.BaseSubmitter">BaseSubmitter</a></code></p>

  
      <p>Submit to NumerBay to fulfill sale orders, in addition to submission to Numerai.</p>
<p>:param tournament_submitter: Base tournament submitter (NumeraiClassicSubmitter or NumeraiSignalsSubmitter). This submitter will use the same directory path.
:param upload_to_numerai: Whether to also submit to Numerai using the tournament submitter. Defaults to True, set to False to only upload to NumerBay.
:param numerbay_username: NumerBay username
:param numerbay_password: NumerBay password</p>

            <details class="quote">
              <summary>Source code in <code>numerblox/submission.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">NumerBaySubmitter</span><span class="p">(</span><span class="n">BaseSubmitter</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Submit to NumerBay to fulfill sale orders, in addition to submission to Numerai.</span>

<span class="sd">    :param tournament_submitter: Base tournament submitter (NumeraiClassicSubmitter or NumeraiSignalsSubmitter). This submitter will use the same directory path.</span>
<span class="sd">    :param upload_to_numerai: Whether to also submit to Numerai using the tournament submitter. Defaults to True, set to False to only upload to NumerBay.</span>
<span class="sd">    :param numerbay_username: NumerBay username</span>
<span class="sd">    :param numerbay_password: NumerBay password</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">tournament_submitter</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">NumeraiClassicSubmitter</span><span class="p">,</span> <span class="n">NumeraiSignalsSubmitter</span><span class="p">],</span>
                 <span class="n">upload_to_numerai</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                 <span class="n">numerbay_username</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">numerbay_password</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">directory_path</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">tournament_submitter</span><span class="o">.</span><span class="n">dir</span><span class="p">),</span> <span class="n">api</span><span class="o">=</span><span class="n">tournament_submitter</span><span class="o">.</span><span class="n">api</span><span class="p">,</span>
            <span class="n">max_retries</span><span class="o">=</span><span class="n">tournament_submitter</span><span class="o">.</span><span class="n">max_retries</span><span class="p">,</span> <span class="n">sleep_time</span><span class="o">=</span><span class="n">tournament_submitter</span><span class="o">.</span><span class="n">sleep_time</span><span class="p">,</span>
            <span class="n">fail_silently</span><span class="o">=</span><span class="n">tournament_submitter</span><span class="o">.</span><span class="n">fail_silently</span>
        <span class="p">)</span>
        <span class="kn">from</span> <span class="nn">numerbay</span> <span class="kn">import</span> <span class="n">NumerBay</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">numerbay_api</span> <span class="o">=</span> <span class="n">NumerBay</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="n">numerbay_username</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">numerbay_password</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tournament_submitter</span> <span class="o">=</span> <span class="n">tournament_submitter</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">upload_to_numerai</span> <span class="o">=</span> <span class="n">upload_to_numerai</span>

    <span class="k">def</span> <span class="nf">upload_predictions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                           <span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                           <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                           <span class="n">numerbay_product_full_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                           <span class="o">*</span><span class="n">args</span><span class="p">,</span>
                           <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Upload CSV file to NumerBay (and Numerai if &#39;upload_to_numerai&#39; is True) for given model name and NumerBay product full name.</span>
<span class="sd">        :param file_name: File name/path relative to directory_path.</span>
<span class="sd">        :param model_name: Lowercase raw model name (For example, &#39;integration_test&#39;).</span>
<span class="sd">        :param numerbay_product_full_name: NumerBay product full name in the format of [category]-[product name], e.g. &#39;numerai-predictions-numerbay&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">upload_to_numerai</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tournament_submitter</span><span class="o">.</span><span class="n">upload_predictions</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">model_name</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">full_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dir</span> <span class="o">/</span> <span class="n">file_name</span><span class="p">)</span>
        <span class="n">api_type</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">numerbay_api</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">api_type</span><span class="si">}</span><span class="s2">: Uploading predictions from &#39;</span><span class="si">{</span><span class="n">full_path</span><span class="si">}</span><span class="s2">&#39; for NumerBay product &#39;</span><span class="si">{</span><span class="n">numerbay_product_full_name</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
        <span class="p">)</span>
        <span class="n">artifact</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">numerbay_api</span><span class="o">.</span><span class="n">upload_artifact</span><span class="p">(</span>
            <span class="nb">str</span><span class="p">(</span><span class="n">full_path</span><span class="p">),</span> <span class="n">product_full_name</span><span class="o">=</span><span class="n">numerbay_product_full_name</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">artifact</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">api_type</span><span class="si">}</span><span class="s2"> submission of &#39;</span><span class="si">{</span><span class="n">full_path</span><span class="si">}</span><span class="s2">&#39; for NumerBay product [bold blue]</span><span class="si">{</span><span class="n">numerbay_product_full_name</span><span class="si">}</span><span class="s2"> is successful!&quot;</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;WARNING: Upload skipped for NumerBay product &#39;</span><span class="si">{</span><span class="n">numerbay_product_full_name</span><span class="si">}</span><span class="s2">&#39;, </span>
<span class="s2">                  the product uses buyer-side encryption but does not have any active sale order to upload for.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">full_submission</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">cols</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">],</span>
        <span class="n">numerbay_product_full_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;submission.csv&#39;</span><span class="p">,</span>
        <span class="o">*</span><span class="n">args</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save DataFrame to csv and upload predictions through API.</span>

<span class="sd">        :param dataf: Main DataFrame containing `cols`.</span>
<span class="sd">        :param model_name: Lowercase Numerai model name.</span>
<span class="sd">        :param numerbay_product_full_name: NumerBay product full name in the format of [category]-[product name], e.g. &#39;numerai-predictions-numerbay&#39;</span>
<span class="sd">        :param file_name: path to save model to relative to base directory.</span>
<span class="sd">        :param cols: Columns to be saved in submission file.</span>
<span class="sd">        1 prediction column for Numerai Classic.</span>
<span class="sd">        At least 1 prediction column and 1 ticker column for Numerai Signals.</span>
<span class="sd">        *args, **kwargs are passed to numerapi API.</span>
<span class="sd">        For example `version` argument in Numerai Classic submissions.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_csv</span><span class="p">(</span><span class="n">dataf</span><span class="o">=</span><span class="n">dataf</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="n">file_name</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="n">cols</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">upload_predictions</span><span class="p">(</span>
            <span class="n">file_name</span><span class="o">=</span><span class="n">file_name</span><span class="p">,</span> <span class="n">model_name</span><span class="o">=</span><span class="n">model_name</span><span class="p">,</span> <span class="n">numerbay_product_full_name</span><span class="o">=</span><span class="n">numerbay_product_full_name</span><span class="p">,</span>
            <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">combine_csvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tournament_submitter</span><span class="o">.</span><span class="n">combine_csvs</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">save_csv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tournament_submitter</span><span class="o">.</span><span class="n">save_csv</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">get_model_mapping</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tournament_submitter</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">get_models</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
            <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
            <span class="n">numerbay_product_full_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
            <span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;submission.csv&quot;</span><span class="p">,</span>
            <span class="n">cols</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;prediction&quot;</span><span class="p">,</span>
            <span class="o">*</span><span class="n">args</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The most common use case will be to create a CSV and submit it immediately after that.</span>
<span class="sd">        full_submission handles this.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">full_submission</span><span class="p">(</span>
            <span class="n">dataf</span><span class="o">=</span><span class="n">dataf</span><span class="p">,</span>
            <span class="n">file_name</span><span class="o">=</span><span class="n">file_name</span><span class="p">,</span>
            <span class="n">model_name</span><span class="o">=</span><span class="n">model_name</span><span class="p">,</span>
            <span class="n">numerbay_product_full_name</span><span class="o">=</span><span class="n">numerbay_product_full_name</span><span class="p">,</span>
            <span class="n">cols</span><span class="o">=</span><span class="n">cols</span><span class="p">,</span>
            <span class="o">*</span><span class="n">args</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">



<h3 id="numerblox.submission.NumerBaySubmitter.__call__" class="doc doc-heading">
          <code class="highlight language-python"><span class="fm">__call__</span><span class="p">(</span><span class="n">dataf</span><span class="p">,</span> <span class="n">model_name</span><span class="p">,</span> <span class="n">numerbay_product_full_name</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="s1">&#39;submission.csv&#39;</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="s1">&#39;prediction&#39;</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>The most common use case will be to create a CSV and submit it immediately after that.
full_submission handles this.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/submission.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">numerbay_product_full_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;submission.csv&quot;</span><span class="p">,</span>
        <span class="n">cols</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;prediction&quot;</span><span class="p">,</span>
        <span class="o">*</span><span class="n">args</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The most common use case will be to create a CSV and submit it immediately after that.</span>
<span class="sd">    full_submission handles this.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">full_submission</span><span class="p">(</span>
        <span class="n">dataf</span><span class="o">=</span><span class="n">dataf</span><span class="p">,</span>
        <span class="n">file_name</span><span class="o">=</span><span class="n">file_name</span><span class="p">,</span>
        <span class="n">model_name</span><span class="o">=</span><span class="n">model_name</span><span class="p">,</span>
        <span class="n">numerbay_product_full_name</span><span class="o">=</span><span class="n">numerbay_product_full_name</span><span class="p">,</span>
        <span class="n">cols</span><span class="o">=</span><span class="n">cols</span><span class="p">,</span>
        <span class="o">*</span><span class="n">args</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="numerblox.submission.NumerBaySubmitter.full_submission" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">full_submission</span><span class="p">(</span><span class="n">dataf</span><span class="p">,</span> <span class="n">model_name</span><span class="p">,</span> <span class="n">cols</span><span class="p">,</span> <span class="n">numerbay_product_full_name</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="s1">&#39;submission.csv&#39;</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Save DataFrame to csv and upload predictions through API.</p>
<p>:param dataf: Main DataFrame containing <code>cols</code>.
:param model_name: Lowercase Numerai model name.
:param numerbay_product_full_name: NumerBay product full name in the format of [category]-[product name], e.g. 'numerai-predictions-numerbay'
:param file_name: path to save model to relative to base directory.
:param cols: Columns to be saved in submission file.
1 prediction column for Numerai Classic.
At least 1 prediction column and 1 ticker column for Numerai Signals.
<em>args, </em>*kwargs are passed to numerapi API.
For example <code>version</code> argument in Numerai Classic submissions.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/submission.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">full_submission</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">cols</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">],</span>
    <span class="n">numerbay_product_full_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;submission.csv&#39;</span><span class="p">,</span>
    <span class="o">*</span><span class="n">args</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Save DataFrame to csv and upload predictions through API.</span>

<span class="sd">    :param dataf: Main DataFrame containing `cols`.</span>
<span class="sd">    :param model_name: Lowercase Numerai model name.</span>
<span class="sd">    :param numerbay_product_full_name: NumerBay product full name in the format of [category]-[product name], e.g. &#39;numerai-predictions-numerbay&#39;</span>
<span class="sd">    :param file_name: path to save model to relative to base directory.</span>
<span class="sd">    :param cols: Columns to be saved in submission file.</span>
<span class="sd">    1 prediction column for Numerai Classic.</span>
<span class="sd">    At least 1 prediction column and 1 ticker column for Numerai Signals.</span>
<span class="sd">    *args, **kwargs are passed to numerapi API.</span>
<span class="sd">    For example `version` argument in Numerai Classic submissions.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">save_csv</span><span class="p">(</span><span class="n">dataf</span><span class="o">=</span><span class="n">dataf</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="n">file_name</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="n">cols</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">upload_predictions</span><span class="p">(</span>
        <span class="n">file_name</span><span class="o">=</span><span class="n">file_name</span><span class="p">,</span> <span class="n">model_name</span><span class="o">=</span><span class="n">model_name</span><span class="p">,</span> <span class="n">numerbay_product_full_name</span><span class="o">=</span><span class="n">numerbay_product_full_name</span><span class="p">,</span>
        <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="numerblox.submission.NumerBaySubmitter.upload_predictions" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">upload_predictions</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">model_name</span><span class="p">,</span> <span class="n">numerbay_product_full_name</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Upload CSV file to NumerBay (and Numerai if 'upload_to_numerai' is True) for given model name and NumerBay product full name.
:param file_name: File name/path relative to directory_path.
:param model_name: Lowercase raw model name (For example, 'integration_test').
:param numerbay_product_full_name: NumerBay product full name in the format of [category]-[product name], e.g. 'numerai-predictions-numerbay'</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/submission.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">upload_predictions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                       <span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                       <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                       <span class="n">numerbay_product_full_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                       <span class="o">*</span><span class="n">args</span><span class="p">,</span>
                       <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Upload CSV file to NumerBay (and Numerai if &#39;upload_to_numerai&#39; is True) for given model name and NumerBay product full name.</span>
<span class="sd">    :param file_name: File name/path relative to directory_path.</span>
<span class="sd">    :param model_name: Lowercase raw model name (For example, &#39;integration_test&#39;).</span>
<span class="sd">    :param numerbay_product_full_name: NumerBay product full name in the format of [category]-[product name], e.g. &#39;numerai-predictions-numerbay&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">upload_to_numerai</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tournament_submitter</span><span class="o">.</span><span class="n">upload_predictions</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">model_name</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="n">full_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dir</span> <span class="o">/</span> <span class="n">file_name</span><span class="p">)</span>
    <span class="n">api_type</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">numerbay_api</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">api_type</span><span class="si">}</span><span class="s2">: Uploading predictions from &#39;</span><span class="si">{</span><span class="n">full_path</span><span class="si">}</span><span class="s2">&#39; for NumerBay product &#39;</span><span class="si">{</span><span class="n">numerbay_product_full_name</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
    <span class="p">)</span>
    <span class="n">artifact</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">numerbay_api</span><span class="o">.</span><span class="n">upload_artifact</span><span class="p">(</span>
        <span class="nb">str</span><span class="p">(</span><span class="n">full_path</span><span class="p">),</span> <span class="n">product_full_name</span><span class="o">=</span><span class="n">numerbay_product_full_name</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">artifact</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">api_type</span><span class="si">}</span><span class="s2"> submission of &#39;</span><span class="si">{</span><span class="n">full_path</span><span class="si">}</span><span class="s2">&#39; for NumerBay product [bold blue]</span><span class="si">{</span><span class="n">numerbay_product_full_name</span><span class="si">}</span><span class="s2"> is successful!&quot;</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;WARNING: Upload skipped for NumerBay product &#39;</span><span class="si">{</span><span class="n">numerbay_product_full_name</span><span class="si">}</span><span class="s2">&#39;, </span>
<span class="s2">              the product uses buyer-side encryption but does not have any active sale order to upload for.&quot;&quot;&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>


</div>

<div class="doc doc-object doc-class">



<h2 id="numerblox.submission.NumeraiClassicSubmitter" class="doc doc-heading">
          <code>NumeraiClassicSubmitter</code>


</h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="numerblox.submission.BaseSubmitter" href="#numerblox.submission.BaseSubmitter">BaseSubmitter</a></code></p>

  
      <p>Submit for Numerai Classic.</p>
<p>:param directory_path: Base directory to save and read prediction files from. </p>
<p>:param key: Key object containing valid credentials for Numerai Classic. </p>
<p>:param max_retries: Maximum number of retries for uploading predictions to Numerai. 
:param sleep_time: Time to sleep between uploading retries.
:param fail_silently: Whether to skip uploading to Numerai without raising an error. 
Useful for if you are uploading many models in a loop and want to skip models that fail to upload.
<em>args, </em>*kwargs will be passed to NumerAPI initialization.</p>

            <details class="quote">
              <summary>Source code in <code>numerblox/submission.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">NumeraiClassicSubmitter</span><span class="p">(</span><span class="n">BaseSubmitter</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Submit for Numerai Classic.</span>

<span class="sd">    :param directory_path: Base directory to save and read prediction files from. \n</span>
<span class="sd">    :param key: Key object containing valid credentials for Numerai Classic. \n</span>
<span class="sd">    :param max_retries: Maximum number of retries for uploading predictions to Numerai. </span>
<span class="sd">    :param sleep_time: Time to sleep between uploading retries.</span>
<span class="sd">    :param fail_silently: Whether to skip uploading to Numerai without raising an error. </span>
<span class="sd">    Useful for if you are uploading many models in a loop and want to skip models that fail to upload.</span>
<span class="sd">    *args, **kwargs will be passed to NumerAPI initialization.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="n">Key</span><span class="p">,</span> 
                 <span class="n">max_retries</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">sleep_time</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> 
                 <span class="n">fail_silently</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">api</span> <span class="o">=</span> <span class="n">NumerAPI</span><span class="p">(</span><span class="n">public_id</span><span class="o">=</span><span class="n">key</span><span class="o">.</span><span class="n">pub_id</span><span class="p">,</span> <span class="n">secret_key</span><span class="o">=</span><span class="n">key</span><span class="o">.</span><span class="n">secret_key</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">directory_path</span><span class="o">=</span><span class="n">directory_path</span><span class="p">,</span> <span class="n">api</span><span class="o">=</span><span class="n">api</span><span class="p">,</span>
            <span class="n">max_retries</span><span class="o">=</span><span class="n">max_retries</span><span class="p">,</span> <span class="n">sleep_time</span><span class="o">=</span><span class="n">sleep_time</span><span class="p">,</span> 
            <span class="n">fail_silently</span><span class="o">=</span><span class="n">fail_silently</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">save_csv</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
            <span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;submission.csv&quot;</span><span class="p">,</span>
            <span class="n">cols</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;prediction&#39;</span><span class="p">,</span>
            <span class="o">*</span><span class="n">args</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param dataf: DataFrame which should have at least the following columns:</span>
<span class="sd">        1. id (as index column)</span>
<span class="sd">        2. cols (for example, &#39;prediction_mymodel&#39;). Will be saved in &#39;prediction&#39; column</span>
<span class="sd">        :param file_name: .csv file path.</span>
<span class="sd">        :param cols: Prediction column name.</span>
<span class="sd">        For example, &#39;prediction&#39; or &#39;prediction_mymodel&#39;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sub_dataf</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">dataf</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_value_range</span><span class="p">(</span><span class="n">dataf</span><span class="o">=</span><span class="n">sub_dataf</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="n">cols</span><span class="p">)</span>

        <span class="n">full_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dir</span> <span class="o">/</span> <span class="n">file_name</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Saving predictions CSV to &#39;</span><span class="si">{</span><span class="n">full_path</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
        <span class="p">)</span>
        <span class="n">sub_dataf</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;prediction&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sub_dataf</span><span class="p">[</span><span class="n">cols</span><span class="p">]</span>
        <span class="n">sub_dataf</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;prediction&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">full_path</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">



<h3 id="numerblox.submission.NumeraiClassicSubmitter.save_csv" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">save_csv</span><span class="p">(</span><span class="n">dataf</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="s1">&#39;submission.csv&#39;</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="s1">&#39;prediction&#39;</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>:param dataf: DataFrame which should have at least the following columns:
1. id (as index column)
2. cols (for example, 'prediction_mymodel'). Will be saved in 'prediction' column
:param file_name: .csv file path.
:param cols: Prediction column name.
For example, 'prediction' or 'prediction_mymodel'.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/submission.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">save_csv</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;submission.csv&quot;</span><span class="p">,</span>
        <span class="n">cols</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;prediction&#39;</span><span class="p">,</span>
        <span class="o">*</span><span class="n">args</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param dataf: DataFrame which should have at least the following columns:</span>
<span class="sd">    1. id (as index column)</span>
<span class="sd">    2. cols (for example, &#39;prediction_mymodel&#39;). Will be saved in &#39;prediction&#39; column</span>
<span class="sd">    :param file_name: .csv file path.</span>
<span class="sd">    :param cols: Prediction column name.</span>
<span class="sd">    For example, &#39;prediction&#39; or &#39;prediction_mymodel&#39;.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sub_dataf</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">dataf</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_check_value_range</span><span class="p">(</span><span class="n">dataf</span><span class="o">=</span><span class="n">sub_dataf</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="n">cols</span><span class="p">)</span>

    <span class="n">full_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dir</span> <span class="o">/</span> <span class="n">file_name</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Saving predictions CSV to &#39;</span><span class="si">{</span><span class="n">full_path</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
    <span class="p">)</span>
    <span class="n">sub_dataf</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;prediction&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sub_dataf</span><span class="p">[</span><span class="n">cols</span><span class="p">]</span>
    <span class="n">sub_dataf</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;prediction&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">full_path</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>


</div>

<div class="doc doc-object doc-class">



<h2 id="numerblox.submission.NumeraiSignalsSubmitter" class="doc doc-heading">
          <code>NumeraiSignalsSubmitter</code>


</h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="numerblox.submission.BaseSubmitter" href="#numerblox.submission.BaseSubmitter">BaseSubmitter</a></code></p>

  
      <p>Submit for Numerai Signals.</p>
<p>:param directory_path: Base directory to save and read prediction files from. </p>
<p>:param key: Key object containing valid credentials for Numerai Signals. </p>
<p>:param max_retries: Maximum number of retries for uploading predictions to Numerai. 
:param sleep_time: Time to sleep between uploading retries.
:param fail_silently: Whether to skip uploading to Numerai without raising an error. 
Useful for if you are uploading many models in a loop and want to skip models that fail to upload.
<em>args, </em>*kwargs will be passed to SignalsAPI initialization.</p>

            <details class="quote">
              <summary>Source code in <code>numerblox/submission.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">NumeraiSignalsSubmitter</span><span class="p">(</span><span class="n">BaseSubmitter</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Submit for Numerai Signals.</span>

<span class="sd">    :param directory_path: Base directory to save and read prediction files from. \n</span>
<span class="sd">    :param key: Key object containing valid credentials for Numerai Signals. \n</span>
<span class="sd">    :param max_retries: Maximum number of retries for uploading predictions to Numerai. </span>
<span class="sd">    :param sleep_time: Time to sleep between uploading retries.</span>
<span class="sd">    :param fail_silently: Whether to skip uploading to Numerai without raising an error. </span>
<span class="sd">    Useful for if you are uploading many models in a loop and want to skip models that fail to upload.</span>
<span class="sd">    *args, **kwargs will be passed to SignalsAPI initialization.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="n">Key</span><span class="p">,</span> 
                 <span class="n">max_retries</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">sleep_time</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> 
                 <span class="n">fail_silently</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">api</span> <span class="o">=</span> <span class="n">SignalsAPI</span><span class="p">(</span>
            <span class="n">public_id</span><span class="o">=</span><span class="n">key</span><span class="o">.</span><span class="n">pub_id</span><span class="p">,</span> <span class="n">secret_key</span><span class="o">=</span><span class="n">key</span><span class="o">.</span><span class="n">secret_key</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">directory_path</span><span class="o">=</span><span class="n">directory_path</span><span class="p">,</span> <span class="n">api</span><span class="o">=</span><span class="n">api</span><span class="p">,</span>
            <span class="n">max_retries</span><span class="o">=</span><span class="n">max_retries</span><span class="p">,</span> <span class="n">sleep_time</span><span class="o">=</span><span class="n">sleep_time</span><span class="p">,</span>
            <span class="n">fail_silently</span><span class="o">=</span><span class="n">fail_silently</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">supported_ticker_formats</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;cusip&quot;</span><span class="p">,</span>
            <span class="s2">&quot;sedol&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ticker&quot;</span><span class="p">,</span>
            <span class="s2">&quot;numerai_ticker&quot;</span><span class="p">,</span>
            <span class="s2">&quot;bloomberg_ticker&quot;</span><span class="p">,</span>
        <span class="p">]</span>

    <span class="k">def</span> <span class="nf">save_csv</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
            <span class="n">cols</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
            <span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;submission.csv&quot;</span><span class="p">,</span>
            <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param dataf: DataFrame which should have at least the following columns:</span>
<span class="sd">         1. One of supported ticker formats (cusip, sedol, ticker, numerai_ticker or bloomberg_ticker)</span>
<span class="sd">         2. signal (Values between 0 and 1 (exclusive))</span>
<span class="sd">         Additional columns for if you include validation data (optional):</span>
<span class="sd">         3. date (YYYY-MM-DD format date indication)</span>
<span class="sd">         4. data_type (&#39;val&#39; and &#39;live&#39; partitions)</span>

<span class="sd">         :param cols: All cols that are saved in CSV.</span>
<span class="sd">         cols should contain at least 1 ticker column and a &#39;signal&#39; column.</span>
<span class="sd">         For example: [&#39;bloomberg_ticker&#39;, &#39;signal&#39;]</span>
<span class="sd">         :param file_name: .csv file path.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_ticker_format</span><span class="p">(</span><span class="n">cols</span><span class="o">=</span><span class="n">cols</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_value_range</span><span class="p">(</span><span class="n">dataf</span><span class="o">=</span><span class="n">dataf</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="s2">&quot;signal&quot;</span><span class="p">)</span>

        <span class="n">full_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dir</span> <span class="o">/</span> <span class="n">file_name</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Saving Signals predictions CSV to &#39;</span><span class="si">{</span><span class="n">full_path</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
        <span class="p">)</span>
        <span class="n">dataf</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">cols</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span>
            <span class="n">full_path</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_check_ticker_format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cols</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Check for valid ticker format. &quot;&quot;&quot;</span>
        <span class="n">valid_tickers</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">cols</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">supported_ticker_formats</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">valid_tickers</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;No supported ticker format in </span><span class="si">{</span><span class="n">cols</span><span class="si">}</span><span class="s2">). </span><span class="se">\</span>
<span class="s2">Supported: &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">supported_ticker_formats</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
            <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">



<h3 id="numerblox.submission.NumeraiSignalsSubmitter.save_csv" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">save_csv</span><span class="p">(</span><span class="n">dataf</span><span class="p">,</span> <span class="n">cols</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="s1">&#39;submission.csv&#39;</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>:param dataf: DataFrame which should have at least the following columns:
 1. One of supported ticker formats (cusip, sedol, ticker, numerai_ticker or bloomberg_ticker)
 2. signal (Values between 0 and 1 (exclusive))
 Additional columns for if you include validation data (optional):
 3. date (YYYY-MM-DD format date indication)
 4. data_type ('val' and 'live' partitions)</p>
<p>:param cols: All cols that are saved in CSV.
 cols should contain at least 1 ticker column and a 'signal' column.
 For example: ['bloomberg_ticker', 'signal']
 :param file_name: .csv file path.</p>

          <details class="quote">
            <summary>Source code in <code>numerblox/submission.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">save_csv</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">cols</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
        <span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;submission.csv&quot;</span><span class="p">,</span>
        <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param dataf: DataFrame which should have at least the following columns:</span>
<span class="sd">     1. One of supported ticker formats (cusip, sedol, ticker, numerai_ticker or bloomberg_ticker)</span>
<span class="sd">     2. signal (Values between 0 and 1 (exclusive))</span>
<span class="sd">     Additional columns for if you include validation data (optional):</span>
<span class="sd">     3. date (YYYY-MM-DD format date indication)</span>
<span class="sd">     4. data_type (&#39;val&#39; and &#39;live&#39; partitions)</span>

<span class="sd">     :param cols: All cols that are saved in CSV.</span>
<span class="sd">     cols should contain at least 1 ticker column and a &#39;signal&#39; column.</span>
<span class="sd">     For example: [&#39;bloomberg_ticker&#39;, &#39;signal&#39;]</span>
<span class="sd">     :param file_name: .csv file path.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_check_ticker_format</span><span class="p">(</span><span class="n">cols</span><span class="o">=</span><span class="n">cols</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_check_value_range</span><span class="p">(</span><span class="n">dataf</span><span class="o">=</span><span class="n">dataf</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="s2">&quot;signal&quot;</span><span class="p">)</span>

    <span class="n">full_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dir</span> <span class="o">/</span> <span class="n">file_name</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Saving Signals predictions CSV to &#39;</span><span class="si">{</span><span class="n">full_path</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
    <span class="p">)</span>
    <span class="n">dataf</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">cols</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span>
        <span class="n">full_path</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>


</div>




  </div>

  </div>

</div><hr />












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Made by CrowdCent
    </div>
  
  
</div>
      
        <div class="md-social">
  
    
    
    
    
    <a href="https://github.com/CrowdCent" target="_blank" rel="noopener" title="crowdcent on github" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
    
    
    
    
    <a href="https://twitter.com/CrowdCent" target="_blank" rel="noopener" title="crowdcent on twitter" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8l164.9-188.5L26.8 48h145.6l100.5 132.9L389.2 48zm-24.8 373.8h39.1L151.1 88h-42l255.3 333.8z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.top", "navigation.tracking", "navigation.expand", "navigation.path", "content.code.copy", "navigation.instant", "navigation.instant.prefetch", "navigation.sections"], "search": "../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.bd41221c.min.js"></script>
      
    
  </body>
</html>